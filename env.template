# apex bridge Configuration Template

# ==================== 服务器配置 ====================
PORT=8088
HOST=0.0.0.0
NODE_ENV=development
DEBUG_MODE=true

# ==================== 认证配置 ====================
# 节点认证密钥（用于WebSocket连接和节点间通信，ABP-only）
ABP_KEY=sk-intellicore-dev-20250101

# API密钥（用于客户端API认证，支持多个密钥用逗号分隔，ABP-only）
ABP_API_KEY=sk-intellicore-dev-20250101

# 自动启动服务器（true/false，默认: true）
# APEX_BRIDGE_AUTOSTART=true

# ==================== LLM提供商配置 ====================

# 默认使用的提供商 (openai | deepseek | zhipu | claude | ollama | custom)
LLM_DEFAULT_PROVIDER=deepseek

# --- OpenAI ---
# OPENAI_API_KEY=sk-your-openai-key
# OPENAI_BASE_URL=https://api.openai.com/v1
# OPENAI_DEFAULT_MODEL=gpt-4
# OPENAI_TIMEOUT=60000
# OPENAI_MAX_RETRIES=3

# --- DeepSeek ---
DEEPSEEK_API_KEY=sk-edcfe0c2c69e4c9f82ff60f16626022a
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
DEEPSEEK_DEFAULT_MODEL=deepseek-chat
DEEPSEEK_TIMEOUT=60000
DEEPSEEK_MAX_RETRIES=3

# --- 智谱AI (ChatGLM) ---
ZHIPU_API_KEY=a09450f4fe944a5688aa4ce4d517fcab.DcJLYgAgXOe9FDhM
ZHIPU_MODE=coding                    # 模式: default (默认) | coding (Coding套餐)
ZHIPU_BASE_URL=                       # 可选：自定义URL（优先级高于MODE）
ZHIPU_DEFAULT_MODEL=GLM-4.6
ZHIPU_TIMEOUT=60000
ZHIPU_MAX_RETRIES=3
#
# 说明:
# - default模式: https://open.bigmodel.cn/api/paas/v4 (普通套餐)
# - coding模式:  https://open.bigmodel.cn/api/coding/paas/v4 (Coding套餐)
# - 如果设置了ZHIPU_BASE_URL，将忽略ZHIPU_MODE

# --- Claude (Anthropic) ---
# CLAUDE_API_KEY=sk-ant-your-claude-key
# CLAUDE_BASE_URL=https://api.anthropic.com/v1
# CLAUDE_DEFAULT_MODEL=claude-3-5-sonnet-20241022
# CLAUDE_TIMEOUT=60000
# CLAUDE_MAX_RETRIES=3

# --- Ollama (本地部署) ---
# OLLAMA_BASE_URL=http://localhost:11434/v1
# OLLAMA_DEFAULT_MODEL=llama3
# OLLAMA_TIMEOUT=120000
# OLLAMA_MAX_RETRIES=2

# --- 自定义OpenAI兼容提供商 ---
# CUSTOM_API_KEY=your-custom-api-key
# CUSTOM_BASE_URL=http://localhost:8080/v1
# CUSTOM_DEFAULT_MODEL=custom-model
# CUSTOM_TIMEOUT=60000
# CUSTOM_MAX_RETRIES=3

# ==================== 插件配置 ====================
PLUGIN_DIR=./plugins
PLUGIN_AUTO_LOAD=true

# ==================== 日志配置 ====================
LOG_LEVEL=info
LOG_FILE=./logs/intellicore.log

# ==================== 性能配置 ====================
WORKER_POOL_SIZE=4
REQUEST_TIMEOUT=60000
MAX_REQUEST_SIZE=50mb

# ==================== 缓存配置（可选）====================
# REDIS_ENABLED=false
# REDIS_HOST=localhost
# REDIS_PORT=6379
# REDIS_PASSWORD=
# REDIS_DB=0

# ==================== 异步结果清理配置 ====================
# 是否启用自动清理 (true/false，默认: true)
ASYNC_RESULT_CLEANUP_ENABLED=true

# 最大保留天数（默认: 7天）
ASYNC_RESULT_MAX_AGE_DAYS=7

# 清理间隔天数（默认: 1天，即每天执行一次）
ASYNC_RESULT_CLEANUP_INTERVAL_DAYS=1

# 清理策略 (directory: 按目录清理 | file: 按文件清理，默认: directory)
ASYNC_RESULT_CLEANUP_STRATEGY=directory

# 搜索范围限制天数（默认: 30天，占位符解析时最多搜索最近30天）
ASYNC_RESULT_SEARCH_DAYS_LIMIT=30

# ==================== RAG配置(可选) ====================
# 启用RAG服务（必需，否则MemoryService无法创建）
# 
# 统一配置风格：仅使用扁平格式（标准.env格式）
RAG_ENABLED=true
RAG_STORAGE_PATH=./vector_store
RAG_VECTORIZER_BASE_URL=https://api.siliconflow.cn/v1
# 兼容旧字段：RAG_VECTORIZER_API_URL
# 或使用OpenAI: https://api.openai.com/v1/embeddings
# 或使用兼容端: http://127.0.0.1:11434/v1
RAG_VECTORIZER_API_KEY=your_embedding_api_key
RAG_VECTORIZER_MODEL=Qwen/Qwen3-Embedding-4B
# 或使用: text-embedding-3-small
RAG_VECTORIZER_DIMENSIONS=2560
# 模型维度: large=3072, small=1536, Qwen3-Embedding-4B=2560
# RAG_VECTORIZER_BATCH=32
# RAG_VECTORIZER_TIMEOUT=30000
# RAG_VECTORIZER_PROVIDER=openai

# ==================== Memory Service配置 ====================
# 记忆系统类型 (rag | memory)
# rag: 使用RAG模式（默认）
# memory: 使用apex-memory服务（后续实现）
MEMORY_SYSTEM=rag

# MemoryService运行时验证（可选）
# 设置为true时，启动时会自动验证MemoryService功能
VERIFY_MEMORY_SERVICE=false

# RAG 默认模式 (basic | time | group | rerank，默认: basic)
RAG_DEFAULT_MODE=basic

# RAG 默认召回数量 K（默认: 5）
RAG_DEFAULT_K=5

# RAG 最大召回数量限制（默认: 20）
RAG_MAX_K=20

# RAG 最大乘数限制（默认: 5.0）
RAG_MAX_MULTIPLIER=5.0

# 语义相似度权重（0-1，默认: 0.7）
RAG_SEMANTIC_WEIGHT=0.7

# 时间相关性权重（0-1，默认: 0.3，仅time模式生效）
RAG_TIME_WEIGHT=0.3

# 语义组配置文件路径（默认: ./config/semantic_groups.json）
SEMANTIC_GROUP_CONFIG=./config/semantic_groups.json

# 语义组权重（0-1，默认: 0.5，组向量融合权重）
SEMANTIC_GROUP_WEIGHT=0.5

# Rerank 是否启用（true/false，默认: false）
RERANK_ENABLED=false

# Rerank Base URL（例如: https://api.cohere.ai/v1）
RERANK_BASE_URL=https://api.siliconflow.cn/v1 
# 兼容旧字段：RERANK_API_URL

# Rerank API Key
RERANK_API_KEY=sk-gyhahquvzizscnxjidcrgbnrhagynisltnwrvssxwkdnlnit

# Rerank 模型（默认: rerank-english-v2.0）
RERANK_MODEL=Qwen/Qwen3-Reranker-8B

# Rerank 超量获取倍数（默认: 2.0，检索 K*2 个结果后重排）
RERANK_MULTIPLIER=2.0

# Rerank 超时时间（毫秒，默认: 5000）
RERANK_TIMEOUT=5000

# Tag 权重配置文件路径（默认: ./config/rag_tags.json）
RAG_TAGS_CONFIG=./config/rag_tags.json

# 全局相似度阈值（0-1，默认: 0.6）
RAG_SIMILARITY_THRESHOLD=0.6

# 日记归档时间
DIARY_ARCHIVE_AFTER_DAYS=0

#自动验证(记忆系统接口预留)
VERIFY_MEMORY_SERVICE=true

# ==================== 管理端控制 ====================
# 设为 true 时，偏好写操作需要管理员角色（后端通过 req.user.role 或请求头 x-admin-role 检查）
APEX_REQUIRE_ADMIN=true