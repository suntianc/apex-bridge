# çŒœæ‹³æ¸¸æˆ

## æè¿°

ç»å…¸çŸ³å¤´å‰ªåˆ€å¸ƒï¼Œä¸ AI å¯¹æˆ˜ï¼Œæ”¯æŒå•å±€å’Œä¸‰å±€ä¸¤èƒœæ¨¡å¼ã€‚

## å‚æ•°

- `player` (string): ç©å®¶å‡ºæ‹³ï¼Œå¯ä½¿ç”¨ä¸­è‹±æ–‡ã€‚å¿…å¡«ã€‚
- `mode` (string): `single` æˆ– `best-of-3`ï¼Œé»˜è®¤ `single`ã€‚

## ä»£ç 

```typescript
type Gesture = 'rock' | 'paper' | 'scissors';
type Outcome = 'win' | 'lose' | 'draw';

const gestureMap: Record<string, Gesture> = {
  rock: 'rock',
  stone: 'rock',
  'çŸ³å¤´': 'rock',
  'çŸ³': 'rock',
  paper: 'paper',
  'å¸ƒ': 'paper',
  scissors: 'scissors',
  scissor: 'scissors',
  'å‰ªåˆ€': 'scissors',
  'å‰ª': 'scissors'
};

function normalizeGesture(input?: string): Gesture | null {
  if (!input) {
    return null;
  }
  return gestureMap[input.toLowerCase().trim()] ?? null;
}

function aiChoice(): Gesture {
  const choices: Gesture[] = ['rock', 'paper', 'scissors'];
  return choices[Math.floor(Math.random() * choices.length)];
}

function judge(player: Gesture, ai: Gesture): Outcome {
  if (player === ai) {
    return 'draw';
  }
  const winPairs: Record<Gesture, Gesture> = {
    rock: 'scissors',
    scissors: 'paper',
    paper: 'rock'
  };
  return winPairs[player] === ai ? 'win' : 'lose';
}

function playRound(player: Gesture): { player: Gesture; ai: Gesture; outcome: Outcome } {
  const ai = aiChoice();
  return {
    player,
    ai,
    outcome: judge(player, ai)
  };
}

function playSeries(player: Gesture): { rounds: Array<{ player: Gesture; ai: Gesture; outcome: Outcome }>; summary: string } {
  const rounds: Array<{ player: Gesture; ai: Gesture; outcome: Outcome }> = [];
  let playerWins = 0;
  let aiWins = 0;

  for (let i = 0; i < 3; i++) {
    const round = playRound(i === 0 ? player : aiChoice());
    rounds.push(round);
    if (round.outcome === 'win') {
      playerWins += 1;
    } else if (round.outcome === 'lose') {
      aiWins += 1;
    }
    if (playerWins === 2 || aiWins === 2) {
      break;
    }
  }

  const summary =
    playerWins === aiWins
      ? 'ä¸¤ä½é€‰æ‰‹å¹³åˆ†ç§‹è‰²'
      : playerWins > aiWins
        ? 'ç©å®¶åœ¨ä¸‰å±€ä¸¤èƒœä¸­è·èƒœ'
        : 'AI åœ¨ä¸‰å±€ä¸¤èƒœä¸­è·èƒœ';

  return { rounds, summary };
}

export async function execute(params: Record<string, unknown>): Promise<unknown> {
  const playerGesture = normalizeGesture(typeof params.player === 'string' ? params.player : '');
  if (!playerGesture) {
    return {
      success: false,
      error: 'ç¼ºå°‘å¿…éœ€å‚æ•° playerï¼Œæˆ–æ‰‹åŠ¿æ— æ³•è¯†åˆ«'
    };
  }

  const mode = typeof params.mode === 'string' ? params.mode.toLowerCase() : 'single';

  if (mode === 'best-of-3') {
    const { rounds, summary } = playSeries(playerGesture);
    return {
      success: true,
      mode: 'best-of-3',
      rounds,
      summary
    };
  }

  const round = playRound(playerGesture);
  const messages: Record<Outcome, string> = {
    win: 'ğŸ‰ æ­å–œï¼ä½ èµ¢äº†ï¼',
    lose: 'ğŸ˜¢ å¾ˆé—æ†¾ï¼Œè¿™å±€è¾“äº†ã€‚',
    draw: 'ğŸ¤ å¹³å±€ï¼Œå†æ¥ä¸€å±€ï¼Ÿ'
  };

  return {
    success: true,
    mode: 'single',
    round,
    message: messages[round.outcome]
  };
}
```
