# EmotionEngine æ‰‹åŠ¨éªŒè¯æŒ‡å—

> **æ¨¡å—**: M1.2 - æƒ…æ„Ÿå¼•æ“åŸºç¡€  
> **æµ‹è¯•æ—¥æœŸ**: 2025-01-20

## ğŸ“‹ éªŒè¯å‡†å¤‡

### 1. å¯åŠ¨æœåŠ¡å™¨

```bash
cd apex-bridge
npm run dev
# æˆ–
npm start
```

### 2. æ£€æŸ¥æ—¥å¿—è¾“å‡º

å¯åŠ¨ååº”è¯¥çœ‹åˆ°ï¼š
```
âœ… EmotionEngine initialized
âœ… EmotionEngine initialized with templates
âœ… Loaded emotion templates: 6 default, 3 personality-specific
```

---

## ğŸ§ª éªŒè¯æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•1: å¿«é€Ÿæ¨¡å¼æƒ…æ„Ÿè¯†åˆ«ï¼ˆå…³é”®è¯åŒ¹é…ï¼‰

**ç›®æ ‡**: éªŒè¯å¿«é€Ÿæ¨¡å¼èƒ½å¿«é€Ÿè¯†åˆ«å¸¸è§æƒ…æ„Ÿå…³é”®è¯

**æµ‹è¯•æ­¥éª¤**:
```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "messages": [
      {"role": "user", "content": "æˆ‘ä»Šå¤©å¾ˆå¼€å¿ƒï¼"}
    ],
    "agent_id": "default",
    "model": "deepseek-chat"
  }'
```

**é¢„æœŸç»“æœ**:
- æ—¥å¿—æ˜¾ç¤º: `ğŸ’­ Detected emotion: happy`
- å¿«é€Ÿæ¨¡å¼è¯†åˆ«ï¼ˆ< 10msï¼‰
- AIå›å¤åº”è¯¥ä½“ç°å¼€å¿ƒæƒ…ç»ª

**æµ‹è¯•å…³é”®è¯**:
- `"æˆ‘å¾ˆå¼€å¿ƒ"` â†’ åº”è¯†åˆ«ä¸º `happy`
- `"æˆ‘å¾ˆéš¾è¿‡"` â†’ åº”è¯†åˆ«ä¸º `sad`
- `"æˆ‘å¾ˆç”Ÿæ°”"` â†’ åº”è¯†åˆ«ä¸º `angry`
- `"å¤ªå…´å¥‹äº†"` â†’ åº”è¯†åˆ«ä¸º `excited`
- `"å¾ˆæ‹…å¿ƒ"` â†’ åº”è¯†åˆ«ä¸º `anxious`

---

### æµ‹è¯•2: LLMæ¨¡å¼æƒ…æ„Ÿè¯†åˆ«ï¼ˆå¤æ‚è¡¨è¾¾ï¼‰

**ç›®æ ‡**: éªŒè¯LLMèƒ½è¯†åˆ«å¤æ‚çš„æƒ…æ„Ÿè¡¨è¾¾

**æµ‹è¯•æ­¥éª¤**:
```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "messages": [
      {"role": "user", "content": "ä»Šå¤©å·¥ä½œé¡ºåˆ©å®Œæˆï¼Œé¡¹ç›®è·å¾—äº†è®¤å¯ï¼Œæ„Ÿè§‰éå¸¸æ»¡è¶³å’Œå……å®"}
    ],
    "agent_id": "default",
    "model": "deepseek-chat"
  }'
```

**é¢„æœŸç»“æœ**:
- æ—¥å¿—æ˜¾ç¤º: `ğŸ’­ Detected emotion: happy` æˆ– `excited`
- LLMæ¨¡å¼è¯†åˆ«ï¼ˆå¯èƒ½éœ€è¦è°ƒç”¨LLMï¼‰
- AIå›å¤ä½“ç°æ­£é¢æƒ…ç»ª

**å¤æ‚è¡¨è¾¾æµ‹è¯•**:
- `"è™½ç„¶é‡åˆ°äº†ä¸€äº›å›°éš¾ï¼Œä½†æˆ‘æ²¡æœ‰æ”¾å¼ƒï¼Œæœ€ç»ˆæˆåŠŸäº†"` â†’ åº”è¯†åˆ«ä¸º `happy` æˆ– `excited`
- `"æœ€è¿‘å‹åŠ›å¾ˆå¤§ï¼Œæ€»æ˜¯æ‹…å¿ƒåšä¸å¥½"` â†’ åº”è¯†åˆ«ä¸º `anxious` æˆ– `sad`
- `"è¿™ä¸ªå†³å®šè®©æˆ‘å¾ˆçº ç»“ï¼Œä¸çŸ¥é“è¯¥æ€ä¹ˆåŠ"` â†’ åº”è¯†åˆ«ä¸º `anxious`

---

### æµ‹è¯•3: äººæ ¼åŒ–å…±æƒ…å“åº”ï¼ˆæ¸©æš–ä¼™ä¼´ï¼‰

**ç›®æ ‡**: éªŒè¯ä¸åŒäººæ ¼å¯¹åŒä¸€æƒ…æ„Ÿæœ‰ä¸åŒçš„å“åº”é£æ ¼

**æµ‹è¯•æ­¥éª¤**:
```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "messages": [
      {"role": "user", "content": "æˆ‘å¾ˆéš¾è¿‡"}
    ],
    "agent_id": "æ¸©æš–ä¼™ä¼´",
    "model": "deepseek-chat"
  }'
```

**é¢„æœŸç»“æœ**:
- æ—¥å¿—æ˜¾ç¤º: `ğŸ’­ Detected emotion: sad`
- æ—¥å¿—æ˜¾ç¤º: `ğŸ’ Injected empathetic response for sad`
- AIå›å¤åº”è¯¥ï¼š
  - ç§°å‘¼ç”¨æˆ·ä¸º"çˆ¸çˆ¸"
  - è¯­æ°”æ¸©æš–ã€å®‰æ…°
  - ä½¿ç”¨è¾ƒå¤šè¡¨æƒ…ç¬¦å·ï¼ˆğŸŒ¸ã€ğŸ’™ç­‰ï¼‰
  - ä½“ç°"å°æ‚¦"çš„æ¸©æš–é£æ ¼

**éªŒè¯è¦ç‚¹**:
- æ£€æŸ¥System Promptä¸­æ˜¯å¦åŒ…å«: `ç”¨æˆ·å½“å‰æƒ…ç»ªï¼šsadã€‚çˆ¸çˆ¸åˆ«éš¾è¿‡...`
- æ£€æŸ¥å›å¤æ˜¯å¦åŒ…å«æ¸©æš–çš„è¯è¯­

---

### æµ‹è¯•4: äººæ ¼åŒ–å…±æƒ…å“åº”ï¼ˆä¸“ä¸šåŠ©æ‰‹ï¼‰

**ç›®æ ‡**: éªŒè¯ä¸“ä¸šäººæ ¼çš„å“åº”é£æ ¼

**æµ‹è¯•æ­¥éª¤**:
```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "messages": [
      {"role": "user", "content": "æˆ‘å¾ˆéš¾è¿‡"}
    ],
    "agent_id": "ä¸“ä¸šåŠ©æ‰‹",
    "model": "deepseek-chat"
  }'
```

**é¢„æœŸç»“æœ**:
- æ—¥å¿—æ˜¾ç¤º: `ğŸ’­ Detected emotion: sad`
- AIå›å¤åº”è¯¥ï¼š
  - ç§°å‘¼ç”¨æˆ·ä¸º"æ‚¨"
  - è¯­æ°”ä¸“ä¸šã€æ”¯æŒæ€§
  - è¡¨æƒ…ç¬¦å·è¾ƒå°‘
  - ä½“ç°"å°æ™º"çš„ä¸“ä¸šé£æ ¼

**å¯¹æ¯”æµ‹è¯•**:
æ¯”è¾ƒ"æ¸©æš–ä¼™ä¼´"å’Œ"ä¸“ä¸šåŠ©æ‰‹"å¯¹ç›¸åŒæƒ…æ„Ÿçš„å“åº”ï¼Œåº”è¯¥æ˜æ˜¾ä¸åŒï¼š
- ç§°å‘¼ä¸åŒï¼ˆ"çˆ¸çˆ¸" vs "æ‚¨"ï¼‰
- è¯­æ°”ä¸åŒï¼ˆæ¸©æš– vs ä¸“ä¸šï¼‰
- è¡¨æƒ…ä½¿ç”¨ä¸åŒï¼ˆå¤š vs å°‘ï¼‰

---

### æµ‹è¯•5: Neutralæƒ…æ„Ÿå¤„ç†

**ç›®æ ‡**: éªŒè¯neutralæƒ…æ„Ÿä¸è§¦å‘ç‰¹æ®Šå“åº”

**æµ‹è¯•æ­¥éª¤**:
```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "messages": [
      {"role": "user", "content": "ä»Šå¤©å¤©æ°”ä¸é”™"}
    ],
    "agent_id": "default",
    "model": "deepseek-chat"
  }'
```

**é¢„æœŸç»“æœ**:
- æ—¥å¿—æ˜¾ç¤º: `ğŸ’­ Detected emotion: neutral`ï¼ˆå¯èƒ½ï¼‰
- ä¸åº”è¯¥æ³¨å…¥ç‰¹æ®Šçš„å…±æƒ…å“åº”
- AIæ­£å¸¸å›å¤ï¼Œä¸åŒ…å«æƒ…ç»ªè°ƒæ•´

---

### æµ‹è¯•6: æµå¼å¯¹è¯æƒ…æ„Ÿè¯†åˆ«

**ç›®æ ‡**: éªŒè¯æµå¼å¯¹è¯ä¸­æƒ…æ„Ÿè¯†åˆ«æ­£å¸¸å·¥ä½œ

**æµ‹è¯•æ­¥éª¤**:
```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "messages": [
      {"role": "user", "content": "å¤ªå¥½äº†ï¼é¡¹ç›®æˆåŠŸäº†ï¼"}
    ],
    "agent_id": "æ¸©æš–ä¼™ä¼´",
    "stream": true,
    "model": "deepseek-chat"
  }'
```

**é¢„æœŸç»“æœ**:
- æ—¥å¿—æ˜¾ç¤ºæƒ…æ„Ÿè¯†åˆ«ï¼ˆåœ¨æµå¼å¼€å§‹å‰ï¼‰
- æµå¼å“åº”ä½“ç°å…±æƒ…
- å“åº”ä¸­åŒ…å«ä¸æƒ…æ„Ÿç›¸å…³çš„è¡¨è¾¾

---

### æµ‹è¯•7: ç¼“å­˜æœºåˆ¶éªŒè¯

**ç›®æ ‡**: éªŒè¯ç›¸åŒæ¶ˆæ¯çš„æƒ…æ„Ÿè¯†åˆ«ç»“æœè¢«ç¼“å­˜

**æµ‹è¯•æ­¥éª¤**:
1. ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼ˆè®°å½•æ—¶é—´ï¼‰:
```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "messages": [
      {"role": "user", "content": "æˆ‘å¾ˆå¼€å¿ƒ"}
    ],
    "agent_id": "default",
    "model": "deepseek-chat"
  }'
```

2. ç¬¬äºŒæ¬¡è°ƒç”¨ç›¸åŒæ¶ˆæ¯ï¼ˆåº”è¯¥æ›´å¿«ï¼‰:
```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "messages": [
      {"role": "user", "content": "æˆ‘å¾ˆå¼€å¿ƒ"}
    ],
    "agent_id": "default",
    "model": "deepseek-chat"
  }'
```

**é¢„æœŸç»“æœ**:
- ç¬¬äºŒæ¬¡è°ƒç”¨æ—¶ï¼Œæ—¥å¿—å¯èƒ½æ˜¾ç¤º: `ğŸ“¦ Using cached emotion: happy`
- ç¬¬äºŒæ¬¡è°ƒç”¨åº”è¯¥æ›´å¿«ï¼ˆå¦‚æœç¬¬ä¸€æ¬¡ä½¿ç”¨äº†LLMæ¨¡å¼ï¼‰

**éªŒè¯æ–¹æ³•**:
- æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼Œå¯»æ‰¾ç¼“å­˜ç›¸å…³çš„æ—¥å¿—
- æ¯”è¾ƒä¸¤æ¬¡è°ƒç”¨çš„å“åº”æ—¶é—´

---

### æµ‹è¯•8: æƒ…æ„Ÿè¯†åˆ«å¤±è´¥å®¹é”™

**ç›®æ ‡**: éªŒè¯è¯†åˆ«å¤±è´¥æ—¶fallbackåˆ°neutral

**æµ‹è¯•æ­¥éª¤**:
1. æš‚æ—¶ç¦ç”¨LLMå®¢æˆ·ç«¯ï¼ˆæˆ–æ¨¡æ‹Ÿå¤±è´¥ï¼‰
2. å‘é€ä¸€æ¡æ¶ˆæ¯

**é¢„æœŸç»“æœ**:
- æ—¥å¿—æ˜¾ç¤º: `âš ï¸ Emotion detection failed, continuing without emotion adjustment`
- å¯¹è¯æ­£å¸¸è¿›è¡Œ
- ä¸å› ä¸ºæƒ…æ„Ÿè¯†åˆ«å¤±è´¥è€Œä¸­æ–­

---

## ğŸ“Š éªŒè¯ checklist

### åŠŸèƒ½éªŒè¯
- [ ] å¿«é€Ÿæ¨¡å¼èƒ½è¯†åˆ«å¸¸è§å…³é”®è¯ï¼ˆhappy/sad/angry/excited/anxiousï¼‰
- [ ] LLMæ¨¡å¼èƒ½è¯†åˆ«å¤æ‚æƒ…æ„Ÿè¡¨è¾¾
- [ ] Neutralæƒ…æ„Ÿä¸è§¦å‘ç‰¹æ®Šå“åº”
- [ ] ä¸åŒäººæ ¼å¯¹ç›¸åŒæƒ…æ„Ÿæœ‰ä¸åŒå“åº”é£æ ¼
- [ ] æµå¼å¯¹è¯ä¸­æƒ…æ„Ÿè¯†åˆ«æ­£å¸¸å·¥ä½œ
- [ ] ç¼“å­˜æœºåˆ¶æ­£å¸¸å·¥ä½œ
- [ ] è¯†åˆ«å¤±è´¥æ—¶fallbackæ­£å¸¸

### æ€§èƒ½éªŒè¯
- [ ] å¿«é€Ÿæ¨¡å¼å»¶è¿Ÿ < 10ms
- [ ] LLMæ¨¡å¼å»¶è¿Ÿ < 100msï¼ˆå¦‚æœè°ƒç”¨LLMï¼‰
- [ ] ç¼“å­˜å‘½ä¸­åå“åº”æ›´å¿«

### æ—¥å¿—éªŒè¯
- [ ] å¯åŠ¨æ—¶åŠ è½½æ¨¡æ¿æˆåŠŸ
- [ ] æƒ…æ„Ÿè¯†åˆ«æ—¥å¿—æ­£å¸¸æ˜¾ç¤º
- [ ] å…±æƒ…å“åº”æ³¨å…¥æ—¥å¿—æ­£å¸¸
- [ ] ç¼“å­˜ä½¿ç”¨æ—¥å¿—æ­£å¸¸

### å“åº”éªŒè¯
- [ ] å¼€å¿ƒæƒ…ç»ª â†’ AIå›å¤ç§¯ææ­£é¢
- [ ] éš¾è¿‡æƒ…ç»ª â†’ AIå›å¤å®‰æ…°æ¸©æš–ï¼ˆæˆ–ä¸“ä¸šæ”¯æŒï¼‰
- [ ] ç”Ÿæ°”æƒ…ç»ª â†’ AIå›å¤å†·é™å®‰æŠš
- [ ] å…´å¥‹æƒ…ç»ª â†’ AIå›å¤åˆ†äº«å–œæ‚¦
- [ ] ç„¦è™‘æƒ…ç»ª â†’ AIå›å¤å®‰æŠšé¼“åŠ±

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

è®¾ç½®ç¯å¢ƒå˜é‡å¢åŠ æ—¥å¿—è¯¦ç»†åº¦ï¼š
```bash
DEBUG=true npm run dev
```

### 2. éªŒè¯System Promptæ³¨å…¥

åœ¨æ—¥å¿—ä¸­æŸ¥æ‰¾ï¼š
```
ğŸ’ Injected empathetic response for [emotion_type]
```

### 3. éªŒè¯æƒ…æ„Ÿè¯†åˆ«ç»“æœ

åœ¨æ—¥å¿—ä¸­æŸ¥æ‰¾ï¼š
```
ğŸ’­ Detected emotion: [type] (intensity: [value])
```

### 4. éªŒè¯æ¨¡æ¿åŠ è½½

å¯åŠ¨æ—¶æ£€æŸ¥ï¼š
```
âœ… Loaded emotion templates: 6 default, 3 personality-specific
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: æƒ…æ„Ÿè¯†åˆ«æ€»æ˜¯è¿”å›neutral
**å¯èƒ½åŸå› **:
- LLMå®¢æˆ·ç«¯æœªæ­£ç¡®è®¾ç½®
- å¿«é€Ÿæ¨¡å¼å…³é”®è¯æœªåŒ¹é…
- æ¨¡æ¿æœªæ­£ç¡®åŠ è½½

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥server.tsä¸­EmotionEngineæ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
2. æ£€æŸ¥LLMClientæ˜¯å¦ä¼ å…¥
3. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ç¡®è®¤æ¨¡æ¿åŠ è½½

### é—®é¢˜2: å…±æƒ…å“åº”æœªæ³¨å…¥
**å¯èƒ½åŸå› **:
- æƒ…æ„Ÿè¯†åˆ«ä¸ºneutralï¼ˆä¸ä¼šæ³¨å…¥å“åº”ï¼‰
- äººæ ¼æœªåŠ è½½
- æ¨¡æ¿åŒ¹é…å¤±è´¥

**æ’æŸ¥æ­¥éª¤**:
1. ç¡®è®¤æƒ…æ„Ÿè¯†åˆ«ç»“æœä¸æ˜¯neutral
2. ç¡®è®¤agent_idå­˜åœ¨ä¸”äººæ ¼å·²åŠ è½½
3. æ£€æŸ¥æ¨¡æ¿æ–‡ä»¶æ˜¯å¦å­˜åœ¨

### é—®é¢˜3: æ€§èƒ½å»¶è¿Ÿè¿‡é«˜
**å¯èƒ½åŸå› **:
- LLMè°ƒç”¨å»¶è¿Ÿé«˜
- æœªå¯ç”¨å¿«é€Ÿæ¨¡å¼
- ç¼“å­˜æœªç”Ÿæ•ˆ

**æ’æŸ¥æ­¥éª¤**:
1. ç¡®è®¤å¿«é€Ÿæ¨¡å¼å·²å¯ç”¨
2. æ£€æŸ¥æ˜¯å¦å‘½ä¸­ç¼“å­˜
3. ä¼˜åŒ–LLMæç¤ºè¯ï¼ˆå·²ä¼˜åŒ–ï¼‰

---

## ğŸ§  æƒ…æ„Ÿæ ‡æ³¨è®°å¿†é›†æˆéªŒè¯ï¼ˆM2.1ï¼‰

> å¯¹åº” `add-emotion-recording` å˜æ›´ï¼ŒéªŒè¯ EmotionEngine â†’ RAGMemoryService â†’ ChatService çš„é—­ç¯ã€‚

### æµ‹è¯•9: æƒ…æ„Ÿå†™å…¥è®°å¿†ç³»ç»Ÿ

**ç›®æ ‡**: ç¡®è®¤ `EmotionEngine.detectEmotion()` è¾“å‡ºå¯é€šè¿‡ `RAGMemoryService.recordEmotion()` å†™å…¥é»˜è®¤ `knowledgeBase`ï¼Œå¹¶æŒä¹…åŒ– `metadata.emotion`ã€‚

**æ­¥éª¤**:
1. å¯åŠ¨ `npm run dev`ï¼Œç¡®ä¿ `.env` ä¸­ `MEMORY_SYSTEM=rag` ä¸” EmotionEngine `recordingEnabled=false`ï¼ˆé€šè¿‡ ChatService å†™å…¥ï¼‰ã€‚
2. è°ƒç”¨èŠå¤©æ¥å£ï¼š
   ```bash
   curl -X POST http://localhost:8088/v1/chat/completions \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer YOUR_API_KEY" \
     -d '{
       "messages": [
         {"role":"user","content":"å¤ªæ£’äº†ï¼ä»Šå¤©å¿ƒæƒ…è¶…å¥½ï¼"}
       ],
       "agent_id": "default",
       "model": "deepseek-chat"
     }'
   ```
3. æ—¥å¿—åº”åŒ…å«ï¼š
   ```
   ğŸ’­ Detected emotion: happy (intensityâ‰ˆ0.8)
   ğŸ’¾ [MemoryService] recordEmotion user=...
   âœ… RAGMemoryService.addDocument ... tags=["emotion:happy"]
   ```
4. è‹¥æœ¬åœ°å¯ç”¨äº† RAG æ£€ç´¢ APIï¼Œå¯é€šè¿‡ `search` æ¥å£éªŒè¯æœ€æ–° `metadata.emotion`ã€‚

**è‡ªåŠ¨åŒ–éªŒè¯**:
```bash
npm run test -- emotion-recording.test.ts
```
`tests/integration/emotion-recording.test.ts` ä¼š Mock RAG æœåŠ¡ï¼Œæ–­è¨€å†™å…¥çš„ emotion metadata ä¸ tagsã€‚

### æµ‹è¯•10: æƒ…æ„Ÿè®°å¿†æ£€ç´¢ä¸æ³¨å…¥

**ç›®æ ‡**: ç¡®ä¿ `MemoryService.recall()` è¿”å›çš„ `metadata.emotion` åœ¨ ChatService `injectMemoriesIntoMessages()` é˜¶æ®µå®Œæ•´æ³¨å…¥ã€‚

**æ­¥éª¤**:
1. å¼€å¯è°ƒè¯•æ—¥å¿—ï¼š`TRACE_PROMPT=1 npm run dev`
2. è§¦å‘å›å¿†æ³¨å…¥ï¼š
   ```bash
   curl -X POST http://localhost:8088/v1/chat/completions \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer YOUR_API_KEY" \
     -d '{
       "messages": [
         {"role":"user","content":"æœ€è¿‘ä¸€ç›´é˜´å¤©ï¼Œæˆ‘æœ‰ç‚¹ä¸§"}
       ],
       "agent_id": "default",
       "model": "deepseek-chat",
       "memory": {"injectEmotionHistory": true}
     }'
   ```
3. æ—¥å¿—åº”å‡ºç°ï¼š
   ```
   ğŸ“š [MemoryInjection] recalled 2 items (emotion)
   ğŸ§  Memory #0 emotion=sad intensity=0.82
   ```
4. Prompt ç‰‡æ®µä¸­ä¼šåŒ…å«ï¼š
   ```
   [EMOTION_MEMORY]
   - 2025-11-12 SAD (0.82): æœ€è¿‘ä¸€ç›´é˜´å¤©...
   ```

**è‡ªåŠ¨åŒ–éªŒè¯**:
`tests/integration/emotion-recording.test.ts` çš„ â€œæ£€ç´¢å¸¦æƒ…æ„Ÿçš„è®°å½•â€ ç”¨ä¾‹ä¼šç¡®ä¿ emotion metadata è¢«ä¿ç•™ã€‚

### æµ‹è¯•11: å®¹é”™ä¸æ€§èƒ½

**ç›®æ ‡**: Emotion å†™å…¥å¤±è´¥æ—¶ä¸ä¸­æ–­ä¼šè¯ï¼›å¿«é€Ÿæ¨¡å¼ä¸‹æ£€æµ‹+å†™å…¥è€—æ—¶ < 20msã€‚

**æ­¥éª¤**:
1. æ¨¡æ‹Ÿ RAG å¤±è´¥ï¼ˆæ–­å¼€ RAG æœåŠ¡æˆ–å¯¼å‡º `RAG_FORCE_FAIL=1`ï¼‰åå†è§¦å‘è¯·æ±‚ï¼Œæ—¥å¿—åº”æ˜¾ç¤ºï¼š
   ```
   âš ï¸  [MemoryService] recordEmotion failed: Storage failed
   â„¹ï¸  ChatService will continue without blocking
   ```
2. è¿è¡Œæ€§èƒ½æ–­è¨€ï¼š
   ```bash
   npm run test -- emotion-recording.test.ts -t "æ€§èƒ½æµ‹è¯•"
   ```
   é¢„æœŸè¾“å‡ºï¼š
   ```
   â±ï¸  Emotion detection (fast mode) 5-8ms
   â±ï¸  recordEmotion overhead < 12ms
   ```

> è‹¥ä»¥ä¸Šæµ‹è¯•é€šè¿‡ï¼Œå³æ»¡è¶³ `add-emotion-recording` å˜æ›´çš„æ–‡æ¡£è¦æ±‚ï¼Œå¯åœ¨ OpenSpec `tasks.md` ä¸­å‹¾é€‰ 6.1ã€‚

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

### æµ‹è¯•ç¯å¢ƒ
- **æ—¥æœŸ**: _______________
- **Nodeç‰ˆæœ¬**: _______________
- **æµ‹è¯•äººå‘˜**: _______________

### æµ‹è¯•ç»“æœ

| æµ‹è¯•é¡¹ | çŠ¶æ€ | å¤‡æ³¨ |
|--------|------|------|
| å¿«é€Ÿæ¨¡å¼è¯†åˆ« | âœ…/âŒ | |
| LLMæ¨¡å¼è¯†åˆ« | âœ…/âŒ | |
| æ¸©æš–ä¼™ä¼´å“åº” | âœ…/âŒ | |
| ä¸“ä¸šåŠ©æ‰‹å“åº” | âœ…/âŒ | |
| Neutralå¤„ç† | âœ…/âŒ | |
| æµå¼å¯¹è¯ | âœ…/âŒ | |
| ç¼“å­˜æœºåˆ¶ | âœ…/âŒ | |
| å®¹é”™æœºåˆ¶ | âœ…/âŒ | |

### æ€§èƒ½æŒ‡æ ‡
- å¿«é€Ÿæ¨¡å¼å»¶è¿Ÿ: _____ ms
- LLMæ¨¡å¼å»¶è¿Ÿ: _____ ms
- ç¼“å­˜å‘½ä¸­ç‡: _____ %

### å‘ç°çš„é—®é¢˜
1. _______________
2. _______________

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- âœ… èƒ½è¯†åˆ«80%+å¸¸è§æƒ…æ„Ÿè¡¨è¾¾ï¼ˆå¿«é€Ÿæ¨¡å¼ + LLMæ¨¡å¼ï¼‰
- âœ… AIå›å¤èƒ½æ ¹æ®ç”¨æˆ·æƒ…ç»ªè°ƒæ•´ï¼ˆå…±æƒ…èƒ½åŠ›ï¼‰
- âœ… ä¸åŒäººæ ¼å¯¹åŒä¸€æƒ…æ„Ÿæœ‰ä¸åŒå“åº”é£æ ¼

### æ€§èƒ½éªŒæ”¶
- âœ… å¿«é€Ÿæ¨¡å¼å»¶è¿Ÿ < 10ms
- âœ… LLMæ¨¡å¼å»¶è¿Ÿ < 100ms
- âœ… ç¼“å­˜æœºåˆ¶æ­£å¸¸å·¥ä½œ

### ç¨³å®šæ€§éªŒæ”¶
- âœ… è¯†åˆ«å¤±è´¥ä¸ä¸­æ–­å¯¹è¯
- âœ… å®¹é”™æœºåˆ¶æ­£å¸¸
- âœ… é”™è¯¯æ—¥å¿—æ­£å¸¸

---

## ğŸ¯ ä¸‹ä¸€æ­¥

éªŒè¯é€šè¿‡åï¼š
1. è®°å½•æµ‹è¯•ç»“æœ
2. æ›´æ–°å¼€å‘æ–‡æ¡£
3. ç»§ç»­ä¸‹ä¸€ä¸ªæ¨¡å—å¼€å‘

éªŒè¯å‘ç°é—®é¢˜ï¼š
1. è®°å½•é—®é¢˜æè¿°
2. åˆ›å»ºissueæˆ–ä¿®å¤
3. é‡æ–°éªŒè¯

