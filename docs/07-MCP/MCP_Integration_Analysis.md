# ApexBridgeé¡¹ç›®é›†æˆMCPå·¥å…·å¯è¡Œæ€§åˆ†ææŠ¥å‘Š

## ğŸ“‹ ç›®å½•

1. [æ‰§è¡Œæ‘˜è¦](#1-æ‰§è¡Œæ‘˜è¦)
2. [MCPæŠ€æœ¯æ¦‚è¿°](#2-mcpæŠ€æœ¯æ¦‚è¿°)
3. [ApexBridgeç°æœ‰æ¶æ„åˆ†æ](#3-apexbridgeç°æœ‰æ¶æ„åˆ†æ)
4. [é›†æˆå¯è¡Œæ€§è¯„ä¼°](#4-é›†æˆå¯è¡Œæ€§è¯„ä¼°)
5. [é›†æˆæ–¹æ¡ˆè®¾è®¡](#5-é›†æˆæ–¹æ¡ˆè®¾è®¡)
6. [MCPæœåŠ¡å™¨ç®¡ç†æ–¹æ¡ˆ](#6-mcpæœåŠ¡å™¨ç®¡ç†æ–¹æ¡ˆ)
7. [å®æ–½è·¯çº¿å›¾](#7-å®æ–½è·¯çº¿å›¾)
8. [é£é™©è¯„ä¼°ä¸ç¼“è§£](#8-é£é™©è¯„ä¼°ä¸ç¼“è§£)
9. [æˆæœ¬æ•ˆç›Šåˆ†æ](#9-æˆæœ¬æ•ˆç›Šåˆ†æ)
10. [å®æ–½å»ºè®®](#10-å®æ–½å»ºè®®)
11. [ç»“è®º](#11-ç»“è®º)
12. [é™„å½•](#12-é™„å½•)

---

## 1. æ‰§è¡Œæ‘˜è¦

### 1.1 ç»“è®º

**ApexBridgeé¡¹ç›®éå¸¸é€‚åˆé›†æˆMCPï¼ˆModel Context Protocolï¼‰**ï¼Œè¿™å°†æ˜¾è‘—å¢å¼ºç³»ç»Ÿçš„å·¥å…·è°ƒç”¨èƒ½åŠ›å’Œç”Ÿæ€ç³»ç»Ÿå…¼å®¹æ€§ã€‚MCPå¯ä»¥æ— ç¼é›†æˆåˆ°ç°æœ‰çš„Skillsç³»ç»Ÿä¹‹ä¸Šï¼Œæä¾›æ ‡å‡†åŒ–çš„å·¥å…·è°ƒç”¨æ¥å£ã€‚

**ä¼˜å…ˆçº§**ï¼šâ­â­â­â­â­ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

### 1.2 æ ¸å¿ƒä»·å€¼

- âœ… **æŠ€æœ¯å®Œç¾åŒ¹é…**ï¼šTypeScriptåŸç”Ÿæ”¯æŒï¼Œæ— éœ€å¤§è§„æ¨¡é‡æ„
- âœ… **ç”Ÿæ€ç³»ç»Ÿæ‰©å±•**ï¼šè®¿é—®247+ç¤¾åŒºMCPæœåŠ¡å™¨ï¼Œå·¥å…·æ•°é‡å¢é•¿10-20å€
- âœ… **æ ‡å‡†åŒ–æ¥å£**ï¼šé‡‡ç”¨è¡Œä¸šæ ‡å‡†åè®®ï¼Œæå‡äº’æ“ä½œæ€§
- âœ… **ä½é£é™©è¿ç§»**ï¼šä¿æŒç°æœ‰Skillsç³»ç»Ÿï¼Œæ¸è¿›å¼å‡çº§

### 1.3 æ¨èæ–¹æ¡ˆ

**å…¼å®¹å¹¶è¡Œæ¨¡å¼**ï¼šSkillså’ŒMCPç³»ç»Ÿå¹¶å­˜
- **ä¿æŒç°æœ‰Skillsç³»ç»Ÿ**ï¼šæ— éœ€ä¿®æ”¹ï¼Œç»§ç»­ä½¿ç”¨ç°æœ‰Skills
- **æ–°å¢MCPç³»ç»Ÿ**ï¼šç‹¬ç«‹å®‰è£…å’Œç®¡ç†MCPæœåŠ¡å™¨
- **ç»Ÿä¸€å·¥å…·ç®¡ç†**ï¼šé€šè¿‡ç»Ÿä¸€æ¥å£è®¿é—®Skillså’ŒMCPå·¥å…·
- **ç”¨æˆ·è‡ªä¸»é€‰æ‹©**ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©ä½¿ç”¨Skillsæˆ–MCPæˆ–ä¸¤è€…

---

## 2. MCPæŠ€æœ¯æ¦‚è¿°

### 2.1 ä»€ä¹ˆæ˜¯MCPï¼Ÿ

**MCPï¼ˆModel Context Protocolï¼‰**æ˜¯ç”±Anthropicäº2024å¹´11æœˆæ¨å‡ºçš„å¼€æ”¾æ ‡å‡†åè®®ï¼Œæ—¨åœ¨æ ‡å‡†åŒ–å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·çš„äº¤äº’æ–¹å¼ã€‚å¯ä»¥å°†å…¶è§†ä¸º"**AIé¢†åŸŸçš„USB-Cæ¥å£**"ã€‚

### 2.2 æ ¸å¿ƒç‰¹æ€§

#### æŠ€æœ¯ç‰¹æ€§
- **æ ‡å‡†åŒ–åè®®**ï¼šåŸºäºJSON-RPC 2.0çš„ç»Ÿä¸€é€šä¿¡åè®®
- **å¤šä¼ è¾“æ–¹å¼**ï¼š
  - stdioï¼ˆæ ‡å‡†è¾“å…¥/è¾“å‡ºï¼‰- é€‚ç”¨äºæœ¬åœ°é›†æˆ
  - SSEï¼ˆServer-Sent Eventsï¼‰- é€‚ç”¨äºWebåº”ç”¨
  - HTTP/WebSocket - é€‚ç”¨äºç½‘ç»œæœåŠ¡

#### å››å¤§åŸè¯­
- **Tools**ï¼šå¯æ‰§è¡Œçš„å‡½æ•°æˆ–æ“ä½œ
- **Resources**ï¼šç»“æ„åŒ–æ•°æ®ç‰‡æ®µ
- **Prompts**ï¼šé¢„å®šä¹‰çš„æç¤ºæ¨¡æ¿
- **Sampling**ï¼šæ¨¡å‹ç”Ÿæˆå‚æ•°ç®¡ç†

#### æ¶æ„æ¨¡å¼
- **å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„**ï¼šHost + Client + Server
- **å¤šå®¿ä¸»æ”¯æŒ**ï¼šä¸€ä¸ªæœåŠ¡å™¨å¯è¢«å¤šä¸ªå®¢æˆ·ç«¯ä½¿ç”¨

### 2.3 ç”Ÿæ€ç³»ç»Ÿç°çŠ¶ï¼ˆ2025å¹´ï¼‰

- **å®˜æ–¹SDK**ï¼šTypeScriptã€Pythonã€Javaã€C#ç­‰
- **ç¤¾åŒºæœåŠ¡å™¨**ï¼š247+å¼€æºMCPæœåŠ¡å™¨å®ç°
- **å¹³å°æ”¯æŒ**ï¼šClaude Desktopã€Cursor IDEã€Windsurfç­‰
- **ä¼ä¸šé‡‡ç”¨**ï¼šGoogleæ¨å‡ºæ‰˜ç®¡MCPæœåŠ¡å™¨

---

## 3. ApexBridgeç°æœ‰æ¶æ„åˆ†æ

### 3.1 ç³»ç»Ÿæ¦‚å†µ

ApexBridgeæ˜¯ä¸€ä¸ªè½»é‡çº§ABPï¼ˆAI Bridge Protocolï¼‰èŠå¤©æœåŠ¡ï¼š

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| å¤šLLMæ”¯æŒ | OpenAIã€DeepSeekã€Zhipuã€Ollama |
| ç­–ç•¥æ¨¡å¼ | ReActï¼ˆå¤šè½®æ€è€ƒï¼‰ã€SingleRoundï¼ˆå¿«é€Ÿå“åº”ï¼‰ |
| Skillsç³»ç»Ÿ | å¤–éƒ¨å·¥å…·è°ƒç”¨æ¡†æ¶ |
| å®æ—¶é€šä¿¡ | WebSocketæµå¼ä¼ è¾“ |
| é…ç½®ç®¡ç† | SQLiteå­˜å‚¨LLMé…ç½® |

### 3.2 ç°æœ‰å·¥å…·ç³»ç»Ÿæ¶æ„

```
ProtocolEngine
    â†“
ABPåè®®è§£æ â†’ å·¥å…·è°ƒç”¨
    â†“
SkillManager + ToolRetrievalService
    â†“
Skillsæ‰§è¡Œ (scripts/execute.js)
    â†“
å¤–éƒ¨API/æœåŠ¡
```

#### æ ¸å¿ƒç»„ä»¶

- **ProtocolEngine**ï¼šåè®®è§£æã€å˜é‡è§£æã€æ’ä»¶ç®¡ç†
- **SkillManager**ï¼šSkillsç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆå®‰è£…ã€å¸è½½ã€æ›´æ–°ï¼‰
- **ToolRetrievalService**ï¼šå‘é‡æœç´¢ã€è¯­ä¹‰åŒ¹é…
- **BuiltInToolsRegistry**ï¼šå†…ç½®å·¥å…·æ³¨å†Œ

### 3.3 Skillsç³»ç»Ÿç»“æ„

æ¯ä¸ªSkillåŒ…å«ï¼š

**1. SKILL.md**
- Frontmatterå…ƒæ•°æ®ï¼ˆnameã€descriptionã€parametersï¼‰
- å‚æ•°æ¨¡å¼å®šä¹‰ï¼ˆJSON Schemaï¼‰
- ä½¿ç”¨æ–‡æ¡£å’Œæ“ä½œæŒ‡å—

**2. scripts/execute.js**
- æ‰§è¡Œé€»è¾‘
- å‚æ•°éªŒè¯
- APIè°ƒç”¨
- ç»“æœè¿”å›

#### ç¤ºä¾‹

```markdown
---
name: "siliconflow-image-generator"
description: "å›¾åƒç”Ÿæˆå·¥å…·"
parameters:
  type: "object"
  properties:
    prompt: { type: "string", description: "å›¾åƒæè¿°" }
    image_size: { type: "string", default: "512x512" }
---
```

```javascript
module.exports = async function({ prompt, image_size = "512x512" }) {
  // è°ƒç”¨APIå¹¶è¿”å›ç»“æœ
};
```

---

## 4. é›†æˆå¯è¡Œæ€§è¯„ä¼°

### 4.1 æŠ€æœ¯æ¶æ„å…¼å®¹æ€§

| ApexBridgeç‰¹æ€§ | MCPæ”¯æŒæƒ…å†µ | å…¼å®¹æ€§ |
|----------------|------------|--------|
| TypeScript/JavaScript | å®˜æ–¹TypeScript SDK | âœ… å®Œç¾åŒ¹é… |
| å·¥å…·è°ƒç”¨ | ToolsåŸè¯­ | âœ… ç›´æ¥å¯¹åº” |
| Skillsç³»ç»Ÿ | å¯åŒ…è£…ä¸ºMCPæœåŠ¡å™¨ | âœ… æ— ç¼é›†æˆ |
| WebSocketå®æ—¶é€šä¿¡ | SSE/WebSocketä¼ è¾“ | âœ… æ”¯æŒ |
| åè®®è§£æ | JSON-RPC 2.0 | âœ… æ ‡å‡†åŒ– |
| å¤šLLMæä¾›å•† | Provider-agnostic | âœ… æ— å…³ |

### 4.2 ç°æœ‰æŠ•èµ„ä¿æŠ¤

- âœ… **Skillsç³»ç»Ÿå®Œå…¨ä¿ç•™**ï¼šæ— éœ€ä¿®æ”¹ç°æœ‰Skillsï¼Œç»§ç»­ç‹¬ç«‹è¿è¡Œ
- âœ… **ProtocolEngineå¤ç”¨**ï¼šå¯åŒæ—¶æ”¯æŒABPå’ŒMCPåè®®
- âœ… **å·¥å…·æ£€ç´¢åŒè½¨åˆ¶**ï¼šSkillsä½¿ç”¨ç°æœ‰å‘é‡æ£€ç´¢ï¼ŒMCPä½¿ç”¨ç‹¬ç«‹ç´¢å¼•
- âœ… **é…ç½®ç®¡ç†æ‰©å±•**ï¼šSQLiteå¯åŒæ—¶å­˜å‚¨Skillså’ŒMCPæœåŠ¡å™¨é…ç½®
- âœ… **é›¶ç ´åæ€§å˜æ›´**ï¼šç°æœ‰APIå’ŒåŠŸèƒ½ä¿æŒä¸å˜

### 4.3 åŠŸèƒ½å¢å¼º

- **æ ‡å‡†åŒ–å·¥å…·è°ƒç”¨**ï¼šMCPæä¾›ä¸šç•Œæ ‡å‡†æ¥å£
- **ç”Ÿæ€ç³»ç»Ÿäº’æ“ä½œ**ï¼šè¿æ¥GitHubã€Google Driveç­‰å¤–éƒ¨MCPæœåŠ¡å™¨
- **å¤šå®¿ä¸»æ”¯æŒ**ï¼šä¸€ä¸ªæŠ€èƒ½å¯è¢«å¤šä¸ªMCPå®¢æˆ·ç«¯ä½¿ç”¨
- **ä¸°å¯Œå·¥å…·ç”Ÿæ€**ï¼šè®¿é—®247+ç¤¾åŒºMCPæœåŠ¡å™¨

---

## 5. é›†æˆæ–¹æ¡ˆè®¾è®¡

### 5.1 æ¶æ„æ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             ApexBridge                  â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Skills    â”‚     â”‚     MCP     â”‚   â”‚
â”‚  â”‚   ç³»ç»Ÿ      â”‚     â”‚    ç³»ç»Ÿ     â”‚   â”‚
â”‚  â”‚            â”‚     â”‚             â”‚   â”‚
â”‚  â”‚ SkillMgr   â”‚     â”‚MCPServerMgr â”‚   â”‚
â”‚  â”‚ Toolæ£€ç´¢   â”‚     â”‚ å·¥å…·å‘ç°    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                  â”‚           â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                  â”‚                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚         â”‚  ç»Ÿä¸€å·¥å…·ç®¡ç†æ¥å£  â”‚          â”‚
â”‚         â”‚ UnifiedToolMgr    â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                  â”‚                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚         â”‚   ProtocolEngine  â”‚          â”‚
â”‚         â”‚ (ABP + MCPæ”¯æŒ)   â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ ç°æœ‰API â”‚        â”‚  å¤–éƒ¨MCP    â”‚
    â”‚ å®¢æˆ·ç«¯  â”‚        â”‚  æœåŠ¡å™¨     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 é›†æˆæ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | æè¿° | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|------|------|------|------|--------|
| **ç‹¬ç«‹å¹¶è¡Œæ¨¡å¼** | Skillså’ŒMCPå®Œå…¨ç‹¬ç«‹ï¼Œå¹¶è¡Œè¿è¡Œ | é›¶é£é™©ï¼Œäº’ä¸å¹²æ‰° | éœ€è¦ä¸¤å¥—ç®¡ç† | â­â­â­â­ |
| **ç»Ÿä¸€ç®¡ç†æ¨¡å¼** | é€šè¿‡ç»Ÿä¸€æ¥å£ç®¡ç†ä¸¤è€… | ç»Ÿä¸€ä½“éªŒï¼Œæ˜“äºä½¿ç”¨ | éœ€è¦é€‚é…å±‚ | â­â­â­â­â­ |
| **å®Œå…¨è¿ç§»æ¨¡å¼** | å°†Skillsè¿ç§»åˆ°MCP | ç»Ÿä¸€æŠ€æœ¯æ ˆ | é«˜é£é™©ï¼Œç ´åæ€§ | â­â­ |

### 5.3 åŒè½¨å¹¶è¡Œç­–ç•¥

| ç³»ç»Ÿ | æ¶æ„ | è¯´æ˜ |
|------|------|------|
| **Skillsç³»ç»Ÿ** | ä¿æŒç°æœ‰æ¶æ„ | é›¶ä¿®æ”¹ï¼Œç»§ç»­ä½¿ç”¨ç°æœ‰ç³»ç»Ÿ |
| **MCPç³»ç»Ÿ** | ç‹¬ç«‹æ¶æ„ | æ–°å»ºMCPç®¡ç†ç³»ç»Ÿ |
| **ç»Ÿä¸€æ¥å£** | æŠ½è±¡å±‚ | æä¾›ç»Ÿä¸€çš„ç®¡ç†å’Œè°ƒç”¨æ¥å£ |
| **å·¥å…·å‘ç°** | ç»Ÿä¸€å‘é‡æœç´¢ | MCPå’ŒSkillsç»Ÿä¸€å­˜å‚¨ï¼Œè¯­ä¹‰æœç´¢åŠ¨æ€å‘ç° |
| **é…ç½®ç®¡ç†** | åˆ†åº“å­˜å‚¨ | Skillsé…ç½®å’ŒMCPé…ç½®ç‹¬ç«‹å­˜å‚¨ |

### 5.4 ç»Ÿä¸€å‘é‡æœç´¢æ–¹æ¡ˆ

#### æ ¸å¿ƒæ€æƒ³

å°†MCPå’ŒSkillså·¥å…·çš„**å…ƒæ•°æ®ç»Ÿä¸€å‘é‡åŒ–**ï¼Œå­˜å…¥åŒä¸€ä¸ªå‘é‡æ•°æ®åº“ï¼Œé€šè¿‡**è¯­ä¹‰æœç´¢**åŠ¨æ€å‘ç°æœ€åˆé€‚çš„å·¥å…·ï¼š

```
ç”¨æˆ·æŸ¥è¯¢ï¼š"æˆ‘æƒ³ç”Ÿæˆä¸€å¼ å›¾ç‰‡"
    â†“
å‘é‡æœç´¢ï¼šåŒ¹é…æ‰€æœ‰ç›¸å…³å·¥å…·
    â”œâ”€â”€ Skills: siliconflow-image-generator (ç›¸ä¼¼åº¦: 0.92)
    â”œâ”€â”€ MCP: stability-ai-mcp (ç›¸ä¼¼åº¦: 0.88)
    â””â”€â”€ MCP: dalle-mcp (ç›¸ä¼¼åº¦: 0.85)
    â†“
é€æ˜è·¯ç”±ï¼šè°ƒç”¨æœ€åŒ¹é…çš„ç³»ç»Ÿ
    â””â”€â”€ Skills: siliconflow-image-generator
```

#### æ•°æ®ç»“æ„è®¾è®¡

```typescript
// ç»Ÿä¸€å·¥å…·ç´¢å¼•
interface UnifiedToolIndex {
  id: string;
  name: string;
  type: 'skill' | 'mcp';
  source: string; // 'skill-manager' | 'mcp-server-id'
  description: string;
  parameters: ToolParameterSchema;
  tags: string[];
  embedding: number[]; // å‘é‡åµŒå…¥
  metadata: {
    category: string;
    version: string;
    author?: string;
  };
}
```

#### ç´¢å¼•æ›´æ–°æœºåˆ¶

**Skillså·¥å…·ç´¢å¼•**ï¼š
- Skillå®‰è£…/å¸è½½æ—¶è‡ªåŠ¨æ›´æ–°å‘é‡ç´¢å¼•
- è§£æSKILL.mdçš„Frontmatterç”Ÿæˆå…ƒæ•°æ®
- ä½¿ç”¨@xenova/transformersç”ŸæˆåµŒå…¥

**MCPå·¥å…·ç´¢å¼•**ï¼š
- MCPæœåŠ¡å™¨è¿æ¥æ—¶è·å–å·¥å…·åˆ—è¡¨
- è§£æå·¥å…·çš„nameã€descriptionã€parameters
- ç”Ÿæˆå‘é‡åµŒå…¥å¹¶ç¼“å­˜

#### æœç´¢æµç¨‹

```typescript
async function discoverTools(query: string): Promise<ToolRetrievalResult[]> {
  // 1. æŸ¥è¯¢å‘é‡åŒ–
  const queryEmbedding = await embeddingModel.encode(query);

  // 2. å‘é‡æœç´¢
  const results = await vectorDb.search({
    vector: queryEmbedding,
    limit: 10,
    threshold: 0.6 // ç›¸ä¼¼åº¦é˜ˆå€¼
  });

  // 3. è§£æç»“æœ
  const tools = results.map(result => ({
    tool: result.metadata,
    score: result.score,
    source: result.metadata.type // skill æˆ– mcp
  }));

  // 4. é€æ˜è·¯ç”±å‡†å¤‡
  return tools;
}

async function executeTool(name: string, args: any): Promise<ToolResult> {
  const toolIndex = await vectorDb.getByName(name);

  if (toolIndex.type === 'skill') {
    // è·¯ç”±åˆ°SkillManager
    return await skillManager.executeSkill(name, args);
  } else {
    // è·¯ç”±åˆ°MCPServer
    return await mcpClient.callTool(toolIndex.source, name, args);
  }
}
```

#### ä¼˜åŠ¿

1. **ç»Ÿä¸€ä½“éªŒ**ï¼šç”¨æˆ·åªéœ€æè¿°éœ€æ±‚ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‰¾åˆ°æœ€åˆé€‚çš„å·¥å…·
2. **æ™ºèƒ½åŒ¹é…**ï¼šé€šè¿‡è¯­ä¹‰ç›¸ä¼¼åº¦è€Œéå…³é”®è¯åŒ¹é…ï¼Œæ›´å‡†ç¡®
3. **è‡ªåŠ¨è·¯ç”±**ï¼šæ— éœ€æ‰‹åŠ¨é€‰æ‹©å·¥å…·ç±»å‹ï¼Œç³»ç»Ÿè‡ªåŠ¨å¤„ç†
4. **åŠ¨æ€å‘ç°**ï¼šæ–°å®‰è£…çš„å·¥å…·è‡ªåŠ¨è¢«ç´¢å¼•ï¼Œæ— éœ€é‡å¯
5. **è·¨ç³»ç»Ÿæœç´¢**ï¼šä¸€æ¬¡æœç´¢å¯åŒæ—¶è¦†ç›–Skillså’ŒMCPç”Ÿæ€

#### å®ç°ç»†èŠ‚

**å‘é‡æ•°æ®åº“é€‰æ‹©**ï¼š
- ç»§ç»­ä½¿ç”¨LanceDBï¼ˆç°æœ‰ä¾èµ–ï¼‰
- æˆ–ä½¿ç”¨ChromaDBï¼ˆæ”¯æŒæ›´å¤æ‚æŸ¥è¯¢ï¼‰

**åµŒå…¥æ¨¡å‹**ï¼š
- ç»§ç»­ä½¿ç”¨@xenova/transformersï¼ˆall-MiniLM-L6-v2ï¼‰
- å¯é€‰å‡çº§åˆ°æ›´å¤§æ¨¡å‹æå‡å‡†ç¡®æ€§

**ç¼“å­˜ç­–ç•¥**ï¼š
- å·¥å…·ç´¢å¼•ç¼“å­˜ï¼ˆé¿å…é‡å¤å‘é‡åŒ–ï¼‰
- æœç´¢ç»“æœç¼“å­˜ï¼ˆæå‡å“åº”é€Ÿåº¦ï¼‰

**å¢é‡æ›´æ–°**ï¼š
- æ–°å·¥å…·ï¼šå®æ—¶ç´¢å¼•
- ä¿®æ”¹å·¥å…·ï¼šè§¦å‘é‡æ–°ç´¢å¼•
- åˆ é™¤å·¥å…·ï¼šä»ç´¢å¼•ä¸­ç§»é™¤

### 5.5 æ ¸å¿ƒç»„ä»¶è®¾è®¡

#### ä¿ç•™ç»„ä»¶ï¼ˆä¸å˜ï¼‰

**1. SkillManager**
- ä¿æŒç°æœ‰åŠŸèƒ½ä¸å˜
- ç»§ç»­ç®¡ç†Skillsçš„å®‰è£…ã€å¸è½½ã€æ›´æ–°
- ç‹¬ç«‹è¿è¡Œï¼Œä¸å—MCPå½±å“

**2. ToolRetrievalService**
- ä¿æŒç°æœ‰å‘é‡æ£€ç´¢åŠŸèƒ½
- ç»§ç»­ä¸ºSkillsæä¾›å·¥å…·å‘ç°æœåŠ¡
- æ— éœ€ä¿®æ”¹

#### æ–°å¢ç»„ä»¶

**3. MCPServerManager**
- ç‹¬ç«‹ç®¡ç†MCPæœåŠ¡å™¨
- æœåŠ¡å™¨æ³¨å†Œå’Œé…ç½®
- ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆå¯åŠ¨/åœæ­¢/é‡å¯ï¼‰
- å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡å¯

**4. MCPClient**
- è¿æ¥åˆ°å¤–éƒ¨MCPæœåŠ¡å™¨
- å·¥å…·å‘ç°å’Œè°ƒç”¨
- ä¼šè¯ç®¡ç†

**5. UnifiedToolManager**
- ç»Ÿä¸€ç®¡ç†Skillså’ŒMCPå·¥å…·
- æä¾›ç»Ÿä¸€çš„å·¥å…·è°ƒç”¨æ¥å£
- åŒè½¨å·¥å…·å‘ç°å’Œæ£€ç´¢
- é€æ˜çš„åè®®é€‚é…å±‚

#### ä¾èµ–æ·»åŠ 

```json
{
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.0.0"
  }
}
```

---

## 6. MCPæœåŠ¡å™¨ç®¡ç†æ–¹æ¡ˆ

### 6.0 ä¸Skillsç³»ç»Ÿçš„å…³ç³»

**é‡è¦è¯´æ˜**ï¼šMCPæœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿä¸ç°æœ‰Skillsç³»ç»Ÿ**å®Œå…¨ç‹¬ç«‹**ï¼Œå¹¶è¡Œè¿è¡Œï¼š

- âœ… **æ— ä¾èµ–å…³ç³»**ï¼šMCPç³»ç»Ÿä¸ä¾èµ–Skillsï¼ŒSkillsä¹Ÿä¸ä¾èµ–MCP
- âœ… **ç‹¬ç«‹ç®¡ç†**ï¼šMCPæœåŠ¡å™¨ç”±MCPServerManagerç‹¬ç«‹ç®¡ç†
- âœ… **ç»Ÿä¸€æ¥å£**ï¼šé€šè¿‡UnifiedToolManageræä¾›ç»Ÿä¸€è®¿é—®
- âœ… **ç”¨æˆ·é€‰æ‹©**ï¼šç”¨æˆ·å¯é€‰æ‹©ä½¿ç”¨Skillsã€MCPæˆ–ä¸¤è€…

### 6.1 æœåŠ¡å™¨ç±»å‹

| ç±»å‹ | ä¼ è¾“æ–¹å¼ | éƒ¨ç½²æ–¹å¼ | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|----------|
| **æœ¬åœ°è¿›ç¨‹å‹** | stdio | npm/git/Docker | è‡ªå®šä¹‰å·¥å…·ã€å¼€å‘ç¯å¢ƒ |
| **è¿œç¨‹æœåŠ¡å‹** | SSE/HTTP | URLé…ç½® | äº‘ç«¯æœåŠ¡ã€ä¼ä¸šå†…ç½‘ |
| **æ··åˆå‹** | stdio+SSE | çµæ´»é…ç½® | ç”Ÿäº§ç¯å¢ƒã€å¤šåœºæ™¯ |

### 6.2 å®‰è£…æ–¹å¼å¯¹æ¯”

| å®‰è£…æ–¹å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|----------|----------|------|------|
| **npmå®‰è£…** | å®˜æ–¹/ç¤¾åŒºæœåŠ¡å™¨ | ç®€å•ã€ç‰ˆæœ¬ç®¡ç† | éœ€è¦Node.jsç¯å¢ƒ |
| **gitå…‹éš†** | å¼€å‘ä¸­ç‰ˆæœ¬ | å¯å®šåˆ¶ã€æœ€æ–°ä»£ç  | éœ€æ‰‹åŠ¨æ›´æ–° |
| **Dockeré•œåƒ** | ç”Ÿäº§éƒ¨ç½² | éš”ç¦»æ€§å¥½ã€æ˜“æ‰©å±• | èµ„æºå ç”¨é«˜ |
| **è¿œç¨‹é…ç½®** | äº‘ç«¯æœåŠ¡ | æ— éœ€æœ¬åœ°å®‰è£… | ä¾èµ–ç½‘ç»œ |

### 6.3 ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### æ ¸å¿ƒåŠŸèƒ½

```
MCPServerManager
â”œâ”€â”€ æœåŠ¡å™¨æ³¨å†Œ
â”‚   â”œâ”€â”€ æœ¬åœ°æœåŠ¡å™¨å®‰è£…
â”‚   â”œâ”€â”€ è¿œç¨‹æœåŠ¡å™¨é…ç½®
â”‚   â””â”€â”€ åŠ¨æ€å‘ç°
â”œâ”€â”€ ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”‚   â”œâ”€â”€ å¯åŠ¨/åœæ­¢
â”‚   â”œâ”€â”€ é‡å¯æœºåˆ¶
â”‚   â””â”€â”€ å¥åº·æ£€æŸ¥
â”œâ”€â”€ é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ è¿æ¥å‚æ•°
â”‚   â”œâ”€â”€ è®¤è¯ä¿¡æ¯
â”‚   â””â”€â”€ ç¯å¢ƒå˜é‡
â””â”€â”€ ç‰ˆæœ¬ç®¡ç†
    â”œâ”€â”€ æ›´æ–°æ£€æŸ¥
    â”œâ”€â”€ è‡ªåŠ¨æ›´æ–°
    â””â”€â”€ å›æ»šæœºåˆ¶
```

#### å¥åº·æ£€æŸ¥æœºåˆ¶

- **æœ¬åœ°æœåŠ¡å™¨**ï¼šæ£€æŸ¥è¿›ç¨‹æ˜¯å¦å­˜åœ¨
- **è¿œç¨‹æœåŠ¡å™¨**ï¼šHTTPç«¯ç‚¹å¯è¾¾æ€§æµ‹è¯•
- **è‡ªåŠ¨é‡å¯**ï¼šä¸å¥åº·æœåŠ¡å™¨è‡ªåŠ¨é‡å¯
- **å®šæœŸæ£€æŸ¥**ï¼šé»˜è®¤60ç§’é—´éš”

### 6.4 æ•°æ®åº“è®¾è®¡

```sql
-- MCPæœåŠ¡å™¨è¡¨
CREATE TABLE mcp_servers (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  type TEXT NOT NULL, -- 'local' | 'remote' | 'hybrid'
  transport TEXT NOT NULL, -- 'stdio' | 'sse' | 'http'
  install_type TEXT NOT NULL, -- 'npm' | 'git' | 'docker' | 'url'
  config TEXT NOT NULL, -- JSONé…ç½®
  status TEXT NOT NULL, -- 'active' | 'inactive' | 'error'
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  last_used DATETIME,
  version TEXT
);

-- æœåŠ¡å™¨è¿è¡Œå®ä¾‹è¡¨
CREATE TABLE mcp_server_instances (
  id TEXT PRIMARY KEY,
  server_id TEXT NOT NULL,
  pid INTEGER,
  status TEXT NOT NULL,
  start_time DATETIME,
  FOREIGN KEY (server_id) REFERENCES mcp_servers(id)
);

-- å·¥å…·ç´¢å¼•ç¼“å­˜è¡¨
CREATE TABLE mcp_tools_cache (
  id TEXT PRIMARY KEY,
  server_id TEXT NOT NULL,
  tool_name TEXT NOT NULL,
  description TEXT,
  parameters TEXT, -- JSON Schema
  cached_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (server_id) REFERENCES mcp_servers(id)
);
```

### 6.5 APIæ¥å£

#### 6.5.1 æœåŠ¡å™¨ç®¡ç†

```typescript
// æ³¨å†ŒMCPæœåŠ¡å™¨
POST /api/mcp/servers
{
  "name": "github-mcp",
  "type": "local",
  "transport": "stdio",
  "config": {
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-github"],
    "env": { "GITHUB_TOKEN": "${env:GITHUB_TOKEN}" }
  }
}

// è·å–MCPæœåŠ¡å™¨åˆ—è¡¨
GET /api/mcp/servers?status=all&type=all&limit=20&offset=0
/*
è¿”å›ç»“æœï¼š
{
  "servers": [
    {
      "id": "srv_001",
      "name": "github-mcp",
      "type": "local",
      "transport": "stdio",
      "status": "running",
      "version": "1.0.0",
      "last_used": "2025-12-15T10:30:00Z",
      "created_at": "2025-12-01T10:00:00Z",
      "tools_count": 15
    },
    {
      "id": "srv_002",
      "name": "postgresql",
      "type": "remote",
      "transport": "sse",
      "status": "active",
      "version": "2.1.0",
      "last_used": "2025-12-15T09:15:00Z",
      "created_at": "2025-12-10T14:00:00Z",
      "tools_count": 8
    }
  ],
  "total": 5,
  "limit": 20,
  "offset": 0
}
*/

// è·å–å•ä¸ªæœåŠ¡å™¨è¯¦æƒ…
GET /api/mcp/servers/:id
/*
è¿”å›ç»“æœï¼š
{
  "id": "srv_001",
  "name": "github-mcp",
  "type": "local",
  "transport": "stdio",
  "install_type": "npm",
  "status": "running",
  "version": "1.0.0",
  "config": {
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-github"],
    "env": {
      "GITHUB_TOKEN": "***"
    },
    "autoRestart": true,
    "timeout": 30000
  },
  "instance": {
    "pid": 12345,
    "start_time": "2025-12-15T10:00:00Z",
    "uptime": 1800,
    "memory_usage": "45MB",
    "cpu_usage": "2.5%"
  },
  "created_at": "2025-12-01T10:00:00Z",
  "updated_at": "2025-12-15T10:00:00Z",
  "last_used": "2025-12-15T10:30:00Z"
}
*/

// æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
GET /api/mcp/servers/:id/status
/*
è¿”å›ç»“æœï¼š
{
  "id": "srv_001",
  "name": "github-mcp",
  "status": "running",
  "health": {
    "overall": "healthy",
    "checks": [
      {
        "name": "process_running",
        "status": "healthy",
        "message": "Process is running",
        "response_time": 5
      },
      {
        "name": "mcp_handshake",
        "status": "healthy",
        "message": "MCP handshake successful",
        "response_time": 45
      },
      {
        "name": "tool_discovery",
        "status": "healthy",
        "message": "15 tools discovered",
        "response_time": 120
      }
    ],
    "last_check": "2025-12-15T10:30:00Z",
    "response_time": 170
  },
  "instance": {
    "pid": 12345,
    "uptime": 1800,
    "memory_usage": "45MB",
    "cpu_usage": "2.5%"
  }
}
*/

// æ‰¹é‡æ£€æŸ¥æ‰€æœ‰æœåŠ¡å™¨çŠ¶æ€
GET /api/mcp/servers/status?summary=true
/*
è¿”å›ç»“æœï¼š
{
  "summary": {
    "total": 5,
    "healthy": 3,
    "unhealthy": 1,
    "not_running": 1
  },
  "servers": [
    {
      "id": "srv_001",
      "name": "github-mcp",
      "status": "running",
      "health": "healthy",
      "response_time": 170
    },
    {
      "id": "srv_002",
      "name": "postgresql",
      "status": "active",
      "health": "healthy",
      "response_time": 85
    },
    {
      "id": "srv_003",
      "name": "filesystem",
      "status": "stopped",
      "health": "not_running",
      "response_time": null
    }
  ]
}
*/

// ç”Ÿå‘½å‘¨æœŸç®¡ç†
POST /api/mcp/servers/:id/start
/*
è¿”å›ç»“æœï¼š
{
  "success": true,
  "message": "Server started successfully",
  "instance": {
    "pid": 12346,
    "start_time": "2025-12-15T10:35:00Z"
  }
}
*/

POST /api/mcp/servers/:id/stop
/*
è¿”å›ç»“æœï¼š
{
  "success": true,
  "message": "Server stopped successfully"
}
*/

POST /api/mcp/servers/:id/restart
/*
è¿”å›ç»“æœï¼š
{
  "success": true,
  "message": "Server restarted successfully",
  "instance": {
    "pid": 12347,
    "start_time": "2025-12-15T10:35:30Z",
    "downtime": 3
  }
}
*/
```

#### 6.5.2 å·¥å…·ç®¡ç†

```typescript
// è·å–æœåŠ¡å™¨å·¥å…·åˆ—è¡¨
GET /api/mcp/servers/:id/tools
/*
è¿”å›ç»“æœï¼š
{
  "server_id": "srv_001",
  "server_name": "github-mcp",
  "tools": [
    {
      "name": "create_issue",
      "description": "Create a new GitHub issue",
      "parameters": {
        "type": "object",
        "properties": {
          "title": { "type": "string" },
          "body": { "type": "string" },
          "labels": { "type": "array", "items": { "type": "string" } }
        }
      },
      "tags": ["github", "issues"]
    },
    {
      "name": "create_repository",
      "description": "Create a new GitHub repository",
      "parameters": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "description": { "type": "string" },
          "private": { "type": "boolean" }
        }
      },
      "tags": ["github", "repository"]
    }
  ],
  "total": 15,
  "cached_at": "2025-12-15T10:30:00Z"
}
*/

// è°ƒç”¨å·¥å…·
POST /api/mcp/tools/:serverId/:toolName
{
  "arguments": {
    "title": "Bug Report",
    "body": "æè¿°é—®é¢˜...",
    "labels": ["bug", "priority-high"]
  },
  "timeout": 30000
}
/*
è¿”å›ç»“æœï¼š
{
  "success": true,
  "result": {
    "id": 123,
    "number": 456,
    "url": "https://github.com/user/repo/issues/456",
    "title": "Bug Report",
    "created_at": "2025-12-15T10:35:00Z"
  },
  "execution_time": 1250
}
*/

// ç»Ÿä¸€å·¥å…·æœç´¢ï¼ˆå‘é‡æœç´¢ï¼‰
GET /api/tools/search?query=ç”Ÿæˆå›¾ç‰‡&limit=5
/*
è¿”å›ç»“æœï¼š
{
  "query": "ç”Ÿæˆå›¾ç‰‡",
  "tools": [
    {
      "name": "siliconflow-image-generator",
      "type": "skill",
      "source": "skill-manager",
      "description": "SiliconFlowå›¾åƒç”Ÿæˆå·¥å…·",
      "score": 0.92,
      "tags": ["image", "generation", "siliconflow"]
    },
    {
      "name": "stability_ai_generate",
      "type": "mcp",
      "source": "srv_004",
      "description": "Stability AIå›¾åƒç”Ÿæˆ",
      "score": 0.88,
      "tags": ["image", "generation", "stability-ai"]
    }
  ]
}
*/

// å¸è½½
DELETE /api/mcp/servers/:id
/*
è¿”å›ç»“æœï¼š
{
  "success": true,
  "message": "Server uninstalled successfully",
  "removed_files": [
    "/var/lib/mcp-servers/github-mcp",
    "/etc/apex-bridge/mcp-servers/github-mcp.json"
  ]
}
*/
```

### 6.6 ç»Ÿä¸€å·¥å…·ç®¡ç†

#### ç»Ÿä¸€æ¥å£

```typescript
interface UnifiedToolManager {
  // Skillsç®¡ç†
  installSkill(options: SkillInstallOptions): Promise<InstallResult>;
  uninstallSkill(skillName: string): Promise<UninstallResult>;
  listSkills(): Promise<SkillTool[]>;

  // MCPæœåŠ¡å™¨ç®¡ç†
  installMCPServer(options: MCPServerInstallOptions): Promise<InstallResult>;
  uninstallMCPServer(serverId: string): Promise<UninstallResult>;
  listMCPServers(): Promise<MCPServer[]>;

  // ç»Ÿä¸€å·¥å…·æ£€ç´¢ï¼ˆå‘é‡æœç´¢ï¼‰
  searchTools(query: string): Promise<ToolRetrievalResult[]>;
  executeTool(name: string, args: any): Promise<ToolResult>;

  // ç»Ÿä¸€å‘é‡ç´¢å¼•ç®¡ç†
  reindexAllTools(): Promise<void>;
  reindexTool(name: string): Promise<void>;
}
```

#### APIä½¿ç”¨ç¤ºä¾‹

```typescript
// 1. åŠ¨æ€å‘ç°å·¥å…·ï¼ˆè¯­ä¹‰æœç´¢ï¼‰
const tools = await unifiedToolManager.searchTools("ç”Ÿæˆå›¾ç‰‡");
/*
è¿”å›ç»“æœï¼š
[
  {
    tool: { name: "siliconflow-image-generator", type: "skill" },
    score: 0.92,
    reason: "è¯­ä¹‰ç›¸ä¼¼åº¦æœ€é«˜"
  },
  {
    tool: { name: "stability_ai_generate", type: "mcp" },
    score: 0.88,
    reason: "è¯­ä¹‰ç›¸ä¼¼åº¦æ¬¡é«˜"
  }
]
*/

// 2. æ‰§è¡Œå·¥å…·ï¼ˆè‡ªåŠ¨è·¯ç”±ï¼‰
const result = await unifiedToolManager.executeTool("siliconflow-image-generator", {
  prompt: "ä¸€åªå¯çˆ±çš„å°çŒ«",
  image_size: "512x512"
});
// ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­è¿™æ˜¯Skillï¼Œè·¯ç”±åˆ°SkillManageræ‰§è¡Œ

// 3. ç›´æ¥æ‰§è¡ŒMCPå·¥å…·ï¼ˆæ— éœ€å…³å¿ƒç±»å‹ï¼‰
const githubResult = await unifiedToolManager.executeTool("github:create_issue", {
  title: "Bug Report",
  body: "æè¿°é—®é¢˜..."
});
// ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­è¿™æ˜¯MCPå·¥å…·ï¼Œè·¯ç”±åˆ°MCPServeræ‰§è¡Œ
```

#### ç»Ÿä¸€å·¥å…·ç´¢å¼•

```
ç»Ÿä¸€å·¥å…·ç´¢å¼•
â”œâ”€â”€ å†…ç½®å·¥å…· (Built-in)
â”‚   â”œâ”€â”€ æ–‡ä»¶æ“ä½œ
â”‚   â”œâ”€â”€ ç½‘ç»œè¯·æ±‚
â”‚   â””â”€â”€ ç³»ç»Ÿå·¥å…·
â”œâ”€â”€ Skillså·¥å…· (Skills)
â”‚   â”œâ”€â”€ siliconflow-image-generator
â”‚   â”œâ”€â”€ data-validator
â”‚   â””â”€â”€ git-commit-helper
â””â”€â”€ MCPå·¥å…· (MCP Servers)
    â”œâ”€â”€ github-mcp (create_issue, create_repo, search)
    â”œâ”€â”€ filesystem-mcp (read_file, write_file, list)
    â””â”€â”€ postgresql-mcp (query, insert, update)
```

### 6.7 éƒ¨ç½²å»ºè®®

#### å¼€å‘ç¯å¢ƒ

```bash
# å¿«é€Ÿå®‰è£…
npm install -g @modelcontextprotocol/server-github
npm install -g @modelcontextprotocol/server-filesystem

# æˆ–ä½¿ç”¨mcp-cli
mcp install github @modelcontextprotocol/server-github
```

#### ç”Ÿäº§ç¯å¢ƒ

```yaml
# docker-compose.yml
version: '3.8'
services:
  apex-bridge:
    image: apex-bridge:latest
    environment:
      - MCP_SERVERS_CONFIG=/etc/apex-bridge/mcp-servers.json
    volumes:
      - ./mcp-servers:/var/lib/mcp-servers
      - ./config/mcp-servers.json:/etc/apex-bridge/mcp-servers.json:ro
```

### 6.8 é…ç½®ç¤ºä¾‹

```json
{
  "mcpServers": [
    {
      "name": "github",
      "type": "local",
      "transport": "stdio",
      "installType": "npm",
      "config": {
        "command": "npx",
        "args": ["-y", "@modelcontextprotocol/server-github"],
        "env": {
          "GITHUB_PERSONAL_ACCESS_TOKEN": "${env:GITHUB_TOKEN}"
        },
        "autoRestart": true
      }
    },
    {
      "name": "postgresql",
      "type": "remote",
      "transport": "sse",
      "installType": "url",
      "config": {
        "endpoint": "https://mcp.company.com/postgresql",
        "auth": {
          "type": "bearer",
          "token": "${env:POSTGRESQL_MCP_TOKEN}"
        },
        "timeout": 30000
      }
    }
  ]
}
```

### 6.9 æœ€ä½³å®è·µ

#### å®‰è£…å»ºè®®

**å¼€å‘ç¯å¢ƒ**ï¼š
- ä½¿ç”¨npmå®‰è£…ï¼Œä¾¿äºè°ƒè¯•
- å¯ç”¨è¯¦ç»†æ—¥å¿—
- ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
- ä½¿ç”¨Dockeréƒ¨ç½²ï¼Œèµ„æºéš”ç¦»
- é”å®šç‰ˆæœ¬å·ï¼Œé¿å…æ„å¤–æ›´æ–°
- é…ç½®èµ„æºé™åˆ¶
- å¯ç”¨è‡ªåŠ¨é‡å¯

**è¿œç¨‹æœåŠ¡**ï¼š
- ä½¿ç”¨HTTPSç¡®ä¿å®‰å…¨
- é…ç½®é€‚å½“çš„è¶…æ—¶æ—¶é—´
- å¯ç”¨è®¤è¯å’Œæˆæƒ
- ç›‘æ§æœåŠ¡å¯ç”¨æ€§

#### ç®¡ç†å»ºè®®

**ç‰ˆæœ¬ç®¡ç†**ï¼š
- å®šæœŸæ£€æŸ¥æ›´æ–°
- æµ‹è¯•ç¯å¢ƒå…ˆè¡ŒéªŒè¯
- ä¿æŒç‰ˆæœ¬é”å®š
- è®°å½•å˜æ›´æ—¥å¿—

**å®‰å…¨å»ºè®®**ï¼š
- æœ€å°æƒé™åŸåˆ™
- å®šæœŸè½®æ¢è®¤è¯ä»¤ç‰Œ
- å®¡è®¡å·¥å…·è°ƒç”¨æ—¥å¿—
- éš”ç¦»æ•æ„Ÿæ•°æ®

**æ€§èƒ½ä¼˜åŒ–**ï¼š
- ç¼“å­˜å·¥å…·åˆ—è¡¨
- è¿æ¥æ± å¤ç”¨
- é™åˆ¶å¹¶å‘è¿æ¥æ•°
- ç›‘æ§å“åº”æ—¶é—´

---

## 7. å®æ–½è·¯çº¿å›¾

### 7.1 é˜¶æ®µ1ï¼šå¹¶è¡Œæ¶æ„æ­å»ºï¼ˆ2-3å‘¨ï¼‰

**ç›®æ ‡**ï¼šå»ºç«‹Skillså’ŒMCPåŒè½¨å¹¶è¡Œæ¶æ„

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ·»åŠ MCP TypeScript SDKä¾èµ–
- [ ] åˆ›å»ºMCPServerManageråŸºç¡€ç±»
- [ ] å®ç°MCPæœåŠ¡å™¨ç‹¬ç«‹ç®¡ç†
- [ ] åˆ›å»ºUnifiedToolManageræŠ½è±¡å±‚
- [ ] ä¿æŒSkillManagerå®Œå…¨ä¸å˜
- [ ] åŸºç¡€å•å…ƒæµ‹è¯•

**äº¤ä»˜ç‰©**ï¼š
- MCPç‹¬ç«‹ç®¡ç†ç³»ç»Ÿ
- ç»Ÿä¸€å·¥å…·ç®¡ç†æ¥å£
- Skillsç³»ç»Ÿä¿æŒä¸å˜
- å•å…ƒæµ‹è¯•å¥—ä»¶

### 7.2 é˜¶æ®µ2ï¼šç»Ÿä¸€å‘é‡æœç´¢ï¼ˆ2-3å‘¨ï¼‰

**ç›®æ ‡**ï¼šå®ç°MCPå’ŒSkillså·¥å…·çš„ç»Ÿä¸€å‘é‡ç´¢å¼•ä¸è¯­ä¹‰æœç´¢

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] è®¾è®¡ç»Ÿä¸€å·¥å…·ç´¢å¼•æ•°æ®ç»“æ„
- [ ] å®ç°å·¥å…·å…ƒæ•°æ®å‘é‡åŒ–
- [ ] æ„å»ºå‘é‡æ•°æ®åº“ç´¢å¼•
- [ ] å¼€å‘è¯­ä¹‰æœç´¢åŠŸèƒ½
- [ ] å®ç°é€æ˜è·¯ç”±æœºåˆ¶
- [ ] é›†æˆæµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–

**äº¤ä»˜ç‰©**ï¼š
- ç»Ÿä¸€å‘é‡æœç´¢ç³»ç»Ÿ
- è¯­ä¹‰åŒ¹é…å’Œè‡ªåŠ¨è·¯ç”±
- å®Œæ•´çš„æœç´¢å’Œè°ƒç”¨API

### 7.3 é˜¶æ®µ3ï¼šå¯é€‰MCPæœåŠ¡å™¨æ¨¡å¼ï¼ˆ2-3å‘¨ï¼‰

**ç›®æ ‡**ï¼šå¯é€‰åœ°å°†ApexBridgeæš´éœ²ä¸ºMCPæœåŠ¡å™¨

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»ºApexBridge MCPæœåŠ¡å™¨
- [ ] å¯é€‰ï¼šå°†Skillsä½œä¸ºMCPå·¥å…·æš´éœ²ï¼ˆç”¨æˆ·å¯é€‰ï¼‰
- [ ] æ·»åŠ èµ„æºç®¡ç†åŠŸèƒ½
- [ ] æ”¯æŒstdioå’ŒSSEä¼ è¾“
- [ ] éƒ¨ç½²å’Œæ–‡æ¡£

**äº¤ä»˜ç‰©**ï¼š
- ApexBridge MCPæœåŠ¡å™¨ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
- éƒ¨ç½²é…ç½®
- ä½¿ç”¨æ–‡æ¡£

**æ³¨æ„**ï¼šæ­¤é˜¶æ®µä¸º**å¯é€‰**ï¼Œå¦‚æœç”¨æˆ·ä¸éœ€è¦å¯¹å¤–æä¾›æœåŠ¡ï¼Œå¯ä»¥è·³è¿‡

### 7.4 é˜¶æ®µ4ï¼šç”Ÿæ€ç³»ç»Ÿé›†æˆï¼ˆæŒç»­ï¼‰

**ç›®æ ‡**ï¼šè¿æ¥å¤–éƒ¨MCPæœåŠ¡å™¨ï¼Œå¢å¼ºåŠŸèƒ½

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] é›†æˆå¸¸ç”¨MCPæœåŠ¡å™¨ï¼ˆGitHubã€Google Driveç­‰ï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜
- [ ] ç›‘æ§å’Œæ—¥å¿—
- [ ] ç¤¾åŒºè´¡çŒ®

**äº¤ä»˜ç‰©**ï¼š
- é¢„é›†æˆçš„MCPæœåŠ¡å™¨åˆ—è¡¨
- æ€§èƒ½ä¼˜åŒ–æŠ¥å‘Š
- ç¤¾åŒºè´¡çŒ®æŒ‡å—

---

## 8. é£é™©è¯„ä¼°ä¸ç¼“è§£

### 8.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| åè®®è½¬æ¢å¤æ‚æ€§ | ä¸­ | ä¸­ | åˆ†é˜¶æ®µå®æ–½ï¼Œå……åˆ†æµ‹è¯• |
| æ€§èƒ½å¼€é”€ | ä½ | ä½ | å¼‚æ­¥å¤„ç†ï¼Œè¿æ¥æ±  |
| ä¾èµ–å‡çº§å†²çª | ä¸­ | ä¸­ | ç‰ˆæœ¬é”å®šï¼Œå…¼å®¹æ€§æµ‹è¯• |
| å·¥å…·è°ƒç”¨å»¶è¿Ÿ | ä¸­ | ä¸­ | å¹¶å‘æ§åˆ¶ï¼Œè¶…æ—¶è®¾ç½® |

### 8.2 ä¸šåŠ¡é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| ç”¨æˆ·å­¦ä¹ æˆæœ¬ | ä½ | ä½ | å‘åå…¼å®¹ï¼Œæ¸è¿›è¿ç§» |
| ç”Ÿæ€ç³»ç»Ÿæˆç†Ÿåº¦ | ä¸­ | ä¸­ | ä¿æŒçµæ´»æ€§ï¼Œé¿å…ç¡¬ç¼–ç  |
| ç»´æŠ¤æˆæœ¬å¢åŠ  | ä¸­ | ä½ | è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæ–‡æ¡£å®Œå–„ |

---

## 9. æˆæœ¬æ•ˆç›Šåˆ†æ

### 9.1 å¼€å‘æˆæœ¬

- **å¼€å‘æ—¶é—´**ï¼š8-10å‘¨ï¼ˆå…¨èŒï¼‰
- **äººåŠ›éœ€æ±‚**ï¼š1-2åå¼€å‘äººå‘˜
- **æµ‹è¯•æˆæœ¬**ï¼šé¢å¤–20%æ—¶é—´
- **ä¼˜åŠ¿**ï¼šæ— éœ€è¿ç§»ç°æœ‰Skillsï¼ŒèŠ‚çœå¤§é‡é‡æ„æˆæœ¬

### 9.2 é¢„æœŸæ”¶ç›Š

#### åŠŸèƒ½å¢å¼º

- âœ… è®¿é—®247+ç¤¾åŒºMCPæœåŠ¡å™¨
- âœ… å·¥å…·ç”Ÿæ€äº’æ“ä½œæ€§
- âœ… æ ‡å‡†åŒ–å·¥å…·è°ƒç”¨æ¥å£
- âœ… å¤šå¹³å°æ”¯æŒï¼ˆClaude Desktopã€Cursorç­‰ï¼‰

#### é•¿æœŸä»·å€¼

- **ç”Ÿæ€ç³»ç»Ÿ**ï¼šæ¥å…¥æ›´å¤§çš„AIå·¥å…·ç”Ÿæ€
- **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
- **ç¤¾åŒºæ”¯æŒ**ï¼šåˆ©ç”¨MCPç¤¾åŒºèµ„æº
- **ç«äº‰ä¼˜åŠ¿**ï¼šæå‰å¸ƒå±€æ–°æŠ€æœ¯

### 9.3 ROIè¯„ä¼°

| æŒ‡æ ‡ | ç°çŠ¶ | é›†æˆå | æ”¹å–„ |
|------|------|--------|------|
| å¯ç”¨å·¥å…·æ•°é‡ | 10-20ä¸ª | 247+ä¸ª | **10-20å€å¢é•¿** |
| ç”Ÿæ€ç³»ç»Ÿé›†æˆåº¦ | ä½ | é«˜ | **æ˜¾è‘—æå‡** |
| æ ‡å‡†åŒ–ç¨‹åº¦ | ç§æœ‰åè®® | è¡Œä¸šæ ‡å‡† | **å¤§å¹…æ”¹å–„** |

---

## 10. å®æ–½å»ºè®®

### 10.1 ç«‹å³è¡ŒåŠ¨é¡¹

1. **åˆ›å»ºæ¦‚å¿µéªŒè¯ï¼ˆPOCï¼‰**
   ```bash
   npm install @modelcontextprotocol/sdk
   # åˆ›å»ºMCPServerManager
   # å®ç°ç‹¬ç«‹çš„MCPæœåŠ¡å™¨ç®¡ç†
   ```

2. **ä¿æŒç°æœ‰Skillsä¸å˜**
   - ç°æœ‰Skillsç³»ç»Ÿ**æ— éœ€ä¿®æ”¹**
   - ç»§ç»­ä½¿ç”¨ç°æœ‰APIå’ŒåŠŸèƒ½
   - ç‹¬ç«‹è¿è¡Œï¼Œäº’ä¸å¹²æ‰°

3. **åˆ¶å®šå¹¶è¡Œæ¶æ„è®¾è®¡æ–‡æ¡£**
   - åŒè½¨å¹¶è¡Œæ¶æ„è®¾è®¡
   - ç»Ÿä¸€ç®¡ç†æ¥å£è®¾è®¡
   - å·¥å…·å‘ç°åŒè½¨æœºåˆ¶

### 10.2 å…³é”®æŠ€æœ¯å†³ç­–

#### ä¼ è¾“åè®®é€‰æ‹©

**æ¨è**ï¼šSSEï¼ˆServer-Sent Eventsï¼‰
- âœ… Webå‹å¥½
- âœ… æ˜“äºè°ƒè¯•
- âœ… é˜²ç«å¢™ç©¿é€æ€§å¥½
- âœ… ä¸ç°æœ‰WebSocketæ¶æ„å…¼å®¹

**å¤‡é€‰**ï¼šstdio
- âœ… æ€§èƒ½æ›´å¥½
- âŒ ä»…é€‚ç”¨äºæœ¬åœ°è¿›ç¨‹

#### å·¥å…·å‘ç°æœºåˆ¶

**ä¿æŒç°æœ‰å‘é‡æ£€ç´¢**
- åˆ©ç”¨@xenova/transformersåµŒå…¥æ¨¡å‹
- ä¿æŒToolRetrievalService
- æ·»åŠ MCPå·¥å…·ç´¢å¼•

#### åŒè½¨å¹¶è¡Œç­–ç•¥

**ç‹¬ç«‹å¹¶è¡Œ**
- Skillsç³»ç»Ÿä¿æŒç°æœ‰æ¶æ„å’ŒAPI
- MCPç³»ç»Ÿç‹¬ç«‹æ­å»ºå’Œç®¡ç†
- é€šè¿‡UnifiedToolManagerç»Ÿä¸€æ¥å£è®¿é—®
- ç”¨æˆ·å¯æ ¹æ®éœ€æ±‚é€‰æ‹©ä½¿ç”¨å“ªä¸ªç³»ç»Ÿ

#### å·¥å…·å‘ç°æœºåˆ¶

**åŒè½¨æ£€ç´¢**
- **ç»Ÿä¸€å‘é‡æœç´¢**ï¼ˆæ¨èï¼‰ï¼šå°†MCPå’ŒSkillså·¥å…·çš„å…ƒæ•°æ®ç»Ÿä¸€å­˜å…¥å‘é‡æ•°æ®åº“ï¼Œé€šè¿‡è¯­ä¹‰æœç´¢åŠ¨æ€å‘ç°æœ€åˆé€‚çš„å·¥å…·
- **é€æ˜è·¯ç”±**ï¼šæœç´¢ç»“æœè‡ªåŠ¨è·¯ç”±åˆ°å¯¹åº”ç³»ç»Ÿï¼ˆSkillsæˆ–MCPï¼‰
- **æ— æ„Ÿåˆ‡æ¢**ï¼šç”¨æˆ·æ— éœ€åŒºåˆ†å·¥å…·ç±»å‹ï¼Œç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©

### 10.3 æˆåŠŸæŒ‡æ ‡

#### æŠ€æœ¯æŒ‡æ ‡

- [ ] æˆåŠŸé›†æˆMCP TypeScript SDK
- [ ] å·¥å…·è°ƒç”¨å»¶è¿Ÿ < 500ms
- [ ] æ”¯æŒ100+å¹¶å‘è¿æ¥
- [ ] 99.9%å¯ç”¨æ€§
- [ ] Skillsç³»ç»Ÿé›¶æ•…éšœè¿è¡Œ

#### åŠŸèƒ½æŒ‡æ ‡

- [ ] MCPç³»ç»Ÿç‹¬ç«‹è¿è¡Œ
- [ ] é›†æˆ10+å¤–éƒ¨MCPæœåŠ¡å™¨
- [ ] æ”¯æŒstdioå’ŒSSEä¼ è¾“
- [ ] ç»Ÿä¸€å‘é‡æœç´¢ç³»ç»Ÿ
- [ ] è¯­ä¹‰åŒ¹é…å’Œè‡ªåŠ¨è·¯ç”±

#### å…¼å®¹æ€§æŒ‡æ ‡

- [ ] ç°æœ‰Skills APIå®Œå…¨å…¼å®¹
- [ ] ç°æœ‰åŠŸèƒ½æ— ä»»ä½•ç ´åæ€§å˜æ›´
- [ ] Skillså’ŒMCPå¯å¹¶è¡Œä½¿ç”¨
- [ ] å·¥å…·å‘ç°é›¶æ„ŸçŸ¥åˆ‡æ¢
- [ ] æœç´¢å‡†ç¡®ç‡ > 85%

---

## 11. ç»“è®º

### 11.1 æœ€ç»ˆç»“è®º

**ApexBridgeé¡¹ç›®é›†æˆMCPå…·æœ‰æé«˜çš„å¯è¡Œæ€§å’Œä»·å€¼**ï¼š

1. **æŠ€æœ¯å¯è¡Œæ€§**ï¼šâ­â­â­â­â­
   - æ¶æ„å®Œç¾åŒ¹é…
   - TypeScriptåŸç”Ÿæ”¯æŒ
   - æ— éœ€å¤§è§„æ¨¡é‡æ„

2. **å•†ä¸šä»·å€¼**ï¼šâ­â­â­â­â­
   - 10-20å€å·¥å…·æ•°é‡å¢é•¿
   - æ¥å…¥247+ç”Ÿæ€ç³»ç»Ÿ
   - è¡Œä¸šæ ‡å‡†å…¼å®¹æ€§

3. **é£é™©ç­‰çº§**ï¼šâ­â­ï¼ˆä½é£é™©ï¼‰
   - å‘åå…¼å®¹
   - æ¸è¿›å¼è¿ç§»
   - æˆç†ŸæŠ€æœ¯æ ˆ

### 11.2 å»ºè®®è¡ŒåŠ¨

**ç«‹å³å¯åŠ¨**ï¼š
- å¼€å§‹POCå¼€å‘ï¼ˆç‹¬ç«‹MCPç³»ç»Ÿï¼‰
- ç»„å»º2äººå°å›¢é˜Ÿ
- åˆ¶å®šå¹¶è¡Œæ¶æ„å®æ–½è®¡åˆ’

**ä¼˜å…ˆé›†æˆæ¨¡å¼**ï¼š
1. **åŒè½¨å¹¶è¡Œæ¨¡å¼**ï¼ˆæ¨èï¼‰
   - Skillsç³»ç»Ÿä¿æŒä¸å˜
   - MCPç³»ç»Ÿç‹¬ç«‹æ­å»º
   - ç»Ÿä¸€ç®¡ç†æ¥å£

2. **é›¶ç ´åæ€§å˜æ›´**
   - ç°æœ‰APIå®Œå…¨å…¼å®¹
   - ç°æœ‰åŠŸèƒ½æ— å½±å“
   - ç”¨æˆ·è‡ªä¸»é€‰æ‹©

**å…³é”®æˆåŠŸå› ç´ **ï¼š
- **é›¶ä¿®æ”¹ç°æœ‰Skills**
- åŒè½¨ç³»ç»Ÿå®Œå…¨ç‹¬ç«‹
- å……åˆ†çš„æµ‹è¯•è¦†ç›–
- è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹
- å¹³æ»‘çš„ç”¨æˆ·ä½“éªŒ

---

## 12. é™„å½•

### A. ç›¸å…³èµ„æº

- [MCPå®˜æ–¹TypeScript SDK](https://github.com/modelcontextprotocol/typescript-sdk)
- [MCPè§„èŒƒæ–‡æ¡£](https://modelcontextprotocol.io/)
- [MCPæœåŠ¡å™¨åˆ—è¡¨](https://github.com/topics/mcp-server)
- [ApexBridgeé¡¹ç›®ä»“åº“](https://github.com/suntianc/apex-bridge)

### B. æŠ€æœ¯å‚è€ƒ

- JSON-RPC 2.0è§„èŒƒ
- Server-Sent Events (SSE)
- WebSocketåè®®
- å‘é‡æ•°æ®åº“ï¼ˆLanceDB/ChromaDBï¼‰

### C. æ–‡æ¡£ä¿¡æ¯

- **é¡¹ç›®ç»´æŠ¤è€…**ï¼šApexBridge Team
- **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0
- **æœ€åæ›´æ–°**ï¼š2025-12-15
- **çŠ¶æ€**ï¼šâœ… æŠ¥å‘Šå®Œæˆ

---
### 6.10 å¹¶è¡Œæ¨¡å¼è¯´æ˜

#### æ ¸å¿ƒåŸåˆ™

**åŒè½¨å¹¶è¡Œ**ï¼šSkillså’ŒMCPæ˜¯ä¸¤ä¸ªå®Œå…¨ç‹¬ç«‹çš„ç³»ç»Ÿï¼Œå°±åƒä¸¤æ¡å¹³è¡Œçš„é“è½¨ï¼š

```
Skillsè½¨é“ â†â†’ SkillManager â†â†’ ç°æœ‰API
     â†•                â†•            â†•
MCPè½¨é“   â†â†’MCPServerMgrâ†â†’ ç»Ÿä¸€æ¥å£
```

#### ä½¿ç”¨åœºæ™¯å¯¹æ¯”

| åœºæ™¯ | æ¨èä½¿ç”¨ | è¯´æ˜ |
|------|----------|------|
| **å·²æœ‰åŠŸèƒ½éœ€æ±‚** | Skills | ä½¿ç”¨ç°æœ‰æˆç†Ÿçš„Skills |
| **æ–°åŠŸèƒ½å¼€å‘** | MCP | ä¼˜å…ˆä½¿ç”¨MCPç”Ÿæ€ |
| **å¤–éƒ¨å·¥å…·é›†æˆ** | MCP | ç›´æ¥ä½¿ç”¨ç¤¾åŒºMCPæœåŠ¡å™¨ |
| **å®šåˆ¶å·¥å…·å¼€å‘** | Skills | ç»§ç»­ä½¿ç”¨Skillsæ¡†æ¶ |
| **ç”Ÿæ€ç³»ç»Ÿå¯¹æ¥** | MCP | è®¿é—®247+ç¤¾åŒºå·¥å…· |

#### APIä½¿ç”¨ç¤ºä¾‹

```typescript
// ä½¿ç”¨Skillsï¼ˆç°æœ‰æ–¹å¼ï¼Œä¸å˜ï¼‰
const skillResult = await skillManager.executeSkill('siliconflow-image-generator', {
  prompt: 'ç”Ÿæˆä¸€å¼ å›¾ç‰‡'
});

// ä½¿ç”¨MCPï¼ˆæ–°å¢æ–¹å¼ï¼‰
const mcpResult = await mcpServerManager.callTool('github', 'create_issue', {
  title: 'New Issue',
  body: 'Issue description'
});

// ç»Ÿä¸€æ¥å£ï¼ˆæ¨èï¼‰
const unifiedResult = await unifiedToolManager.executeTool('github:create_issue', {
  title: 'New Issue'
});
```

#### ä¼˜åŠ¿æ€»ç»“

1. **é›¶é£é™©**ï¼šç°æœ‰ç³»ç»Ÿå®Œå…¨ä¸å—å½±å“
2. **é›¶å­¦ä¹ æˆæœ¬**ï¼šSkillsç”¨æˆ·æ— éœ€å­¦ä¹ æ–°ç³»ç»Ÿ
3. **æœ€å¤§åŒ–æ”¶ç›Š**ï¼šæ—¢æœ‰ç¨³å®šæ€§ï¼Œåˆæœ‰åˆ›æ–°æ€§
4. **çµæ´»é€‰æ‹©**ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚ç³»ç»Ÿ
5. **å¹³æ»‘è¿‡æ¸¡**ï¼šé€æ­¥å¼•å…¥MCPï¼Œæ— éœ€ä¸€æ¬¡æ€§åˆ‡æ¢


### 5.6 æ–¹æ¡ˆä¼˜åŠ¿å¯¹æ¯”

#### ä½¿ç”¨å‰ vs ä½¿ç”¨å

**ä½¿ç”¨å‰ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰**ï¼š
```
ç”¨æˆ·ï¼š"æˆ‘æƒ³ç”Ÿæˆå›¾ç‰‡"
ç³»ç»Ÿï¼šä½ éœ€è¦é€‰æ‹©ä½¿ç”¨å“ªä¸ªå·¥å…·ï¼Ÿ
- Skillsä¸­çš„siliconflow-image-generator
- MCPä¸­çš„stability-ai-mcp
- MCPä¸­çš„dalle-mcp
ç”¨æˆ·ï¼šğŸ¤” ä¸çŸ¥é“é€‰å“ªä¸ª...
```

**ä½¿ç”¨åï¼ˆå‘é‡æœç´¢ï¼‰**ï¼š
```
ç”¨æˆ·ï¼š"æˆ‘æƒ³ç”Ÿæˆå›¾ç‰‡"
ç³»ç»Ÿè‡ªåŠ¨å‘é‡æœç´¢ï¼š
â†’ å‘ç°3ä¸ªç›¸å…³å·¥å…·
â†’ è¯­ä¹‰ç›¸ä¼¼åº¦æ’åº
â†’ æ¨èæœ€åŒ¹é…çš„siliconflow-image-generator (0.92)
â†’ ç›´æ¥æ‰§è¡Œæˆ–è¯¢é—®æ˜¯å¦ä½¿ç”¨æ¨èå·¥å…·
```

#### æ ¸å¿ƒä»·å€¼

| ç‰¹æ€§ | ä¼ ç»Ÿæ–¹å¼ | å‘é‡æœç´¢æ–¹å¼ |
|------|----------|-------------|
| **ç”¨æˆ·è®¤çŸ¥è´Ÿæ‹…** | é«˜ï¼ˆéœ€è¦äº†è§£æ‰€æœ‰å·¥å…·ï¼‰ | ä½ï¼ˆç³»ç»Ÿè‡ªåŠ¨æ¨èï¼‰ |
| **å·¥å…·å‘ç°** | æ‰‹åŠ¨æµè§ˆåˆ—è¡¨ | è¯­ä¹‰æœç´¢ |
| **å‡†ç¡®åŒ¹é…** | ä¾èµ–å…³é”®è¯ | åŸºäºè¯­ä¹‰ç†è§£ |
| **è·¨ç³»ç»Ÿæ•´åˆ** | å›°éš¾ | è‡ªç„¶èåˆ |
| **æ‰©å±•æ€§** | æ–°å·¥å…·éœ€æ‰‹åŠ¨äº†è§£ | è‡ªåŠ¨è¢«å‘ç° |

**ç»“è®º**ï¼šä½¿ç”¨ç»Ÿä¸€å‘é‡æœç´¢åŠ¨æ€å‘ç°MCP+Skillsæ˜¯**æœ€ä½³å®è·µ**ï¼Œæ—¢ä¿æŒäº†ç³»ç»Ÿç‹¬ç«‹æ€§ï¼Œåˆå®ç°äº†ç»Ÿä¸€ç”¨æˆ·ä½“éªŒã€‚


### 5.7 æ‰§è¡Œæµç¨‹è¯¦è§£

#### 5.7.1 å‘é‡æœç´¢çš„ä½œç”¨

**å‘é‡æœç´¢ä¸æ˜¯ç›´æ¥æ‰§è¡Œï¼Œè€Œæ˜¯ä¸ºLLMæä¾›ä¸Šä¸‹æ–‡**ï¼š

```
ç”¨æˆ·è¾“å…¥ï¼š"æˆ‘æƒ³ç”Ÿæˆä¸€å¼ æµ·è¾¹æ—¥è½çš„å›¾ç‰‡"
    â†“
ã€ç¬¬1æ­¥ï¼šå‘é‡æœç´¢ã€‘
- æœç´¢æœ€ç›¸å…³çš„å·¥å…·ï¼ˆä¸æ‰§è¡Œï¼ŒåªæŸ¥æ‰¾ï¼‰
- è¿”å›å·¥å…·å€™é€‰åˆ—è¡¨å’Œç›¸ä¼¼åº¦åˆ†æ•°
- æ¯ä¸ªå€™é€‰åŒ…å«ï¼šå·¥å…·å…ƒæ•°æ®ã€æè¿°ã€å‚æ•°schema

ã€ç¬¬2æ­¥ï¼šLLMæ¨ç†ã€‘
- LLMæ¥æ”¶ç”¨æˆ·è¾“å…¥ + å‘é‡æœç´¢ç»“æœ
- LLMåŸºäºä¸Šä¸‹æ–‡ç†è§£ç”¨æˆ·æ„å›¾
- LLMé€‰æ‹©æœ€åˆé€‚çš„å·¥å…·ï¼ˆå¯èƒ½æ˜¯siliconflow-image-generatorï¼‰

ã€ç¬¬3æ­¥ï¼šå·¥å…·è°ƒç”¨ã€‘
- LLMå†³å®šè°ƒç”¨å·¥å…·åï¼Œé€šè¿‡UnifiedToolManageræ‰§è¡Œ
- UnifiedToolManageræ ¹æ®å·¥å…·ç±»å‹è·¯ç”±åˆ°å¯¹åº”ç³»ç»Ÿ
- æ‰§è¡Œå·¥å…·å¹¶è¿”å›ç»“æœ

ã€ç¬¬4æ­¥ï¼šç»“æœå¤„ç†ã€‘
- LLMæ¥æ”¶å·¥å…·æ‰§è¡Œç»“æœ
- LLMå°†ç»“æœæ•´åˆåˆ°å›ç­”ä¸­
- è¿”å›ç»™ç”¨æˆ·
```

#### 5.7.2 å‘é‡æœç´¢è¿”å›çš„å†…å®¹

```typescript
// GET /api/tools/search?query=ç”Ÿæˆå›¾ç‰‡
{
  "query": "ç”Ÿæˆå›¾ç‰‡",
  "tools": [
    {
      "name": "siliconflow-image-generator",
      "type": "skill",  // å‘Šè¯‰LLMè¿™æ˜¯Skill
      "source": "skill-manager",  // å‘Šè¯‰LLMä»å“ªé‡Œè°ƒç”¨
      "description": "SiliconFlowå›¾åƒç”Ÿæˆå·¥å…·",
      "score": 0.92,  // ç›¸ä¼¼åº¦åˆ†æ•°
      "tags": ["image", "generation", "siliconflow"],
      "parameters": {  // å‚æ•°schemaï¼ŒLLMå¯ä»¥å‚è€ƒ
        "type": "object",
        "properties": {
          "prompt": { "type": "string", "description": "å›¾åƒæè¿°" },
          "image_size": { "type": "string", "default": "512x512" }
        }
      }
    },
    {
      "name": "stability_ai_generate",
      "type": "mcp",
      "source": "srv_004",
      "description": "Stability AIå›¾åƒç”Ÿæˆ",
      "score": 0.88,
      "tags": ["image", "generation", "stability-ai"],
      "parameters": {
        "type": "object",
        "properties": {
          "prompt": { "type": "string" },
          "steps": { "type": "integer", "default": 30 }
        }
      }
    }
  ]
}
```

**é‡è¦**ï¼šå‘é‡æœç´¢**åªè¿”å›å…ƒæ•°æ®**ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼

#### 5.7.3 LLMçš„æ¨ç†è¿‡ç¨‹

**LLMæ¥æ”¶åˆ°çš„å®Œæ•´ä¸Šä¸‹æ–‡**ï¼š
```
ç³»ç»Ÿæç¤ºï¼šä½ æ˜¯ApexBridge AIåŠ©æ‰‹ï¼Œå¯ä»¥ä½¿ç”¨å„ç§å·¥å…·æ¥å¸®åŠ©ç”¨æˆ·

ç”¨æˆ·è¾“å…¥ï¼šæˆ‘æƒ³ç”Ÿæˆä¸€å¼ æµ·è¾¹æ—¥è½çš„å›¾ç‰‡

å·¥å…·å€™é€‰ï¼ˆå‘é‡æœç´¢ç»“æœï¼‰ï¼š
1. siliconflow-image-generator (ç›¸ä¼¼åº¦: 0.92)
   - ç±»å‹: skill
   - æè¿°: SiliconFlowå›¾åƒç”Ÿæˆå·¥å…·
   - å‚æ•°: prompt(string), image_size(string)
   
2. stability_ai_generate (ç›¸ä¼¼åº¦: 0.88)
   - ç±»å‹: mcp
   - æè¿°: Stability AIå›¾åƒç”Ÿæˆ
   - å‚æ•°: prompt(string), steps(integer)

è¯·é€‰æ‹©æœ€åˆé€‚çš„å·¥å…·å¹¶ç”Ÿæˆè°ƒç”¨ã€‚
```

**LLMçš„æ€è€ƒè¿‡ç¨‹**ï¼š
```
1. ç”¨æˆ·è¦æ±‚ç”Ÿæˆå›¾ç‰‡
2. æˆ‘æœ‰ä¸¤ä¸ªå›¾ç‰‡ç”Ÿæˆå·¥å…·å€™é€‰
3. siliconflow-image-generatorç›¸ä¼¼åº¦æ›´é«˜(0.92)
4. å®ƒæ˜¯Skillç±»å‹ï¼Œæˆç†Ÿç¨³å®š
5. ç”¨æˆ·æ²¡æœ‰æŒ‡å®šç‰¹å®šæœåŠ¡ï¼Œé»˜è®¤é€‰æ‹©æœ€åŒ¹é…çš„
6. è°ƒç”¨siliconflow-image-generator
7. å‚æ•°ï¼š
   - prompt: "æµ·è¾¹æ—¥è½ï¼Œæ¸©æš–çš„å…‰çº¿ï¼Œå®é™çš„æµ·æµª"
   - image_size: "1024x1024" (é»˜è®¤)
```

#### 5.7.4 å·¥å…·è°ƒç”¨æ‰§è¡Œæµç¨‹

**æ­¥éª¤1ï¼šLLMç”Ÿæˆè°ƒç”¨æŒ‡ä»¤**
```typescript
// LLMç”Ÿæˆçš„ç»“æ„åŒ–è°ƒç”¨
{
  tool_name: "siliconflow-image-generator",
  arguments: {
    prompt: "æµ·è¾¹æ—¥è½ï¼Œæ¸©æš–çš„å…‰çº¿ï¼Œå®é™çš„æµ·æµª",
    image_size: "1024x1024"
  }
}
```

**æ­¥éª¤2ï¼šUnifiedToolManagerå¤„ç†**
```typescript
async function executeTool(name: string, args: any): Promise<ToolResult> {
  // 1. æŸ¥å‘é‡ç´¢å¼•ç¡®å®šå·¥å…·ç±»å‹å’Œæ¥æº
  const toolIndex = await vectorDb.getByName(name);
  
  if (toolIndex.type === 'skill') {
    // 2. è·¯ç”±åˆ°SkillManager
    return await skillManager.executeSkill(name, args);
  } else {
    // 3. è·¯ç”±åˆ°MCPClient
    return await mcpClient.callTool(toolIndex.source, name, args);
  }
}
```

**æ­¥éª¤3ï¼šå®é™…æ‰§è¡Œ**
- **å¦‚æœæ˜¯Skill**ï¼šè°ƒç”¨scripts/execute.js
- **å¦‚æœæ˜¯MCPå·¥å…·**ï¼šé€šè¿‡JSON-RPCåè®®è°ƒç”¨MCPæœåŠ¡å™¨

#### 5.7.5 å®Œæ•´æ—¶åºå›¾

```
ç”¨æˆ·: "æˆ‘æƒ³ç”Ÿæˆæµ·è¾¹æ—¥è½å›¾ç‰‡"
    â†“
ApexBridge
    â†“
ã€å‘é‡æœç´¢ã€‘
UnifiedToolManager.searchTools("ç”Ÿæˆå›¾ç‰‡")
    â†“
å‘é‡æ•°æ®åº“
    â†“
è¿”å›å·¥å…·å€™é€‰åˆ—è¡¨
    â†“
ã€LLMæ¨ç†ã€‘
LLMæ¥æ”¶: ç”¨æˆ·è¾“å…¥ + å·¥å…·å€™é€‰
    â†“
LLMé€‰æ‹©: siliconflow-image-generator
    â†“
LLMç”Ÿæˆ: å·¥å…·è°ƒç”¨æŒ‡ä»¤
    â†“
ã€å·¥å…·æ‰§è¡Œã€‘
UnifiedToolManager.executeTool("siliconflow-image-generator", {...})
    â†“
å‘é‡ç´¢å¼•æŸ¥è¯¢: ç¡®å®šæ˜¯skillç±»å‹
    â†“
SkillManager.executeSkill("siliconflow-image-generator", {...})
    â†“
è°ƒç”¨: scripts/execute.js
    â†“
SiliconFlow API
    â†“
è¿”å›: å›¾ç‰‡URL
    â†“
ã€ç»“æœæ•´åˆã€‘
LLMæ¥æ”¶: å›¾ç‰‡URL
    â†“
LLMç”Ÿæˆ: åŒ…å«å›¾ç‰‡çš„å›ç­”
    â†“
ç”¨æˆ·: "![æµ·è¾¹æ—¥è½](å›¾ç‰‡URL)"
```

#### 5.7.6 å…³é”®é—®é¢˜è§£ç­”

**Q: å‘é‡æœç´¢æ˜¯å¦ç›´æ¥è¿”å›ç»“æœï¼Ÿ**
A: **ä¸è¿”å›**ã€‚å‘é‡æœç´¢åªè¿”å›**å·¥å…·å…ƒæ•°æ®å’Œç›¸ä¼¼åº¦åˆ†æ•°**ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚

**Q: LLMå¦‚ä½•ä½¿ç”¨æœç´¢ç»“æœï¼Ÿ**
A: LLMå°†æœç´¢ç»“æœä½œä¸º**ä¸Šä¸‹æ–‡ä¿¡æ¯**ï¼Œç»“åˆç”¨æˆ·è¾“å…¥è¿›è¡Œæ¨ç†ï¼Œé€‰æ‹©æœ€åˆé€‚çš„å·¥å…·ã€‚

**Q: è°å†³å®šè°ƒç”¨å“ªä¸ªå·¥å…·ï¼Ÿ**
A: **LLMåŸºäºæœç´¢ç»“æœå’Œä¸Šä¸‹æ–‡è¿›è¡Œå†³ç­–**ã€‚LLMä¼šé€‰æ‹©ç›¸ä¼¼åº¦æœ€é«˜ä¸”æœ€ç¬¦åˆç”¨æˆ·éœ€æ±‚çš„å·¥å…·ã€‚

**Q: å·¥å…·è°ƒç”¨æ˜¯è‡ªåŠ¨çš„è¿˜æ˜¯äº¤äº’å¼çš„ï¼Ÿ**
A: **ä¸¤ç§æ¨¡å¼éƒ½æ”¯æŒ**ï¼š
- **è‡ªåŠ¨æ¨¡å¼**ï¼šLLMè‡ªåŠ¨é€‰æ‹©å¹¶è°ƒç”¨å·¥å…·
- **äº¤äº’æ¨¡å¼**ï¼šLLMåˆ—å‡ºå€™é€‰å·¥å…·ï¼Œè¯¢é—®ç”¨æˆ·é€‰æ‹©

**Q: å¦‚æœç›¸ä¼¼åº¦éƒ½å¾ˆä½æ€ä¹ˆåŠï¼Ÿ**
A: ç³»ç»Ÿä¼šï¼š
1. è¿”å›ç›¸ä¼¼åº¦æœ€é«˜çš„å€™é€‰
2. åœ¨å›ç­”ä¸­è¯´æ˜ï¼š"æ²¡æœ‰æ‰¾åˆ°å®Œå…¨åŒ¹é…çš„å·¥å…·ï¼Œä½†å‘ç°ä»¥ä¸‹ç›¸å…³å·¥å…·..."
3. æä¾›å¤‡é€‰æ–¹æ¡ˆ

#### 5.7.7 æ€§èƒ½è€ƒè™‘

**å‘é‡æœç´¢å¼€é”€**ï¼š
- æ¯æ¬¡ç”¨æˆ·æŸ¥è¯¢éƒ½ä¼šè§¦å‘å‘é‡æœç´¢
- å¯ç¼“å­˜çƒ­é—¨æŸ¥è¯¢ç»“æœ
- ä½¿ç”¨è¿‘ä¼¼å‘é‡æœç´¢æå‡é€Ÿåº¦

**LLMæ¨ç†å¼€é”€**ï¼š
- LLMéœ€è¦å¤„ç†é¢å¤–çš„å·¥å…·å€™é€‰ä¿¡æ¯
- ä½†è¿™è®©LLMçš„å†³ç­–æ›´å‡†ç¡®

**æ•´ä½“å»¶è¿Ÿ**ï¼š
```
å‘é‡æœç´¢: ~50-100ms
LLMæ¨ç†: ~200-500ms (å–å†³äºæ¨¡å‹)
å·¥å…·æ‰§è¡Œ: ~1000-3000ms (å–å†³äºå¤–éƒ¨API)
ç»“æœæ•´åˆ: ~100-200ms
æ€»è®¡: ~1.5-4ç§’
```

---

## 11. ç»“è®º

### 11.1 æ€»ä½“è¯„ä¼°

**ApexBridgeé›†æˆMCPå·¥å…·å…·æœ‰æé«˜çš„æŠ€æœ¯å¯è¡Œæ€§å’Œå•†ä¸šä»·å€¼**ï¼š

- âœ… **æŠ€æœ¯å®Œç¾åŒ¹é…**ï¼šTypeScriptåŸç”Ÿæ”¯æŒï¼Œæ¶æ„å…¼å®¹
- âœ… **ä½é£é™©é›†æˆ**ï¼šä¿æŒç°æœ‰Skillsç³»ç»Ÿä¸å˜
- âœ… **é«˜ä»·å€¼å›æŠ¥**ï¼šè®¿é—®247+ç¤¾åŒºMCPæœåŠ¡å™¨
- âœ… **æ ‡å‡†åŒ–æ¥å£**ï¼šé‡‡ç”¨è¡Œä¸šæ ‡å‡†ï¼Œæå‡äº’æ“ä½œæ€§

### 11.2 æ¨èè¡ŒåŠ¨

**ç«‹å³å¯åŠ¨MCPé›†æˆé¡¹ç›®**ï¼š

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼ˆ2å‘¨ï¼‰ï¼šMCPæ ¸å¿ƒé›†æˆ
   - æ·»åŠ MCP SDKä¾èµ–
   - å®ç°MCPServerManager
   - åˆ›å»ºç»Ÿä¸€å·¥å…·ç®¡ç†æ¥å£

2. **ç¬¬äºŒé˜¶æ®µ**ï¼ˆ2å‘¨ï¼‰ï¼šå‘é‡æœç´¢é›†æˆ
   - æ‰©å±•ToolRetrievalServiceæ”¯æŒMCP
   - å®ç°ç»Ÿä¸€å·¥å…·ç´¢å¼•

3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼ˆ1å‘¨ï¼‰ï¼šAPIå’Œæµ‹è¯•
   - æ·»åŠ MCPç®¡ç†API
   - é›†æˆæµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–

4. **ç¬¬å››é˜¶æ®µ**ï¼ˆæŒç»­ï¼‰ï¼šç”Ÿæ€æ‰©å±•
   - é›†æˆå¸¸ç”¨MCPæœåŠ¡å™¨
   - ç¤¾åŒºè´¡çŒ®å’Œæ–‡æ¡£å®Œå–„

### 11.3 é•¿æœŸå±•æœ›

é€šè¿‡MCPé›†æˆï¼ŒApexBridgeå°†æˆä¸ºï¼š
- **å¤šåè®®å…¼å®¹**çš„AIå·¥å…·è°ƒç”¨å¹³å°
- **æ ‡å‡†åŒ–**çš„LLMå·¥å…·ç”Ÿæ€å…¥å£
- **å¯æ‰©å±•**çš„ä¼ä¸šçº§AIè§£å†³æ–¹æ¡ˆ

è¿™å°†ä¸ºApexBridgeå¸¦æ¥æ˜¾è‘—çš„**æŠ€æœ¯ä¼˜åŠ¿**å’Œ**å¸‚åœºç«äº‰åŠ›**ã€‚

---

## 12. é™„å½•

### 12.1 MCPæœåŠ¡å™¨ç±»å‹å¯¹ç…§è¡¨

| ç±»å‹ | ç¤ºä¾‹æœåŠ¡å™¨ | ç”¨é€” |
|------|-----------|------|
| filesystem | @modelcontextprotocol/server-filesystem | æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ“ä½œ |
| git | @modelcontextprotocol/server-git | Gitç‰ˆæœ¬æ§åˆ¶ |
| github | @modelcontextprotocol/server-github | GitHub APIé›†æˆ |
| postgresql | @modelcontextprotocol/server-postgres | PostgreSQLæ•°æ®åº“ |
| sqlite | @modelcontextprotocol/server-sqlite | SQLiteæ•°æ®åº“ |
| google-drive | @modelcontextprotocol/server-google-drive | Google Drive |
| s3 | @modelcontextprotocol/server-s3 | AWS S3å­˜å‚¨ |
| docker | @modelcontextprotocol/server-docker | Dockerå®¹å™¨ç®¡ç† |

### 12.2 å¸¸ç”¨MCPæœåŠ¡å™¨å®‰è£…å‘½ä»¤

```bash
# NPMå…¨å±€å®‰è£…
npm install -g @modelcontextprotocol/server-filesystem
npm install -g @modelcontextprotocol/server-github
npm install -g @modelcontextprotocol/server-git

# ä½¿ç”¨mcp-cli
mcp install filesystem @modelcontextprotocol/server-filesystem
mcp install github @modelcontextprotocol/server-github
mcp install git @modelcontextprotocol/server-git
```

### 12.3 ç›¸å…³èµ„æº

- **MCPå®˜æ–¹æ–‡æ¡£**: https://modelcontextprotocol.io/
- **MCP TypeScript SDK**: https://github.com/modelcontextprotocol/typescript-sdk
- **MCPæœåŠ¡å™¨åˆ—è¡¨**: https://github.com/modelcontextprotocol/servers
- **Anthropicåšå®¢**: https://www.anthropic.com/news/model-context-protocol

### 12.4 æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|------|------|
| MCP | Model Context Protocolï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®® |
| LLM | Large Language Modelï¼Œå¤§å‹è¯­è¨€æ¨¡å‹ |
| ABP | AI Bridge Protocolï¼ŒAIæ¡¥æ¥åè®® |
| Skills | ApexBridgeçš„å·¥å…·è°ƒç”¨ç³»ç»Ÿ |
| JSON-RPC | JSON Remote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®® |
| SSE | Server-Sent Eventsï¼ŒæœåŠ¡å™¨å‘é€äº‹ä»¶ |
| stdio | Standard Input/Outputï¼Œæ ‡å‡†è¾“å…¥è¾“å‡º |
| SDK | Software Development Kitï¼Œè½¯ä»¶å¼€å‘å·¥å…·åŒ… |
| Vector DB | Vector Databaseï¼Œå‘é‡æ•°æ®åº“ |

### 12.5 ç‰ˆæœ¬å†å²

- **v1.0** (2025-01-15): åˆå§‹å¯è¡Œæ€§åˆ†æ
- **v1.1** (2025-01-15): æ·»åŠ ç»Ÿä¸€å·¥å…·ç®¡ç†æ–¹æ¡ˆ
- **v1.2** (2025-01-15): å®Œå–„å‘é‡æœç´¢é›†æˆ
- **v2.0** (2025-01-15): æ›´æ–°æ‰§è¡Œæµç¨‹ï¼Œæ·»åŠ å®æ–½è·¯çº¿å›¾
- **v3.0** (2025-01-15): æ·»åŠ å®Œæ•´å®ç°ä»£ç å’ŒAPIæ–‡æ¡£

---

## 13. å®æ–½ç»†èŠ‚ä¸ä»£ç å®ç°

### 13.1 å·²å®ç°çš„ç»„ä»¶

ä»¥ä¸‹æ˜¯MCPé›†æˆçš„å…·ä½“ä»£ç å®ç°ï¼Œä½äº `src/services/` ç›®å½•ä¸‹ï¼š

#### 13.1.1 å·¥å…·æ£€ç´¢æœåŠ¡ (ToolRetrievalService) - æ‰©å±•

**æ–‡ä»¶**: `src/services/ToolRetrievalService.ts`ï¼ˆå·²å­˜åœ¨ï¼Œéœ€æ‰©å±•ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**:
- ä½¿ç”¨ @xenova/transformers ç”Ÿæˆå·¥å…·æè¿°çš„å‘é‡åµŒå…¥
- ä½¿ç”¨ LanceDB å­˜å‚¨å’Œæ£€ç´¢å‘é‡
- æä¾›å·¥å…·çš„è¯­ä¹‰æœç´¢åŠŸèƒ½
- **æ‰©å±•æ”¯æŒç»Ÿä¸€å·¥å…·ç´¢å¼•ï¼ˆSkills + MCPï¼‰**

**ä¸»è¦æ–¹æ³•**:
```typescript
// ç°æœ‰æ–¹æ³•
async initialize(config: ToolRetrievalConfig): Promise<void>
async searchTools(query: string, limit?: number): Promise<ToolRetrievalResult[]>
async reindexSkills(): Promise<void>

// æ‰©å±•æ–¹æ³•ï¼ˆæ–°å¢ï¼‰
async indexMCPTools(tools: MCPTool[]): Promise<void>
async searchAllTools(query: string, options: {
  limit?: number;
  minScore?: number;
  types?: ('skill' | 'mcp')[]
}): Promise<VectorToolResult[]>
```

**æ‰©å±•è®¡åˆ’**:
- âœ… ä½¿ç”¨ç°æœ‰ä¾èµ– @xenova/transformers å’Œ @lancedb/lancedb
- âœ… è‡ªåŠ¨ç”Ÿæˆå‘é‡åµŒå…¥ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- âœ… é«˜æ•ˆçš„ç›¸ä¼¼åº¦æœç´¢ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰
- âœ… æ”¯æŒæ··åˆæ£€ç´¢ï¼ˆå‘é‡ + å…³é”®è¯ï¼‰
- ğŸ†• **æ‰©å±•ç°æœ‰æ¶æ„æ”¯æŒMCPå·¥å…·**
- ğŸ†• **ç»Ÿä¸€å·¥å…·ç´¢å¼•ï¼ˆSkills + MCPï¼‰**
- ğŸ†• **æ··åˆæœç´¢ç»“æœæ’åº**

#### 13.1.2 MCPé›†æˆæœåŠ¡ (MCPIntegrationService)

**æ–‡ä»¶**: `src/services/MCPIntegrationService.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
- ç®¡ç†å¤šä¸ªMCPæœåŠ¡å™¨å®ä¾‹
- å¤„ç†MCPæœåŠ¡å™¨ç”Ÿå‘½å‘¨æœŸï¼ˆå¯åŠ¨ã€åœæ­¢ã€é‡å¯ï¼‰
- æä¾›ç»Ÿä¸€çš„å·¥å…·è°ƒç”¨æ¥å£
- æ”¯æŒå·¥å…·å‘ç°å’ŒçŠ¶æ€ç›‘æ§

**ä¸»è¦æ–¹æ³•**:
```typescript
// æ³¨å†ŒMCPæœåŠ¡å™¨
async registerServer(config: MCPServerConfig): Promise<{ serverId: string; success: boolean }>

// æ³¨é”€MCPæœåŠ¡å™¨
async unregisterServer(serverId: string): Promise<boolean>

// è·å–æ‰€æœ‰æœåŠ¡å™¨
getServers(): MCPServerInfo[]

// æ‰§è¡Œå·¥å…·è°ƒç”¨
async callTool(params: {
  toolName: string;
  arguments: Record<string, any>;
  serverId?: string;
}): Promise<MCPToolResult>

// è·å–ç»Ÿè®¡ä¿¡æ¯
getStatistics(): { totalServers: number; totalTools: number; ... }
```

**ç‰¹æ€§**:
- âœ… äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆç»§æ‰¿è‡ªEventEmitterï¼‰
- âœ… è‡ªåŠ¨å·¥å…·å‘ç°å’Œç´¢å¼•æ›´æ–°
- âœ… å¥åº·æ£€æŸ¥å’ŒçŠ¶æ€ç›‘æ§
- âœ… ä¼˜é›…å…³é—­å’Œé”™è¯¯å¤„ç†

#### 13.1.3 MCPæœåŠ¡å™¨ç®¡ç†å™¨ (MCPServerManager)

**æ–‡ä»¶**: `src/services/MCPServerManager.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
- ç®¡ç†å•ä¸ªMCPæœåŠ¡å™¨å®ä¾‹
- å¤„ç†æœåŠ¡å™¨å¯åŠ¨å’Œå…³é—­
- å·¥å…·å‘ç°å’Œè°ƒç”¨æ‰§è¡Œ
- æ€§èƒ½æŒ‡æ ‡æ”¶é›†

**ä¸»è¦æ–¹æ³•**:
```typescript
// åˆå§‹åŒ–æœåŠ¡å™¨
async initialize(): Promise<void>

// æ‰§è¡Œå·¥å…·è°ƒç”¨
async callTool(call: MCPToolCall): Promise<MCPToolResult>

// è·å–æœåŠ¡å™¨çŠ¶æ€
getStatus(): MCPServerStatus

// é‡å¯æœåŠ¡å™¨
async restart(): Promise<void>

// å…³é—­æœåŠ¡å™¨
async shutdown(): Promise<void>
```

**ç‰¹æ€§**:
- âœ… å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… æ¨¡æ‹ŸMCPåè®®äº¤äº’ï¼ˆç”¨äºæ¼”ç¤ºï¼‰
- âœ… æŒ‡æ ‡æ”¶é›†ï¼ˆè°ƒç”¨æ¬¡æ•°ã€å“åº”æ—¶é—´ç­‰ï¼‰
- âœ… çŠ¶æ€ç›‘æ§ï¼ˆè¿è¡Œæ—¶é—´ã€å¥åº·çŠ¶æ€ç­‰ï¼‰

#### 13.1.4 ç»Ÿä¸€å·¥å…·ç®¡ç†å™¨ (UnifiedToolManager)

**æ–‡ä»¶**: `src/services/UnifiedToolManager.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
- ç»Ÿä¸€ç®¡ç†Skillså’ŒMCPå·¥å…·
- æä¾›ä¸€è‡´çš„æœç´¢å’Œè°ƒç”¨æ¥å£
- æ™ºèƒ½è·¯ç”±ï¼ˆæ ¹æ®å·¥å…·ç±»å‹è‡ªåŠ¨é€‰æ‹©æ‰§è¡Œå¼•æ“ï¼‰
- å®æ—¶åŒæ­¥å·¥å…·å˜åŒ–

**ä¸»è¦æ–¹æ³•**:
```typescript
// åˆå§‹åŒ–
async initialize(): Promise<void>

// æœç´¢å·¥å…·
async searchTools(options: ToolSearchOptions): Promise<ToolSearchResult[]>

// è°ƒç”¨å·¥å…·
async callTool(
  toolNameOrId: string,
  arguments_: Record<string, any>,
  options?: { toolId?: string }
): Promise<UnifiedToolResult>

// è·å–æ‰€æœ‰å·¥å…·
getAllTools(type?: 'skill' | 'mcp'): UnifiedTool[]

// è·å–ç»Ÿè®¡ä¿¡æ¯
getStatistics(): { totalTools: number; skillsCount: number; mcpToolsCount: number; ... }
```

**ç‰¹æ€§**:
- âœ… åŒç³»ç»Ÿé›†æˆï¼ˆSkills + MCPï¼‰
- âœ… æ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼ˆ5åˆ†é’ŸTTLï¼‰
- âœ… è‡ªåŠ¨å·¥å…·ç´¢å¼•åˆ·æ–°
- âœ… ç»Ÿä¸€å·¥å…·è¡¨ç¤ºï¼ˆUnifiedToolæ¥å£ï¼‰

#### 13.1.5 MCP APIè·¯ç”±

**æ–‡ä»¶**: `src/api/routes/mcpRoutes.ts`

**REST APIç«¯ç‚¹**:

**æœåŠ¡å™¨ç®¡ç†**:
- `GET /api/mcp/servers` - è·å–æ‰€æœ‰MCPæœåŠ¡å™¨åˆ—è¡¨
- `POST /api/mcp/servers` - æ³¨å†Œæ–°çš„MCPæœåŠ¡å™¨
- `GET /api/mcp/servers/:serverId` - è·å–ç‰¹å®šæœåŠ¡å™¨ä¿¡æ¯
- `DELETE /api/mcp/servers/:serverId` - æ³¨é”€MCPæœåŠ¡å™¨
- `POST /api/mcp/servers/:serverId/restart` - é‡å¯MCPæœåŠ¡å™¨
- `GET /api/mcp/servers/:serverId/status` - è·å–æœåŠ¡å™¨çŠ¶æ€

**å·¥å…·ç®¡ç†**:
- `GET /api/mcp/servers/:serverId/tools` - è·å–æœåŠ¡å™¨å·¥å…·åˆ—è¡¨
- `POST /api/mcp/servers/:serverId/tools/:toolName/call` - è°ƒç”¨æŒ‡å®šå·¥å…·
- `POST /api/mcp/tools/call` - è°ƒç”¨å·¥å…·ï¼ˆè‡ªåŠ¨å‘ç°ï¼‰

**ç³»ç»Ÿç›‘æ§**:
- `GET /api/mcp/statistics` - è·å–ç»Ÿè®¡ä¿¡æ¯
- `GET /api/mcp/health` - å¥åº·æ£€æŸ¥

**APIå“åº”æ ¼å¼**:
```typescript
{
  success: boolean;
  data: any;
  meta?: {
    total: number;
    timestamp: string;
  };
  error?: {
    code: string;
    message: string;
  };
}
```

**ç‰¹æ€§**:
- âœ… RESTful APIè®¾è®¡
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… çŠ¶æ€ç è§„èŒƒä½¿ç”¨
- âœ… JSONå“åº”æ ¼å¼ç»Ÿä¸€

### 13.2 ä½¿ç”¨ç¤ºä¾‹

#### 13.2.1 æ³¨å†ŒMCPæœåŠ¡å™¨

```typescript
import { mcpIntegration } from './services/MCPIntegrationService';

// æ³¨å†ŒGitHub MCPæœåŠ¡å™¨
const result = await mcpIntegration.registerServer({
  id: 'github-mcp',
  type: 'stdio',
  command: 'npx',
  args: ['-y', '@modelcontextprotocol/server-github'],
  env: {
    GITHUB_PERSONAL_ACCESS_TOKEN: 'your-token-here'
  }
});

console.log(result);
// { serverId: 'github-mcp', success: true }
```

#### 13.2.2 æœç´¢å’Œè°ƒç”¨å·¥å…·

```typescript
import { unifiedToolManager } from './services/UnifiedToolManager';

// æœç´¢å›¾ç‰‡ç”Ÿæˆå·¥å…·
const searchResults = await unifiedToolManager.searchTools({
  query: 'ç”Ÿæˆå›¾ç‰‡',
  type: 'all',
  limit: 5
});

console.log(searchResults);
/*
[
  {
    tool: { name: 'siliconflow-image-generator', type: 'skill' },
    score: 0.92
  },
  {
    tool: { name: 'stability_ai_generate', type: 'mcp' },
    score: 0.88
  }
]
*/

// è°ƒç”¨å·¥å…·ï¼ˆè‡ªåŠ¨è·¯ç”±ï¼‰
const result = await unifiedToolManager.callTool('siliconflow-image-generator', {
  prompt: 'ä¸€åªå¯çˆ±çš„å°çŒ«',
  image_size: '512x512'
});

console.log(result);
/*
{
  success: true,
  content: [
    {
      type: 'text',
      text: 'Generated image at: https://...'
    }
  ],
  duration: 1234,
  metadata: {
    toolType: 'skill',
    source: 'siliconflow-image-generator',
    toolName: 'siliconflow-image-generator'
  }
}
*/
```

#### 13.2.3 ä½¿ç”¨REST API

```bash
# è·å–æ‰€æœ‰MCPæœåŠ¡å™¨
curl -X GET http://localhost:3000/api/mcp/servers

# æ³¨å†ŒMCPæœåŠ¡å™¨
curl -X POST http://localhost:3000/api/mcp/servers \
  -H 'Content-Type: application/json' \
  -d '{
    "id": "filesystem-mcp",
    "type": "stdio",
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/files"]
  }'

# è°ƒç”¨MCPå·¥å…·
curl -X POST http://localhost:3000/api/mcp/tools/call \
  -H 'Content-Type: application/json' \
  -d '{
    "toolName": "read_file",
    "arguments": {
      "path": "/path/to/file.txt"
    }
  }'

# è·å–ç»Ÿè®¡ä¿¡æ¯
curl -X GET http://localhost:3000/api/mcp/statistics
```

### 13.3 é›†æˆæ­¥éª¤

è¦åœ¨ApexBridgeä¸­å¯ç”¨MCPé›†æˆï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

#### æ­¥éª¤1: å®‰è£…ä¾èµ–

```bash
# å¦‚æœéœ€è¦ï¼Œæ·»åŠ MCP TypeScript SDK
# npm install @modelcontextprotocol/sdk
```

#### æ­¥éª¤2: åˆå§‹åŒ–æœåŠ¡

åœ¨ `src/server.ts` æˆ–åº”ç”¨å…¥å£ä¸­æ·»åŠ ï¼š

```typescript
import { mcpIntegration } from './services/MCPIntegrationService';
import { ToolRetrievalService } from './services/ToolRetrievalService';
import { UnifiedToolManager } from './services/UnifiedToolManager';

// è·å–æˆ–åˆ›å»ºå·¥å…·æ£€ç´¢æœåŠ¡å®ä¾‹
// ï¼ˆToolRetrievalServiceå·²åœ¨ç³»ç»Ÿä¸­åˆå§‹åŒ–ï¼‰
const toolRetrievalService = ToolRetrievalService.getInstance();

// åˆå§‹åŒ–MCPé›†æˆ
await mcpIntegration.initialize();

// åˆå§‹åŒ–ç»Ÿä¸€å·¥å…·ç®¡ç†å™¨
const unifiedToolManager = new UnifiedToolManager(
  skillManager,
  mcpIntegration,
  toolRetrievalService
);

await unifiedToolManager.initialize();
```

#### æ­¥éª¤3: æ³¨å†ŒMCPæœåŠ¡å™¨

```typescript
// æ³¨å†Œå¸¸ç”¨MCPæœåŠ¡å™¨
await mcpIntegration.registerServer({
  id: 'filesystem-mcp',
  type: 'stdio',
  command: 'npx',
  args: ['-y', '@modelcontextprotocol/server-filesystem', process.cwd()]
});

await mcpIntegration.registerServer({
  id: 'git-mcp',
  type: 'stdio',
  command: 'npx',
  args: ['-y', '@modelcontextprotocol/server-git']
});
```

#### æ­¥éª¤4: æ·»åŠ APIè·¯ç”±

åœ¨Expressåº”ç”¨ä¸­ï¼š

```typescript
import mcpRoutes from './api/routes/mcpRoutes';

app.use('/api/mcp', mcpRoutes);
```

### 13.4 æœ€ä½³å®è·µ

#### 13.4.1 æ€§èƒ½ä¼˜åŒ–

1. **ç¼“å­˜å‘é‡æœç´¢ç»“æœ**ï¼š
   ```typescript
   const cachedResults = await cache.get(`search:${queryHash}`);
   if (cachedResults) return cachedResults;
   ```

2. **æ‰¹é‡ç´¢å¼•å·¥å…·**ï¼š
   ```typescript
   // ä¸€æ¬¡æ€§ç´¢å¼•æ‰€æœ‰å·¥å…·ï¼Œè€Œä¸æ˜¯é€ä¸ªç´¢å¼•
   await toolRetrievalService.indexMCPTools(mcpTools);
   await toolRetrievalService.reindexSkills(); // é‡æ–°ç´¢å¼•Skills
   ```

3. **é™åˆ¶å¹¶å‘MCPæœåŠ¡å™¨æ•°é‡**ï¼š
   ```typescript
   const maxServers = 10;
   if (currentServers >= maxServers) {
     throw new Error('Maximum number of MCP servers reached');
   }
   ```

#### 13.4.2 é”™è¯¯å¤„ç†

1. **ä¼˜é›…é™çº§**ï¼š
   ```typescript
   try {
     return await mcpIntegration.callTool(params);
   } catch (error) {
     logger.warn('MCP tool failed, trying fallback:', error);
     // å°è¯•ä½¿ç”¨Skillsç³»ç»Ÿä½œä¸ºå¤‡é€‰
     return await skillManager.executeSkill(...);
   }
   ```

2. **é‡è¯•æœºåˆ¶**ï¼š
   ```typescript
   const maxRetries = 3;
   for (let i = 0; i < maxRetries; i++) {
     try {
       return await mcpIntegration.callTool(params);
     } catch (error) {
       if (i === maxRetries - 1) throw error;
       await delay(1000 * (i + 1));  // æŒ‡æ•°é€€é¿
     }
   }
   ```

### 13.5 æ•…éšœæ’é™¤

#### å¸¸è§é—®é¢˜

**Q: MCPæœåŠ¡å™¨å¯åŠ¨å¤±è´¥**
A: æ£€æŸ¥å‘½ä»¤è·¯å¾„å’Œå‚æ•°æ˜¯å¦æ­£ç¡®ï¼Œç¡®è®¤ä¾èµ–å·²å®‰è£…

**Q: å‘é‡æœç´¢è¿”å›ç©ºç»“æœ**
A: æ£€æŸ¥å·¥å…·æ˜¯å¦å·²æ­£ç¡®ç´¢å¼•ï¼Œç¡®è®¤å‘é‡æ•°æ®åº“æ–‡ä»¶æœªæŸå

**Q: å·¥å…·è°ƒç”¨è¶…æ—¶**
A: å¢åŠ è¶…æ—¶æ—¶é—´ï¼Œæˆ–æ£€æŸ¥MCPæœåŠ¡å™¨æ€§èƒ½

**Q: å†…å­˜ä½¿ç”¨è¿‡é«˜**
A: é™åˆ¶å¹¶å‘MCPæœåŠ¡å™¨æ•°é‡ï¼Œå¯ç”¨å‘é‡æœç´¢ç»“æœç¼“å­˜

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.0
**æœ€åæ›´æ–°**: 2025-01-15
**ç»´æŠ¤è€…**: ApexBridge Team

