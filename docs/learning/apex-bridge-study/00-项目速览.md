# 00 - 项目速览

## 0.1 项目全景定位
Apex Bridge 是一个面向家庭与个人的 AI 中枢系统，核心目标是让 AI 与家庭成员形成持久、可信赖的关系。系统以 Node.js + TypeScript 为基础，结合人格引擎、情绪识别、主动调度、记忆系统及插件生态，为用户提供对话、提醒、娱乐、家务协同等服务。Hub 负责集中式调度，Worker/Companion 节点提供分工协作，Rust 编写的 apex-memory（可选）承载高性能记忆能力，React 管理后台提供可视化运维。

## 0.2 核心能力概览
- **对话协议与工具调用**：基于 VCP 协议实现多轮对话、变量解析、异步回调、插件编排。
- **人格情感系统**：Support 系统 Prompt 拼装、人设管理、情绪识别、主动问候及提醒。
- **记忆体系**：默认 RAG 实现保证轻量部署；apex-memory 侧重 Graph-RAG、情绪记忆、关系图谱、快照归档等高级能力。
- **节点生态**：NodeService、DistributedService、NodeManager 共同维护 Worker/Companion 节点的注册、心跳、任务派发。
- **插件平台**：Direct/Hybrid/Static 多形态插件统一由 PluginRuntime 托管，结合权限与配额策略控制执行风险。
- **管理与运维**：React 后台、日志体系、测试框架、自动化脚本、OpenSpec 变更流程确保系统迭代质量。

## 0.3 目录骨架与模块职责
```
apex-bridge/
├── src/
│   ├── core/                # VCPEngine、LLMClient、EmotionEngine、PersonalityEngine 等核心组件
│   ├── services/            # ChatService、RAGMemoryService、DistributedService 等业务服务
│   ├── api/                 # REST 控制器、中间件、WebSocket 管理器
│   ├── utils/               # 日志、错误、缓存、重试等通用工具
│   └── server.ts            # 入口，启动 HTTP + WebSocket
├── packages/node-agent/     # Worker/Companion 节点运行时与测试
├── admin/                   # React 管理后台
├── plugins/                 # 插件实现（按类型分类）
├── data/                    # 运行态数据（向量库、节点配置、日志、日记等）
├── config/                  # 示例配置
├── scripts/                 # 构建、部署、维护脚本
└── docs/                    # 架构、设计、测试、学习资料
```

## 0.4 技术栈与运行要求
- **语言与框架**：Node.js 18+、TypeScript 5、Express 4、ws、node-schedule。
- **模型接入**：LLMClient 支持 DeepSeek、OpenAI、智谱、Ollama，配置在 `.env` 中。
- **记忆**：内置 `vcp-intellicore-rag`；可选连接 Rust 服务 `apex-memory`，依赖 PostgreSQL、Qdrant、Neo4j。
- **前端**：React 18 + Vite + shadcn/ui + Zustand。
- **测试**：Jest、ts-jest、Supertest；集成测试涵盖节点与 WebSocket 场景。
- **部署**：Windows / Linux / macOS 均可；支持树莓派作为家庭级部署节点。

## 0.5 系统分层结构
```
┌──────────────────────────────────────────┐
│ 接入层：Web、移动端、语音设备、第三方 API  │
├───────────────┬─────────────────────────┤
│ HTTP API       │ WebSocket               │
│ - Chat/Models  │ - 会话推送、节点通道     │
│ - Interrupt    │ - 心跳、任务、日志等     │
└───────┬────────┴───────────────┬────────┘
        │                        │
┌───────▼────────────────────────▼───────┐
│ Hub 核心层                              │
│  - VCPEngine：协议调度、工具编排        │
│  - LLMClient：多模型访问                │
│  - PluginRuntime：插件执行              │
│  - Emotion/Personality：人格与情绪      │
│  - ProactivityScheduler：主动任务       │
│  - NodeManager/Distributed：节点治理    │
└───────┬───────────────────────────────┘
        │
┌───────▼───────────────────────────────┐
│ 记忆层                                 │
│  - RAGMemoryService（默认）             │
│  - RemoteMemoryClient → apex-memory     │
└───────┬───────────────────────────────┘
        │
┌───────▼──────────────┬────────────────┐
│ 插件系统              │ 节点生态       │
│ Direct/Hybrid/Static  │ Worker/Companion│
└───────────────────────┴────────────────┘
```

## 0.6 运行配置与数据布局
- `.env`：主配置文件，涵盖端口、模型、记忆模式、WebSocket、插件开关等。
- `data/config/personality/`：人格模板文本，Hub 启动时注入 PersonalityEngine。
- `data/config/proactivity/`：主动调度场景定义。
- `data/config/nodes/`：节点注册信息与状态缓存。
- `data/vector_store/`：默认 RAG 向量库。
- `logs/`：结构化运行日志，建议纳入集中式收集。
- `async_results/`：异步插件回调结果缓存。

## 0.7 运行示例
```bash
# 初始化环境
cp env.template .env
npm install

# 启动 Hub
npm run dev

# 健康检查
curl http://localhost:8088/health

# 调用对话接口
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
        "messages": [
          {"role": "user", "content": "整理一下今天的重点事项"}
        ],
        "stream": false
      }'
```

## 0.8 路线图关键信息
- **Phase 1**：Hub MVP（对话、插件、基础人格）、Admin 初版、Windows 一键安装。
- **Phase 2**：情绪记忆、主动关怀、时间线展示、偏好学习。
- **Phase 3**：Worker/Companion 节点生态、分布式可视化管理。
- **Phase 4**：多端同步、语音交互、插件市场。
- **Phase 5**：apex-memory Rust 服务落地，Graph-RAG 与情绪图谱。
- **Phase 6**：AI 自主进化、插件生成与审批。

## 0.9 关键注意事项
1. 数据默认本地存储，涉及家庭隐私，部署时需加强主机安全与备份策略。
2. 插件引入需审核权限与资源声明，避免执行高危操作。
3. Worker/Companion 节点必须提供唯一 ID，并保持心跳稳定；建议配置守护进程。
4. apex-memory 部署复杂，需准备数据库、内存、网络环境，建议先在 RAG 模式验证业务。

本章节描述了 Apex Bridge 的工程全貌和运行要求，后续章节将逐个拆解核心引擎、服务体系、节点协作、记忆架构、测试运维等主题。

