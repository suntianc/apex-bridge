# VariableEngine æµ‹è¯•ç”¨ä¾‹ (VariableEngine Test Cases)

> **æ¨¡å—**: VariableEngine (å˜é‡å¼•æ“)  
> **ä¼˜å…ˆçº§**: P1  
> **æœ€åæ›´æ–°**: 2025-11-18

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æ–‡æ¡£åŒ…å« VariableEngine æ¨¡å—çš„è¯¦ç»†æµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–æ‰€æœ‰å˜é‡æä¾›è€…çš„åŠŸèƒ½æµ‹è¯•ã€‚

### æµ‹è¯•èŒƒå›´

- âœ… TimeProvider (æ—¶é—´å˜é‡)
- âœ… EnvironmentProvider (ç¯å¢ƒå˜é‡)
- âœ… PlaceholderProvider (å ä½ç¬¦å˜é‡)
- âœ… ToolDescriptionProvider (å·¥å…·æè¿°å˜é‡)
- âœ… RAGProvider (RAG æ£€ç´¢å˜é‡)
- âœ… å˜é‡ç¼“å­˜æœºåˆ¶
- âœ… å˜é‡åµŒå¥—å’Œç»„åˆ

### å˜é‡æä¾›è€…

| æä¾›è€… | å˜é‡æ ¼å¼ | åŠŸèƒ½ | çŠ¶æ€ |
|--------|----------|------|------|
| **TimeProvider** | `{{time:now}}` | å½“å‰æ—¶é—´ | âœ… Active |
| **EnvironmentProvider** | `{{env:VAR}}` | ç¯å¢ƒå˜é‡ | âœ… Active |
| **PlaceholderProvider** | `{{placeholder:name}}` | å ä½ç¬¦ | âœ… Active |
| **ToolDescriptionProvider** | `{{tools}}` | å·¥å…·æè¿° | âœ… Active |
| **RAGProvider** | `{{rag:collection}}` | RAG æ£€ç´¢ | âœ… Active |

### å‰ç½®æ¡ä»¶

- ApexBridge æœåŠ¡å·²å¯åŠ¨
- VariableEngine å·²åˆå§‹åŒ–
- ProtocolEngine å·²åˆå§‹åŒ–

---

## TimeProvider æµ‹è¯•

### ç”¨ä¾‹ VAR-001: åŸºæœ¬æ—¶é—´å˜é‡è§£æ

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ `{{time:now}}` å˜é‡çš„åŸºæœ¬è§£æåŠŸèƒ½ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "å½“å‰æ—¶é—´æ˜¯: {{time:now}}"},
      {"role": "user", "content": "å‘Šè¯‰æˆ‘ä½ çœ‹åˆ°çš„å½“å‰æ—¶é—´"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- `{{time:now}}` è¢«æ›¿æ¢ä¸ºå®é™…æ—¶é—´
- æ—¶é—´æ ¼å¼æ­£ç¡®
- AI èƒ½çœ‹åˆ°è§£æåçš„æ—¶é—´

#### éªŒè¯ç‚¹

- [ ] æ—¶é—´å˜é‡è¢«è§£æ
- [ ] æ—¶é—´æ ¼å¼æ­£ç¡® (å¦‚: 2025-11-18 10:30:00)
- [ ] AI å“åº”åŒ…å«æ­£ç¡®æ—¶é—´
- [ ] æ—¶é—´ä¸å½“å‰å®é™…æ—¶é—´ä¸€è‡´

#### é€šè¿‡æ ‡å‡†

æ—¶é—´å˜é‡è¢«æ­£ç¡®è§£æä¸ºå½“å‰æ—¶é—´ã€‚

---

### ç”¨ä¾‹ VAR-002: æ—¶é—´æ ¼å¼åŒ–å˜é‡

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ä¸åŒæ ¼å¼çš„æ—¶é—´å˜é‡è§£æã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
# æµ‹è¯•ä¸åŒæ—¶é—´æ ¼å¼
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "æ—¶é—´ä¿¡æ¯: å®Œæ•´æ—¶é—´={{time:now}}, æ—¥æœŸ={{time:date}}, æ—¶åˆ»={{time:time}}"},
      {"role": "user", "content": "åˆ—å‡ºæ‰€æœ‰æ—¶é—´ä¿¡æ¯"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- æ‰€æœ‰æ—¶é—´æ ¼å¼å˜é‡è¢«æ­£ç¡®è§£æ
- æ ¼å¼ç¬¦åˆé¢„æœŸ

#### éªŒè¯ç‚¹

- [ ] `{{time:now}}` è§£æä¸ºå®Œæ•´æ—¶é—´
- [ ] `{{time:date}}` è§£æä¸ºæ—¥æœŸ (å¦‚: 2025-11-18)
- [ ] `{{time:time}}` è§£æä¸ºæ—¶åˆ» (å¦‚: 10:30:00)
- [ ] æ‰€æœ‰æ ¼å¼æ­£ç¡®

#### é€šè¿‡æ ‡å‡†

ä¸åŒæ—¶é—´æ ¼å¼éƒ½è¢«æ­£ç¡®è§£æã€‚

---

### ç”¨ä¾‹ VAR-003: æ—¶é—´å˜é‡åœ¨å¤šä¸ªä½ç½®

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯åŒä¸€æ—¶é—´å˜é‡åœ¨å¤šå¤„ä½¿ç”¨æ—¶çš„ä¸€è‡´æ€§ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "ç³»ç»Ÿå¯åŠ¨æ—¶é—´: {{time:now}}"},
      {"role": "user", "content": "å½“å‰æ—¶é—´: {{time:now}}, è¯·ç¡®è®¤è¿™ä¸¤ä¸ªæ—¶é—´æ˜¯å¦ä¸€è‡´"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- ä¸¤å¤„çš„æ—¶é—´å€¼ç›¸åŒæˆ–éå¸¸æ¥è¿‘
- æ˜¾ç¤ºæ—¶é—´å˜é‡çš„ä¸€è‡´æ€§

#### éªŒè¯ç‚¹

- [ ] ä¸¤å¤„æ—¶é—´è¢«è§£æ
- [ ] ä¸¤å¤„æ—¶é—´ä¸€è‡´ï¼ˆå·®å¼‚ < 1ç§’ï¼‰
- [ ] æ˜¾ç¤ºäº†å˜é‡çš„ç¨³å®šæ€§

#### é€šè¿‡æ ‡å‡†

å¤šå¤„ä½¿ç”¨çš„æ—¶é—´å˜é‡ä¿æŒä¸€è‡´ã€‚

---

## EnvironmentProvider æµ‹è¯•

### ç”¨ä¾‹ VAR-004: ç¯å¢ƒå˜é‡è¯»å–

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ `{{env:VARIABLE}}` å˜é‡çš„è¯»å–åŠŸèƒ½ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
# è®¾ç½®æµ‹è¯•ç¯å¢ƒå˜é‡
export TEST_VAR="è¿™æ˜¯æµ‹è¯•å€¼"
export NODE_ENV="development"

# æµ‹è¯•ç¯å¢ƒå˜é‡è¯»å–
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "æµ‹è¯•å˜é‡: {{env:TEST_VAR}}, ç¯å¢ƒ: {{env:NODE_ENV}}"},
      {"role": "user", "content": "å‘Šè¯‰æˆ‘è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡çš„å€¼"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- ç¯å¢ƒå˜é‡è¢«æ­£ç¡®è¯»å–
- å€¼æ›¿æ¢æ­£ç¡®

#### éªŒè¯ç‚¹

- [ ] `{{env:TEST_VAR}}` è¢«æ›¿æ¢ä¸º "è¿™æ˜¯æµ‹è¯•å€¼"
- [ ] `{{env:NODE_ENV}}` è¢«æ›¿æ¢ä¸º "development"
- [ ] AI èƒ½çœ‹åˆ°ç¯å¢ƒå˜é‡çš„å€¼

#### é€šè¿‡æ ‡å‡†

ç¯å¢ƒå˜é‡è¢«æ­£ç¡®è¯»å–å’Œæ›¿æ¢ã€‚

---

### ç”¨ä¾‹ VAR-005: ä¸å­˜åœ¨çš„ç¯å¢ƒå˜é‡

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: å¼‚å¸¸æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ä¸å­˜åœ¨çš„ç¯å¢ƒå˜é‡çš„å¤„ç†ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "ä¸å­˜åœ¨çš„å˜é‡: {{env:NON_EXISTENT_VAR}}"},
      {"role": "user", "content": "å‘Šè¯‰æˆ‘å˜é‡çš„å€¼"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- ä¸å­˜åœ¨çš„å˜é‡è¢«å¤„ç†
- å¯èƒ½ä¿ç•™åŸæ ·æˆ–æ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²
- ä¸æŠ¥é”™

#### éªŒè¯ç‚¹

- [ ] ä¸å­˜åœ¨çš„å˜é‡è¢«æ£€æµ‹
- [ ] ä¸å¯¼è‡´ç³»ç»Ÿé”™è¯¯
- [ ] æœ‰åˆç†çš„é»˜è®¤è¡Œä¸º

#### é€šè¿‡æ ‡å‡†

ä¼˜é›…åœ°å¤„ç†ä¸å­˜åœ¨çš„ç¯å¢ƒå˜é‡ã€‚

---

### ç”¨ä¾‹ VAR-006: æ•æ„Ÿç¯å¢ƒå˜é‡ä¿æŠ¤

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: å®‰å…¨æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯æ•æ„Ÿç¯å¢ƒå˜é‡ï¼ˆå¦‚ API Keyï¼‰ä¸ä¼šè¢«æ³„éœ²ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "API Key: {{env:DEEPSEEK_API_KEY}}"},
      {"role": "user", "content": "å‘Šè¯‰æˆ‘ API Key"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- æ•æ„Ÿå˜é‡è¢«ä¿æŠ¤
- ä¸åº”è¯¥å®Œæ•´æ˜¾ç¤º API Key
- æˆ–è€…ç›´æ¥æ‹’ç»è®¿é—®

#### éªŒè¯ç‚¹

- [ ] æ•æ„Ÿå˜é‡è¢«è¯†åˆ«
- [ ] API Key æœªå®Œæ•´æ˜¾ç¤º
- [ ] æˆ–å˜é‡è®¿é—®è¢«æ‹’ç»

#### é€šè¿‡æ ‡å‡†

æ•æ„Ÿç¯å¢ƒå˜é‡å¾—åˆ°ä¿æŠ¤ã€‚

---

## PlaceholderProvider æµ‹è¯•

### ç”¨ä¾‹ VAR-007: å ä½ç¬¦å˜é‡åŸºæœ¬åŠŸèƒ½

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ `{{placeholder:name}}` å˜é‡çš„åŸºæœ¬åŠŸèƒ½ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "ç”¨æˆ·å: {{placeholder:username}}, ä¼šè¯ID: {{placeholder:session_id}}"},
      {"role": "user", "content": "å‘Šè¯‰æˆ‘å ä½ç¬¦çš„å€¼"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- å ä½ç¬¦å˜é‡è¢«å¤„ç†
- å¦‚æœæœ‰å€¼åˆ™æ›¿æ¢ï¼Œå¦åˆ™ä¿ç•™æˆ–ä½¿ç”¨é»˜è®¤å€¼

#### éªŒè¯ç‚¹

- [ ] å ä½ç¬¦è¢«è¯†åˆ«
- [ ] æœ‰å€¼æ—¶æ­£ç¡®æ›¿æ¢
- [ ] æ— å€¼æ—¶æœ‰åˆç†å¤„ç†

#### é€šè¿‡æ ‡å‡†

å ä½ç¬¦å˜é‡è¢«æ­£ç¡®å¤„ç†ã€‚

---

### ç”¨ä¾‹ VAR-008: å ä½ç¬¦é»˜è®¤å€¼

**ä¼˜å…ˆçº§**: P2  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯å ä½ç¬¦å˜é‡çš„é»˜è®¤å€¼æœºåˆ¶ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "ç”¨æˆ·: {{placeholder:username:Guest}}"},
      {"role": "user", "content": "å‘Šè¯‰æˆ‘ç”¨æˆ·å"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- æ— å€¼æ—¶ä½¿ç”¨é»˜è®¤å€¼ "Guest"

#### éªŒè¯ç‚¹

- [ ] é»˜è®¤å€¼è¯­æ³•è¢«è¯†åˆ«
- [ ] æ— å€¼æ—¶ä½¿ç”¨é»˜è®¤å€¼
- [ ] æœ‰å€¼æ—¶å¿½ç•¥é»˜è®¤å€¼

#### é€šè¿‡æ ‡å‡†

é»˜è®¤å€¼æœºåˆ¶æ­£å¸¸å·¥ä½œï¼ˆå¦‚æœæ”¯æŒï¼‰ã€‚

---

## ToolDescriptionProvider æµ‹è¯•

### ç”¨ä¾‹ VAR-009: å·¥å…·æè¿°å˜é‡ç”Ÿæˆ

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ `{{tools}}` å˜é‡ç”Ÿæˆå®Œæ•´çš„å·¥å…·æè¿°ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "å¯ç”¨å·¥å…·:\n{{tools}}"},
      {"role": "user", "content": "åˆ—å‡ºæ‰€æœ‰å¯ç”¨å·¥å…·"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- `{{tools}}` è¢«æ›¿æ¢ä¸ºæ‰€æœ‰ Skills çš„æè¿°
- æè¿°æ ¼å¼ç¬¦åˆ ABP è§„èŒƒ
- åŒ…å«æ‰€æœ‰å¯ç”¨å·¥å…·

#### éªŒè¯ç‚¹

- [ ] å·¥å…·æè¿°å˜é‡è¢«è§£æ
- [ ] åŒ…å«æ‰€æœ‰ 5 ä¸ª Skills
- [ ] æ ¼å¼ç¬¦åˆ ABP è§„èŒƒ
- [ ] æè¿°æ¸…æ™°æ˜“æ‡‚

#### é€šè¿‡æ ‡å‡†

å·¥å…·æè¿°å˜é‡æ­£ç¡®ç”Ÿæˆã€‚

---

### ç”¨ä¾‹ VAR-010: å·¥å…·æè¿°æ ¼å¼

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯å·¥å…·æè¿°çš„æ ¼å¼å’Œå†…å®¹å®Œæ•´æ€§ã€‚

#### æµ‹è¯•æ­¥éª¤

**é€šè¿‡æ—¥å¿—æŸ¥çœ‹å·¥å…·æè¿°**:

```bash
npm run dev 2>&1 | grep -A 50 "tools description"
```

**æˆ–é€šè¿‡ä»£ç æ£€æŸ¥**:

```javascript
// test-tools-description.js
const axios = require('axios');

async function testToolsDescription() {
  const response = await axios.post('http://localhost:8088/v1/chat/completions', {
    messages: [
      {role: 'system', content: 'å¯ç”¨å·¥å…·: {{tools}}'},
      {role: 'user', content: 'åˆ—å‡ºå·¥å…·'}
    ],
    stream: false
  });
  
  console.log('å·¥å…·æè¿°:', response.data.choices[0].message.content);
}

testToolsDescription();
```

#### é¢„æœŸç»“æœ

- æ¯ä¸ªå·¥å…·åŒ…å«ï¼šåç§°ã€æè¿°ã€å‚æ•°
- æ ¼å¼ç»Ÿä¸€
- ä¿¡æ¯å®Œæ•´

#### éªŒè¯ç‚¹

- [ ] åŒ…å«å·¥å…·åç§°
- [ ] åŒ…å«å·¥å…·æè¿°
- [ ] åŒ…å«å‚æ•°è¯´æ˜ï¼ˆå¦‚æœ‰ï¼‰
- [ ] æ ¼å¼ç»Ÿä¸€

#### é€šè¿‡æ ‡å‡†

å·¥å…·æè¿°æ ¼å¼æ­£ç¡®ä¸”å®Œæ•´ã€‚

---

## RAGProvider æµ‹è¯•

### ç”¨ä¾‹ VAR-011: RAG å˜é‡åŸºæœ¬åŠŸèƒ½

**ä¼˜å…ˆçº§**: P2  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ `{{rag:collection}}` å˜é‡çš„ RAG æ£€ç´¢åŠŸèƒ½ã€‚

#### å‰ç½®æ¡ä»¶

- RAG åŠŸèƒ½å·²å¯ç”¨ (`RAG_ENABLED=true`)
- å·²æœ‰ RAG æ•°æ®é›†åˆ

#### æµ‹è¯•æ­¥éª¤

```bash
# ç¡®ä¿ RAG å·²å¯ç”¨
export RAG_ENABLED=true

# æµ‹è¯• RAG å˜é‡
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "ç›¸å…³æ–‡æ¡£: {{rag:docs}}"},
      {"role": "user", "content": "æ ¹æ®æ–‡æ¡£å›ç­”é—®é¢˜"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- RAG æ£€ç´¢è¢«è§¦å‘
- ç›¸å…³æ–‡æ¡£è¢«æ£€ç´¢
- æ–‡æ¡£å†…å®¹è¢«æ³¨å…¥

#### éªŒè¯ç‚¹

- [ ] RAG å˜é‡è¢«è¯†åˆ«
- [ ] æ£€ç´¢è¢«è§¦å‘
- [ ] è¿”å›ç›¸å…³æ–‡æ¡£
- [ ] æ–‡æ¡£å†…å®¹æ­£ç¡®

#### é€šè¿‡æ ‡å‡†

RAG å˜é‡åŠŸèƒ½æ­£å¸¸ï¼ˆå¦‚æœå¯ç”¨ RAGï¼‰ã€‚

---

### ç”¨ä¾‹ VAR-012: RAG æ£€ç´¢æ¨¡å¼

**ä¼˜å…ˆçº§**: P2  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ä¸åŒçš„ RAG æ£€ç´¢æ¨¡å¼ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
# æ—¶é—´æ¨¡å¼
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "æœ€è¿‘æ–‡æ¡£: {{rag:docs:time}}"},
      {"role": "user", "content": "æœ€è¿‘çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ"}
    ],
    "stream": false
  }'

# åˆ†ç»„æ¨¡å¼
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "åˆ†ç»„æ–‡æ¡£: {{rag:docs:group}}"},
      {"role": "user", "content": "æŒ‰ç»„æ˜¾ç¤ºæ–‡æ¡£"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- ä¸åŒæ¨¡å¼è¢«è¯†åˆ«
- æ£€ç´¢ç»“æœç¬¦åˆæ¨¡å¼ç‰¹ç‚¹

#### éªŒè¯ç‚¹

- [ ] time æ¨¡å¼ï¼šæŒ‰æ—¶é—´æ’åº
- [ ] group æ¨¡å¼ï¼šæŒ‰ç»„åˆ†ç±»
- [ ] å…¶ä»–æ¨¡å¼æ­£å¸¸å·¥ä½œ

#### é€šè¿‡æ ‡å‡†

ä¸åŒ RAG æ¨¡å¼éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚

---

## å˜é‡ç»„åˆæµ‹è¯•

### ç”¨ä¾‹ VAR-013: å¤šå˜é‡æ··åˆä½¿ç”¨

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯å¤šä¸ªä¸åŒç±»å‹å˜é‡åŒæ—¶ä½¿ç”¨çš„åŠŸèƒ½ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "æ—¶é—´: {{time:now}}, ç¯å¢ƒ: {{env:NODE_ENV}}, ç”¨æˆ·: {{placeholder:username}}, å·¥å…·: {{tools}}"},
      {"role": "user", "content": "æ˜¾ç¤ºæ‰€æœ‰ä¿¡æ¯"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- æ‰€æœ‰å˜é‡éƒ½è¢«æ­£ç¡®è§£æ
- å˜é‡ä¹‹é—´ä¸äº’ç›¸å¹²æ‰°
- æ›¿æ¢é¡ºåºæ­£ç¡®

#### éªŒè¯ç‚¹

- [ ] æ‰€æœ‰å˜é‡éƒ½è¢«è§£æ
- [ ] å„å˜é‡ç‹¬ç«‹å·¥ä½œ
- [ ] æ— è§£æå†²çª
- [ ] ç»“æœæ­£ç¡®

#### é€šè¿‡æ ‡å‡†

å¤šå˜é‡æ··åˆä½¿ç”¨æ­£å¸¸ã€‚

---

### ç”¨ä¾‹ VAR-014: å˜é‡åµŒå¥—

**ä¼˜å…ˆçº§**: P2  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯å˜é‡åµŒå¥—è§£æçš„åŠŸèƒ½ï¼ˆå¦‚æœæ”¯æŒï¼‰ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
# æµ‹è¯•å˜é‡åµŒå¥—
export VAR_NAME="NODE_ENV"

curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "åµŒå¥—å˜é‡: {{env:{{env:VAR_NAME}}}}"},
      {"role": "user", "content": "åµŒå¥—å˜é‡çš„å€¼æ˜¯ä»€ä¹ˆï¼Ÿ"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- åµŒå¥—å˜é‡è¢«è¯†åˆ«
- å†…å±‚å…ˆè§£æï¼Œå¤–å±‚åè§£æ
- æˆ–è€…æç¤ºä¸æ”¯æŒåµŒå¥—

#### éªŒè¯ç‚¹

- [ ] åµŒå¥—è¢«æ£€æµ‹
- [ ] è§£æé¡ºåºæ­£ç¡®
- [ ] æˆ–æ˜ç¡®æç¤ºä¸æ”¯æŒ

#### é€šè¿‡æ ‡å‡†

åµŒå¥—å˜é‡å¤„ç†åˆç†ï¼ˆæ”¯æŒæˆ–æ˜ç¡®æç¤ºä¸æ”¯æŒï¼‰ã€‚

---

## å˜é‡ç¼“å­˜æµ‹è¯•

### ç”¨ä¾‹ VAR-015: å˜é‡è§£æç¼“å­˜

**ä¼˜å…ˆçº§**: P2  
**ç±»å‹**: æ€§èƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯å˜é‡è§£æç»“æœçš„ç¼“å­˜æœºåˆ¶ã€‚

#### æµ‹è¯•æ­¥éª¤

```javascript
// test-variable-cache.js
const axios = require('axios');

async function testCache() {
  console.log('ğŸ§ª æµ‹è¯•å˜é‡ç¼“å­˜...\n');
  
  const systemPrompt = 'æ—¶é—´: {{time:now}}, ç¯å¢ƒ: {{env:NODE_ENV}}';
  
  // ç¬¬ä¸€æ¬¡è¯·æ±‚
  console.log('ç¬¬ä¸€æ¬¡è¯·æ±‚:');
  const start1 = Date.now();
  await axios.post('http://localhost:8088/v1/chat/completions', {
    messages: [
      {role: 'system', content: systemPrompt},
      {role: 'user', content: 'æµ‹è¯•1'}
    ],
    stream: false
  });
  const time1 = Date.now() - start1;
  console.log(`  è€—æ—¶: ${time1}ms`);
  
  // ç¬¬äºŒæ¬¡è¯·æ±‚ï¼ˆåº”ä½¿ç”¨ç¼“å­˜ï¼‰
  console.log('\nç¬¬äºŒæ¬¡è¯·æ±‚:');
  const start2 = Date.now();
  await axios.post('http://localhost:8088/v1/chat/completions', {
    messages: [
      {role: 'system', content: systemPrompt},
      {role: 'user', content: 'æµ‹è¯•2'}
    ],
    stream: false
  });
  const time2 = Date.now() - start2;
  console.log(`  è€—æ—¶: ${time2}ms`);
  
  if (time2 <= time1) {
    console.log('\nâœ… ç¼“å­˜å¯èƒ½ç”Ÿæ•ˆ');
  }
}

testCache();
```

#### é¢„æœŸç»“æœ

- ç›¸åŒå˜é‡çš„é‡å¤è§£æä½¿ç”¨ç¼“å­˜
- æ€§èƒ½æœ‰æå‡

#### éªŒè¯ç‚¹

- [ ] ç¼“å­˜æœºåˆ¶å·¥ä½œ
- [ ] é‡å¤è§£ææ›´å¿«
- [ ] ç¼“å­˜è¿‡æœŸæ­£å¸¸

#### é€šè¿‡æ ‡å‡†

ç¼“å­˜æœºåˆ¶æ­£å¸¸å·¥ä½œã€‚

---

## ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»

### æµ‹è¯•ç”¨ä¾‹ç»Ÿè®¡

| ç±»åˆ« | ç”¨ä¾‹æ•° | æè¿° |
|------|--------|------|
| TimeProvider | 3 | åŸºæœ¬ã€æ ¼å¼åŒ–ã€ä¸€è‡´æ€§ |
| EnvironmentProvider | 3 | è¯»å–ã€ä¸å­˜åœ¨ã€æ•æ„Ÿä¿æŠ¤ |
| PlaceholderProvider | 2 | åŸºæœ¬åŠŸèƒ½ã€é»˜è®¤å€¼ |
| ToolDescriptionProvider | 2 | ç”Ÿæˆã€æ ¼å¼ |
| RAGProvider | 2 | åŸºæœ¬åŠŸèƒ½ã€æ£€ç´¢æ¨¡å¼ |
| å˜é‡ç»„åˆ | 2 | æ··åˆä½¿ç”¨ã€åµŒå¥— |
| ç¼“å­˜æœºåˆ¶ | 1 | ç¼“å­˜æµ‹è¯• |
| **æ€»è®¡** | **15** | |

### ä¼˜å…ˆçº§åˆ†å¸ƒ

| ä¼˜å…ˆçº§ | ç”¨ä¾‹æ•° | ç”¨ä¾‹ç¼–å· |
|--------|--------|----------|
| P0 | 4 | VAR-001, 004, 006, 009 |
| P1 | 7 | VAR-002, 003, 005, 007, 010, 013 |
| P2 | 4 | VAR-008, 011, 012, 014, 015 |

### æµ‹è¯•è®°å½•æ¨¡æ¿

```markdown
## VariableEngine æµ‹è¯•æ‰§è¡Œè®°å½•

- **æµ‹è¯•æ—¥æœŸ**: YYYY-MM-DD
- **æµ‹è¯•äººå‘˜**: [å§“å]
- **ApexBridge ç‰ˆæœ¬**: [ç‰ˆæœ¬å·]

| ç”¨ä¾‹ç¼–å· | ç”¨ä¾‹åç§° | ç»“æœ | å¤‡æ³¨ |
|----------|----------|------|------|
| VAR-001 | æ—¶é—´å˜é‡ | âœ… PASS | - |
| VAR-002 | æ—¶é—´æ ¼å¼åŒ– | âœ… PASS | - |
| VAR-003 | æ—¶é—´ä¸€è‡´æ€§ | âœ… PASS | - |
| ... | ... | ... | ... |

**æ€»é€šè¿‡ç‡**: XX%
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•æ€»è§ˆæŒ‡å—](../MANUAL_TESTING_GUIDE.md)
- [ProtocolEngine æµ‹è¯•ç”¨ä¾‹](./PROTOCOL_ENGINE_TEST_CASES.md)
- [Chat API æµ‹è¯•ç”¨ä¾‹](./CHAT_API_TEST_CASES.md)

---

## ğŸ’¡ æµ‹è¯•æŠ€å·§

1. **æŸ¥çœ‹å˜é‡è§£ææ—¥å¿—**:
   ```bash
   LOG_LEVEL=debug npm run dev 2>&1 | grep -i "variable"
   ```

2. **æµ‹è¯•ç¯å¢ƒå˜é‡**:
   - è®¾ç½®æµ‹è¯•ç¯å¢ƒå˜é‡
   - éªŒè¯è¯»å–æ­£ç¡®æ€§
   - æ¸…ç†æµ‹è¯•å˜é‡

3. **éªŒè¯å·¥å…·æè¿°**:
   ```bash
   npm run dev 2>&1 | grep -A 50 "tools"
   ```

4. **æ€§èƒ½æµ‹è¯•**:
   - æµ‹è¯•å¤§é‡å˜é‡çš„è§£æ
   - éªŒè¯ç¼“å­˜æ•ˆæœ

---

**æ–‡æ¡£ç»´æŠ¤**: å¦‚å‘ç°æµ‹è¯•ç”¨ä¾‹æœ‰é—®é¢˜æˆ–éœ€è¦è¡¥å……ï¼Œè¯·æäº¤ Issue æˆ– PRã€‚

*æœ€åæ›´æ–°: 2025-11-18*

