# ProtocolEngine æµ‹è¯•ç”¨ä¾‹ (ProtocolEngine Test Cases)

> **æ¨¡å—**: ProtocolEngine (åè®®å¼•æ“æ ¸å¿ƒ)  
> **ä¼˜å…ˆçº§**: P0  
> **æœ€åæ›´æ–°**: 2025-11-18

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æ–‡æ¡£åŒ…å« ProtocolEngine æ¨¡å—çš„è¯¦ç»†æµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›– ABP åè®®è§£æã€å˜é‡è§£æã€å·¥å…·æè¿°ç”Ÿæˆç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### æµ‹è¯•èŒƒå›´

- âœ… ABP åè®®è§£æ
- âœ… å·¥å…·è°ƒç”¨è§£æ
- âœ… å˜é‡å¼•æ“åˆå§‹åŒ–
- âœ… å·¥å…·æè¿°ç”Ÿæˆ
- âœ… é”™è¯¯æ¢å¤æœºåˆ¶
- âœ… JSON ä¿®å¤
- âœ… å™ªå£°è¿‡æ»¤

### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | èŒè´£ | çŠ¶æ€ |
|------|------|------|
| ABPProtocolParser | ABP åè®®è§£æ | âœ… Active |
| VariableEngine | å˜é‡è§£æä¸æ›¿æ¢ | âœ… Active |
| ToolDescriptionProvider | å·¥å…·æè¿°ç”Ÿæˆ | âœ… Active |

### å‰ç½®æ¡ä»¶

- ApexBridge æœåŠ¡å·²å¯åŠ¨
- ProtocolEngine å·²æ­£ç¡®åˆå§‹åŒ–
- Skills å·²åŠ è½½

---

## ABP åè®®è§£ææµ‹è¯•

### ç”¨ä¾‹ PE-001: åŸºæœ¬ ABP åè®®è§£æ

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ ProtocolEngine èƒ½å¤Ÿæ­£ç¡®è§£ææ ‡å‡† ABP åè®®æ ¼å¼ã€‚

#### æµ‹è¯•æ­¥éª¤

**æµ‹è¯•æ•°æ®** - æ ‡å‡† ABP æ ¼å¼:

```text
<tool_call>
  <tool_name>TimeInfo</tool_name>
  <parameters>
    {}
  </parameters>
</tool_call>
```

**æµ‹è¯•æ–¹æ³•**:

```bash
# é€šè¿‡èŠå¤©æ¥å£è§¦å‘ ABP åè®®
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ"}
    ],
    "stream": false
  }'
```

**æˆ–è€…ä½¿ç”¨ Node.js æµ‹è¯•è„šæœ¬**:

```javascript
// test-protocol-engine-abp.js
const axios = require('axios');

async function testABPParsing() {
  console.log('ğŸ§ª æµ‹è¯• ABP åè®®è§£æ...\n');
  
  const response = await axios.post('http://localhost:8088/v1/chat/completions', {
    messages: [
      {role: 'user', content: 'ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ'}
    ],
    stream: false
  });
  
  console.log('âœ… å“åº”:', response.data.choices[0].message.content);
  
  // éªŒè¯å“åº”åŒ…å«æ—¶é—´ä¿¡æ¯
  const content = response.data.choices[0].message.content;
  if (content.match(/\d{4}|\d{1,2}:\d{2}|\d{1,2}ç‚¹/)) {
    console.log('âœ… ABP åè®®è§£ææˆåŠŸï¼Œå·¥å…·è°ƒç”¨æ­£å¸¸');
    return true;
  } else {
    console.log('âŒ å·¥å…·è°ƒç”¨å¤±è´¥');
    return false;
  }
}

testABPParsing();
```

#### é¢„æœŸç»“æœ

- LLM ç”Ÿæˆ ABP æ ¼å¼çš„å·¥å…·è°ƒç”¨
- ProtocolEngine æˆåŠŸè§£æ ABP åè®®
- æ­£ç¡®æå– tool_name å’Œ parameters
- å·¥å…·è¢«æˆåŠŸè°ƒç”¨
- å“åº”åŒ…å«æ—¶é—´ä¿¡æ¯

#### éªŒè¯ç‚¹

- [ ] ABP åè®®è¢«æ­£ç¡®è§£æ
- [ ] tool_name ä¸º "TimeInfo"
- [ ] parameters è¢«æ­£ç¡®æå–
- [ ] å·¥å…·è°ƒç”¨æˆåŠŸæ‰§è¡Œ
- [ ] å“åº”åŒ…å«æ—¶é—´ä¿¡æ¯

#### é€šè¿‡æ ‡å‡†

ABP åè®®è¢«æ­£ç¡®è§£æï¼Œå·¥å…·è°ƒç”¨æˆåŠŸã€‚

---

### ç”¨ä¾‹ PE-002: å¸¦å‚æ•°çš„ ABP åè®®è§£æ

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯è§£æå¸¦æœ‰å‚æ•°çš„ ABP å·¥å…·è°ƒç”¨ã€‚

#### æµ‹è¯•æ­¥éª¤

**åˆ›å»ºæµ‹è¯• Skill** (å¦‚æœéœ€è¦):

```bash
# å‡è®¾æœ‰ä¸€ä¸ªæ”¯æŒå‚æ•°çš„ Skill
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "å¸®æˆ‘æ·ä¸¤ä¸ª6é¢éª°å­"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- å‚æ•°è¢«æ­£ç¡®è§£æ
- å‚æ•°ä¼ é€’ç»™ Skill
- Skill ä½¿ç”¨å‚æ•°æ‰§è¡Œ

#### éªŒè¯ç‚¹

- [ ] ABP åè®®ä¸­çš„å‚æ•°è¢«è§£æ
- [ ] å‚æ•°æ ¼å¼æ­£ç¡®ï¼ˆJSONï¼‰
- [ ] å‚æ•°ä¼ é€’ç»™æ‰§è¡Œå™¨
- [ ] Skill ä½¿ç”¨å‚æ•°æ‰§è¡Œ

#### é€šè¿‡æ ‡å‡†

å¸¦å‚æ•°çš„ ABP åè®®è¢«æ­£ç¡®è§£æå’Œæ‰§è¡Œã€‚

---

### ç”¨ä¾‹ PE-003: å¤šä¸ªå·¥å…·è°ƒç”¨è§£æ

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯è§£æåŒ…å«å¤šä¸ªå·¥å…·è°ƒç”¨çš„å“åº”ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "è¯·å‘Šè¯‰æˆ‘ç°åœ¨å‡ ç‚¹ï¼Œç„¶åæŸ¥è¯¢ç³»ç»Ÿä¿¡æ¯"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- å“åº”åŒ…å«æ—¶é—´ä¿¡æ¯
- å“åº”åŒ…å«ç³»ç»Ÿä¿¡æ¯
- ä¸¤ä¸ªå·¥å…·éƒ½è¢«æˆåŠŸè°ƒç”¨

#### éªŒè¯ç‚¹

- [ ] è§£æå‡ºå¤šä¸ªå·¥å…·è°ƒç”¨
- [ ] æ¯ä¸ªå·¥å…·è°ƒç”¨éƒ½è¢«æ‰§è¡Œ
- [ ] æ‰§è¡Œé¡ºåºæ­£ç¡®
- [ ] å“åº”åŒ…å«æ‰€æœ‰ç»“æœ

#### é€šè¿‡æ ‡å‡†

å¤šä¸ªå·¥å…·è°ƒç”¨éƒ½è¢«æ­£ç¡®è§£æå’Œæ‰§è¡Œã€‚

---

### ç”¨ä¾‹ PE-004: ABP åè®®é”™è¯¯æ¢å¤

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: å¼‚å¸¸æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ ProtocolEngine çš„é”™è¯¯æ¢å¤æœºåˆ¶ã€‚

#### æµ‹è¯•æ­¥éª¤

**æ¨¡æ‹Ÿç•¸å½¢çš„ ABP åè®®** (é€šè¿‡æ—¥å¿—æŸ¥çœ‹):

```javascript
// test-abp-error-recovery.js
const axios = require('axios');

async function testErrorRecovery() {
  console.log('ğŸ§ª æµ‹è¯• ABP é”™è¯¯æ¢å¤...\n');
  
  // å‘é€ä¸€ä¸ªå¯èƒ½å¯¼è‡´ ABP æ ¼å¼é”™è¯¯çš„è¯·æ±‚
  try {
    const response = await axios.post('http://localhost:8088/v1/chat/completions', {
      messages: [
        {role: 'system', content: 'è¯·ç›´æ¥è¾“å‡ºå·¥å…·è°ƒç”¨ï¼Œæ ¼å¼å¯èƒ½ä¸å®Œæ•´'},
        {role: 'user', content: 'æ—¶é—´'}
      ],
      stream: false
    });
    
    console.log('âœ… å“åº”:', response.data.choices[0].message.content);
    console.log('âœ… é”™è¯¯æ¢å¤æœºåˆ¶å·¥ä½œæ­£å¸¸');
  } catch (error) {
    console.log('â„¹ï¸  é”™è¯¯:', error.message);
  }
}

testErrorRecovery();
```

#### é¢„æœŸç»“æœ

- ç•¸å½¢çš„ ABP åè®®è¢«æ£€æµ‹
- é”™è¯¯æ¢å¤æœºåˆ¶å¯åŠ¨
- è¿”å›åˆç†çš„å“åº”æˆ–é”™è¯¯ä¿¡æ¯
- æœåŠ¡æœªå´©æºƒ

#### éªŒè¯ç‚¹

- [ ] é”™è¯¯è¢«æ£€æµ‹
- [ ] é”™è¯¯æ¢å¤æœºåˆ¶å¯åŠ¨
- [ ] è¿”å›æœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯
- [ ] æœåŠ¡ä¿æŒç¨³å®š

#### é€šè¿‡æ ‡å‡†

é”™è¯¯æ¢å¤æœºåˆ¶æ­£å¸¸å·¥ä½œï¼ŒæœåŠ¡ç¨³å®šã€‚

---

## å˜é‡å¼•æ“æµ‹è¯•

### ç”¨ä¾‹ PE-005: å˜é‡å¼•æ“åˆå§‹åŒ–

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯å˜é‡å¼•æ“çš„æ­£ç¡®åˆå§‹åŒ–ã€‚

#### æµ‹è¯•æ­¥éª¤

**æŸ¥çœ‹å¯åŠ¨æ—¥å¿—**:

```bash
npm run dev 2>&1 | grep -i "VariableEngine"
```

#### é¢„æœŸè¾“å‡º

```
âœ… VariableEngine initialized
```

#### éªŒè¯ç‚¹

- [ ] æ—¥å¿—æ˜¾ç¤º VariableEngine åˆå§‹åŒ–
- [ ] æ‰€æœ‰å˜é‡æä¾›è€…å·²æ³¨å†Œ
- [ ] æ— åˆå§‹åŒ–é”™è¯¯

#### é€šè¿‡æ ‡å‡†

å˜é‡å¼•æ“æˆåŠŸåˆå§‹åŒ–ï¼Œæ‰€æœ‰æä¾›è€…å·²æ³¨å†Œã€‚

---

### ç”¨ä¾‹ PE-006: æ—¶é—´å˜é‡è§£æ

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯æ—¶é—´å˜é‡ `{{time:now}}` çš„è§£æã€‚

#### æµ‹è¯•æ­¥éª¤

**é€šè¿‡ System Prompt æµ‹è¯•**:

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "å½“å‰æ—¶é—´æ˜¯: {{time:now}}"},
      {"role": "user", "content": "å‘Šè¯‰æˆ‘ä½ çŸ¥é“çš„å½“å‰æ—¶é—´"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- `{{time:now}}` è¢«æ›¿æ¢ä¸ºå®é™…æ—¶é—´
- AI èƒ½å¤Ÿçœ‹åˆ°è§£æåçš„æ—¶é—´
- å“åº”ä¸­åŒ…å«æ­£ç¡®çš„æ—¶é—´ä¿¡æ¯

#### éªŒè¯ç‚¹

- [ ] æ—¶é—´å˜é‡è¢«è§£æ
- [ ] æ›¿æ¢ä¸ºå®é™…æ—¶é—´
- [ ] æ—¶é—´æ ¼å¼æ­£ç¡®
- [ ] AI èƒ½è®¿é—®è§£æåçš„å€¼

#### é€šè¿‡æ ‡å‡†

æ—¶é—´å˜é‡è¢«æ­£ç¡®è§£æå’Œæ›¿æ¢ã€‚

---

### ç”¨ä¾‹ PE-007: ç¯å¢ƒå˜é‡è§£æ

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ç¯å¢ƒå˜é‡ `{{env:VARIABLE_NAME}}` çš„è§£æã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
# è®¾ç½®æµ‹è¯•ç¯å¢ƒå˜é‡
export TEST_VAR="æµ‹è¯•å€¼123"

# æµ‹è¯•ç¯å¢ƒå˜é‡è§£æ
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "æµ‹è¯•å˜é‡: {{env:TEST_VAR}}"},
      {"role": "user", "content": "å‘Šè¯‰æˆ‘æµ‹è¯•å˜é‡çš„å€¼"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- `{{env:TEST_VAR}}` è¢«æ›¿æ¢ä¸º "æµ‹è¯•å€¼123"
- AI èƒ½å¤Ÿçœ‹åˆ°ç¯å¢ƒå˜é‡çš„å€¼

#### éªŒè¯ç‚¹

- [ ] ç¯å¢ƒå˜é‡è¢«è§£æ
- [ ] æ›¿æ¢ä¸ºæ­£ç¡®çš„å€¼
- [ ] ä¸å­˜åœ¨çš„ç¯å¢ƒå˜é‡è¢«å¤„ç†

#### é€šè¿‡æ ‡å‡†

ç¯å¢ƒå˜é‡è¢«æ­£ç¡®è§£æã€‚

---

### ç”¨ä¾‹ PE-008: å ä½ç¬¦å˜é‡è§£æ

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯å ä½ç¬¦å˜é‡ `{{placeholder:name}}` çš„è§£æã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "ç”¨æˆ·å: {{placeholder:username}}"},
      {"role": "user", "content": "ä½ çŸ¥é“æˆ‘çš„ç”¨æˆ·åå—ï¼Ÿ"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- å ä½ç¬¦å˜é‡è¢«è¯†åˆ«
- å¦‚æœæœ‰å€¼åˆ™æ›¿æ¢ï¼Œå¦åˆ™ä¿ç•™æˆ–ä½¿ç”¨é»˜è®¤å€¼

#### éªŒè¯ç‚¹

- [ ] å ä½ç¬¦å˜é‡è¢«å¤„ç†
- [ ] æœ‰å€¼æ—¶æ­£ç¡®æ›¿æ¢
- [ ] æ— å€¼æ—¶ä¸æŠ¥é”™

#### é€šè¿‡æ ‡å‡†

å ä½ç¬¦å˜é‡è¢«æ­£ç¡®å¤„ç†ã€‚

---

### ç”¨ä¾‹ PE-009: å·¥å…·æè¿°å˜é‡

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯å·¥å…·æè¿°å˜é‡ `{{tools}}` çš„ç”Ÿæˆå’Œæ³¨å…¥ã€‚

#### æµ‹è¯•æ­¥éª¤

**æŸ¥çœ‹ç”Ÿæˆçš„å·¥å…·æè¿°**:

```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—ä¸­çš„å·¥å…·æè¿°
npm run dev 2>&1 | grep -A 20 "tools description"
```

**æˆ–é€šè¿‡èŠå¤©æµ‹è¯•**:

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "å¯ç”¨å·¥å…·: {{tools}}"},
      {"role": "user", "content": "ä½ æœ‰å“ªäº›å·¥å…·å¯ä»¥ä½¿ç”¨ï¼Ÿ"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- `{{tools}}` è¢«æ›¿æ¢ä¸ºå·¥å…·åˆ—è¡¨
- åŒ…å«æ‰€æœ‰å¯ç”¨ Skills
- æ ¼å¼ç¬¦åˆ ABP è§„èŒƒ

#### éªŒè¯ç‚¹

- [ ] å·¥å…·æè¿°è¢«ç”Ÿæˆ
- [ ] åŒ…å«æ‰€æœ‰ Skills
- [ ] æ ¼å¼æ­£ç¡®ï¼ˆABP æ ¼å¼ï¼‰
- [ ] AI èƒ½çœ‹åˆ°å·¥å…·åˆ—è¡¨

#### é€šè¿‡æ ‡å‡†

å·¥å…·æè¿°å˜é‡è¢«æ­£ç¡®ç”Ÿæˆå’Œæ³¨å…¥ã€‚

---

### ç”¨ä¾‹ PE-010: å˜é‡ç¼“å­˜æœºåˆ¶

**ä¼˜å…ˆçº§**: P2  
**ç±»å‹**: æ€§èƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯å˜é‡è§£æçš„ç¼“å­˜æœºåˆ¶ã€‚

#### æµ‹è¯•æ­¥éª¤

```javascript
// test-variable-cache.js
const axios = require('axios');

async function testVariableCache() {
  console.log('ğŸ§ª æµ‹è¯•å˜é‡ç¼“å­˜...\n');
  
  const systemPrompt = 'å½“å‰æ—¶é—´: {{time:now}}, ç¯å¢ƒ: {{env:NODE_ENV}}';
  
  console.log('ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼ˆå†·å¯åŠ¨ï¼‰:');
  const start1 = Date.now();
  await axios.post('http://localhost:8088/v1/chat/completions', {
    messages: [
      {role: 'system', content: systemPrompt},
      {role: 'user', content: 'å‘Šè¯‰æˆ‘å½“å‰ä¿¡æ¯'}
    ],
    stream: false
  });
  const time1 = Date.now() - start1;
  console.log(`  è€—æ—¶: ${time1}ms\n`);
  
  console.log('ç¬¬äºŒæ¬¡è¯·æ±‚ï¼ˆåº”ä½¿ç”¨ç¼“å­˜ï¼‰:');
  const start2 = Date.now();
  await axios.post('http://localhost:8088/v1/chat/completions', {
    messages: [
      {role: 'system', content: systemPrompt},
      {role: 'user', content: 'å†å‘Šè¯‰æˆ‘ä¸€æ¬¡'}
    ],
    stream: false
  });
  const time2 = Date.now() - start2;
  console.log(`  è€—æ—¶: ${time2}ms\n`);
  
  if (time2 <= time1) {
    console.log('âœ… ç¼“å­˜æœºåˆ¶å¯èƒ½ç”Ÿæ•ˆï¼ˆç¬¬äºŒæ¬¡ä¸æ…¢äºç¬¬ä¸€æ¬¡ï¼‰');
  } else {
    console.log('â„¹ï¸  ç¬¬äºŒæ¬¡è¯·æ±‚æ›´æ…¢ï¼ˆå¯èƒ½å—ç½‘ç»œæˆ–LLMå½±å“ï¼‰');
  }
}

testVariableCache();
```

#### é¢„æœŸç»“æœ

- å˜é‡è§£æç»“æœè¢«ç¼“å­˜
- é‡å¤è¯·æ±‚ä½¿ç”¨ç¼“å­˜
- æ€§èƒ½æœ‰æ‰€æå‡

#### éªŒè¯ç‚¹

- [ ] ç¼“å­˜æœºåˆ¶å·¥ä½œ
- [ ] é‡å¤è§£æä½¿ç”¨ç¼“å­˜
- [ ] ç¼“å­˜è¿‡æœŸæœºåˆ¶æ­£å¸¸

#### é€šè¿‡æ ‡å‡†

ç¼“å­˜æœºåˆ¶æ­£å¸¸å·¥ä½œã€‚

---

## å·¥å…·æè¿°ç”Ÿæˆæµ‹è¯•

### ç”¨ä¾‹ PE-011: Skills åˆ°å·¥å…·æè¿°çš„è½¬æ¢

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ Skills å…ƒæ•°æ®åˆ° ABP å·¥å…·æè¿°çš„è½¬æ¢ã€‚

#### æµ‹è¯•æ­¥éª¤

**æŸ¥çœ‹ç”Ÿæˆçš„å·¥å…·æè¿°**:

```bash
# å¯åŠ¨æœåŠ¡å¹¶æŸ¥çœ‹å·¥å…·æè¿°ç”Ÿæˆæ—¥å¿—
npm run dev 2>&1 | grep -i "tool description" -A 10
```

**æµ‹è¯•å·¥å…·æè¿°çš„ä½¿ç”¨**:

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "ä½ æœ‰å“ªäº›å·¥å…·å¯ä»¥ä½¿ç”¨ï¼Ÿè¯·åˆ—å‡ºæ¥"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- æ‰€æœ‰ Skills è¢«è½¬æ¢ä¸ºå·¥å…·æè¿°
- å·¥å…·æè¿°æ ¼å¼ç¬¦åˆ ABP è§„èŒƒ
- åŒ…å«å·¥å…·åç§°ã€æè¿°ã€å‚æ•°ç­‰ä¿¡æ¯

#### éªŒè¯ç‚¹

- [ ] æ‰€æœ‰ 5 ä¸ª Skills éƒ½æœ‰å·¥å…·æè¿°
- [ ] å·¥å…·æè¿°æ ¼å¼æ­£ç¡®
- [ ] åŒ…å«å¿…è¦ä¿¡æ¯ï¼ˆname, descriptionï¼‰
- [ ] AI èƒ½ç†è§£å·¥å…·æè¿°

#### é€šè¿‡æ ‡å‡†

Skills æ­£ç¡®è½¬æ¢ä¸ºå·¥å…·æè¿°ã€‚

---

### ç”¨ä¾‹ PE-012: å·¥å…·æè¿°åŠ¨æ€æ›´æ–°

**ä¼˜å…ˆçº§**: P2  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ Skills å˜åŒ–æ—¶å·¥å…·æè¿°çš„åŠ¨æ€æ›´æ–°ã€‚

#### æµ‹è¯•æ­¥éª¤

1. è®°å½•åˆå§‹å·¥å…·æ•°é‡
2. æ·»åŠ æ–°çš„ Skillï¼ˆå¦‚æœæ”¯æŒçƒ­åŠ è½½ï¼‰
3. éªŒè¯å·¥å…·æè¿°æ˜¯å¦æ›´æ–°

```bash
# æŸ¥çœ‹å½“å‰å·¥å…·æ•°é‡
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "åˆ—å‡ºæ‰€æœ‰å¯ç”¨å·¥å…·"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- æ–° Skill çš„å·¥å…·æè¿°è¢«ç”Ÿæˆ
- å·¥å…·åˆ—è¡¨åŠ¨æ€æ›´æ–°

#### éªŒè¯ç‚¹

- [ ] æ–° Skill è¢«æ£€æµ‹
- [ ] å·¥å…·æè¿°è¢«ç”Ÿæˆ
- [ ] AI èƒ½çœ‹åˆ°æ–°å·¥å…·

#### é€šè¿‡æ ‡å‡†

å·¥å…·æè¿°èƒ½å¤ŸåŠ¨æ€æ›´æ–°ï¼ˆå¦‚æœæ”¯æŒï¼‰ã€‚

---

## é”™è¯¯å¤„ç†æµ‹è¯•

### ç”¨ä¾‹ PE-013: JSON ä¿®å¤æœºåˆ¶

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: å¼‚å¸¸æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ ProtocolEngine çš„ JSON ä¿®å¤åŠŸèƒ½ã€‚

#### æµ‹è¯•æ­¥éª¤

**é€šè¿‡æ—¥å¿—è§‚å¯Ÿ JSON ä¿®å¤**:

```bash
# å¯åŠ¨æœåŠ¡å¹¶è§‚å¯Ÿ JSON ä¿®å¤æ—¥å¿—
npm run dev 2>&1 | grep -i "json repair"
```

**è§¦å‘å¯èƒ½çš„ JSON é”™è¯¯**:

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "è¯·è¾“å‡ºå·¥å…·è°ƒç”¨ï¼Œå‚æ•°å¯ä»¥ä¸å®Œæ•´"},
      {"role": "user", "content": "æ—¶é—´"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- ç•¸å½¢ JSON è¢«æ£€æµ‹
- JSON ä¿®å¤æœºåˆ¶å¯åŠ¨
- JSON è¢«ä¿®å¤æˆ–è¿”å›æ˜ç¡®é”™è¯¯

#### éªŒè¯ç‚¹

- [ ] JSON é”™è¯¯è¢«æ£€æµ‹
- [ ] ä¿®å¤æœºåˆ¶å°è¯•ä¿®å¤
- [ ] ä¿®å¤æˆåŠŸæˆ–ä¼˜é›…å¤±è´¥
- [ ] ä¸å½±å“åç»­è¯·æ±‚

#### é€šè¿‡æ ‡å‡†

JSON ä¿®å¤æœºåˆ¶æ­£å¸¸å·¥ä½œã€‚

---

### ç”¨ä¾‹ PE-014: å™ªå£°è¿‡æ»¤

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ ABP åè®®è§£æçš„å™ªå£°è¿‡æ»¤åŠŸèƒ½ã€‚

#### æµ‹è¯•æ­¥éª¤

**æ¨¡æ‹Ÿå¸¦å™ªå£°çš„å“åº”** (é€šè¿‡æ—¥å¿—è§‚å¯Ÿ):

```bash
# è§‚å¯Ÿå™ªå£°è¿‡æ»¤æ—¥å¿—
npm run dev 2>&1 | grep -i "noise"
```

#### é¢„æœŸç»“æœ

- LLM å“åº”ä¸­çš„é¢å¤–æ–‡æœ¬è¢«è¿‡æ»¤
- åªæå– ABP å·¥å…·è°ƒç”¨éƒ¨åˆ†
- å·¥å…·è°ƒç”¨æ­£ç¡®æ‰§è¡Œ

#### éªŒè¯ç‚¹

- [ ] é¢å¤–æ–‡æœ¬è¢«è¿‡æ»¤
- [ ] ABP åè®®è¢«æ­£ç¡®æå–
- [ ] å·¥å…·è°ƒç”¨æˆåŠŸ

#### é€šè¿‡æ ‡å‡†

å™ªå£°è¿‡æ»¤æœºåˆ¶æ­£å¸¸å·¥ä½œã€‚

---

### ç”¨ä¾‹ PE-015: è¾¹ç•ŒéªŒè¯

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: å¼‚å¸¸æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ ABP åè®®è¾¹ç•Œçš„éªŒè¯æœºåˆ¶ã€‚

#### æµ‹è¯•æ­¥éª¤

**æµ‹è¯•ä¸å®Œæ•´çš„ ABP åè®®**:

é€šè¿‡è§‚å¯ŸæœåŠ¡æ—¥å¿—ï¼ŒæŸ¥çœ‹è¾¹ç•ŒéªŒè¯çš„å·¥ä½œæƒ…å†µã€‚

```bash
npm run dev 2>&1 | grep -i "boundary validation"
```

#### é¢„æœŸç»“æœ

- ä¸å®Œæ•´çš„ ABP åè®®è¢«æ£€æµ‹
- è¿”å›é€‚å½“çš„é”™è¯¯æˆ–ä½¿ç”¨é™çº§æœºåˆ¶

#### éªŒè¯ç‚¹

- [ ] è¾¹ç•Œé”™è¯¯è¢«æ£€æµ‹
- [ ] éªŒè¯æœºåˆ¶æ­£å¸¸å·¥ä½œ
- [ ] ä¼˜é›…é™çº§æˆ–é”™è¯¯å¤„ç†

#### é€šè¿‡æ ‡å‡†

è¾¹ç•ŒéªŒè¯æœºåˆ¶æ­£å¸¸å·¥ä½œã€‚

---

## ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»

### æµ‹è¯•ç”¨ä¾‹ç»Ÿè®¡

| ç±»åˆ« | ç”¨ä¾‹æ•° | æè¿° |
|------|--------|------|
| ABP åè®®è§£æ | 4 | åŸºæœ¬è§£æã€å‚æ•°ã€å¤šå·¥å…·ã€é”™è¯¯æ¢å¤ |
| å˜é‡å¼•æ“ | 6 | åˆå§‹åŒ–ã€æ—¶é—´ã€ç¯å¢ƒã€å ä½ç¬¦ã€å·¥å…·æè¿°ã€ç¼“å­˜ |
| å·¥å…·æè¿°ç”Ÿæˆ | 2 | è½¬æ¢ã€åŠ¨æ€æ›´æ–° |
| é”™è¯¯å¤„ç† | 3 | JSONä¿®å¤ã€å™ªå£°è¿‡æ»¤ã€è¾¹ç•ŒéªŒè¯ |
| **æ€»è®¡** | **15** | |

### ä¼˜å…ˆçº§åˆ†å¸ƒ

| ä¼˜å…ˆçº§ | ç”¨ä¾‹æ•° | ç”¨ä¾‹ç¼–å· |
|--------|--------|----------|
| P0 | 8 | PE-001, 002, 003, 005, 006, 009, 011 |
| P1 | 6 | PE-004, 007, 008, 013, 014, 015 |
| P2 | 1 | PE-010, 012 |

### æµ‹è¯•è®°å½•æ¨¡æ¿

```markdown
## ProtocolEngine æµ‹è¯•æ‰§è¡Œè®°å½•

- **æµ‹è¯•æ—¥æœŸ**: YYYY-MM-DD
- **æµ‹è¯•äººå‘˜**: [å§“å]
- **ApexBridge ç‰ˆæœ¬**: [ç‰ˆæœ¬å·]

| ç”¨ä¾‹ç¼–å· | ç”¨ä¾‹åç§° | ç»“æœ | å¤‡æ³¨ |
|----------|----------|------|------|
| PE-001 | åŸºæœ¬ ABP è§£æ | âœ… PASS | - |
| PE-002 | å¸¦å‚æ•°è§£æ | âœ… PASS | - |
| PE-003 | å¤šå·¥å…·è°ƒç”¨ | âœ… PASS | - |
| ... | ... | ... | ... |

**æ€»é€šè¿‡ç‡**: XX%
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•æ€»è§ˆæŒ‡å—](../MANUAL_TESTING_GUIDE.md)
- [VariableEngine æµ‹è¯•ç”¨ä¾‹](./VARIABLE_ENGINE_TEST_CASES.md)
- [Skills æµ‹è¯•ç”¨ä¾‹](./SKILLS_TEST_CASES.md)
- [Chat API æµ‹è¯•ç”¨ä¾‹](./CHAT_API_TEST_CASES.md)

---

## ğŸ’¡ æµ‹è¯•æŠ€å·§

1. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**:
   ```bash
   LOG_LEVEL=debug npm run dev
   ```

2. **ç›‘æ§åè®®è§£æ**:
   ```bash
   npm run dev 2>&1 | grep -i "ABP\|protocol"
   ```

3. **æµ‹è¯•å˜é‡è§£æ**:
   - åœ¨ System Prompt ä¸­ä½¿ç”¨å˜é‡
   - è§‚å¯Ÿè§£æåçš„å€¼

4. **éªŒè¯å·¥å…·æè¿°**:
   ```bash
   npm run dev 2>&1 | grep -i "tool" | head -50
   ```

---

**æ–‡æ¡£ç»´æŠ¤**: å¦‚å‘ç°æµ‹è¯•ç”¨ä¾‹æœ‰é—®é¢˜æˆ–éœ€è¦è¡¥å……ï¼Œè¯·æäº¤ Issue æˆ– PRã€‚

*æœ€åæ›´æ–°: 2025-11-18*

