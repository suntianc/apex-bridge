# èŠå¤©æ¥å£æµ‹è¯•ç”¨ä¾‹ (Chat API Test Cases)

> **æ¨¡å—**: Chat API (`/v1/chat/completions`)  
> **ä¼˜å…ˆçº§**: P0  
> **æœ€åæ›´æ–°**: 2025-11-18

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æ–‡æ¡£åŒ…å« ApexBridge èŠå¤©æ¥å£çš„è¯¦ç»†æµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–æ‰€æœ‰æ ¸å¿ƒèŠå¤©åŠŸèƒ½ã€‚

### æµ‹è¯•èŒƒå›´

- âœ… éæµå¼èŠå¤©è¯·æ±‚
- âœ… æµå¼èŠå¤©è¯·æ±‚
- âœ… å¸¦å·¥å…·è°ƒç”¨çš„èŠå¤©
- âœ… å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†
- âœ… è¯·æ±‚å‚æ•°éªŒè¯
- âœ… é”™è¯¯å¤„ç†
- âœ… è®¤è¯æµ‹è¯•
- âœ… é€Ÿç‡é™åˆ¶æµ‹è¯•

### å‰ç½®æ¡ä»¶

- ApexBridge æœåŠ¡å·²å¯åŠ¨ï¼ˆç«¯å£ 8088ï¼‰
- è‡³å°‘é…ç½®äº†ä¸€ä¸ª LLM æä¾›å•†
- ç¯å¢ƒå˜é‡å·²æ­£ç¡®é…ç½®

---

## æµ‹è¯•ç”¨ä¾‹

### ç”¨ä¾‹ API-CHAT-001: åŸºæœ¬éæµå¼èŠå¤©

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯éæµå¼èŠå¤©è¯·æ±‚çš„åŸºæœ¬åŠŸèƒ½ã€‚

#### å‰ç½®æ¡ä»¶

- æœåŠ¡æ­£å¸¸è¿è¡Œ
- LLM API Key å·²é…ç½®

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "ä½ å¥½ï¼Œè¯·ç”¨ä¸€å¥è¯ä»‹ç»ä½ è‡ªå·±"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

**HTTP çŠ¶æ€ç **: 200

**å“åº”æ ¼å¼**:
```json
{
  "id": "chatcmpl-xxxxx",
  "object": "chat.completion",
  "created": 1700000000,
  "model": "deepseek-chat",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "æˆ‘æ˜¯ AI åŠ©æ‰‹ï¼Œå¯ä»¥å›ç­”é—®é¢˜å’Œæä¾›å¸®åŠ©ã€‚"
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 20,
    "completion_tokens": 15,
    "total_tokens": 35
  }
}
```

#### éªŒè¯ç‚¹

- [ ] HTTP çŠ¶æ€ç ä¸º 200
- [ ] å“åº”åŒ…å« `id` å­—æ®µ
- [ ] å“åº”åŒ…å« `choices` æ•°ç»„
- [ ] `choices[0].message.role` ä¸º `assistant`
- [ ] `choices[0].message.content` ä¸ä¸ºç©º
- [ ] `choices[0].finish_reason` ä¸º `stop`
- [ ] åŒ…å« `usage` ç»Ÿè®¡ä¿¡æ¯

#### é€šè¿‡æ ‡å‡†

æ‰€æœ‰éªŒè¯ç‚¹éƒ½é€šè¿‡ã€‚

---

### ç”¨ä¾‹ API-CHAT-002: æµå¼èŠå¤©

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯æµå¼èŠå¤©è¯·æ±‚çš„åŠŸèƒ½ã€‚

#### å‰ç½®æ¡ä»¶

åŒ API-CHAT-001

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -N \
  -d '{
    "messages": [
      {"role": "user", "content": "è¯·ç”¨50ä¸ªå­—ä»‹ç»åŒ—äº¬"}
    ],
    "stream": true
  }'
```

#### é¢„æœŸç»“æœ

**HTTP çŠ¶æ€ç **: 200  
**Content-Type**: text/event-stream

**å“åº”æ ¼å¼** (æµå¼æ•°æ®):
```
data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1700000000,"model":"deepseek-chat","choices":[{"index":0,"delta":{"role":"assistant","content":""},"finish_reason":null}]}

data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1700000000,"model":"deepseek-chat","choices":[{"index":0,"delta":{"content":"åŒ—äº¬"},"finish_reason":null}]}

data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1700000000,"model":"deepseek-chat","choices":[{"index":0,"delta":{"content":"æ˜¯"},"finish_reason":null}]}

...

data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1700000000,"model":"deepseek-chat","choices":[{"index":0,"delta":{},"finish_reason":"stop"}]}

data: [DONE]
```

#### éªŒè¯ç‚¹

- [ ] HTTP çŠ¶æ€ç ä¸º 200
- [ ] Content-Type ä¸º `text/event-stream`
- [ ] æ¥æ”¶åˆ°å¤šä¸ª `data:` å—
- [ ] ç¬¬ä¸€ä¸ªå—åŒ…å« `role: "assistant"`
- [ ] åç»­å—åŒ…å« `content` å¢é‡å†…å®¹
- [ ] æœ€åä¸€ä¸ªå— `finish_reason` ä¸º `stop`
- [ ] æœ€åæ¥æ”¶åˆ° `data: [DONE]`

#### é€šè¿‡æ ‡å‡†

æ‰€æœ‰éªŒè¯ç‚¹éƒ½é€šè¿‡ã€‚

---

### ç”¨ä¾‹ API-CHAT-003: å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯å¤šè½®å¯¹è¯ä¸­ä¸Šä¸‹æ–‡çš„ä¿æŒã€‚

#### å‰ç½®æ¡ä»¶

åŒ API-CHAT-001

#### æµ‹è¯•æ­¥éª¤

**ç¬¬ä¸€è½®å¯¹è¯**:
```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "æˆ‘å«å¼ ä¸‰"}
    ],
    "stream": false
  }'
```

**ç¬¬äºŒè½®å¯¹è¯** (åŒ…å«ä¸Šä¸€è½®ä¸Šä¸‹æ–‡):
```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "æˆ‘å«å¼ ä¸‰"},
      {"role": "assistant", "content": "ä½ å¥½å¼ ä¸‰ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ï¼"},
      {"role": "user", "content": "æˆ‘åˆšæ‰å‘Šè¯‰ä½ æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

ç¬¬äºŒè½®å¯¹è¯çš„å“åº”åº”è¯¥åŒ…å« "å¼ ä¸‰"ã€‚

#### éªŒè¯ç‚¹

- [ ] ç¬¬ä¸€è½®å¯¹è¯æˆåŠŸ
- [ ] ç¬¬äºŒè½®å¯¹è¯æˆåŠŸ
- [ ] ç¬¬äºŒè½®å“åº”ä¸­æåˆ°äº† "å¼ ä¸‰"
- [ ] å“åº”æ˜¾ç¤ºç†è§£äº†ä¸Šä¸‹æ–‡

#### é€šè¿‡æ ‡å‡†

æ‰€æœ‰éªŒè¯ç‚¹éƒ½é€šè¿‡ï¼Œç‰¹åˆ«æ˜¯ç¬¬äºŒè½®èƒ½æ­£ç¡®å¼•ç”¨ "å¼ ä¸‰"ã€‚

---

### ç”¨ä¾‹ API-CHAT-004: å¸¦å·¥å…·è°ƒç”¨çš„èŠå¤©ï¼ˆæ—¶é—´æŸ¥è¯¢ï¼‰

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯• + é›†æˆæµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯èŠå¤©ä¸­å·¥å…·è°ƒç”¨åŠŸèƒ½ï¼ˆæŸ¥è¯¢æ—¶é—´ï¼‰ã€‚

#### å‰ç½®æ¡ä»¶

- æœåŠ¡æ­£å¸¸è¿è¡Œ
- TimeInfo æŠ€èƒ½å·²åŠ è½½

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

å“åº”åº”åŒ…å«å½“å‰æ—¶é—´ä¿¡æ¯ã€‚

**å¯èƒ½çš„å“åº”**:
```json
{
  "id": "chatcmpl-xxxxx",
  "object": "chat.completion",
  "created": 1700000000,
  "model": "deepseek-chat",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "ç°åœ¨æ˜¯ 2025å¹´11æœˆ18æ—¥ 10:30:00"
      },
      "finish_reason": "stop"
    }
  ]
}
```

#### éªŒè¯ç‚¹

- [ ] HTTP çŠ¶æ€ç ä¸º 200
- [ ] å“åº”åŒ…å«æ—¶é—´ä¿¡æ¯
- [ ] æ—¶é—´æ ¼å¼æ­£ç¡®ï¼ˆå¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼‰
- [ ] æ—¶é—´ä¸å½“å‰å®é™…æ—¶é—´æ¥è¿‘

#### é€šè¿‡æ ‡å‡†

æ‰€æœ‰éªŒè¯ç‚¹éƒ½é€šè¿‡ï¼Œæ—¶é—´ä¿¡æ¯å‡†ç¡®ã€‚

---

### ç”¨ä¾‹ API-CHAT-005: å¸¦å·¥å…·è°ƒç”¨çš„èŠå¤©ï¼ˆç³»ç»Ÿä¿¡æ¯ï¼‰

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯• + é›†æˆæµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯èŠå¤©ä¸­å·¥å…·è°ƒç”¨åŠŸèƒ½ï¼ˆæŸ¥è¯¢ç³»ç»Ÿä¿¡æ¯ï¼‰ã€‚

#### å‰ç½®æ¡ä»¶

- æœåŠ¡æ­£å¸¸è¿è¡Œ
- SystemInfo æŠ€èƒ½å·²åŠ è½½

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "æŸ¥è¯¢ä¸€ä¸‹ç³»ç»Ÿä¿¡æ¯"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

å“åº”åº”åŒ…å«ç³»ç»Ÿä¿¡æ¯ï¼ˆæ“ä½œç³»ç»Ÿã€CPUã€å†…å­˜ç­‰ï¼‰ã€‚

#### éªŒè¯ç‚¹

- [ ] HTTP çŠ¶æ€ç ä¸º 200
- [ ] å“åº”åŒ…å«ç³»ç»Ÿç›¸å…³ä¿¡æ¯
- [ ] åŒ…å«æ“ä½œç³»ç»Ÿç±»å‹
- [ ] åŒ…å« CPU æˆ–å†…å­˜ä¿¡æ¯
- [ ] ä¿¡æ¯æ ¼å¼æ¸…æ™°å¯è¯»

#### é€šè¿‡æ ‡å‡†

æ‰€æœ‰éªŒè¯ç‚¹éƒ½é€šè¿‡ï¼Œç³»ç»Ÿä¿¡æ¯å‡†ç¡®ã€‚

---

### ç”¨ä¾‹ API-CHAT-006: System Prompt è‡ªå®šä¹‰

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯è‡ªå®šä¹‰ system prompt çš„åŠŸèƒ½ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªè¯—äººï¼Œæ€»æ˜¯ç”¨è¯—å¥å›ç­”é—®é¢˜ã€‚"},
      {"role": "user", "content": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

å“åº”åº”è¯¥ä»¥è¯—å¥çš„å½¢å¼å›ç­”ã€‚

#### éªŒè¯ç‚¹

- [ ] HTTP çŠ¶æ€ç ä¸º 200
- [ ] å“åº”é£æ ¼ç¬¦åˆ system prompt çš„è®¾å®š
- [ ] å›ç­”ä¸å¤©æ°”ç›¸å…³
- [ ] å›ç­”å…·æœ‰è¯—æ„æˆ–è¯—å¥å½¢å¼

#### é€šè¿‡æ ‡å‡†

å“åº”é£æ ¼æ˜æ˜¾å— system prompt å½±å“ã€‚

---

### ç”¨ä¾‹ API-CHAT-007: å‚æ•°éªŒè¯ - ç¼ºå°‘ messages

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: å¼‚å¸¸æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯è¯·æ±‚å‚æ•°éªŒè¯æœºåˆ¶ï¼ˆç¼ºå°‘å¿…éœ€å­—æ®µï¼‰ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

**HTTP çŠ¶æ€ç **: 400

**å“åº”æ ¼å¼**:
```json
{
  "error": {
    "message": "messages field is required",
    "type": "invalid_request_error",
    "param": "messages",
    "code": "missing_required_parameter"
  }
}
```

#### éªŒè¯ç‚¹

- [ ] HTTP çŠ¶æ€ç ä¸º 400
- [ ] å“åº”åŒ…å« error å¯¹è±¡
- [ ] error.message æŒ‡æ˜ç¼ºå°‘ messages
- [ ] error.type ä¸º `invalid_request_error`

#### é€šè¿‡æ ‡å‡†

æ­£ç¡®æ‹’ç»æ— æ•ˆè¯·æ±‚å¹¶è¿”å›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ã€‚

---

### ç”¨ä¾‹ API-CHAT-008: å‚æ•°éªŒè¯ - messages æ ¼å¼é”™è¯¯

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: å¼‚å¸¸æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ messages æ•°ç»„æ ¼å¼éªŒè¯ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": "invalid format",
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

**HTTP çŠ¶æ€ç **: 400

#### éªŒè¯ç‚¹

- [ ] HTTP çŠ¶æ€ç ä¸º 400
- [ ] å“åº”åŒ…å« error å¯¹è±¡
- [ ] error.message æŒ‡æ˜ messages æ ¼å¼é”™è¯¯

#### é€šè¿‡æ ‡å‡†

æ­£ç¡®æ‹’ç»æ ¼å¼é”™è¯¯çš„è¯·æ±‚ã€‚

---

### ç”¨ä¾‹ API-CHAT-009: å‚æ•°éªŒè¯ - ç©º messages æ•°ç»„

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: å¼‚å¸¸æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ç©º messages æ•°ç»„çš„å¤„ç†ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

**HTTP çŠ¶æ€ç **: 400

#### éªŒè¯ç‚¹

- [ ] HTTP çŠ¶æ€ç ä¸º 400
- [ ] error.message æŒ‡æ˜ messages ä¸èƒ½ä¸ºç©º

#### é€šè¿‡æ ‡å‡†

æ­£ç¡®æ‹’ç»ç©º messages æ•°ç»„ã€‚

---

### ç”¨ä¾‹ API-CHAT-010: LLM API è°ƒç”¨å¤±è´¥å¤„ç†

**ä¼˜å…ˆçº§**: P0  
**ç±»å‹**: å¼‚å¸¸æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ LLM API è°ƒç”¨å¤±è´¥æ—¶çš„é”™è¯¯å¤„ç†ã€‚

#### å‰ç½®æ¡ä»¶

- ä¸´æ—¶ä¿®æ”¹ `.env` ä¸­çš„ API Key ä¸ºæ— æ•ˆå€¼
- æˆ–ä¸´æ—¶å…³é—­ç½‘ç»œè¿æ¥

#### æµ‹è¯•æ­¥éª¤

```bash
# å…ˆè®¾ç½®æ— æ•ˆçš„ API Key
export DEEPSEEK_API_KEY="invalid-key"

# é‡å¯æœåŠ¡
npm run dev

# å‘é€èŠå¤©è¯·æ±‚
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "ä½ å¥½"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

**HTTP çŠ¶æ€ç **: 500 æˆ– 503

**å“åº”æ ¼å¼**:
```json
{
  "error": {
    "message": "LLM API call failed: Invalid API key",
    "type": "api_error",
    "code": "llm_api_error"
  }
}
```

#### éªŒè¯ç‚¹

- [ ] HTTP çŠ¶æ€ç ä¸º 5xx
- [ ] å“åº”åŒ…å« error å¯¹è±¡
- [ ] error.message åŒ…å«æœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯
- [ ] æœåŠ¡æœªå´©æºƒï¼Œå¯ä»¥ç»§ç»­å¤„ç†å…¶ä»–è¯·æ±‚

#### é€šè¿‡æ ‡å‡†

ä¼˜é›…åœ°å¤„ç† LLM API é”™è¯¯ï¼Œä¸å½±å“æœåŠ¡ç¨³å®šæ€§ã€‚

---

### ç”¨ä¾‹ API-CHAT-011: é•¿æ–‡æœ¬è¾“å…¥

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: è¾¹ç•Œæµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯å¤„ç†é•¿æ–‡æœ¬è¾“å…¥çš„èƒ½åŠ›ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
# ç”Ÿæˆé•¿æ–‡æœ¬ï¼ˆçº¦5000å­—ï¼‰
LONG_TEXT=$(python3 -c "print('è¿™æ˜¯æµ‹è¯•æ–‡æœ¬ã€‚' * 500)")

curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d "{
    \"messages\": [
      {\"role\": \"user\", \"content\": \"$LONG_TEXT è¯·æ€»ç»“ä»¥ä¸Šå†…å®¹\"}
    ],
    \"stream\": false
  }"
```

#### é¢„æœŸç»“æœ

- è¯·æ±‚è¢«æˆåŠŸå¤„ç†ï¼Œæˆ–
- è¿”å›æ˜ç¡®çš„é•¿åº¦é™åˆ¶é”™è¯¯

#### éªŒè¯ç‚¹

- [ ] è¯·æ±‚æˆåŠŸå¤„ç†æˆ–è¿”å›åˆç†çš„é”™è¯¯
- [ ] å¦‚æœæˆåŠŸï¼Œå“åº”æ—¶é—´åœ¨å¯æ¥å—èŒƒå›´å†…
- [ ] æœåŠ¡æœªå´©æºƒ

#### é€šè¿‡æ ‡å‡†

èƒ½å¤Ÿå¤„ç†é•¿æ–‡æœ¬æˆ–æä¾›æ˜ç¡®çš„é™åˆ¶è¯´æ˜ã€‚

---

### ç”¨ä¾‹ API-CHAT-012: å¹¶å‘è¯·æ±‚

**ä¼˜å…ˆçº§**: P2  
**ç±»å‹**: æ€§èƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯å¤„ç†å¹¶å‘èŠå¤©è¯·æ±‚çš„èƒ½åŠ›ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
# ä½¿ç”¨ GNU parallel æˆ–ç¼–å†™ç®€å•è„šæœ¬
for i in {1..10}; do
  curl -X POST http://localhost:8088/v1/chat/completions \
    -H "Content-Type: application/json" \
    -d '{
      "messages": [
        {"role": "user", "content": "ä½ å¥½ï¼Œè¿™æ˜¯ç¬¬'"$i"'ä¸ªè¯·æ±‚"}
      ],
      "stream": false
    }' &
done
wait
```

#### é¢„æœŸç»“æœ

- æ‰€æœ‰è¯·æ±‚éƒ½èƒ½æˆåŠŸå¤„ç†
- å“åº”æ—¶é—´åœ¨å¯æ¥å—èŒƒå›´å†…

#### éªŒè¯ç‚¹

- [ ] æ‰€æœ‰ 10 ä¸ªè¯·æ±‚éƒ½è¿”å› 200
- [ ] å¹³å‡å“åº”æ—¶é—´ < 5ç§’
- [ ] æ— è¯·æ±‚å¤±è´¥
- [ ] æœåŠ¡ç¨³å®š

#### é€šè¿‡æ ‡å‡†

èƒ½å¤Ÿç¨³å®šå¤„ç† 10 ä¸ªå¹¶å‘è¯·æ±‚ã€‚

---

### ç”¨ä¾‹ API-CHAT-013: é€Ÿç‡é™åˆ¶è§¦å‘

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: å®‰å…¨æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯é€Ÿç‡é™åˆ¶æœºåˆ¶ã€‚

#### å‰ç½®æ¡ä»¶

- `.env` ä¸­é…ç½®äº†é€Ÿç‡é™åˆ¶ï¼š
  ```env
  RATE_LIMIT_ENABLED=true
  RATE_LIMIT_WINDOW_MS=60000
  RATE_LIMIT_MAX_REQUESTS=10
  ```

#### æµ‹è¯•æ­¥éª¤

```bash
# å¿«é€Ÿå‘é€ 15 ä¸ªè¯·æ±‚
for i in {1..15}; do
  curl -X POST http://localhost:8088/v1/chat/completions \
    -H "Content-Type: application/json" \
    -d '{
      "messages": [
        {"role": "user", "content": "æµ‹è¯•'$i'"}
      ],
      "stream": false
    }'
  sleep 0.1
done
```

#### é¢„æœŸç»“æœ

- å‰ 10 ä¸ªè¯·æ±‚æˆåŠŸï¼ˆ200ï¼‰
- åç»­è¯·æ±‚è¢«é™æµï¼ˆ429ï¼‰

#### éªŒè¯ç‚¹

- [ ] å‰ 10 ä¸ªè¯·æ±‚è¿”å› 200
- [ ] ç¬¬ 11+ ä¸ªè¯·æ±‚è¿”å› 429
- [ ] 429 å“åº”åŒ…å« Retry-After å¤´

#### é€šè¿‡æ ‡å‡†

é€Ÿç‡é™åˆ¶æ­£ç¡®å·¥ä½œã€‚

---

### ç”¨ä¾‹ API-CHAT-014: æµå¼å“åº”ä¸­æ–­

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯æµå¼å“åº”çš„ä¸­æ–­æœºåˆ¶ã€‚

#### æµ‹è¯•æ­¥éª¤

1. å¼€å§‹ä¸€ä¸ªæµå¼èŠå¤©è¯·æ±‚
2. åœ¨å“åº”è¿‡ç¨‹ä¸­ä¸­æ–­è¿æ¥ï¼ˆCtrl+Cï¼‰
3. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# å¼€å§‹æµå¼è¯·æ±‚
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -N \
  -d '{
    "messages": [
      {"role": "user", "content": "è¯·å†™ä¸€ç¯‡1000å­—çš„æ–‡ç« "}
    ],
    "stream": true
  }'
# ç­‰å¾… 2 ç§’åæŒ‰ Ctrl+C
```

#### é¢„æœŸç»“æœ

- è¿æ¥è¢«æ­£ç¡®å…³é—­
- æœåŠ¡æœªå´©æºƒ
- èµ„æºè¢«æ­£ç¡®é‡Šæ”¾

#### éªŒè¯ç‚¹

- [ ] è¿æ¥å¯ä»¥æ­£å¸¸ä¸­æ–­
- [ ] æœåŠ¡æ—¥å¿—æ— é”™è¯¯
- [ ] æœåŠ¡ä»å¯å¤„ç†æ–°è¯·æ±‚
- [ ] æ— å†…å­˜æ³„æ¼

#### é€šè¿‡æ ‡å‡†

ä¼˜é›…åœ°å¤„ç†ä¸­æ–­ï¼ŒæœåŠ¡ä¿æŒç¨³å®šã€‚

---

### ç”¨ä¾‹ API-CHAT-015: ç‰¹æ®Šå­—ç¬¦å¤„ç†

**ä¼˜å…ˆçº§**: P1  
**ç±»å‹**: è¾¹ç•Œæµ‹è¯•

#### æµ‹è¯•ç›®æ ‡

éªŒè¯ç‰¹æ®Šå­—ç¬¦çš„æ­£ç¡®å¤„ç†ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
curl -X POST http://localhost:8088/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "æµ‹è¯•ç‰¹æ®Šå­—ç¬¦ï¼š<>&\"'\''\\n\\tğŸ˜€ğŸ‰"}
    ],
    "stream": false
  }'
```

#### é¢„æœŸç»“æœ

- è¯·æ±‚è¢«æ­£ç¡®å¤„ç†
- å“åº”æ­£å¸¸

#### éªŒè¯ç‚¹

- [ ] HTTP çŠ¶æ€ç ä¸º 200
- [ ] ç‰¹æ®Šå­—ç¬¦è¢«æ­£ç¡®å¤„ç†
- [ ] æ—  JSON è§£æé”™è¯¯
- [ ] æ—  SQL æ³¨å…¥æˆ– XSS é£é™©

#### é€šè¿‡æ ‡å‡†

æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦éƒ½è¢«å®‰å…¨å¤„ç†ã€‚

---

## ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»

### æµ‹è¯•ç”¨ä¾‹ç»Ÿè®¡

| ç±»åˆ« | ç”¨ä¾‹æ•° | æè¿° |
|------|--------|------|
| åŠŸèƒ½æµ‹è¯• | 6 | æ ¸å¿ƒèŠå¤©åŠŸèƒ½ |
| é›†æˆæµ‹è¯• | 2 | ä¸ Skills é›†æˆ |
| å¼‚å¸¸æµ‹è¯• | 5 | é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ |
| æ€§èƒ½æµ‹è¯• | 1 | å¹¶å‘è¯·æ±‚ |
| å®‰å…¨æµ‹è¯• | 1 | é€Ÿç‡é™åˆ¶ |
| **æ€»è®¡** | **15** | |

### ä¼˜å…ˆçº§åˆ†å¸ƒ

| ä¼˜å…ˆçº§ | ç”¨ä¾‹æ•° | ç”¨ä¾‹ç¼–å· |
|--------|--------|----------|
| P0 | 6 | 001, 002, 003, 004, 005, 010 |
| P1 | 8 | 006, 007, 008, 009, 011, 013, 014, 015 |
| P2 | 1 | 012 |

### æµ‹è¯•è®°å½•æ¨¡æ¿

```markdown
## æµ‹è¯•æ‰§è¡Œè®°å½•

- **æµ‹è¯•æ—¥æœŸ**: YYYY-MM-DD
- **æµ‹è¯•äººå‘˜**: [å§“å]
- **ApexBridge ç‰ˆæœ¬**: [ç‰ˆæœ¬å·]
- **LLM æä¾›å•†**: [OpenAI/DeepSeek/...]

| ç”¨ä¾‹ç¼–å· | ç”¨ä¾‹åç§° | ç»“æœ | å¤‡æ³¨ |
|----------|----------|------|------|
| API-CHAT-001 | åŸºæœ¬éæµå¼èŠå¤© | âœ… PASS | - |
| API-CHAT-002 | æµå¼èŠå¤© | âœ… PASS | - |
| API-CHAT-003 | å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ | âœ… PASS | - |
| ... | ... | ... | ... |

**æ€»é€šè¿‡ç‡**: XX%
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•æ€»è§ˆæŒ‡å—](../MANUAL_TESTING_GUIDE.md)
- [Skills æµ‹è¯•ç”¨ä¾‹](./SKILLS_TEST_CASES.md)
- [WebSocket æµ‹è¯•ç”¨ä¾‹](./WEBSOCKET_TEST_CASES.md)
- [ç«¯åˆ°ç«¯å¯¹è¯åœºæ™¯](../scenarios/E2E_CHAT_SCENARIOS.md)

---

**æ–‡æ¡£ç»´æŠ¤**: å¦‚å‘ç°æµ‹è¯•ç”¨ä¾‹æœ‰é—®é¢˜æˆ–éœ€è¦è¡¥å……ï¼Œè¯·æäº¤ Issue æˆ– PRã€‚

