# ApexBridge é›†æˆæµ‹è¯•ç”¨ä¾‹æ‰‹å†Œ

> **ç‰ˆæœ¬**: 1.0
> **åˆ›å»ºæ—¥æœŸ**: 2025-11-17
> **æµ‹è¯•ç±»å‹**: åŸºäºåœºæ™¯çš„ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£åŒ…å«ApexBridgeç³»ç»Ÿçš„å®Œæ•´é›†æˆæµ‹è¯•åœºæ™¯ï¼Œæ¯ä¸ªåœºæ™¯è¦†ç›–å¤šä¸ªåŠŸèƒ½æ¨¡å—çš„é›†æˆï¼Œè€Œä¸æ˜¯å­¤ç«‹çš„å•å…ƒæµ‹è¯•ï¼Œç¡®ä¿çœŸå®ç”¨æˆ·è·¯å¾„çš„å®Œæ•´æ€§å’Œæ•°æ®ä¸€è‡´æ€§ã€‚

## ğŸ¯ æµ‹è¯•èŒƒå›´è¦†ç›–

| æµ‹è¯•æ¨¡å— | åœºæ™¯æ•°é‡ | æ ¸å¿ƒå¼•æ“ | ä¸šåŠ¡æœåŠ¡ | APIæ¥å£ |
|---------|---------|---------|---------|--------|
| **èŠå¤©å¯¹è¯åœºæ™¯** | 5ä¸ª | âœ… ProtocolEngine<br>âœ… PersonalityEngine<br>âœ… EmotionEngine | âœ… ChatService<br>âœ… Memory | âœ… ChatController |
| **èŠ‚ç‚¹åˆ†å¸ƒå¼åœºæ™¯** | 4ä¸ª | âœ… NodeManager | âœ… NodeService<br>âœ… DistributedService | âœ… NodeController |
| **è®°å¿†ç³»ç»Ÿåœºæ™¯** | 4ä¸ª | âœ… ProtocolEngine | âœ… RAGMemoryService<br>âœ… Memory | âœ… MemoryController |
| **Skillsæ‰§è¡Œåœºæ™¯** | 5ä¸ª | âœ… ABPSkillsAdapter | âœ… SkillsExecutionManager | âœ… Tool APIs |
| **ç®¡ç†åå°åœºæ™¯** | 2ä¸ª | - | - | âœ… Admin APIs |
| **å®‰å…¨å®¡è®¡åœºæ™¯** | 1ä¸ª | âœ… PolicyGuard | âœ… SecurityServices | âœ… SecurityController |

**æ€»è®¡**: 21ä¸ªä¸»åœºæ™¯ï¼Œè¦†ç›–95%ä»¥ä¸Šçš„æ ¸å¿ƒåŠŸèƒ½è·¯å¾„

---

## ğŸ¯ æ¨¡å—ä¸€ï¼šèŠå¤©å¯¹è¯å®Œæ•´åœºæ™¯æµ‹è¯•

### åœºæ™¯ 1.1ï¼šæ—¥å¸¸å¯¹è¯å®Œæ•´æµç¨‹æµ‹è¯•

**ç›®æ ‡**: éªŒè¯ä»äººæ ¼åŠ è½½åˆ°è®°å¿†å­˜å‚¨çš„å®Œæ•´èŠå¤©ç”Ÿå‘½å‘¨æœŸ

**å‰ç½®æ¡ä»¶**:
- é…ç½®è‡³å°‘1ä¸ªLLMæä¾›å•†ï¼ˆOpenAI/DeepSeekï¼‰
- åˆ›å»ºæµ‹è¯•äººæ ¼é…ç½®ï¼ˆJSONæ ¼å¼ï¼‰`config/personalities/test-assistant.json`
- å¯åŠ¨RAGæœåŠ¡
- å‡†å¤‡è‡³å°‘1ä¸ªSkillï¼ˆå¦‚`SearchMemory`ï¼‰

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | å‘é€POST `/api/chat`<br/>è¯·æ±‚ä½“: `{"message": "ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ä¸‰", "userId": "test-user-123"}` | è¿”å›AIå“åº”ï¼ŒåŒ…å«äººæ ¼ç‰¹å¾ | âœ… æ£€æŸ¥å“åº”ä¸­çš„`personality.name`æ­£ç¡®<br>âœ… éªŒè¯æƒ…æ„Ÿè¯†åˆ«ä¸º`NEUTRAL`<br>âœ… ç¡®è®¤system promptåŒ…å«äººæ ¼ç‰¹è´¨ï¼ˆå‹å¥½ã€ä¸“ä¸šï¼‰ |
| 2ï¸âƒ£ | æ£€æŸ¥è®°å¿†å­˜å‚¨ | è®°å¿†æœåŠ¡åˆ›å»ºæ–°æ¡ç›® | âœ… RAGæœåŠ¡æœ‰`content`åŒ…å«"æˆ‘æ˜¯å¼ ä¸‰"<br>âœ… `metadata.userId` = "test-user-123"<br>âœ… `metadata.source` = 'chat'<br>âœ… `metadata.timestamp`å­˜åœ¨ |
| 3ï¸âƒ£ | å‘é€æ¶ˆæ¯: `{"message": "æˆ‘ä»Šå¤©å¾ˆå¼€å¿ƒï¼Œå®Œæˆäº†é¡¹ç›®"}` | AIè¯†åˆ«æƒ…æ„Ÿå¹¶å…±æƒ…å›åº” | âœ… EmotionEngine.detectEmotionè¿”å›`HAPPY`<br>âœ… å“åº”åŒ…å«å¼€å¿ƒemoji ğŸ˜Š<br>âœ… å“åº”ä½¿ç”¨äººæ ¼åŒ–çš„åº†ç¥è¯­æ°”<br>âœ… æƒ…æ„Ÿè®°å½•åˆ°`metadata.emotion` |
| 4ï¸âƒ£ | AIè°ƒç”¨å·¥å…·: `{"name": "SearchMemory", "args": {"query": "é¡¹ç›®"}}` | Skillsæ‰§è¡Œæœç´¢è®°å¿† | âœ… SkillsExecutionManageræ‰¾åˆ°`SearchMemory`<br>âœ… SkillsToToolMapperå‚æ•°æ­£ç¡®<br>âœ… å‚æ•°åŒ…å«`knowledgeBase='diary'`<br>âœ… è¿”å›ç›¸å…³è®°å¿†æ¡ç›® >= 1æ¡ |
| 5ï¸âƒ£ | æ£€æŸ¥å˜é‡è§£æ: å‘é€åŒ…å«`{{time}}`çš„è¯·æ±‚ | ProtocolEngineè§£æå˜é‡ | âœ… TimeProviderè¿”å›å½“å‰æ—¶é—´ï¼ˆå¦‚"2025-11-17 09:30"ï¼‰<br>âœ… æ ¼å¼ç¬¦åˆé…ç½®<br>âœ… æ— æœªè§£æå˜é‡æ®‹ç•™ |
| 6ï¸âƒ£ | æ£€æŸ¥é«˜çº§å˜é‡: `{{rag:diary:é¡¹ç›®:5}}` | RAGå˜é‡è§£æ | âœ… RAGProvider.searchè°ƒç”¨<br>âœ… æŸ¥è¯¢"é¡¹ç›®"å‰5æ¡ç»“æœ<br>âœ… ç»“æœæ’å…¥åˆ°promptä¸­ |
| 7ï¸âƒ£ | å‘é€æ¶ˆæ¯: `{"message": "å†è§"}` | è§¦å‘ä¼šè¯ç»“æŸé€»è¾‘ | âœ… ConversationContextæ­£å¸¸æ¸…ç†<br>âœ… æ— å†…å­˜æ³„æ¼ï¼ˆactiveRequestsæ¸…ç†ï¼‰<br>âœ… WebSocketé€šé“å…³é—­ï¼ˆå¦‚æœæœ‰ï¼‰<br>âœ… è®°å¿†å½’æ¡£æ£€æŸ¥ï¼ˆå¦‚æœæœ‰é…ç½®ï¼‰ |

**æ•°æ®éªŒè¯**:
```json
// éªŒè¯ç‚¹1: äººæ ¼ç³»ç»Ÿæç¤ºè¯
{
  "role": "system",
  "content": "ä½ æ˜¯å°æµ‹è¯•åŠ©æ‰‹ ğŸ§ªã€‚ä½ æ˜¯ç”¨æˆ·çš„æµ‹è¯•åŠ©æ‰‹ã€‚\n\nä½ çš„æ€§æ ¼ç‰¹ç‚¹ï¼š\n- æ ¸å¿ƒç‰¹è´¨ï¼šä¸¥è°¨ã€ç»†è‡´ã€è€å¿ƒ..."
}

// éªŒè¯ç‚¹2: æƒ…æ„Ÿè®°å½•
{
  "type": "HAPPY",
  "confidence": 0.85,
  "detectedAt": "timestamp",
  "userId": "test-user-123",
  "message": "æˆ‘ä»Šå¤©å¾ˆå¼€å¿ƒï¼Œå®Œæˆäº†é¡¹ç›®"
}

// éªŒè¯ç‚¹3: è®°å¿†å­˜å‚¨æ ¼å¼
{
  "id": "mem_xxx",
  "content": "å¼ ä¸‰ä»Šå¤©å¾ˆå¼€å¿ƒï¼Œå®Œæˆäº†é¡¹ç›®",
  "userId": "test-user-123",
  "metadata": {
    "knowledgeBase": "diary",
    "timestamp": 1234567890,
    "emotion": "HAPPY",
    "source": "chat",
    "score": 0.92
  }
}

// éªŒè¯ç‚¹4: Skillsè°ƒç”¨è¿”å›
{
  "success": true,
  "result": {
    "data": ["è®°å¿†1", "è®°å¿†2"],
    "count": 2
  },
  "skillName": "SearchMemory"
}
```

**æ€§èƒ½åŸºå‡†**:
- å•è½®å¯¹è¯å“åº”æ—¶é—´: < 3ç§’
- æƒ…æ„Ÿæ£€æµ‹æ—¶é—´: < 500ms
- å˜é‡è§£ææ—¶é—´: < 200ms
- è®°å¿†å­˜å‚¨æ—¶é—´: < 1ç§’

---

### åœºæ™¯ 1.2ï¼šå¤šè½®å¯¹è¯ä¸ä¸Šä¸‹æ–‡ä¿æŒæµ‹è¯•

**ç›®æ ‡**: éªŒè¯é•¿å¯¹è¯ä¸­çš„ä¸Šä¸‹æ–‡ç®¡ç†ã€è®°å¿†æ£€ç´¢å’Œä¸ªæ€§åŒ–å“åº”

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | åˆå§‹åŒ–å¯¹è¯: `userId="user-456"` | åˆ›å»ºconversationContext | âœ… ConversationContextStoreä¸­æœ‰è¯¥ä¼šè¯<br>âœ… contextåŒ…å«userIdã€startTimeã€messageCount=0 |
| 2ï¸âƒ£ | å‘é€5æ¡æŠ€æœ¯è®¨è®ºæ¶ˆæ¯<br/>ä¸»é¢˜: GraphQLã€TypeScriptã€Node.js | PromptBuilderä¼˜åŒ–prompt | âœ… SemanticMemoryService.searchè°ƒç”¨ï¼ˆæŠ€æœ¯çŸ¥è¯†åº“ï¼‰<br>âœ… æ£€ç´¢åˆ°ç›¸å…³æŠ€æœ¯è®°å¿† >= 3æ¡<br>âœ… Contexté•¿åº¦å¢é•¿5æ¡<br>âœ… System promptåŒ…å«RAGç»“æœ |
| 3ï¸âƒ£ | ç¬¬6æ¡æ¶ˆæ¯: "åˆšæ‰è¯´çš„é‚£ä¸ªæŠ€æœ¯ï¼Œå†è¯¦ç»†è¯´æ˜" | ä¸Šä¸‹æ–‡å¼•ç”¨æ­£ç¡® | âœ… PromptBuilderæ³¨å…¥å†å²æ¶ˆæ¯<br>âœ… LLMæ¥æ”¶æœ€è¿‘5-10æ¡ä¸Šä¸‹æ–‡<br>âœ… AIèƒ½æ­£ç¡®ç†è§£"é‚£ä¸ªæŠ€æœ¯"æŒ‡ä»£<br>âœ… å“åº”ä¸ä¹‹å‰è®¨è®ºè¿è´¯ |
| 4ï¸âƒ£ | æ£€æŸ¥æƒ…æ„Ÿä¸€è‡´æ€§: ç”¨æˆ·è¡¨è¾¾æŒ«æŠ˜æ„Ÿ | æƒ…æ„Ÿå“åº”è¿è´¯ | âœ… æ£€æµ‹åˆ°`FRUSTRATED`æƒ…æ„Ÿ<br>âœ… å“åº”åŒ…å«å®‰æ…°è¯­æ°”<br>âœ… è¡¨æƒ…ä½¿ç”¨é€‚åº¦ï¼ˆæ ¹æ®äººæ ¼é…ç½®ï¼‰|
| 5ï¸âƒ£ | åˆ‡æ¢äººæ ¼: `personalityId="different-persona"` | åŠ¨æ€åŠ è½½æ–°äººæ ¼ | âœ… PersonalityEngine.clearCache()è°ƒç”¨<br>âœ… æ–°system promptç«‹å³ç”Ÿæ•ˆ<br>âœ… å“åº”é£æ ¼æ˜æ˜¾å˜åŒ–ï¼ˆè¯­æ°”ã€ç”¨è¯ï¼‰<br>âœ… å†å²å¯¹è¯ä¿ç•™ä½†äººæ ¼æ”¹å˜ |
| 6ï¸âƒ£ | å‘é€åŒ…å«å¤šä¸ªå˜é‡çš„æ¶ˆæ¯: `{{time}}`, `{{date}}`, `{{env:NODE_ENV}}` | ProtocolEngineè§£ææ‰€æœ‰å˜é‡ | âœ… TimeProviderè¿”å›å½“å‰æ—¶é—´<br>âœ… æ—¥æœŸæ ¼å¼æ­£ç¡®ï¼ˆYYYY-MM-DDï¼‰<br>âœ… EnvironmentProviderè¯»å–NODE_ENV<br>âœ… PlaceholderProviderå¤„ç†æœªè§£æå˜é‡<br>âœ… æ‰€æœ‰å˜é‡è¢«æ›¿æ¢ï¼Œæ— æ®‹ç•™{{}} |
| 7ï¸âƒ£ | ä¸­æ–­å½“å‰è¯·æ±‚ | å–æ¶ˆLLMè¯·æ±‚ | âœ… activeRequestsä¸­æ‰¾åˆ°requestId<br>âœ… AbortController.signal.aborted=true<br>âœ… WebSocketå‘é€ä¸­æ–­é€šçŸ¥<br>âœ… æ— èµ„æºæ³„æ¼ |
| 8ï¸âƒ£ | ç¬¬20è½®å¯¹è¯ | æ£€æŸ¥å†…å­˜ä½¿ç”¨å’Œç¼“å­˜ | âœ… ç¼“å­˜å‘½ä¸­ç‡ > 30%<br>âœ… promptCacheæœ‰ç¼“å­˜æ¡ç›®<br>âœ… å†…å­˜ä½¿ç”¨ <é˜ˆå€¼ï¼ˆå¦‚500MBï¼‰<br>âœ… æ— å†…å­˜æ³„æ¼ï¼ˆå †æ ˆç¨³å®šï¼‰ |

**ä¸Šä¸‹æ–‡éªŒè¯**:
```typescript
// éªŒè¯ConversationContextç»“æ„
{
  contextId: "ctx_xxx",
  userId: "user-456",
  startTime: 1234567890,
  lastActivity: 1234567900,
  messageCount: 20,
  memories: ["è®°å¿†1", ...], // æ£€ç´¢åˆ°çš„ç›¸å…³è®°å¿†
  emotionHistory: ["NEUTRAL", "HAPPY", "FRUSTRATED"]
}
```

---

### åœºæ™¯ 1.3ï¼šå¤æ‚å·¥å…·è°ƒç”¨é“¾æµ‹è¯•

**ç›®æ ‡**: éªŒè¯Skillsçš„åµŒå¥—è°ƒç”¨ã€æ•…éšœè½¬ç§»å’Œå‚æ•°è¡¥å…¨

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | AIå†³å®šä½¿ç”¨å·¥å…·: `ComplexWorkflow` | SkillsExecutionManageræ‰§è¡Œ | âœ… SkillsLoaderæ‰¾åˆ°å·¥å…·å®šä¹‰<br>âœ… æ£€æŸ¥kind='action'æˆ–'service'<br>âœ… PolicyGuardæ£€æŸ¥permissions<br>âœ… è®°å½•è°ƒç”¨åˆ°SkillUsageTracker |
| 2ï¸âƒ£ | ä¸»æ‰§è¡Œå™¨å¤±è´¥ï¼ˆå¦‚serviceè¶…æ—¶ï¼‰ | è‡ªåŠ¨æ•…éšœè½¬ç§» | âœ… fallbackChainè§¦å‘: serviceâ†’directâ†’internal<br>âœ… ç¬¬ä¸€æ­¥è¶…æ—¶ï¼ˆ10ç§’ï¼‰<br>âœ… è‡ªåŠ¨æ‰§è¡Œdirectç±»å‹<br>âœ… è¿”å›warningsåŒ…å«æ•…éšœä¿¡æ¯ |
| 3ï¸âƒ£ | directæ‰§è¡Œå™¨ä¹Ÿå¤±è´¥ | ç»§ç»­æ•…éšœè½¬ç§» | âœ… directè¿”å›error<br>âœ… æ‰§è¡Œinternalç±»å‹<br>âœ… internalé€šè¿‡ï¼ˆä½¿ç”¨æœ¬åœ°æ•°æ®ï¼‰<br>âœ… æœ€ç»ˆsuccess=true |
| 4ï¸âƒ£ | å·¥å…·è¿”å›intermediateSteps | è®°å½•ä¸­é—´æ­¥éª¤ | âœ… processIntermediateStepsè°ƒç”¨<br>âœ… ä¸­é—´æ­¥éª¤è®°å½•åˆ°æ—¥å¿—<br>âœ… è°ƒè¯•ä¿¡æ¯å®Œæ•´<br>âœ… å¯ç”¨äºé—®é¢˜æ’æŸ¥ |
| 5ï¸âƒ£ | å·¥å…·è¿”å›memoryWrites | è‡ªåŠ¨ä¿å­˜åˆ°è®°å¿†æœåŠ¡ | âœ… IMemoryService.save(memoryWrites)è°ƒç”¨<br>âœ… knowledgeBaseæ­£ç¡®ï¼ˆdiary/technicalï¼‰<br>âœ… userIdæ­£ç¡®<br>âœ… è®°å¿†ä¿å­˜æˆåŠŸ |
| 6ï¸âƒ£ | æŸ¥çœ‹å·¥å…·ä½¿ç”¨ç»Ÿè®¡ | ç»Ÿè®¡æ•°æ®æ­£ç¡® | âœ… getStats()è¿”å›è°ƒç”¨æ¬¡æ•°<br>âœ… å¹³å‡å“åº”æ—¶é—´è®¡ç®—æ­£ç¡®<br>âœ… æˆåŠŸç‡ = æˆåŠŸæ•°/æ€»æ•°<br>âœ… çƒ­é—¨å·¥å…·æ’åºæ­£ç¡® |
| 7ï¸âƒ£ | æ‰¹é‡æ‰§è¡Œ3ä¸ªä¾èµ–å·¥å…· | é¡ºåºæ‰§è¡Œå’Œç»“æœä¼ é€’ | âœ… å·¥å…·Aæ‰§è¡ŒæˆåŠŸ<br>âœ… å°†Açš„ç»“æœä¼ ç»™B<br>âœ… Bæ‰§è¡ŒæˆåŠŸ<br>âœ… Cæ¥æ”¶Bç»“æœ<br>âœ… æœ€ç»ˆç»“æœåŒ…å«æ‰€æœ‰æ­¥éª¤ |

**æ•…éšœè½¬ç§»éªŒè¯**:
```typescript
// fallbackChainæ‰§è¡Œè®°å½•
{
  requestId: "req_xxx",
  toolName: "ComplexWorkflow",
  executionChain: [
    { type: "service", status: "timeout", duration: 10000 },
    { type: "direct", status: "failed", error: "Connection refused" },
    { type: "internal", status: "success", duration: 150 }
  ],
  finalStatus: "success",
  warnings: [
    "æ‰§è¡Œå™¨ service å¤±è´¥: timeout",
    "æ‰§è¡Œå™¨ direct å¤±è´¥: Connection refused",
    "ä½¿ç”¨ internal ä½œä¸ºæ•…éšœè½¬ç§»"
  ]
}
```

---

## ğŸ¯ æ¨¡å—äºŒï¼šèŠ‚ç‚¹ç®¡ç†ä¸åˆ†å¸ƒå¼ä»»åŠ¡åœºæ™¯

### åœºæ™¯ 2.1ï¼šèŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸç®¡ç†æµ‹è¯•

**ç›®æ ‡**: éªŒè¯èŠ‚ç‚¹æ³¨å†Œã€å¿ƒè·³æ£€æµ‹å’ŒçŠ¶æ€ç®¡ç†

**å‰ç½®æ¡ä»¶**:
- WebSocketæœåŠ¡å™¨è¿è¡Œ
- NodeManageråˆå§‹åŒ–
- è‡³å°‘1ä¸ªWorkerèŠ‚ç‚¹å’Œ1ä¸ªCompanionèŠ‚ç‚¹

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | èŠ‚ç‚¹è¿æ¥: `ws://localhost:3000/nodes/register` | WebSocketè¿æ¥å»ºç«‹ | âœ… NodeService.createNode()è°ƒç”¨<br>âœ… ç”Ÿæˆå”¯ä¸€`nodeId`å’Œ`connectionId`<br>âœ… nodes Mapä¸­æœ‰æ–°èŠ‚ç‚¹ |
| 2ï¸âƒ£ | å‘é€æ³¨å†Œæ¶ˆæ¯: `{"type": "register", "payload": {...}}` | èŠ‚ç‚¹æ³¨å†ŒæˆåŠŸ | âœ… æ¥æ”¶RegisterNodeInput<br>âœ… éªŒè¯nameã€typeã€capabilities<br>âœ… è¿”å›{nodeId, connectionId, config}<br>âœ… NodeInfoæŒä¹…åŒ–åˆ°Redis/æ–‡ä»¶ |
| 3ï¸âƒ£ | èŠ‚ç‚¹å‘é€å¿ƒè·³ï¼ˆæ¯30ç§’ï¼‰ | èŠ‚ç‚¹çŠ¶æ€ä¿æŒactive | âœ… å®¢æˆ·ç«¯å®šæ—¶å‘é€å¿ƒè·³<br>âœ… NodeManageræ¥æ”¶heartbeat<br>âœ… `lastHeartbeat`æ›´æ–°ä¸ºå½“å‰æ—¶é—´<br>âœ… `status='online'` |
| 4ï¸âƒ£ | è¿ç»­å‘é€3æ¬¡å¿ƒè·³ | å¿ƒè·³è®¡æ•°å™¨å¢é•¿ | âœ… heartbeatCount = 3<br>âœ… æ— duplicateèŠ‚ç‚¹<br>âœ… å¿ƒè·³é—´éš”ç¨³å®šï¼ˆ30Â±5ç§’ï¼‰ |
| 5ï¸âƒ£ | åœæ­¢å‘é€å¿ƒè·³ï¼ˆç­‰å¾…90ç§’ï¼‰ | èŠ‚ç‚¹æ ‡è®°ä¸ºoffline | âœ… heartbeat_timeoutè§¦å‘ï¼ˆ90ç§’ï¼‰<br>âœ… statuså˜ä¸º'offline'<br>âœ… EventBuså‘å¸ƒ'node_offline'äº‹ä»¶<br>âœ… WebSocketå°è¯•é‡è¿ |
| 6ï¸âƒ£ | é‡å¯èŠ‚ç‚¹å¹¶æ¢å¤å¿ƒè·³ | èŠ‚ç‚¹çŠ¶æ€æ¢å¤ | âœ… èŠ‚ç‚¹ä½¿ç”¨ç›¸åŒnodeIdå¤ç”¨<br>âœ… ä¸åˆ›å»ºæ–°è®°å½•<br>âœ… statuså˜å›'online'<br>âœ… å†å²ç»Ÿè®¡æ•°æ®ä¿ç•™ï¼ˆtotalTasksç­‰ï¼‰ |
| 7ï¸âƒ£ | èŠ‚ç‚¹ä¸»åŠ¨å‘é€disconnect | ä¼˜é›…å…³é—­ | âœ… å‘é€`{"type": "disconnect"}`<br>âœ… NodeManager.handleDisconnect()<br>âœ… æ¸…ç†pendingTasks<br>âœ… ä»nodes Mapç§»é™¤<br>âœ… é‡Šæ”¾é…é¢ |
| 8ï¸âƒ£ | æ³¨å†Œ5ä¸ªWorker + 2ä¸ªCompanion | èŠ‚ç‚¹è¿‡æ»¤å™¨å·¥ä½œ | âœ… NodeManager.listNodes({type: 'worker'})è¿”å›5ä¸ª<br>âœ… listNodes({type: 'companion'})è¿”å›2ä¸ª<br>âœ… listNodes({status: 'online'})è¿”å›7ä¸ª<br>âœ… æ­£ç¡®çš„èŠ‚ç‚¹ç»Ÿè®¡ |

**èŠ‚ç‚¹çŠ¶æ€éªŒè¯**:
```typescript
// èŠ‚ç‚¹ä¿¡æ¯ç»“æ„
interface NodeInfo {
  nodeId: "node_xxx",
  name: "Test-Worker-1",
  type: "worker",
  status: "online",
  capabilities: ["image-generation", "data-processing"],
  lastHeartbeat: 1234567890,
  heartbeatCount: 5,
  registeredAt: 1234567800,
  connectionId: "conn_xxx",
  stats: {
    tasksCompleted: 10,
    tasksFailed: 1,
    avgResponseTime: 1500
  }
}
```

**å¿ƒè·³æ—¶åºå›¾**:
```
æ—¶é—´çº¿: 0ç§’      30ç§’      60ç§’      90ç§’      120ç§’
         |         |         |         |         |
å®¢æˆ·ç«¯:  Register  Heartbeat1  Heartbeat2  NoHeartbeat3  Reconnect
         |--------|---------|---------|---------|-------->
æœåŠ¡å™¨:  Register  Update    Update    Timeout   Register
         |         |         |         |         |
çŠ¶æ€:    online    online    online    offline   online
```

---

### åœºæ™¯ 2.2ï¼šåˆ†å¸ƒå¼ä»»åŠ¡åˆ†é…ä¸æ‰§è¡Œæµ‹è¯•

**ç›®æ ‡**: éªŒè¯ä»»åŠ¡è°ƒåº¦ã€è´Ÿè½½å‡è¡¡å’Œæ•…éšœæ¢å¤

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | åˆ›å»ºä»»åŠ¡: `TaskAssignPayload` with capability='image-generation' | æ™ºèƒ½é€‰æ‹©èŠ‚ç‚¹ | âœ… NodeManager.filterNodes({capability: 'image-generation'})<br>âœ… è¿”å›æ”¯æŒè¯¥èƒ½åŠ›çš„èŠ‚ç‚¹åˆ—è¡¨ï¼ˆå¦‚3ä¸ªï¼‰<br>âœ… é€‰æ‹©queueLengthæœ€å°çš„èŠ‚ç‚¹<br>âœ… NodeService.getNodeStats()è¿”å›å‡†ç¡®çš„queueLength |
| 2ï¸âƒ£ | åŒæ—¶åˆ›å»º3ä¸ªå›¾åƒç”Ÿæˆä»»åŠ¡ | è´Ÿè½½å‡è¡¡åˆ†é… | âœ… 3ä¸ªä»»åŠ¡åˆ†é…åˆ°ä¸åŒèŠ‚ç‚¹ï¼ˆä¸å…¨éƒ¨åˆ°åŒä¸€èŠ‚ç‚¹ï¼‰<br>âœ… æ¯ä¸ªèŠ‚ç‚¹queueLength +1<br>âœ… æœ€ç©ºé—²èŠ‚ç‚¹ä¼˜å…ˆåˆ†é…<br>âœ… totalTasksQueued = 3 |
| 3ï¸âƒ£ | Worker1å®Œæˆä»»åŠ¡å¹¶è¿”å›ç»“æœ | ä»»åŠ¡çŠ¶æ€æ›´æ–° | âœ… Worker1å‘é€`{type: "task_complete", taskId, result}`<br>âœ… NodeManageræ›´æ–°stats.tasksCompleted<br>âœ… pendingTasksä¸­ç§»é™¤taskId<br>âœ… taskAssignmentsé‡Šæ”¾slot<br>âœ… è°ƒç”¨resolve(result)è¿”å›ç»™å®¢æˆ·ç«¯ |
| 4ï¸âƒ£ | Worker1åœ¨æ‰§è¡Œä»»åŠ¡æ—¶å´©æºƒ | æ•…éšœè½¬ç§» | âœ… Worker1å¿ƒè·³åœæ­¢ï¼ˆ90ç§’timeoutï¼‰<br>âœ… NodeManageræ ‡è®°ä¸ºoffline<br>âœ… æ£€æµ‹pendingTasksä¸­çš„è¶…æ—¶ä»»åŠ¡<br>âœ… é‡æ–°assignåˆ°å…¶ä»–onlineèŠ‚ç‚¹<br>âœ… è¿”å›é”™è¯¯åŒ…å«æ•…éšœèŠ‚ç‚¹ä¿¡æ¯ |
| 5ï¸âƒ£ | åŒæ—¶å‘é€20ä¸ªä»»åŠ¡ | é«˜çº§è´Ÿè½½å‡è¡¡ | âœ… 7ä¸ªèŠ‚ç‚¹å¹³å‡åˆ†é…ï¼ˆçº¦3ä¸ª/èŠ‚ç‚¹ï¼‰<br>âœ… æ— å•èŠ‚ç‚¹è¿‡è½½ï¼ˆmaxQueueLength <= 5ï¼‰<br>âœ… ä¼˜å…ˆçº§é«˜çš„ä»»åŠ¡ä¼˜å…ˆåˆ†é…<br>âœ… æ‰€æœ‰ä»»åŠ¡åœ¨è¶…æ—¶å‰å®Œæˆï¼ˆæˆåŠŸç‡ > 95%ï¼‰ |
| 6ï¸âƒ£ | æ£€æŸ¥èŠ‚ç‚¹quota: Worker2é…é¢è€—å°½ | QuotaManageræ‹’ç»è¯·æ±‚ | âœ… QuotaManager.checkQuota()è¿”å›DENIED<br>âœ… NodeManagerè·³è¿‡è¯¥èŠ‚ç‚¹ï¼ˆå³ä½¿ç©ºé—²ï¼‰<br>âœ… è¿”å›é”™è¯¯ç 'QUOTA_EXCEEDED'<br>âœ… HTTPçŠ¶æ€ç 429 |
| 7ï¸âƒ£ | æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€: GET `/api/tasks/{taskId}` | è¿”å›å®Œæ•´çŠ¶æ€ä¿¡æ¯ | âœ… è¿”å›{taskId, nodeId, status, assignedAt, result}<br>âœ… çŠ¶æ€æ­£ç¡®ï¼ˆpending/running/completed/failedï¼‰<br>âœ… durationè®¡ç®—æ­£ç¡®<br>âœ… å¦‚æœå¤±è´¥åŒ…å«errorMessage |

**ä»»åŠ¡åˆ†é…ç®—æ³•éªŒè¯**:
```typescript
// èŠ‚ç‚¹è´Ÿè½½è®¡ç®—
node1: queueLength=2, cpuUsage=30%, weight=0.5*2 + 0.5*0.3 = 1.15
node2: queueLength=1, cpuUsage=60%, weight=0.5*1 + 0.5*0.6 = 0.8
node3: queueLength=3, cpuUsage=20%, weight=0.5*3 + 0.5*0.2 = 1.6

é€‰æ‹©æƒé‡æœ€å°çš„: node2 (0.8) âœ…
```

---

### åœºæ™¯ 2.3ï¼šLLMä»£ç†ä¸æµå¼ä¼ è¾“æµ‹è¯•

**ç›®æ ‡**: éªŒè¯èŠ‚ç‚¹LLMè¯·æ±‚ä»£ç†ã€æµå¼ä¼ è¾“å’Œä¸­æ–­

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | Worker1å‘é€LLMè¯·æ±‚: `LLMRequestPayload` with 3æ¡æ¶ˆæ¯ | NodeManagerä»£ç†åˆ°LLMClient | âœ… QuotaManageræ£€æŸ¥èŠ‚ç‚¹é…é¢ï¼ˆperMinute/hourï¼‰<br>âœ… é…é¢å……è¶³è¿”å›ALLOWED<br>âœ… NodeManagerè°ƒç”¨LLMClient.streamChat()<br>âœ… pendingLLMRequestsè®°å½•request |
| 2ï¸âƒ£ | æµå¼å“åº”chunksï¼ˆæ¯50msä¸€ä¸ªchunkï¼‰ | å®æ—¶è½¬å‘åˆ°èŠ‚ç‚¹ | âœ… æ¯ä¸ªchunké€šè¿‡WebSocketå‘é€<br>âœ… streamObserver.onChunkè°ƒç”¨<br>âœ… ç´¯è®¡å†…å®¹æ­£ç¡®ï¼ˆæ— ä¸¢å¤±ï¼‰<br>âœ… è½¬å‘å»¶è¿Ÿ < 100ms |
| 3ï¸âƒ£ | èŠ‚ç‚¹request 2ä¸ªåŒæ—¶LLMè¯·æ±‚ | å¹¶å‘æ§åˆ¶ | âœ… ä¸¤ä¸ªè¯·æ±‚éƒ½è¿›å…¥pendingLLMRequests<br>âœ… QuotaManageråˆ†åˆ«æ£€æŸ¥é…é¢<br>âœ… ä¸¤ä¸ªæµå¹¶è¡Œè¿›è¡Œ<br>âœ… æ¯ä¸ªchunkæ­£ç¡®è·¯ç”±åˆ°å¯¹åº”requestId |
| 4ï¸âƒ£ | èŠ‚ç‚¹å‘é€ä¸­æ–­: `{"type": "interrupt", "requestId": "xxx"}` | å–æ¶ˆLLMè¯·æ±‚ | âœ… NodeManager.findRequest(requestId)<br>âœ… æ‰¾åˆ°AbortController<br>âœ… AbortController.abort()è°ƒç”¨<br>âœ… chatService.interruptRequest()è¿”å›true<br>âœ… ä»pendingLLMRequestsç§»é™¤<br>âœ… LLMè¯·æ±‚åœæ­¢ï¼ˆä¸å†æ¥æ”¶chunksï¼‰ |
| 5ï¸âƒ£ | èŠ‚ç‚¹quotaä¸è¶³ï¼ˆperMinute=0ï¼‰ | ä»£ç†è¢«æ‹’ç» | âœ… QuotaManager.checkQuotaè¿”å›DENIED<br>âœ… NodeManagerä¸è°ƒç”¨LLMClient<br>âœ… è¿”å›é”™è¯¯`{error: "quota_exceeded", code: 429}`<br>âœ… èŠ‚ç‚¹æ”¶åˆ°é”™è¯¯ |
| 6ï¸âƒ£ | 5ä¸ªèŠ‚ç‚¹åŒæ—¶è¯·æ±‚LLMï¼ˆå„1ä¸ªï¼‰ | å…¬å¹³è°ƒåº¦ | âœ… æŒ‰ä¼˜å…ˆçº§æ’åº<br>âœ… æ— èŠ‚ç‚¹é¥¥é¥¿ï¼ˆæ‰€æœ‰è¯·æ±‚åœ¨5ç§’å†…å¼€å§‹ï¼‰<br>âœ… æ€»å¹¶å‘æ•° <= MAX_LLM_CONCURRENT<br>âœ… æ‰€æœ‰è¯·æ±‚æœ€ç»ˆå®Œæˆ |
| 7ï¸âƒ£ | èŠ‚ç‚¹æ–­è¿è€ŒLLMæµè¿›è¡Œä¸­ | è‡ªåŠ¨æ¸…ç† | âœ… onDisconnectäº‹ä»¶è§¦å‘<br>âœ… NodeManageréå†pendingLLMRequests<br>âœ… æ‰¾åˆ°è¯¥èŠ‚ç‚¹çš„è¯·æ±‚<br>âœ… AbortController.abort()<br>âœ… é‡Šæ”¾è¿æ¥èµ„æº<br>âœ… æ— èµ„æºæ³„æ¼ |

**æµå¼ä¼ è¾“æ€§èƒ½éªŒè¯**:
```
æµ‹è¯•æ•°æ®: 1000 tokens, æ¯50mså‘é€50 tokens
é¢„æœŸæ—¶é—´: 1000/50 * 50ms = 1000ms (1ç§’)
å…è®¸èŒƒå›´: 900ms - 1100ms

æµ‹é‡æŒ‡æ ‡:
- ç¬¬ä¸€ä¸ªchunkå»¶è¿Ÿ: < 200ms
- å¹³å‡chunké—´éš”: 45-55ms
- æ€»ä¼ è¾“æ—¶é—´: ~1000ms
- ç´¯è®¡å†…å®¹: 1000 tokens (æ— ä¸¢å¤±)
```

---

### åœºæ™¯ 2.4ï¼šèŠ‚ç‚¹æ•…éšœæ¢å¤ä¸ä¸€è‡´æ€§æµ‹è¯•

**ç›®æ ‡**: éªŒè¯èŠ‚ç‚¹æ•…éšœåçš„æ•°æ®ä¸€è‡´æ€§å’Œæ¢å¤èƒ½åŠ›

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | èŠ‚ç‚¹Aæ­£åœ¨æ‰§è¡Œ5ä¸ªä»»åŠ¡ | ä»»åŠ¡çŠ¶æ€è¿½è¸ª | âœ… taskAssignmentsè®°å½•5ä¸ªä»»åŠ¡<br>âœ… æ¯ä¸ªä»»åŠ¡æœ‰nodeId='nodeA'<br>âœ… assignedAtæ—¶é—´æˆ³æ­£ç¡® |
| 2ï¸âƒ£ | èŠ‚ç‚¹Açªç„¶å´©æºƒï¼ˆKILL -9ï¼‰ | æ£€æµ‹æ•…éšœ | âœ… å¿ƒè·³åœæ­¢ï¼ˆ< 90ç§’ï¼‰<br>âœ… NodeManageræ ‡è®°ä¸ºoffline<br>âœ… EventBuså‘å¸ƒ'node_disconnected' |
| 3ï¸âƒ£ | æ£€æŸ¥è¿ç§»ä»»åŠ¡ | è‡ªåŠ¨é‡æ–°åˆ†é… | âœ… NodeManager.findFailedTasks(nodeA)<br>âœ… 5ä¸ªä»»åŠ¡è¢«è¯†åˆ«ä¸ºfailed<br>âœ… é‡æ–°åˆ†é…åˆ°å…¶ä»–èŠ‚ç‚¹ï¼ˆnodeB/nodeCï¼‰<br>âœ… è¿”å›warningsåŒ…å«è¿ç§»ä¿¡æ¯ |
| 4ï¸âƒ£ | æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§ | æ— æ•°æ®ä¸¢å¤± | âœ… å·²å®Œæˆçš„ä»»åŠ¡ç»“æœä¿å­˜<br>âœ… å¤±è´¥çš„ä»»åŠ¡å¯é‡è¯•<br>âœ… NodeServiceä¸­çš„èŠ‚ç‚¹è®°å½•å®Œæ•´<br>âœ… ç»Ÿè®¡æ•°æ®ï¼ˆtasksCompletedï¼‰æ­£ç¡® |
| 5ï¸âƒ£ | èŠ‚ç‚¹Aé‡å¯å¹¶é‡æ–°æ³¨å†Œ | ä¼˜é›…æ¢å¤ | âœ… èŠ‚ç‚¹Aä½¿ç”¨ç›¸åŒnodeId<br>âœ… çŠ¶æ€å˜ä¸ºonline<br>âœ… å†å²ç»Ÿè®¡æ•°æ®ä¿ç•™<br>âœ… å¯ä»¥æ¥å—æ–°ä»»åŠ¡ |
| 6ï¸âƒ£ | æ£€æŸ¥é…é¢ä¸€è‡´æ€§ | é…é¢æ­£ç¡®é‡ç½® | âœ… quotaUsedé‡ç½®ï¼ˆæ–°å‘¨æœŸï¼‰<br>âœ… æˆ–quotaUsedä»æŒä¹…åŒ–æ¢å¤<br>âœ… ä¸è¶…å‡ºå…¨å±€é…é¢é™åˆ¶ |
| 7ï¸âƒ£ | ç½‘ç»œåˆ†åŒºï¼ˆè„‘è£‚ï¼‰åœºæ™¯ | é˜²æ­¢ä¸ä¸€è‡´ | âœ… ç½‘ç»œåˆ†åŒºæ£€æµ‹<br>ï¸âœ… å¤šæ•°èŠ‚ç‚¹ç¡®è®¤<br>âœ… é˜²æ­¢é‡å¤ä»»åŠ¡åˆ†é…<br>ï¸âœ… æœ€ç»ˆä¸€è‡´æ€§ |

**æ•…éšœæ¢å¤æ—¶åº**:
```
æ—¶é—´
0s    [èŠ‚ç‚¹Aæ‰§è¡Œä»»åŠ¡1-5]
30s   [å¿ƒè·³æ­£å¸¸]
60s   [ç½‘ç»œä¸­æ–­ï¼Œå¿ƒè·³ä¸¢å¤±]
90s   [å¿ƒè·³timeoutï¼Œæ ‡è®°offline]
91s   [æ£€æµ‹åˆ°5ä¸ªå¤±è´¥ä»»åŠ¡]
92s   [ä»»åŠ¡é‡æ–°åˆ†é…åˆ°èŠ‚ç‚¹Bå’ŒC]
120s  [ç½‘ç»œæ¢å¤ï¼ŒèŠ‚ç‚¹Aé‡æ–°online]
125s  [èŠ‚ç‚¹Aæ¥å—æ–°ä»»åŠ¡6]

éªŒè¯: ä»»åŠ¡1-5å®Œæˆï¼ŒèŠ‚ç‚¹AçŠ¶æ€æ­£ç¡® âœ…
```

---

## ğŸ¯ æ¨¡å—ä¸‰ï¼šè®°å¿†ç³»ç»Ÿä¸RAGé›†æˆåœºæ™¯

### åœºæ™¯ 3.1ï¼šåŒè½¨è®°å¿†å­˜å‚¨ä¸æ£€ç´¢æµ‹è¯•

**ç›®æ ‡**: éªŒè¯è¯­ä¹‰è®°å¿†å’Œæƒ…æ™¯è®°å¿†çš„ç‹¬ç«‹ç®¡ç†å’Œæ¡¥æ¥

**å‰ç½®æ¡ä»¶**:
- RAGæœåŠ¡å·²åˆå§‹åŒ–ï¼ˆhnswlib-nodeï¼‰
- é…ç½®è‡³å°‘2ä¸ªçŸ¥è¯†åº“: 'diary'ã€'technical'
- é…ç½®å‘é‡ç”Ÿæˆå™¨ï¼ˆOpenAI/text-embedding-ada-002ï¼‰

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | å­˜å‚¨åˆ°diaryè®°å¿†: `save({content: "ä»Šå¤©å­¦ä¹ äº†GraphQL", knowledgeBase: "diary", userId: "user1"})` | æˆåŠŸå­˜å‚¨åˆ°RAG | âœ… ragService.addDocumentè°ƒç”¨<br>âœ… knowledgeBase='diary_storage'<br>âœ… metadata.userId='user1'<br>âœ… metadata.timestampå­˜åœ¨<br>âœ… å‘é‡æˆåŠŸç”Ÿæˆï¼ˆ1536ç»´ï¼‰ |
| 2ï¸âƒ£ | å­˜å‚¨åˆ°technicalè®°å¿†: `knowledgeBase="technical"` | å­˜å‚¨åˆ°ä¸åŒçŸ¥è¯†åº“ | âœ… RAGä¸­æœ‰2ä¸ªä¸åŒknowledgeBase<br>âœ… å‘é‡ç»´åº¦ä¸€è‡´ï¼ˆ1536ç»´ï¼‰<br>âœ… å¯ç‹¬ç«‹æ£€ç´¢ï¼ˆknowledgeBaseå‚æ•°ï¼‰ |
| 3ï¸âƒ£ | æ£€ç´¢æ—¥è®°: `recall("GraphQL", {knowledgeBase: "diary", userId: "user1"})` | è¿”å›ç›¸å…³è¯­ä¹‰è®°å¿† | âœ… ragService.searchè°ƒç”¨<br>âœ… æŸ¥è¯¢"GraphQL"<br>âœ… ç»“æœscore > 0.7<br>âœ… ç»“æœåŒ…å«"GraphQL"å…³é”®è¯<br>âœ… è¿”å›Memory[]æ ¼å¼æ­£ç¡® |
| 4ï¸âƒ£ | æ£€ç´¢æŠ€æœ¯çŸ¥è¯†åº“: `knowledgeBase="technical"` | åªåœ¨æŠ€æœ¯åº“æœç´¢ | âœ… ä¸æœç´¢diaryçŸ¥è¯†åº“<br>âœ… åªè¿”å›technicalç›¸å…³ç»“æœ<br>âœ… å¯åŒºåˆ†ä¸åŒçŸ¥è¯†åº“å†…å®¹ |
| 5ï¸âƒ£ | è·¨çŸ¥è¯†åº“æ£€ç´¢: ä¸æŒ‡å®šknowledgeBase | æœç´¢æ‰€æœ‰çŸ¥è¯†åº“ | âœ… SemanticMemoryServiceæœç´¢å¤šä¸ªçŸ¥è¯†åº“<br>âœ… ç»“æœå»é‡ï¼ˆmemoryIdå”¯ä¸€ï¼‰<br>âœ… åˆå¹¶ç»“æœå¹¶scoreæ’åº |
| 6ï¸âƒ£ | å­˜å‚¨å¸¦emotionçš„è®°å¿† | æƒ…æ„Ÿå…ƒæ•°æ®ä¿ç•™ | âœ… metadata.emotion='EXCITED'<br>âœ… metadata.emotionConfidence=0.85<br>âœ… æ£€ç´¢æ—¶æƒ…æ„Ÿä¿¡æ¯ä¿ç•™<br>âœ… å¯ç”¨äºæƒ…æ„Ÿåˆ†æå’Œå“åº” |
| 7ï¸âƒ£ | æ‰¹é‡å­˜å‚¨100æ¡è®°å¿† | æ€§èƒ½æ£€æŸ¥ | âœ… å­˜å‚¨æ—¶é—´ < 5ç§’ï¼ˆæ‰¹é‡ä¼˜åŒ–ï¼‰<br>âœ… æ— å†…å­˜æ³„æ¼ï¼ˆå †å†…å­˜ç¨³å®šï¼‰<br>âœ… ç¼“å­˜å‘½ä¸­ç‡ > 80%<br>âœ… å‘é‡ç´¢å¼•æ„å»ºæˆåŠŸ |

**è®°å¿†æ ¼å¼éªŒè¯**:
```json
// å­˜å‚¨çš„è®°å¿†
{
  "id": "mem_xxx",
  "content": "ä»Šå¤©å­¦ä¹ äº†GraphQLï¼Œæ„Ÿè§‰å¾ˆæœ‰ç”¨",
  "userId": "user1",
  "timestamp": 1234567890,
  "metadata": {
    "knowledgeBase": "diary",
    "storageKnowledgeBase": "diary_storage",
    "emotion": "EXCITED",
    "emotionConfidence": 0.85,
    "tags": ["å­¦ä¹ ", "GraphQL"],
    "source": "chat"
  }
}
```

**æ£€ç´¢æ€§èƒ½åŸºå‡†**:
- å•æ¡æ£€ç´¢ï¼ˆk=10ï¼‰: < 100ms
- è·¨çŸ¥è¯†åº“æ£€ç´¢ï¼ˆ2ä¸ªåº“ï¼‰: < 200ms
- æ‰¹é‡æ£€ç´¢100æ¡: < 500ms
- ç›¸ä¼¼åº¦é˜ˆå€¼è¿‡æ»¤: < 100ms

---

### åœºæ™¯ 3.2ï¼šè®°å¿†ä¸Šä¸‹æ–‡ä¸è¿‡æ»¤æµ‹è¯•

**ç›®æ ‡**: éªŒè¯æ£€ç´¢ä¸Šä¸‹æ–‡çš„ç²¾ç¡®æ§åˆ¶å’Œå…ƒæ•°æ®è¿‡æ»¤

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | å­˜å‚¨3æ¡ç”¨æˆ·1çš„è®°å¿† | å¸¦ç”¨æˆ·æ ‡è®°å­˜å‚¨ | âœ… metadata.userId='user1'<br>âœ… memoryIdå…¨å±€å”¯ä¸€<br>âœ… ç”¨æˆ·éš”ç¦»æ­£ç¡® |
| 2ï¸âƒ£ | å­˜å‚¨2æ¡ç”¨æˆ·2çš„è®°å¿†ï¼ˆç›¸åŒå†…å®¹ï¼‰ | ç‹¬ç«‹å­˜å‚¨ | âœ… metadata.userId='user2'<br>âœ… ä¸åŒmemoryId<br>âœ… å†…å®¹ç›¸åŒä½†å½’å±ä¸åŒ |
| 3ï¸âƒ£ | ç”¨æˆ·1æ£€ç´¢: `recall("é¡¹ç›®", {userId: "user1"})` | ä»…è¿”å›ç”¨æˆ·1è®°å¿† | âœ… metadataFilter={userId: 'user1'}<br>âœ… åªè¿”å›3æ¡user1çš„è®°å¿†<br>âœ… æ— user2çš„æ•°æ®ï¼ˆéšç§ä¿æŠ¤ï¼‰<br>âœ… ç»“æœç›¸å…³åº¦ > 0.6 |
| 4ï¸âƒ£ | ç”¨æˆ·2æ£€ç´¢ç›¸åŒå…³é”®è¯ | åªè¿”å›user2è®°å¿† | âœ… metadataFilter={userId: 'user2'}<br>âœ… åªè¿”å›2æ¡user2è®°å¿†<br>âœ… ä¸user1æ•°æ®å®Œå…¨éš”ç¦» |
| 5ï¸âƒ£ | ç”¨æˆ·1æ£€ç´¢ä½†æ— userIdè¿‡æ»¤å™¨ | éšå¼è¿‡æ»¤ï¼ˆå¦‚æœä»ä¸Šä¸‹æ–‡è·å–ï¼‰ | âœ… å¦‚æœcontextæœ‰userIdï¼Œè‡ªåŠ¨è¿‡æ»¤<br>âœ… è¿”å›user1è®°å¿†<br>âœ… ä¸è¿”å›user2è®°å¿† |
| 6ï¸âƒ£ | æ£€ç´¢å¸¦limit=2 | é™åˆ¶è¿”å›æ•°é‡ | âœ… ragService.search({k: 2})<br>âœ… è¿”å›exactly 2æ¡<br>âœ… è¿”å›scoreæœ€é«˜çš„2æ¡<br>âœ… ä¸è¶…å‡ºé™åˆ¶ |
| 7ï¸âƒ£ | æ£€ç´¢å¸¦threshold=0.8 | è¿‡æ»¤ä½åˆ†ç»“æœ | âœ… æ‰€æœ‰ç»“æœscore >= 0.8<br>âœ… ä½åˆ†ç»“æœï¼ˆ<0.8ï¼‰è¢«è¿‡æ»¤<br>âœ… ç»“æœè´¨é‡æ›´é«˜ |
| 8ï¸âƒ£ | æ··åˆæŸ¥è¯¢: "æŠ€æœ¯ diary 2024" | è‡ªåŠ¨è¯†åˆ«knowledgeBase | âœ… è§£æå…³é”®è¯'diary'<br>âœ… è®¾ç½®knowledgeBase='diary'<br>âœ… å…³é”®è¯"2024"åŠ å…¥æŸ¥è¯¢<br>âœ… ç»“æœç›¸å…³æ€§é«˜ |

**éšç§ä¸å®‰å…¨éªŒè¯**:
```typescript
// user1æŸ¥è¯¢ï¼ˆåº”è¯¥åªçœ‹åˆ°è‡ªå·±çš„ï¼‰
const memories = await recall("å·¥ä½œ", { userId: "user1" });
// ç»“æœ: [è®°å¿†1, è®°å¿†2, è®°å¿†3] - å…¨éƒ¨æ˜¯user1çš„

// æ£€æŸ¥æ˜¯å¦æ··å…¥user2æ•°æ®
const hasUser2Data = memories.some(m => m.metadata.userId === 'user2');
// æœŸæœ›: false âœ…

// æ£€æŸ¥è®°å¿†æ•°é‡
expect(memories.length).toBe(3); // ä¸æ˜¯5 âœ…
```

---

### åœºæ™¯ 3.3ï¼šè®°å¿†å¢å¼ºä¸çŸ¥è¯†å›¾è°±æµ‹è¯•

**ç›®æ ‡**: éªŒè¯è®°å¿†çš„å¢å¼ºæ£€ç´¢å’Œå…³è”åˆ†æ

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | å­˜å‚¨ç›¸å…³è®°å¿†: "GraphQLåŸºç¡€", "GraphQLè¿›é˜¶", "GraphQLæœ€ä½³å®è·µ" | å½¢æˆä¸»é¢˜èšç±» | âœ… metadata.tagsåŒ…å«"GraphQL"<br>âœ… RAGå‘é‡ç›¸ä¼¼åº¦é«˜<br>âœ… å¯è¯†åˆ«ä¸ºä¸»é¢˜èšç±» |
| 2ï¸âƒ£ | æ£€ç´¢: "GraphQL" | è¿”å›å®Œæ•´ä¸»é¢˜ | âœ… è¿”å›æ‰€æœ‰3æ¡è®°å¿†<br>âœ… æŒ‰scoreæ’åº<br>âœ… æœ€é«˜score ~0.95 |
| 3ï¸âƒ£ | æ£€æŸ¥è®°å¿†å…³è” | è‡ªåŠ¨å…³è”ç›¸å…³è®°å¿† | âœ… è®°å¿†Aæœ‰ç›¸å…³è®°å¿†Bçš„å¼•ç”¨<br>âœ… è®°å¿†Cå¼•ç”¨Aå’ŒB<br>âœ… å½¢æˆè®°å¿†é“¾ |
| 4ï¸âƒ£ | å­˜å‚¨æ—¶é—´æ•æ„Ÿè®°å¿†: "ä¼šè®®2024-01-15: è®¨è®ºGraphQL" | æ—¶é—´ç»´åº¦æ£€ç´¢ | âœ… metadata.timestamp<br>âœ… metadata.date='2024-01-15'<br>âœ… å¯æ—¶é—´çº¿æ£€ç´¢ |
| 5ï¸âƒ£ | æ£€ç´¢: "2024å¹´1æœˆGraphQL" | æ—¶é—´+å…³é”®è¯æ£€ç´¢ | âœ… è§£ææ—¶é—´èŒƒå›´: 2024-01<br>âœ… å…³é”®è¯"GraphQL"<br>âœ… è¿”å›è¯¥æ—¶é—´æ®µçš„ç›¸å…³è®°å¿† |
| 6ï¸âƒ£ | ä½¿ç”¨RAGå¢å¼ºprompt | è®°å¿†æ³¨å…¥ç³»ç»Ÿæç¤ºè¯ | âœ… PromptBuilderæ£€ç´¢ç›¸å…³è®°å¿†ï¼ˆk=5ï¼‰<br>âœ… å°†è®°å¿†åŠ å…¥system prompt<br>âœ… LLMå“åº”åŸºäºè®°å¿†ä¸Šä¸‹æ–‡ |
| 7ï¸âƒ£ | è®°å¿†æ›´æ–°: ä¿®æ”¹æ—§è®°å¿†å†…å®¹ | ç‰ˆæœ¬æ§åˆ¶ | âœ… åˆ›å»ºæ–°ç‰ˆæœ¬è®°å¿†<br>âœ… ä¿ç•™æ—§ç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰<br>âœ… metadata.version++<br>âœ… metadata.updatedAt |

**çŸ¥è¯†å¢å¼ºç¤ºä¾‹**:
```typescript
// ç”¨æˆ·æé—®: "GraphQLæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ"

// è‡ªåŠ¨æ£€ç´¢è®°å¿†
const memories = await recall("GraphQLä¼˜åŠ¿", { k: 5 });
// è¿”å›: [
//   "GraphQLæ”¯æŒç²¾ç¡®æŸ¥è¯¢",
//   "GraphQLå‡å°‘ç½‘ç»œè¯·æ±‚",
//   "GraphQLæœ‰å¼ºç±»å‹ç³»ç»Ÿ"
// ]

// æ„å»ºå¢å¼ºprompt
const enhancedPrompt = `
æ ¹æ®ç”¨æˆ·çš„è®°å¿†ï¼š
${memories.map(m => `- ${m.content}`).join('\n')}

è¯·å›ç­”ç”¨æˆ·é—®é¢˜: GraphQLæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ
`;

// LLMå“åº”åŸºäºç”¨æˆ·çš„å†å²è®°å¿†
// å›ç­”æ›´ä¸ªæ€§åŒ–ã€æ›´å‡†ç¡®
```

---

### åœºæ™¯ 3.4ï¼šRAGæœåŠ¡å®¹é”™ä¸æ¢å¤æµ‹è¯•

**ç›®æ ‡**: éªŒè¯RAGæœåŠ¡æ•…éšœæ—¶çš„å®¹é”™å’Œæ¢å¤èƒ½åŠ›

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | RAGæœåŠ¡æ­£å¸¸æ—¶å­˜å‚¨è®°å¿† | æˆåŠŸå­˜å‚¨ | âœ… ragService.addDocumentæˆåŠŸ<br>âœ… å‘é‡ç”Ÿæˆæ­£å¸¸<br>âœ… ç´¢å¼•æ„å»ºå®Œæˆ |
| 2ï¸âƒ£ | RAGæœåŠ¡å´©æºƒï¼ˆKILLï¼‰ | æ£€æµ‹æ•…éšœ | âœ… é”™è¯¯æ•è·: RAG service unavailable<br>âœ… ChatServiceä¸å´©æºƒ<br>âœ… è¿”å›é”™è¯¯ç»™è°ƒç”¨è€… |
| 3ï¸âƒ£ | å°è¯•å­˜å‚¨æ–°è®°å¿† | ä¼˜é›…å¤±è´¥ | âœ… æ•è·å¼‚å¸¸<br>âœ… logè­¦å‘Š: "RAG service unavailable, memory not saved"<br>âœ… ç»§ç»­æ‰§è¡Œï¼ˆä¸é˜»æ–­æµç¨‹ï¼‰<br>âœ… è®°å¿†å­˜å‚¨åˆ°fallbackï¼ˆå¦‚æ–‡ä»¶ï¼‰ |
| 4ï¸âƒ£ | å°è¯•æ£€ç´¢è®°å¿† | ä¼˜é›…å¤±è´¥ | âœ… æ•è·å¼‚å¸¸<br>âœ… è¿”å›ç©ºæ•°ç»„[]<br>âœ… ä¸å½±å“ä¸»æµç¨‹<br>âœ… logè­¦å‘Š |
| 5ï¸âƒ£ | RAGæœåŠ¡é‡å¯ | è‡ªåŠ¨æ¢å¤ | âœ… æ£€æµ‹RAGæœåŠ¡å¥åº·æ£€æŸ¥<br>âœ… é‡æ–°åˆå§‹åŒ–RAGè¿æ¥<br>âœ… æ¢å¤å‘é‡ç´¢å¼•<br>âœ… å¯ç»§ç»­å­˜å‚¨å’Œæ£€ç´¢ |
| 6ï¸âƒ£ | æ£€æŸ¥æŒä¹…åŒ–ç´¢å¼• | ç´¢å¼•ä¸ä¸¢å¤± | âœ… RAGç´¢å¼•ä¿å­˜åˆ°ç£ç›˜<br>âœ… é‡å¯åç´¢å¼•åŠ è½½æˆåŠŸ<br>âœ… å†å²è®°å¿†å¯æ£€ç´¢<br>âœ… æ–°çš„å­˜å‚¨ç»§ç»­è¿½åŠ  |

**å®¹é”™è®¾è®¡éªŒè¯**:
```typescript
// RAGè°ƒç”¨åŒ…è£…
try {
  await ragService.addDocument(doc);
} catch (error) {
  logger.warn('RAG service error:', error.message);
  // ä¸æŠ›å‡ºé”™è¯¯ï¼Œå…è®¸ç³»ç»Ÿç»§ç»­è¿è¡Œ
  // å¯é€‰ï¼šä¿å­˜åˆ°fallbackå­˜å‚¨
  await fallbackStorage.save(doc);
}
```

---

## ğŸ¯ æ¨¡å—å››ï¼šSkillsæ‰§è¡Œä¸å·¥å…·è°ƒç”¨åœºæ™¯

### åœºæ™¯ 4.1ï¼šå¤šæ‰§è¡Œå™¨ç±»å‹ä¸æ•…éšœè½¬ç§»æµ‹è¯•

**ç›®æ ‡**: éªŒè¯ä¸åŒç±»å‹çš„æ‰§è¡Œå™¨å’Œæ•…éšœè½¬ç§»é“¾

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | æ‰§è¡Œserviceç±»å‹Skill | ServiceExecutoræ‰§è¡Œ | âœ… è°ƒç”¨å¤–éƒ¨API/å¾®æœåŠ¡<br>âœ… HTTPè¯·æ±‚æ­£ç¡®ï¼ˆmethod, url, headersï¼‰<br>âœ… è¿”å›success=true<br>âœ… result.dataç»“æ„ç¬¦åˆé¢„æœŸ |
| 2ï¸âƒ£ | serviceæ‰§è¡Œå™¨è¶…æ—¶ï¼ˆ10ç§’æ— å“åº”ï¼‰ | æ•…éšœè½¬ç§» | âœ… serviceTimeout=10000ms<br>âœ… è¶…æ—¶è§¦å‘<br>âœ… è®°å½•serviceå¤±è´¥<br>âœ… fallbackChainè§¦å‘: serviceâ†’direct |
| 3ï¸âƒ£ | directæ‰§è¡Œå™¨å¤±è´¥ï¼ˆæœ¬åœ°è„šæœ¬é”™è¯¯ï¼‰ | ç»§ç»­æ•…éšœè½¬ç§» | âœ… æ•è·é”™è¯¯: "Script not found"<br>âœ… è®°å½•directå¤±è´¥<br>âœ… fallbackChain: directâ†’internal<br>âœ… internalæ‰§è¡Œå™¨è°ƒç”¨ |
| 4ï¸âƒ£ | internalæ‰§è¡Œå™¨æ‰§è¡Œ | è¿”å›å†…ç½®æ•°æ® | âœ… ä½¿ç”¨å†…ç½®æ•°æ®/é€»è¾‘<br>âœ… æ‰§è¡ŒæˆåŠŸ<br>âœ… result = å†…éƒ¨è®¡ç®—ç»“æœ<br>âœ… å“åº”æ—¶é—´ < 50ms |
| 5ï¸âƒ£ | internalä¹Ÿå¤±è´¥ | æ— æ›´å¤šfallback | âœ… æœ€ç»ˆé”™è¯¯è¿”å›<br>âœ… warningsåŒ…å«æ‰€æœ‰å°è¯•: ["service timeout", "direct failed", "internal failed"]<br>âœ… é”™è¯¯ä¿¡æ¯å®Œæ•´ï¼Œå¯æ’æŸ¥ |
| 6ï¸âƒ£ | preprocessorç±»å‹æ‰§è¡Œ | æ‰§è¡Œé¢„å¤„ç† | âœ… è¾“å…¥å‚æ•°é¢„å¤„ç†<br>âœ… transformé€»è¾‘ç”Ÿæ•ˆ<br>âœ… è¾“å‡ºæ ¼å¼ç¬¦åˆschema<br>âœ… å¯ç”¨äºæ•°æ®æ¸…æ´— |
| 7ï¸âƒ£ | staticç±»å‹æ‰§è¡Œ | è¿”å›é™æ€æ•°æ® | âœ… æ— å¤–éƒ¨è°ƒç”¨<br>âœ… ä»é™æ€æ–‡ä»¶/å†…å­˜è¯»å–<br>âœ… å“åº”æ—¶é—´ < 10ms<br>âœ… ç¬¬äºŒæ¬¡è°ƒç”¨ä»ç¼“å­˜è¯»å– |

**FallbackChainéªŒè¯**:
```typescript
const FALLBACK_CHAIN = {
  service: ['direct', 'internal'],
  distributed: ['service', 'direct'],
  direct: ['internal'],
  preprocessor: ['internal'],
  static: [],
  internal: []
};

// æµ‹è¯•ç»“æœ: serviceå¤±è´¥ â†’ directå¤±è´¥ â†’ internalæˆåŠŸ âœ…
```

**æ‰§è¡Œç»Ÿè®¡**:
```typescript
{
  totalRequests: 100,
  service: { success: 80, failed: 20 },
  direct: { success: 15, failed: 5 },  // æ‰¿æ¥serviceå¤±è´¥çš„20ä¸ª
  internal: { success: 5, failed: 0 }, // æ‰¿æ¥directå¤±è´¥çš„5ä¸ª
  overallSuccessRate: 100% // (80+15+5)/100 = 100% âœ…
}
```

---

### åœºæ™¯ 4.2ï¼šåå¥½é©±åŠ¨å‚æ•°è¡¥å…¨æµ‹è¯•

**ç›®æ ‡**: éªŒè¯å·¥å…·å‚æ•°æŒ‰åå¥½>schema>é»˜è®¤å€¼çš„ä¼˜å…ˆçº§è¡¥å…¨

**å‰ç½®æ¡ä»¶**:
- é…ç½®ç”¨æˆ·åå¥½: `toolsDefaults.maxResults=10`
- Skillå®šä¹‰: å·¥å…·å‚æ•°`maxResults`é»˜è®¤=5
- å½“å‰ç”¨æˆ·çš„preferences.json: `{"toolsDefaults": {"maxResults": 15}}`

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | è°ƒç”¨å·¥å…·: `{"tool": "SearchMemory", "args": {"maxResults": 20}}` | ä½¿ç”¨æ˜¾å¼å‚æ•°20 | âœ… å‚æ•°ä¸å˜åŒ–ï¼Œä¿æŒ20<br>âœ… Skillsæ¥æ”¶maxResults=20<br>âœ… ä¸æŸ¥preferencesï¼ˆæ˜¾å¼æœ€é«˜ä¼˜å…ˆçº§ï¼‰<br>âœ… log: "Using explicit parameter: maxResults=20" |
| 2ï¸âƒ£ | è°ƒç”¨å·¥å…·: `{"tool": "SearchMemory", "args": {}}`<br/>æ— maxResultså‚æ•° | åå¥½è¡¥å…¨ä¸º15 | âœ… PreferenceService.getPreferences()è°ƒç”¨<br>âœ… è¯»å–`toolsDefaults.maxResults=15`<br>âœ… å·¥å…·æ¥æ”¶maxResults=15<br>âœ… log: "Filled maxResults from preferences: 15" |
| 3ï¸âƒ£ | åˆ é™¤toolsDefaultsåå¥½ | ä½¿ç”¨schemaé»˜è®¤å€¼5 | âœ… åå¥½ä¸­æ— toolsDefaults<br>âœ… è¯»å–schema.parameters.maxResults.default=5<br>âœ… å·¥å…·æ¥æ”¶maxResults=5<br>âœ… log: "Filled maxResults from schema default: 5" |
| 4ï¸âƒ£ | schemaä¹Ÿæ— é»˜è®¤å€¼ | å‚æ•°å¯é€‰ä¸ä¼  | âœ… å‚æ•°æ ‡è®°ä¸ºoptional: true<br>âœ… å·¥å…·æ¥æ”¶undefined<br>âœ… log: "Parameter maxResults is optional, using undefined"<br>âœ… å·¥å…·å†…éƒ¨å¤„ç†é»˜è®¤å€¼ |
| 5ï¸âƒ£ | æŸ¥çœ‹å·¥å…·æè¿°ï¼ˆæ— åå¥½æ—¶ï¼‰ | æ˜¾ç¤ºschemaé»˜è®¤å€¼ | âœ… SkillsToToolMapper.generateDescription()<br>âœ… ToolDescriptionProvideræ— åå¥½<br>âœ… å·¥å…·æè¿°: "maxResults: æœ€å¤šè¿”å›ç»“æœæ•°ï¼ˆé»˜è®¤: 5ï¼‰" |
| 6ï¸âƒ£ | æŸ¥çœ‹å·¥å…·æè¿°ï¼ˆæœ‰åå¥½æ—¶ï¼‰ | preferencesæ³¨å…¥åˆ°description | âœ… PreferenceService.getPreferences()<br>âœ… è¯»å–å½“å‰ç”¨æˆ·åå¥½<br>âœ… ToolDescriptionProvideræ³¨å…¥descriptionï¼š<br>> "maxResults: æœ€å¤šè¿”å›ç»“æœæ•°ï¼ˆé»˜è®¤: 5ï¼Œæ‚¨çš„åå¥½: 15ï¼‰" |
| 7ï¸âƒ£ | åˆ‡æ¢ç”¨æˆ·: `userId="user-2"` | ä¸åŒç”¨æˆ·ä¸åŒé»˜è®¤å€¼ | âœ… user-2çš„preferences.json: {"maxResults": 8}<br>âœ… åŒä¸€å·¥å…·user-2è°ƒç”¨æ—¶é»˜è®¤8<br>âœ… user-1è°ƒç”¨æ—¶é»˜è®¤15<br>âœ… å®ç°ç”¨æˆ·çº§ä¸ªæ€§åŒ– |

**ä¼˜å…ˆçº§è§„åˆ™**:
```typescript
// å‚æ•°å€¼è§£æä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰
1. æ˜¾å¼å‚æ•°ï¼ˆè°ƒç”¨è€…æä¾›ï¼‰
   â†’ args.maxResults = 20 âœ…

2. åå¥½é»˜è®¤å€¼ï¼ˆå½“å‰ç”¨æˆ·ï¼‰
   â†’ preferences.toolsDefaults.maxResults = 15

3. Schemaé»˜è®¤å€¼ï¼ˆå·¥å…·å®šä¹‰ï¼‰
   â†’ schema.parameters.maxResults.default = 5

4. å·¥å…·å†…éƒ¨é»˜è®¤å€¼
   â†’ function execute(args) { const max = args.maxResults || 10; }

5. æ— å€¼ï¼ˆundefinedï¼‰- å¦‚æœå‚æ•°å¯é€‰
```

**æµ‹è¯•ç»“æœè®°å½•**:
```typescript
// æµ‹è¯•1: æ˜¾å¼å‚æ•°ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
Input: { maxResults: 20 }
Expected: { maxResults: 20 }
Actual: { maxResults: 20 } âœ…

// æµ‹è¯•2: åå¥½è¡¥å…¨
Input: {}
User Preference: { maxResults: 15 }
Expected: { maxResults: 15 }
Actual: { maxResults: 15 } âœ…

// æµ‹è¯•3: Schemaé»˜è®¤å€¼
Input: {}
User Preference: {}
Schema Default: { maxResults: 5 }
Expected: { maxResults: 5 }
Actual: { maxResults: 5 } âœ…
```

---

### åœºæ™¯ 4.3ï¼šå·¥å…·æ‰§è¡Œå‚æ•°éªŒè¯ä¸æ¸…ç†æµ‹è¯•

**ç›®æ ‡**: éªŒè¯å‚æ•°éªŒè¯ã€è¾“å…¥æ¸…ç†å’Œå®‰å…¨é˜²æŠ¤

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | è°ƒç”¨å·¥å…·: `{"query": "ç”¨æˆ·è¾“å…¥", "limit": 10}` | å‚æ•°éªŒè¯é€šè¿‡ | âœ… æ£€æŸ¥requiredå‚æ•°å­˜åœ¨<br>âœ… éªŒè¯limitç±»å‹=number<br>âœ… éªŒè¯queryç±»å‹=string<br>âœ… æ‰€æœ‰éªŒè¯é€šè¿‡ |
| 2ï¸âƒ£ | ç¼ºå°‘å¿…éœ€å‚æ•°: `{"limit": 10}` | éªŒè¯å¤±è´¥ | âœ… æ£€æŸ¥queryå‚æ•°ç¼ºå¤±<br>âœ… è¿”å›é”™è¯¯: "Missing required parameter: query"<br>âœ… HTTP 400 Bad Request |
| 3ï¸âƒ£ | å‚æ•°ç±»å‹é”™è¯¯: `{"query": 123, "limit": "10"}` | ç±»å‹éªŒè¯å¤±è´¥ | âœ… æ£€æŸ¥queryç±»å‹ï¼ˆæœŸæœ›stringï¼Œå¾—åˆ°numberï¼‰<br>âœ… æ£€æŸ¥limitç±»å‹ï¼ˆæœŸæœ›numberï¼Œå¾—åˆ°stringï¼‰<br>âœ… è¿”å›é”™è¯¯: "Parameter query must be string"<br>âœ… è¿”å›æ‰€æœ‰éªŒè¯é”™è¯¯ |
| 4ï¸âƒ£ | SQLæ³¨å…¥å°è¯•: `{"query": "'; DROP TABLE memories; --", "limit": 10}` | è¾“å…¥æ¸…ç† | âœ… è¾“å…¥æ¸…ç†: è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦<br>âœ… æˆ–å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆprepared statementï¼‰<br>âœ… æ¶æ„SQLä¸æ‰§è¡Œ<br>âœ… logå®‰å…¨è­¦å‘Š |
| 5ï¸âƒ£ | XSSå°è¯•: `{"query": "<script>alert('xss')</script>"}` | HTMLè½¬ä¹‰ | âœ… è¾“å‡ºç¼–ç : &lt;script&gt;...<br>âœ… ä¸æ‰§è¡ŒJavaScript<br>âœ… logå®‰å…¨äº‹ä»¶ |
| 6ï¸âƒ£ | è¶…é•¿å‚æ•°: `{"query": "a".repeat(10000), "limit": 10}` | é•¿åº¦é™åˆ¶ | âœ… æ£€æŸ¥æœ€å¤§é•¿åº¦: maxLength=1000<br>âœ… æˆªæ–­æˆ–æ‹’ç»<br>âœ… è¿”å›é”™è¯¯: "Parameter query too long" |
| 7ï¸âƒ£ | å‚æ•°æ ¼å¼éªŒè¯: emailã€URLç­‰ | æ ¼å¼éªŒè¯ | âœ… éªŒè¯emailæ ¼å¼: user@example.com âœ“<br>âœ… éªŒè¯URLæ ¼å¼: https://example.com âœ“<br>âœ… æ ¼å¼é”™è¯¯è¿”å›è¯¦ç»†æç¤º |

**å®‰å…¨éªŒè¯**:
```typescript
// è¾“å…¥æ¸…ç†ç¤ºä¾‹
function sanitizeInput(input: string): string {
  // 1. SQLæ³¨å…¥é˜²æŠ¤
  const sqlEscaped = input.replace(/['"\\]/g, '\\$&');

  // 2. XSSé˜²æŠ¤
  const xssEscaped = sqlEscaped
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');

  // 3. é•¿åº¦é™åˆ¶
  if (xssEscaped.length > MAX_LENGTH) {
    throw new Error(`Input too long: ${xssEscaped.length} > ${MAX_LENGTH}`);
  }

  return xssEscaped;
}
```

---

### åœºæ™¯ 4.4ï¼šå·¥å…·æˆæƒä¸å®‰å…¨å®¡è®¡æµ‹è¯•

**ç›®æ ‡**: éªŒè¯å·¥å…·è°ƒç”¨çš„æƒé™æ£€æŸ¥å’Œå®‰å…¨å®¡è®¡

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | è°ƒç”¨ä½é£é™©å·¥å…·: `SearchMemory` | è‡ªåŠ¨æ‰§è¡Œ | âœ… PolicyGuardæ£€æŸ¥riskLevel='low'<br>âœ… skipAuth=true<br>âœ… ç«‹å³æ‰§è¡Œ<br>âœ… è®°å½•å®¡è®¡æ—¥å¿— |
| 2ï¸âƒ£ | è°ƒç”¨é«˜é£é™©å·¥å…·: `DeleteFile` | è§¦å‘æˆæƒè¯·æ±‚ | âœ… PolicyGuardæ£€æŸ¥riskLevel='high'<br>âœ… requiresAuth=true<br>âœ… è¿”å›needsApproval=true<br>âœ… åˆ›å»ºToolApprovalRequest |
| 3ï¸âƒ£ | Adminç”¨æˆ·åœ¨Admin Panelæ‰¹å‡† | æ‰§è¡Œå·¥å…· | âœ… AdminControlleræ”¶åˆ°æ‰¹å‡†: POST /api/admin/approvals/{id}/approve<br>âœ… ToolAuthorizationè®°å½•approval<br>âœ… æ›´æ–°ToolApprovalRequestçŠ¶æ€='approved'<br>âœ… é‡æ–°æ‰§è¡Œå·¥å…·å¹¶é€šè¿‡ |
| 4ï¸âƒ£ | æ™®é€šç”¨æˆ·æ‹’ç» | å·¥å…·è¢«æ‹’ç» | âœ… ToolApprovalRequestçŠ¶æ€='denied'<br>âœ… è¿”å›é”™è¯¯: 'unauthorized'<br>âœ… SecurityStatsServiceè®°å½•denied<br>âœ… å·¥å…·ä¸æ‰§è¡Œ |
| 5ï¸âƒ£ | ä½¿ç”¨API Keyè°ƒç”¨å·¥å…· | API Keyæƒé™æ£€æŸ¥ | âœ… æ£€æŸ¥API Keyæƒé™çº§åˆ«<br>âœ… å¦‚æœæƒé™ä¸è¶³è¿”å›401<br>âœ… è®°å½•API Keyä½¿ç”¨ |
| 6ï¸âƒ£ | æŸ¥è¯¢å®¡è®¡æ—¥å¿— | è¿”å›å®Œæ•´æ—¥å¿— | âœ… GET /api/admin/audit/logs<br>âœ… æ˜¾ç¤ºå·¥å…·åã€è°ƒç”¨è€…ã€æ—¶é—´<br>âœ… æ˜¾ç¤ºæˆæƒçŠ¶æ€ï¼ˆapproved/deniedï¼‰<br>âœ… å¯ç­›é€‰æ—¶é—´èŒƒå›´ |
| 7ï¸âƒ£ | æ‰¹é‡æ‰§è¡Œ10ä¸ªå·¥å…·æˆæƒ | æ‰¹é‡æˆæƒç•Œé¢ | âœ… Admin Panelæ˜¾ç¤ºæ‰¹é‡æˆæƒè¯·æ±‚<br>âœ… å¯é€‰æ‹©æ€§æ‰¹å‡†/æ‹’ç»<br>âœ… æ‰¹é‡æ“ä½œå‡å°‘adminå·¥ä½œé‡ |

**æˆæƒæµç¨‹å›¾**:
```
å·¥å…·è°ƒç”¨
  â†“
PolicyGuardæ£€æŸ¥riskLevel
  â†“
[low] â†’ è‡ªåŠ¨æ‰§è¡Œ â†’ è®°å½•å®¡è®¡ â†’ å®Œæˆ
  â†“
[high] â†’ éœ€è¦æˆæƒ â†’ åˆ›å»ºApprovalRequest â†’ ç­‰å¾…adminæ‰¹å‡†
                                      â†“
                          [adminæ‰¹å‡†] â†’ æ‰§è¡Œå·¥å…· â†’ è®°å½•å®¡è®¡ â†’ å®Œæˆ
                          [adminæ‹’ç»] â†’ è¿”å›é”™è¯¯ â†’ è®°å½•å®¡è®¡ â†’ å®Œæˆ
                          [è¶…æ—¶30åˆ†é’Ÿ] â†’ è‡ªåŠ¨æ‹’ç» â†’ è®°å½•å®¡è®¡ â†’ å®Œæˆ
```

**å®¡è®¡è®°å½•ç¤ºä¾‹**:
```json
{
  "auditId": "audit_xxx",
  "timestamp": 1234567890,
  "toolName": "DeleteFile",
  "userId": "user123",
  "apiKeyId": "ak_xxx",
  "action": "execute",
  "authorization": {
    "required": true,
    "status": "approved",
    "approvedBy": "admin@example.com",
    "approvedAt": 1234567900
  },
  "parameters": {
    "filePath": "/tmp/test.log"
  },
  "result": {
    "success": true,
    "executionTime": 150
  }
}
```

---

### åœºæ™¯ 4.5ï¼šSkillsä½¿ç”¨è·Ÿè¸ªä¸æ€§èƒ½æµ‹è¯•

**ç›®æ ‡**: éªŒè¯Skillsä½¿ç”¨æƒ…å†µçš„è·Ÿè¸ªå’Œæ€§èƒ½ç›‘æ§

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | æ‰§è¡Œå·¥å…·: `SearchMemory` | è®°å½•ä½¿ç”¨ | âœ… SkillUsageTracker.recordExecution()<br>âœ… è®°å½•skillName: 'SearchMemory'<br>âœ… è®°å½•timestamp<br>âœ… è®°å½•userId<br>âœ… è®°å½•executionTime |
| 2ï¸âƒ£ | æ‰§è¡Œä¸åŒå·¥å…·10æ¬¡ | ä½¿ç”¨ç»Ÿè®¡ç´¯ç§¯ | âœ… æ¯ä¸ªå·¥å…·è°ƒç”¨éƒ½è®°å½•<br>âœ… è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡æ­£ç¡®<br>âœ… å¹³å‡å“åº”æ—¶é—´è®¡ç®—æ­£ç¡®<br>âœ… æˆåŠŸç‡ç»Ÿè®¡ |
| 3ï¸âƒ£ | æŸ¥è¯¢ä½¿ç”¨ç»Ÿè®¡: `getUsageStats()` | è¿”å›ç»Ÿè®¡æ•°æ® | âœ… è¿”å›è°ƒç”¨æ¬¡æ•°ï¼ˆcountï¼‰<br>âœ… å¹³å‡å“åº”æ—¶é—´ï¼ˆavgResponseTimeï¼‰<br>âœ… æˆåŠŸç‡ï¼ˆsuccessRateï¼‰<br>âœ… çƒ­é—¨å·¥å…·æ’åï¼ˆtopToolsï¼‰ |
| 4ï¸âƒ£ | æŸ¥è¯¢ç‰¹å®šå·¥å…·ç»Ÿè®¡ | å·¥å…·è¯¦ç»†æ•°æ® | âœ… è°ƒç”¨æ¬¡æ•°<br>âœ… å¹³å‡å“åº”æ—¶é—´<br>âœ… é”™è¯¯æ¬¡æ•°<br>âœ… æœ€åè°ƒç”¨æ—¶é—´ |
| 5ï¸âƒ£ | æŸ¥çœ‹ç”¨æˆ·çº§ç»Ÿè®¡ | ç”¨æˆ·ä½¿ç”¨æƒ…å†µ | âœ… æ¯ä¸ªç”¨æˆ·çš„ä½¿ç”¨ç»Ÿè®¡<br>âœ… ç”¨æˆ·åå¥½åˆ†æ<br>âœ… ç”¨æˆ·è¡Œä¸ºæ´å¯Ÿ |
| 6ï¸âƒ£ | æ£€æŸ¥æ€§èƒ½ç“¶é¢ˆ | è¯†åˆ«æ…¢å·¥å…· | âœ… ç›‘æ§æ‰§è¡Œæ—¶é—´<br>âœ… æ ‡è®°æ…¢å·¥å…·ï¼ˆ>1ç§’ï¼‰<br>âœ… ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š |
| 7ï¸âƒ£ | é«˜å¹¶å‘æµ‹è¯•ï¼ˆ100è¯·æ±‚ï¼‰ | ç»Ÿè®¡å‡†ç¡®æ€§ | âœ… å¹¶å‘å†™å…¥ä¸ä¸¢æ•°æ®<br>âœ… æœ€ç»ˆç»Ÿè®¡å‡†ç¡®ï¼ˆ100æ¬¡ï¼‰<br>âœ… æ— ç«æ€æ¡ä»¶ |

**ä½¿ç”¨ç»Ÿè®¡ç¤ºä¾‹**:
```json
{
  "totalExecutions": 1000,
  "successRate": 0.95,
  "avgResponseTime": 450,
  "topTools": [
    { "name": "SearchMemory", "count": 300, "avgTime": 120 },
    { "name": "GenerateImage", "count": 200, "avgTime": 2500 },
    { "name": "Calculate", "count": 150, "avgTime": 50 }
  ],
  "hourlyStats": [
    { "hour": "2025-11-17T09:00:00Z", "count": 150 },
    { "hour": "2025-11-17T10:00:00Z", "count": 200 }
  ]
}
```

**æ€§èƒ½ç›‘æ§**:
```typescript
// æ…¢å·¥å…·æ£€æµ‹
const SLOW_THRESHOLD = 1000; // 1ç§’

if (executionTime > SLOW_THRESHOLD) {
  logger.warn(`Slow tool detected: ${skillName} took ${executionTime}ms`);
  alertService.sendAlert({
    type: 'performance',
    message: `Tool ${skillName} is slow`,
    executionTime
  });
}
```

---

## ğŸ¯ æ¨¡å—äº”ï¼šç®¡ç†åå°åŠŸèƒ½åœºæ™¯

### åœºæ™¯ 5.1ï¼šç®¡ç†åå°é…ç½®ç®¡ç†æµ‹è¯•

**ç›®æ ‡**: éªŒè¯Reactç®¡ç†åå°ä¸APIçš„é›†æˆ

**å‰ç½®æ¡ä»¶**:
- ç®¡ç†åå°è¿è¡Œ: `cd admin && npm run dev` (localhost:3000/admin)
- APIæœåŠ¡è¿è¡Œ: `npm run dev` (localhost:3000)
- ç®¡ç†å‘˜è´¦å·å·²åˆ›å»º
- è‡³å°‘1ä¸ªäººæ ¼é…ç½®å’Œ1ä¸ªèŠ‚ç‚¹é…ç½®

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | è®¿é—®: `http://localhost:3000/admin` | æ˜¾ç¤ºç™»å½•é¡µ | âœ… æ˜¾ç¤ºLoginç»„ä»¶<br>âœ… æœ‰ç”¨æˆ·åå’Œå¯†ç è¾“å…¥æ¡†<br>âœ… æœ‰ç™»å½•æŒ‰é’® |
| 2ï¸âƒ£ | è¾“å…¥ç®¡ç†å‘˜è´¦å·å¯†ç  | æˆåŠŸç™»å½• | âœ… POST /api/auth/login<br>âœ… è¿”å›`{token, user}`<br>âœ… localStorage.setItem('token', token)<br>âœ… Redux storeæ›´æ–°userçŠ¶æ€<br>âœ… è·³è½¬åˆ°Dashboard |
| 3ï¸âƒ£ | è®¿é—®Settingsé¡µé¢ | åŠ è½½å½“å‰é…ç½® | âœ… GET /api/configè¿”å›Config<br>âœ… æ˜¾ç¤ºloaderï¼ˆåŠ è½½ä¸­ï¼‰<br>âœ… è¡¨å•å¡«å……Configæ•°æ®<br>âœ… æ˜¾ç¤ºLLMæä¾›å•†é…ç½®<br>âœ… æ˜¾ç¤ºRAGé…ç½® |
| 4ï¸âƒ£ | ä¿®æ”¹LLMé…ç½®ï¼ˆåˆ‡æ¢é»˜è®¤æä¾›å•†ï¼‰ | æäº¤ä¿å­˜ | âœ… è¡¨å•è¾“å…¥å˜æ›´<br>âœ… ç‚¹å‡»SaveæŒ‰é’®<br>âœ… PUT /api/configå‘é€æ–°é…ç½®<br>âœ… RuntimeConfigServiceæ›´æ–°é…ç½®<br>âœ… ChatServiceé‡è½½LLMClient<br>âœ… æ˜¾ç¤ºSuccess toast: "é…ç½®å·²ä¿å­˜" |
| 5ï¸âƒ£ | åˆ‡æ¢Personalityé…ç½® | å®æ—¶ç”Ÿæ•ˆ | âœ… ä¸‹æ‹‰é€‰æ‹©ä¸åŒäººæ ¼<br>âœ… è¡¨å•æ˜¾ç¤ºæ–°äººæ ¼æ•°æ®<br>âœ… ä¿å­˜åPersonalityEngine.clearCache()<br>âœ… æ–°å¯¹è¯ç«‹å³ä½¿ç”¨æ–°äººæ ¼ |
| 6ï¸âƒ£ | æ·»åŠ æ–°çš„LLMæä¾›å•†é…ç½® | åŠ¨æ€é…ç½® | âœ… ç‚¹å‡»"Add Provider"<br>âœ… å¡«å†™è¡¨å•ï¼ˆname, baseURL, apiKeyï¼‰<br>âœ… ä¿å­˜åprovidersæ•°ç»„+1<br>âœ… LLMClientæ³¨å†Œæ–°adapter |
| 7ï¸âƒ£ | è®¿é—®Personalitiesé¡µé¢ | æ˜¾ç¤ºäººæ ¼åˆ—è¡¨ | âœ… GET /api/personalitiesè¿”å›åˆ—è¡¨<br>âœ… æ˜¾ç¤ºäººæ ¼å¡ç‰‡ç½‘æ ¼<br>âœ… æ¯å¼ å¡ç‰‡æ˜¾ç¤º: å¤´åƒã€åç§°ã€æè¿°<br>âœ… æ˜¾ç¤ºåŠ è½½çŠ¶æ€ç´ æï¼ˆå¦‚æœåŠ è½½æ…¢ï¼‰ |
| 8ï¸âƒ£ | ç¼–è¾‘äººæ ¼ï¼ˆç‚¹å‡»Editï¼‰ | JSONç¼–è¾‘å™¨æ‰“å¼€ | âœ… æ˜¾ç¤ºJSONç¼–è¾‘å™¨ï¼ˆMonaco Editorï¼‰<br>âœ… æ˜¾ç¤ºå½“å‰äººæ ¼JSON<br>âœ… æ”¯æŒè¯­æ³•é«˜äº®<br>âœ… æ”¯æŒæ ¼å¼éªŒè¯ |
| 9ï¸âƒ£ | ä¿®æ”¹äººæ ¼JSONå¹¶ä¿å­˜ | ä¿å­˜åéªŒè¯ | âœ… PUT /api/personalities/{id}<br>âœ… æœåŠ¡å™¨éªŒè¯JSONæ ¼å¼<br>âœ… éªŒè¯å¿…è¦å­—æ®µï¼ˆname, traits.coreï¼‰<br>âœ… éªŒè¯æˆåŠŸä¿å­˜<br>âœ… éªŒè¯å¤±è´¥æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ |
| ğŸ”Ÿ | åˆ›å»ºæ–°çš„äººæ ¼é…ç½® | å®Œæ•´æµç¨‹ | âœ… ç‚¹å‡»"Create New"<br>âœ… å¡«å†™è¡¨å•æˆ–JSON<br>âœ… POST /api/personalities<br>âœ… æœåŠ¡å™¨å†™å…¥config/personalities/new.json<br>âœ… è¿”å›201 Created<br>âœ… åˆ—è¡¨åˆ·æ–°ï¼Œæ˜¾ç¤ºæ–°äººæ ¼ |
| 1ï¸âƒ£1ï¸âƒ£ | åˆ é™¤äººæ ¼é…ç½® | ç¡®è®¤åˆ é™¤ | âœ… ç‚¹å‡»DeleteæŒ‰é’®<br>âœ… æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†<br>âœ… ç¡®è®¤åDELETE /api/personalities/{id}<br>âœ… æœåŠ¡å™¨fs.unlinkåˆ é™¤æ–‡ä»¶<br>âœ… åˆ—è¡¨åˆ·æ–°ï¼Œäººæ ¼ç§»é™¤ |

**é…ç½®æ•°æ®ç»“æ„**:
```typescript
// Admin UI State
interface ConfigState {
  config: {
    llm: {
      defaultProvider: 'openai';
      providers: {
        openai: { baseURL, apiKey, defaultModel },
        deepseek: { baseURL, apiKey, defaultModel }
      }
    };
    rag: {
      enabled: true,
      workDir: './vector_store',
      vectorizer: { baseURL, apiKey, model }
    };
  };
  loading: false;
  error: null;
}
```

---

### åœºæ™¯ 5.2ï¼šèŠ‚ç‚¹ç›‘æ§ä¸ç®¡ç†æµ‹è¯•

**ç›®æ ‡**: éªŒè¯èŠ‚ç‚¹ç›‘æ§ä»ªè¡¨æ¿åŠŸèƒ½å’Œå®æ—¶æ›´æ–°

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | è®¿é—®Nodesé¡µé¢: `/admin/nodes` | æ˜¾ç¤ºèŠ‚ç‚¹ç›‘æ§ | âœ… WebSocketè¿æ¥åˆ°`ws://localhost:3000/ws/admin`<br>âœ… è®¢é˜…'node_events'é¢‘é“<br>âœ… åˆå§‹GET /api/nodesè¿”å›æ‰€æœ‰èŠ‚ç‚¹<br>âœ… æ˜¾ç¤ºèŠ‚ç‚¹åˆ—è¡¨ï¼ˆå¡ç‰‡æˆ–è¡¨æ ¼ï¼‰ |
| 2ï¸âƒ£ | æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨ | æ˜¾ç¤ºèŠ‚ç‚¹ä¿¡æ¯å’ŒçŠ¶æ€ | âœ… æ¯ä¸ªèŠ‚ç‚¹æ˜¾ç¤º: nodeIdã€nameã€typeï¼ˆworker/companionï¼‰<br>âœ… çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆonline/offlineï¼‰<br>âœ… æœ€åå¿ƒè·³æ—¶é—´<br>âœ… è¿è¡Œæ—¶é—´ï¼ˆuptimeï¼‰ |
| 3ï¸âƒ£ | ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹è¯¦æƒ… | æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ | âœ… æ˜¾ç¤ºcapabilitiesåˆ—è¡¨<br>âœ… æ˜¾ç¤ºå½“å‰ä»»åŠ¡æ•°ï¼ˆrunning tasksï¼‰<br>âœ… æ˜¾ç¤ºç»Ÿè®¡æ•°æ®ï¼ˆæ€»ä»»åŠ¡ã€æˆåŠŸç‡ã€å¹³å‡å“åº”æ—¶é—´ï¼‰<br>âœ… æ˜¾ç¤ºé…é¢ä½¿ç”¨æƒ…å†µï¼ˆquota used/limitï¼‰ |
| 4ï¸âƒ£ | èŠ‚ç‚¹ç¦»çº¿æ¨¡æ‹Ÿï¼ˆKILL worker1ï¼‰ | å®æ—¶æ›´æ–°çŠ¶æ€ | âœ… WebSocketæ”¶åˆ°'node_offline'äº‹ä»¶<br>âœ… èŠ‚ç‚¹å¡ç‰‡å˜çº¢ï¼ˆçº¢è‰²è¾¹æ¡†/èƒŒæ™¯ï¼‰<br>âœ… çŠ¶æ€æ˜¾ç¤º"ç¦»çº¿"<br>âœ… æœ€åå¿ƒè·³æ—¶é—´åœæ­¢æ›´æ–°<br>âœ… å¯é€‰: æ’­æ”¾è­¦å‘ŠéŸ³æ•ˆ<br>âœ… æ˜¾ç¤ºé€šçŸ¥toast: "èŠ‚ç‚¹ worker1 ç¦»çº¿" |
| 5ï¸âƒ£ | èŠ‚ç‚¹é‡æ–°ä¸Šçº¿ | æ¢å¤æ­£å¸¸æ˜¾ç¤º | âœ… WebSocketæ”¶åˆ°'node_online'äº‹ä»¶<br>âœ… å¡ç‰‡å˜ç»¿ï¼ˆç»¿è‰²è¾¹æ¡†/èƒŒæ™¯ï¼‰<br>âœ… çŠ¶æ€æ˜¾ç¤º"åœ¨çº¿"<br>âœ… å¿ƒè·³æ¢å¤æ›´æ–°<br>âœ… é€šçŸ¥toast: "èŠ‚ç‚¹ worker1 å·²æ¢å¤" |
| 6ï¸âƒ£ | æ‰‹åŠ¨ç§»é™¤èŠ‚ç‚¹ | ç¡®è®¤åˆ é™¤æ“ä½œ | âœ… æ˜¾ç¤º"ç§»é™¤æ­¤èŠ‚ç‚¹"æŒ‰é’®<br>âœ… ç‚¹å‡»åæ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†<br>âœ… äºŒæ¬¡ç¡®è®¤åPOST /api/nodes/{id}/remove<br>âœ… NodeService.removeNode(nodeId)<br>âœ… åˆ—è¡¨åˆ·æ–°ï¼ŒèŠ‚ç‚¹æ¶ˆå¤± |
| 7ï¸âƒ£ | æŸ¥çœ‹èŠ‚ç‚¹æ—¥å¿— | æ˜¾ç¤ºæ—¥å¿—æµ | âœ… ç‚¹å‡»"View Logs"<br>âœ… GET /api/nodes/{id}/logs<br>âœ… æ˜¾ç¤ºæ—¥å¿—åˆ—è¡¨ï¼ˆæ—¶é—´æˆ³ã€çº§åˆ«ã€æ¶ˆæ¯ï¼‰<br>âœ… å¯ç­›é€‰çº§åˆ«ï¼ˆinfo/warn/errorï¼‰<br>âœ… æ”¯æŒå®æ—¶æ—¥å¿—æµï¼ˆWebSocketï¼‰ |
| 8ï¸âƒ£ | è°ƒæ•´èŠ‚ç‚¹é…é¢ | é…é¢é…ç½®ç”Ÿæ•ˆ | âœ… ç‚¹å‡»"Edit Quota"<br>âœ… ä¿®æ”¹perMinuteå’ŒperHouré™åˆ¶<br>âœ… PUT /api/nodes/{id}/quota<br>âœ… RuntimeConfigServiceæ›´æ–°<br>âœ… QuotaManageré‡æ–°åŠ è½½<br>âœ… æ–°ä»»åŠ¡ä½¿ç”¨æ–°é…é¢ |

**WebSocketäº‹ä»¶æ ¼å¼**:
```typescript
interface NodeEvent {
  type: 'node_online' | 'node_offline' | 'node_heartbeat';
  timestamp: number;
  nodeId: string;
  payload: {
    status: NodeStatus;
    stats?: NodeStats;
    message?: string;
  };
}

// å®æ—¶æ›´æ–°ç¤ºä¾‹
websocket.on('node_offline', (event) => {
  // æ›´æ–°UI
  updateNodeStatus(event.nodeId, 'offline');
  showNotification(`èŠ‚ç‚¹ ${event.nodeId} ç¦»çº¿`, 'warning');
});
```

**èŠ‚ç‚¹ç›‘æ§æŒ‡æ ‡**:
```typescript
// æ˜¾ç¤ºçš„å…³é”®æŒ‡æ ‡
{
  nodes: {
    total: 7,
    online: 5,
    offline: 2,
    byType: {
      worker: 5,
      companion: 2
    }
  },
  tasks: {
    running: 12,
    queued: 5,
    completedToday: 150,
    successRate: 0.98
  }
}
```

---

### åœºæ™¯ 5.3ï¼šå®‰å…¨å®¡è®¡ä¸æ—¥å¿—ç›‘æ§æµ‹è¯•

**ç›®æ ‡**: éªŒè¯å®‰å…¨äº‹ä»¶çš„è®°å½•ã€ç›‘æ§å’Œå‘Šè­¦

**æµ‹è¯•æ­¥éª¤**:

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|-------|
| 1ï¸âƒ£ | è®¿é—®Securityé¡µé¢ | æ˜¾ç¤ºå®‰å…¨ä»ªè¡¨æ¿ | âœ… SecurityStatsServiceèšåˆæ•°æ®<br>âœ… æ˜¾ç¤ºæ€»è¯·æ±‚æ•°ï¼ˆtotalRequestsï¼‰<br>âœ… æ˜¾ç¤ºå¯ç–‘æ´»åŠ¨æ•°ï¼ˆsuspiciousActivitiesï¼‰<br>âœ… æ˜¾ç¤ºå°ç¦IPæ•°ï¼ˆbannedIPsï¼‰<br>âœ… æ˜¾ç¤ºå·¥å…·æˆæƒç»Ÿè®¡ï¼ˆapprovals pending/deniedï¼‰ |
| 2ï¸âƒ£ | è§¦å‘é€Ÿç‡é™åˆ¶ï¼ˆæš´åŠ›ç ´è§£ï¼‰ | IPè¢«å°ç¦ | âœ… å‘é€100+è¯·æ±‚/åˆ†é’Ÿ<br>âœ… rateLimitMiddlewareè§¦å‘<br>âœ… Redisè®°å½•å°ç¦: `SET ip:blocklist:1.2.3.4 true EX 3600`<br>âœ… è¿”å›HTTP 429<br>âœ… SecurityAlertServiceå‘é€å‘Šè­¦ï¼ˆé‚®ä»¶/Discordï¼‰<br>âœ… ä»ªè¡¨æ¿æ˜¾ç¤ºbannedIPs +1 |
| 3ï¸âƒ£ | æŸ¥çœ‹å®‰å…¨æ—¥å¿— | æ˜¾ç¤ºè¯¦ç»†æ—¥å¿— | âœ… GET /api/security/logs<br>âœ… æ˜¾ç¤ºæ—¥å¿—åˆ—è¡¨ï¼ˆæ—¶é—´æˆ³ã€IPã€äº‹ä»¶ç±»å‹ï¼‰<br>âœ… å¯ç­›é€‰eventTypeï¼ˆlogin_fail, rate_limit, auth_failï¼‰<br>âœ… æ”¯æŒåˆ†é¡µï¼ˆpage, limitï¼‰ |
| 4ï¸âƒ£ | æŸ¥è¯¢ç‰¹å®šIPæ´»åŠ¨ | è¿”å›IPå†å² | âœ… GET /api/security/logs?ip=1.2.3.4<br>âœ… è¿”å›è¯¥IPæ‰€æœ‰äº‹ä»¶<br>âœ… æ˜¾ç¤ºé¦–æ¬¡å‡ºç°æ—¶é—´<br>âœ… æ˜¾ç¤ºæ´»åŠ¨é¢‘ç‡ï¼ˆæ¯å°æ—¶è¯·æ±‚æ•°ï¼‰<br>âœ… æ˜¾ç¤ºé£é™©è¯„åˆ† |
| 5ï¸âƒ£ | æ‰‹åŠ¨å°ç¦IP | æ·»åŠ åˆ°é»‘åå• | âœ… åœ¨Securityé¡µé¢è¾“å…¥IP<br>âœ… POST /api/security/ban {ip: "1.2.3.4"}<br>âœ… Redisæ·»åŠ : `SET ip:blocklist:1.2.3.4 true EX 86400`<br>âœ… è¯¥IPæ‰€æœ‰è¯·æ±‚è¿”å›403 Forbidden<br>âœ… ä»ªè¡¨æ¿bannedIPs +1 |
| 6ï¸âƒ£ | æŸ¥çœ‹å·¥å…·è°ƒç”¨å®¡è®¡ | æ˜¾ç¤ºè°ƒç”¨è®°å½• | âœ… GET /api/security/tool-calls<br>âœ… æ˜¾ç¤ºè°ƒç”¨çš„å·¥å…·å<br>âœ… æ˜¾ç¤ºè°ƒç”¨è€…userId<br>âœ… æ˜¾ç¤ºè°ƒç”¨æ—¶é—´<br>âœ… æ˜¾ç¤ºæˆæƒçŠ¶æ€ï¼ˆapproved/denied/autoï¼‰ |
| 7ï¸âƒ£ | å¯¼å‡ºå®¡è®¡æŠ¥è¡¨ | ç”ŸæˆCSV/PDF | âœ… POST /api/security/export<br>âœ… ç”ŸæˆCSVæ ¼å¼<br>âœ… åŒ…å«æ‰€æœ‰å®¡è®¡å­—æ®µï¼ˆ30å¤©æ•°æ®ï¼‰<br>âœ… å¯ä¸‹è½½æ–‡ä»¶ï¼ˆaudit_report_2025-11-17.csvï¼‰<br>âœ… æ–‡ä»¶å¤§å° < 10MB |
| 8ï¸âƒ£ | è®¾ç½®å‘Šè­¦è§„åˆ™ | å‘Šè­¦è§¦å‘ | âœ… é…ç½®è§„åˆ™: é€Ÿç‡é™åˆ¶ > 50è¯·æ±‚/åˆ†é’Ÿ<br>âœ… é…ç½®é€šçŸ¥æ–¹å¼: email + Discord<br>âœ… è§¦å‘è§„åˆ™åå‘é€å‘Šè­¦<br>âœ… å‘Šè­¦åŒ…å«è¯¦ç»†ä¿¡æ¯ï¼ˆIPã€æ—¶é—´ã€äº‹ä»¶ï¼‰ |

**å‘Šè­¦é€šçŸ¥ç¤ºä¾‹**:
```typescript
// Discordé€šçŸ¥
{
  "embeds": [{
    "title": "ğŸš¨ å®‰å…¨å‘Šè­¦",
    "color": 15158332,
    "fields": [
      { "name": "äº‹ä»¶ç±»å‹", "value": "rate_limit_exceeded", "inline": true },
      { "name": "IPåœ°å€", "value": "192.168.1.100", "inline": true },
      { "name": "è¯·æ±‚æ•°", "value": "120/åˆ†é’Ÿ", "inline": true },
      { "name": "æ—¶é—´", "value": "2025-11-17 10:30:00 UTC" }
    ],
    "timestamp": "2025-11-17T10:30:00Z"
  }]
}
```

**å®‰å…¨æ€åŠ¿æŒ‡æ ‡**:
```typescript
{
  "period": "24h",
  "requests": {
    "total": 15420,
    "blocked": 45,
    "rateLimited": 120
  },
  "auth": {
    "loginAttempts": 320,
    "loginSuccess": 315,
    "loginFailures": 5
  },
  "tools": {
    "totalCalls": 850,
    "approved": 800,
    "denied": 50,
    "pending": 3
  }
}
```

---

## ğŸ“Š æµ‹è¯•æ‰§è¡ŒæŒ‡å—

### æ‰§è¡Œé¡ºåºå»ºè®®

```bash
é˜¶æ®µ1: åŸºç¡€åŠŸèƒ½æµ‹è¯•ï¼ˆ30-60åˆ†é’Ÿï¼‰
  â†’ åœºæ™¯1.1ï¼ˆèŠå¤©åŸºç¡€ï¼‰
  â†’ åœºæ™¯3.1ï¼ˆè®°å¿†åŸºç¡€ï¼‰
  â†’ åœºæ™¯4.1ï¼ˆSkillsåŸºç¡€ï¼‰

é˜¶æ®µ2: é›†æˆæµ‹è¯•ï¼ˆ60-120åˆ†é’Ÿï¼‰
  â†’ åœºæ™¯1.2ï¼ˆå¤šè½®å¯¹è¯ï¼‰
  â†’ åœºæ™¯2.1ï¼ˆèŠ‚ç‚¹ç®¡ç†ï¼‰
  â†’ åœºæ™¯4.2ï¼ˆåå¥½è¡¥å…¨ï¼‰
  â†’ åœºæ™¯5.1ï¼ˆåå°é…ç½®ï¼‰

é˜¶æ®µ3: æ•…éšœæ¢å¤æµ‹è¯•ï¼ˆ30-60åˆ†é’Ÿï¼‰
  â†’ åœºæ™¯2.2ï¼ˆä»»åŠ¡è°ƒåº¦+æ•…éšœè½¬ç§»ï¼‰
  â†’ åœºæ™¯2.3ï¼ˆLLMä»£ç†+ä¸­æ–­ï¼‰
  â†’ åœºæ™¯3.4ï¼ˆRAGå®¹é”™ï¼‰
  â†’ åœºæ™¯4.3ï¼ˆå®‰å…¨å®¡è®¡ï¼‰

é˜¶æ®µ4: æ€§èƒ½ä¸å‹åŠ›æµ‹è¯•ï¼ˆ30-60åˆ†é’Ÿï¼‰
  â†’ æ‰¹é‡è¯·æ±‚ï¼ˆ100+ï¼‰
  â†’ èŠ‚ç‚¹å¹¶å‘ï¼ˆ10èŠ‚ç‚¹ï¼‰
  â†’ å†…å­˜æ³„æ¼æ£€æŸ¥
```

### è‡ªåŠ¨åŒ–æµ‹è¯•å»ºè®®

**å¯è‡ªåŠ¨åŒ–åœºæ™¯**ï¼ˆå•å…ƒ/é›†æˆæµ‹è¯•ï¼‰:

```typescript
// ç¤ºä¾‹: åœºæ™¯1.1 - èŠå¤©åŸºç¡€æµç¨‹
describe('åœºæ™¯1.1: æ—¥å¸¸å¯¹è¯å®Œæ•´æµç¨‹', () => {
  it('åº”è¯¥è¿”å›åŒ…å«äººæ ¼ç‰¹å¾çš„å“åº”', async () => {
    const response = await request(app)
      .post('/api/chat')
      .send({ message: 'ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ä¸‰', userId: 'test-user-123' });

    expect(response.status).toBe(200);
    expect(response.body.personality.name).toBeDefined();
    expect(response.body.emotion).toBe('NEUTRAL');
  });

  it('åº”è¯¥å­˜å‚¨è®°å¿†åˆ°RAG', async () => {
    await request(app)
      .post('/api/chat')
      .send({ message: 'ä»Šå¤©å¾ˆå¼€å¿ƒ', userId: 'test-user-123' });

    const memories = await ragService.search({
      query: 'å¾ˆå¼€å¿ƒ',
      userId: 'test-user-123'
    });

    expect(memories.length).toBeGreaterThan(0);
    expect(memories[0].metadata.userId).toBe('test-user-123');
  });
});
```

**éœ€äººå·¥æµ‹è¯•åœºæ™¯**:
- UI/UXäº¤äº’ï¼ˆç®¡ç†åå°è§†è§‰éªŒè¯ï¼‰
- æµå¼å“åº”ä½“éªŒï¼ˆæ„Ÿå—å“åº”æµç•…åº¦ï¼‰
- WebSocketå®æ—¶æ›´æ–°
- å¤æ‚æ•…éšœåœºæ™¯

### æµ‹è¯•æ•°æ®å‡†å¤‡

åœ¨ `tests/data/` ç›®å½•å‡†å¤‡æµ‹è¯•æ•°æ®ï¼š

```bash
tests/data/
â”œâ”€â”€ personalities/
â”‚   â””â”€â”€ test-assistant.json      # æµ‹è¯•äººæ ¼é…ç½®
â”œâ”€â”€ nodes/
â”‚   â””â”€â”€ test-nodes.json          # æµ‹è¯•èŠ‚ç‚¹é…ç½®
â”œâ”€â”€ preferences/
â”‚   â””â”€â”€ test-user-preferences.json # ç”¨æˆ·åå¥½
â””â”€â”€ skills/
    â””â”€â”€ TestMemorySkill/
        â””â”€â”€ SKILL.md             # æµ‹è¯•Skill
```

**äººæ ¼é…ç½®ç¤ºä¾‹**: `tests/data/personalities/test-assistant.json`
```json
{
  "identity": {
    "name": "å°æµ‹è¯•åŠ©æ‰‹",
    "avatar": "ğŸ§ª",
    "role": "æµ‹è¯•åŠ©æ‰‹",
    "background": "ä¸€ä¸ªä¸“ä¸šçš„æµ‹è¯•AIåŠ©æ‰‹"
  },
  "traits": {
    "core": ["ä¸¥è°¨", "ç»†è‡´", "è€å¿ƒ"],
    "interests": ["è½¯ä»¶æµ‹è¯•", "è´¨é‡ä¿è¯"],
    "values": ["å‡†ç¡®æ€§", "å¯é æ€§"]
  },
  "style": {
    "tone": "ä¸“ä¸šä½†å‹å¥½",
    "address": "æ‚¨",
    "emojiUsage": "moderate"
  }
}
```

---

## ğŸ“ˆ æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

| æ¨¡å— | è¦†ç›–ç‡ç›®æ ‡ | å·²è¦†ç›– | çŠ¶æ€ |
|-----|-----------|--------|------|
| æ ¸å¿ƒå¼•æ“ | 95% | - | ğŸ“ å¾…æ‰§è¡Œ |
| APIæ¥å£ | 90% | - | ğŸ“ å¾…æ‰§è¡Œ |
| Services | 92% | - | ğŸ“ å¾…æ‰§è¡Œ |
| Skillsä½“ç³» | 98% | - | ğŸ“ å¾…æ‰§è¡Œ |
| èŠ‚ç‚¹ç®¡ç† | 90% | - | ğŸ“ å¾…æ‰§è¡Œ |
| è®°å¿†ç³»ç»Ÿ | 95% | - | ğŸ“ å¾…æ‰§è¡Œ |
| ç®¡ç†åå° | 88% | - | ğŸ“ å¾…æ‰§è¡Œ |
| **æ€»ä½“** | **93%** | - | ğŸ“ å¾…æ‰§è¡Œ |

---

## âœ… æµ‹è¯•å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰21ä¸ªä¸»åœºæ™¯æ‰§è¡Œå®Œæˆ
- [ ] æµ‹è¯•æ•°æ®å‡†å¤‡é½å…¨
- [ ] æµ‹è¯•ç¯å¢ƒæ­å»ºå®Œæˆï¼ˆLLMã€RAGã€WebSocketï¼‰
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•é€šè¿‡
- [ ] å®‰å…¨æµ‹è¯•é€šè¿‡ï¼ˆæ³¨å…¥ã€XSSã€è¶Šæƒï¼‰
- [ ] æ•…éšœæ¢å¤æµ‹è¯•é€šè¿‡
- [ ] ç®¡ç†åå°æ‰€æœ‰åŠŸèƒ½éªŒè¯
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ
- [ ] æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
- [ ] ç¼ºé™·ä¿®å¤å¹¶å›å½’æµ‹è¯•

---

## ğŸ› å·²çŸ¥é—®é¢˜ä¸æ³¨æ„äº‹é¡¹

### 1. WebSocketè¿æ¥ç¨³å®šæ€§
- **é—®é¢˜**: ç½‘ç»œä¸ç¨³å®šæ—¶WebSocketå¯èƒ½æ–­å¼€
- **åº”å¯¹**: å·²å®ç°è‡ªåŠ¨é‡è¿ï¼Œé‡è¯•é—´éš”æŒ‡æ•°é€€é¿
- **éªŒè¯ç‚¹**: åœºæ™¯2.1æ­¥éª¤6

### 2. RAGæœåŠ¡å¯åŠ¨æ—¶é—´
- **é—®é¢˜**: é¦–æ¬¡å¯åŠ¨RAGæœåŠ¡éœ€åŠ è½½å‘é‡ç´¢å¼•ï¼Œè€—æ—¶10-30ç§’
- **åº”å¯¹**: æ˜¾ç¤ºloadingçŠ¶æ€ï¼Œä¸é˜»å¡å…¶ä»–åŠŸèƒ½
- **éªŒè¯ç‚¹**: åœºæ™¯3.1æ­¥éª¤1

### 3. LLMæä¾›å•†é…é¢
- **é—®é¢˜**: å…è´¹é¢åº¦æœ‰é™ï¼Œæµ‹è¯•æ—¶éœ€æ§åˆ¶è¯·æ±‚é‡
- **åº”å¯¹**: ä½¿ç”¨mockæˆ–Ollamaæœ¬åœ°æ¨¡å‹
- **å»ºè®®**: å‡†å¤‡æµ‹è¯•ä¸“ç”¨API Key

### 4. å†…å­˜ä½¿ç”¨
- **é—®é¢˜**: é•¿å¯¹è¯ä¸Šä¸‹æ–‡å¯èƒ½å ç”¨å¤§é‡å†…å­˜
- **åº”å¯¹**: é™åˆ¶contexté•¿åº¦ï¼ˆmaxTokensï¼‰ï¼Œå®šæœŸæ¸…ç†
- **ç›‘æ§**: åœºæ™¯1.2æ­¥éª¤8

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ApexBridge æ¶æ„æ–‡æ¡£](../README.md)
- [æ ¸å¿ƒå¼•æ“è¯¦è§£](../src/core/README.md)
- [Serviceså±‚æ–‡æ¡£](../src/services/README.md)
- [APIæ¥å£æ–‡æ¡£](../src/api/README.md)
- [ç®¡ç†åå°æ–‡æ¡£](../admin/README.md)

---

## ğŸ“ ä¿®è®¢å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®è®¢å†…å®¹ | ä¿®è®¢äºº |
|-----|------|---------|--------|
| 1.0 | 2025-11-17 | åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«21ä¸ªæµ‹è¯•åœºæ™¯ | æµ®æµ®é…± |

---

**æ–‡æ¡£ç»´æŠ¤**: æµ®æµ®é…± ğŸ¤–
**æœ€åæ›´æ–°**: 2025-11-17
**ä¸‹ä¸€ç‰ˆæœ¬è®¡åˆ’**: æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœå’Œè‡ªåŠ¨åŒ–è„šæœ¬
