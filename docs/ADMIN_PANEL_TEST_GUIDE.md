# Web管理后台测试指南

## 测试前准备

### 1. 确认构建状态
- 后端已编译：`npm run build` 在 `apex-bridge/` 目录下
- 前端已构建：`npm run build` 在 `apex-bridge/admin/` 目录下

### 2. 配置文件
- 首次启动：系统会自动创建 `config/admin-config.json`（如果不存在）
- 已有配置：确保 `config/admin-config.json` 格式正确

### 3. 启动服务器
```bash
# 在 apex-bridge 目录下
npm start
# 或开发模式
npm run dev
```

服务器默认运行在：`http://localhost:8088`

## 测试步骤

### 阶段1：首次启动测试

1. **启动服务器**
   - 启动后端服务器
   - 检查日志，确认配置加载成功
   - 检查是否创建了 `config/admin-config.json`

2. **访问管理界面**
   - 打开浏览器访问：`http://localhost:8088/admin`
   - **预期**：应自动重定向到 `/admin/setup`（设置向导页面）

3. **测试设置向导**
   - **步骤1 - 管理员账户**：
     - 输入用户名（至少3个字符）
     - 输入密码（至少6个字符）
     - 确认密码
     - 如果存在.env文件，测试"从.env导入"功能
   - **步骤2 - LLM配置**：
     - 选择默认LLM提供商（如OpenAI）
     - 输入API Key
     - 配置Base URL和默认模型
   - **步骤3 - 可选功能**：
     - 选择是否启用RAG
     - 如果启用，配置RAG相关参数
   - **步骤4 - 完成设置**：
     - 查看配置摘要
     - 点击"完成设置"
     - **预期**：保存配置并跳转到登录页

### 阶段2：登录测试

1. **访问登录页**
   - 应该自动跳转到 `/admin/login`
   - 或手动访问：`http://localhost:8088/admin/login`

2. **测试登录**
   - 输入设置向导中创建的管理员用户名和密码
   - 点击"登录"
   - **预期**：登录成功，跳转到Dashboard

3. **测试登录失败**
   - 输入错误的用户名或密码
   - **预期**：显示错误提示，不跳转

### 阶段3：Dashboard测试

1. **查看Dashboard**
   - 访问 `/admin/dashboard`
   - **预期**：显示系统状态卡片和统计信息

2. **检查系统状态**
   - 服务器运行状态（应显示"运行中"）
   - 在线节点数
   - 总节点数
   - 今日请求数
   - 总对话数

### 阶段4：配置管理测试

1. **访问配置管理页面**
   - 点击侧边栏"配置管理"
   - 或访问 `/admin/settings`

2. **测试配置读取**
   - 页面应自动加载当前配置
   - **预期**：显示所有配置项的值

3. **测试配置修改**
   - **系统参数**：
     - 修改端口（注意：修改后需要重启）
     - 修改主机地址
     - 修改运行环境
     - 切换调试模式
   - **认证配置**：
     - 修改VCP Key
     - 添加/删除API Keys
   - **LLM配置**：
     - 修改默认提供商
     - 修改各提供商的API Key、Base URL、模型等
   - **RAG配置**：
     - 启用/禁用RAG
     - 修改存储路径
     - 修改Vectorizer配置

4. **测试配置保存**
   - 修改配置后点击"保存配置"
   - **预期**：
     - 系统参数修改：提示需要重启
     - 其他配置修改：提示保存成功
     - 配置已保存到 `config/admin-config.json`

5. **测试配置重置**
   - 点击"重置为默认"按钮
   - **预期**：配置恢复为默认值

### 阶段5：节点管理测试

1. **访问节点管理页面**
   - 点击侧边栏"节点管理"
   - 或访问 `/admin/nodes`

2. **测试节点列表**
   - **预期**：
     - 如果无节点：显示空状态提示
     - 如果有节点：显示节点表格
     - 节点状态每5秒自动刷新

3. **测试节点注册**
   - 点击"注册新节点"按钮
   - 填写节点信息：
     - 节点名称（必填）
     - 节点类型（worker/companion/custom）
     - 端点地址（可选）
     - 能力列表（可选）
   - 点击"注册"
   - **预期**：节点添加到列表，显示注册时间和状态

4. **测试节点编辑**
   - 点击节点行的"编辑"按钮
   - 修改节点信息
   - 点击"保存"
   - **预期**：节点信息更新

5. **测试节点删除**
   - 点击节点行的"删除"按钮
   - 确认删除
   - **预期**：节点从列表中移除

### 阶段6：路由和导航测试

1. **测试路由守卫**
   - 未登录状态下访问 `/admin/dashboard`
   - **预期**：自动重定向到 `/admin/login`

2. **测试首次启动重定向**
   - 删除 `config/admin-config.json`（或设置 `setup_completed: false`）
   - 访问 `/admin/dashboard`
   - **预期**：自动重定向到 `/admin/setup`

3. **测试侧边栏导航**
   - 点击各个导航项
   - **预期**：正确跳转到对应页面，当前路由高亮显示

4. **测试登出**
   - 点击顶部栏"登出"按钮
   - **预期**：清除登录状态，跳转到登录页

## 常见问题排查

### 问题1：无法访问管理界面
- **检查**：服务器是否正常启动
- **检查**：端口是否正确（默认8088）
- **检查**：`admin/dist` 目录是否存在且包含构建产物

### 问题2：配置读取失败
- **检查**：`config/admin-config.json` 是否存在
- **检查**：JSON格式是否正确
- **查看**：服务器日志中的错误信息

### 问题3：设置向导无法完成
- **检查**：所有必填项是否已填写
- **检查**：密码是否符合要求（至少6个字符）
- **查看**：浏览器控制台的错误信息

### 问题4：登录失败
- **检查**：设置向导中创建的管理员账户信息
- **检查**：`config/admin-config.json` 中的 `auth.admin` 配置
- **查看**：服务器日志中的认证日志

### 问题5：配置保存后不生效
- **系统参数**：需要重启服务器
- **其他配置**：部分配置支持热更新，部分需要重启
- **检查**：`config/admin-config.json` 是否已更新

## 测试检查清单

- [ ] 首次启动：自动创建配置文件
- [ ] 设置向导：4个步骤都能正常完成
- [ ] .env导入：能够从.env文件导入配置（如果存在）
- [ ] 登录功能：能够成功登录和登出
- [ ] 路由守卫：未登录时正确重定向
- [ ] Dashboard：显示系统状态和统计信息
- [ ] 配置管理：能够读取、修改、保存配置
- [ ] 配置重置：能够重置为默认配置
- [ ] 节点管理：能够注册、编辑、删除节点
- [ ] 节点状态：能够实时更新节点状态
- [ ] 侧边栏导航：所有导航项正常工作
- [ ] UI风格：符合Anthropic设计风格（简洁、现代、留白充足）

## 性能测试（可选）

1. **配置保存响应时间**
   - 目标：< 1秒

2. **节点列表刷新时间**
   - 目标：< 500ms

3. **页面加载时间**
   - 目标：首次加载 < 2秒

## 下一步

测试完成后，如果发现问题，请记录：
1. 问题描述
2. 复现步骤
3. 预期行为
4. 实际行为
5. 错误日志或截图

然后我们可以根据问题逐一修复。

