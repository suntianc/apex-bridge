# ApexBridge ACE æ¶æ„ä¸ EiC èåˆå¯è¡Œæ€§åˆ†ææŠ¥å‘Š

## ğŸ“‘ æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘ŠåŸºäºå¯¹ ApexBridge **ä¸ªäººé¡¹ç›®**å½“å‰æ¶æ„çš„æ·±åº¦åˆ†æï¼Œç»“åˆã€ŠEverything is Context ä¸ ACE æ¡†æ¶çš„æ·±åº¦æ¶æ„åˆ†æä¸èåˆç ”ç©¶ã€‹çš„ç†è®ºç ”ç©¶ï¼Œæå‡ºäº†ä¸€æ¡é€‚åˆ**å•äºº/å°å›¢é˜Ÿå¼€å‘**çš„æŠ€æœ¯æ¼”è¿›è·¯å¾„ã€‚ApexBridge å·²å…·å¤‡ **ACE æ¡†æ¶çš„åŸºç¡€å®ç°**ï¼ˆL1-L6 å±‚çš„åŸå‹ç»“æ„ï¼‰ï¼Œä½†ç¼ºå°‘ **EiC çš„æ–‡ä»¶ç³»ç»ŸæŠ½è±¡**ã€**Playbook è®°å¿†ç³»ç»Ÿ**å’Œ**æ ‡å‡†åŒ–ä¸Šä¸‹æ–‡ç®¡ç†**ã€‚æœ¬æŠ¥å‘Šè¯„ä¼°äº†èåˆå¯è¡Œæ€§å¹¶æä¾›äº†**å¾ªåºæ¸è¿›ã€å¯æš‚åœ**çš„å®æ–½æ–¹æ¡ˆã€‚

### æ ¸å¿ƒç»“è®º

| ç»´åº¦ | è¯„ä¼°ç»“æœ | å¯è¡Œæ€§ |
|------|---------|-------|
| **æ¶æ„å…¼å®¹æ€§** | ApexBridge é‡‡ç”¨åˆ†å±‚æœåŠ¡æ¶æ„ï¼Œä¸ ACE å…­å±‚æ¨¡å‹å…·æœ‰å¤©ç„¶æ˜ å°„å…³ç³» | â­â­â­â­â­ 95% |
| **æŠ€æœ¯æ ˆåŒ¹é…åº¦** | TypeScript + Node.js ç”Ÿæ€å®Œæ•´ï¼Œå·²é›†æˆ LanceDB/SQLiteï¼Œæ”¯æŒå‘é‡å­˜å‚¨ | â­â­â­â­â­ 92% |
| **ä¸ªäººå¼€å‘å‹å¥½åº¦** | æ¨¡å—åŒ–è®¾è®¡ï¼Œå¯æŒ‰éœ€å®ç°ï¼Œæ— éœ€å®Œæ•´å›¢é˜Ÿå³å¯æ¨è¿› | â­â­â­â­â­ 90% |
| **EiC å¼•å…¥æˆæœ¬** | éœ€è¦æ„å»º AFS è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿå±‚ï¼Œä½†å¯å¤ç”¨ç°æœ‰ ProtocolEngine å’Œ SkillManager | â­â­â­â­ 78% |
| **Playbook å®æ–½æˆæœ¬** | éœ€è¦è®¾è®¡åæ€å¾ªç¯å’Œç»éªŒæç‚¼æœºåˆ¶ï¼Œå¯ä»ç®€åŒ–ç‰ˆå¼€å§‹ | â­â­â­ 70% |
| **å·¥ç¨‹å®æ–½å¤æ‚åº¦** | å¯çµæ´»åˆ†é…åˆ° 2-6 ä¸ªæœˆï¼ˆå–å†³äºä¸ªäººæ—¶é—´æŠ•å…¥ï¼‰ï¼Œæ”¯æŒæŒ‰æ¨¡å—æ¸è¿› | â­â­â­â­ 80% |

**å…³é”®å‘ç°**ï¼šApexBridge å·²ç»åœ¨ä¸è‡ªçŸ¥çš„æƒ…å†µä¸‹å®ç°äº† ACE æ¡†æ¶çš„å¤šä¸ªæ ¸å¿ƒæ¦‚å¿µï¼ˆå±‚çº§åŒ–ã€åæ€æœºåˆ¶ã€è½¨è¿¹è®°å½•ï¼‰ï¼Œè¿™ä½¿å¾—æ·±åŒ– ACE é›†æˆçš„æˆæœ¬è¿œä½äºä»é›¶æ„å»ºã€‚å¼•å…¥ EiC çš„ AFS å°†ä¸ºç³»ç»Ÿå¸¦æ¥**å­¦ä¹ èƒ½åŠ›å¢å¼º**ã€**è°ƒè¯•ä½“éªŒæå‡**å’Œ**å¯ç©æ€§æ‰©å±•**ä¸‰å¤§æ ¸å¿ƒä»·å€¼ã€‚å¯¹äºä¸ªäººé¡¹ç›®è€Œè¨€ï¼Œ**Playbook æœºåˆ¶**æ˜¯å®ç°"æ™ºèƒ½ä½“è‡ªæˆ‘è¿›åŒ–"çš„å…³é”®çªç ´å£ã€‚

---

## ğŸ“Š ç¬¬ä¸€éƒ¨åˆ†ï¼šApexBridge å½“å‰æ¶æ„æ·±åº¦åˆ†æ

### 1.1 æ¶æ„å…¨æ™¯æ¦‚è§ˆ

ApexBridge é‡‡ç”¨**äº”å±‚æœåŠ¡æ¶æ„**ï¼Œè‡ªåº•å‘ä¸Šä¸ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Layer (REST + WebSocket)                           â”‚
â”‚  controllers/ + websocket/ + middleware/                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Strategy Layer (ç­–ç•¥æ¨¡å¼)                               â”‚
â”‚  ReActStrategy | SingleRoundStrategy                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service Layer (ä¸šåŠ¡ç¼–æ’)                                â”‚
â”‚  ChatService | SessionManager | SkillManager            â”‚
â”‚  RequestTracker | AceService                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Core Engine Layer (æ ¸å¿ƒå¼•æ“)                            â”‚
â”‚  ProtocolEngine | LLMManager | ReActEngine              â”‚
â”‚  VariableEngine | ToolDispatcher                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Data Layer (æŒä¹…åŒ–)                                     â”‚
â”‚  SQLite (LLMé…ç½®/ä¼šè¯) | LanceDB (å‘é‡ç´¢å¼•/æŠ€èƒ½æ£€ç´¢)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®æ¶æ„ç‰¹å¾**ï¼š
1. **æ¸…æ™°çš„å±‚çº§è¾¹ç•Œ**ï¼šæ¯å±‚é€šè¿‡æ¥å£å¥‘çº¦é€šä¿¡ï¼Œç¬¦åˆ ACE çš„å±‚çº§å°è£…ç†å¿µ
2. **ç­–ç•¥æ¨¡å¼**ï¼šReActStrategy å®ç°å¤šè½®æ€è€ƒï¼ŒSingleRoundStrategy å®ç°å¿«é€Ÿå“åº”
3. **äº‹ä»¶é©±åŠ¨**ï¼šWebSocket å®æ—¶æ¨é€ + RequestTracker ä¸­æ–­ç®¡ç†
4. **æ··åˆå­˜å‚¨**ï¼šç»“æ„åŒ–æ•°æ®ï¼ˆSQLiteï¼‰+ å‘é‡æ•°æ®ï¼ˆLanceDBï¼‰

### 1.2 ACE æ¡†æ¶æ˜ å°„åˆ†æ

#### 1.2.1 å·²å®ç°çš„ ACE ç»„ä»¶

| ACE å±‚çº§ | ApexBridge å¯¹åº”å®ç° | å®Œæˆåº¦ | è¯æ®æ–‡ä»¶ |
|---------|-------------------|-------|---------|
| **L1: Aspirational Layer** | `AceCore` çš„ä¼¦ç†åæ€è§¦å‘å™¨ | ğŸŸ¡ 40% | [AceCore.ts:459-471](src/core/ace/AceCore.ts:459-471) |
| **L2: Global Strategy** | `AceStrategyManager` (è§„åˆ’ä¸­) | ğŸŸ¡ 30% | [ACE-L2-L3-Integration.ts:42-45](src/services/ACE-L2-L3-Integration.ts:42-45) |
| **L3: Agent Model** | `AceCapabilityManager` + `SkillManager` | ğŸŸ¢ 70% | [SkillManager.ts](src/services/SkillManager.ts) |
| **L4: Executive Function** | `ChatService` ç­–ç•¥é€‰æ‹©é€»è¾‘ | ğŸŸ¢ 75% | [strategies/ChatStrategy.ts](src/strategies/ChatStrategy.ts) |
| **L5: Cognitive Control** | `ReActEngine` è¿­ä»£æ§åˆ¶ | ğŸŸ¢ 85% | [ReActEngine.ts:67-103](src/core/stream-orchestrator/ReActEngine.ts:67-103) |
| **L6: Task Prosecution** | `ToolDispatcher` + `SkillExecutor` | ğŸŸ¢ 90% | [ToolDispatcher.ts](src/core/tool-action/ToolDispatcher.ts) |

**ğŸ¯ å…³é”®å‘ç°**ï¼š
- **L5-L6 å±‚å·²æˆç†Ÿ**ï¼šå·¥å…·æ‰§è¡Œå’Œä»»åŠ¡æ§åˆ¶è¾¾åˆ°ç”Ÿäº§çº§åˆ«ï¼ˆ85-90% å®Œæˆåº¦ï¼‰
- **L3-L4 å±‚å¯ç”¨**ï¼šæŠ€èƒ½ç®¡ç†å’Œç­–ç•¥ç¼–æ’å·²å…·é›å½¢ï¼ˆ70-75% å®Œæˆåº¦ï¼‰
- **L1-L2 å±‚ç¼ºå¤±**ï¼šä¼¦ç†å±‚å’Œæˆ˜ç•¥å±‚å¤„äºè®¾è®¡é˜¶æ®µï¼ˆ30-40% å®Œæˆåº¦ï¼‰

#### 1.2.2 ACE åŒå‘æ€»çº¿å®ç°

```typescript
// src/core/ace/AceCore.ts
export class AceCore {
  public readonly bus = {
    northbound: new EventEmitter(),  // å‘ä¸Šä¼ é€’æ„ŸçŸ¥æ•°æ®
    southbound: new EventEmitter()   // å‘ä¸‹ä¼ é€’æ§åˆ¶æŒ‡ä»¤
  };
}
```

**è¯„ä¼°**ï¼š
- âœ… å·²å®ç°åŸºäº EventEmitter çš„åŒå‘æ€»çº¿
- âœ… æ”¯æŒä¼šè¯åˆ›å»ºã€æ´»åŠ¨æ›´æ–°ã€è½¨è¿¹ä¿å­˜ç­‰äº‹ä»¶
- âŒ ç¼ºå°‘å±‚é—´æ¶ˆæ¯æ ¼å¼æ ‡å‡†åŒ–ï¼ˆå½“å‰ä¸ºæ¾æ•£çš„ JSON å¯¹è±¡ï¼‰
- âŒ ç¼ºå°‘æ¶ˆæ¯æŒä¹…åŒ–æœºåˆ¶ï¼ˆé‡å¯åæ€»çº¿çŠ¶æ€ä¸¢å¤±ï¼‰

### 1.3 Skills ç³»ç»Ÿæ¶æ„åˆ†æ

#### 1.3.1 Skills æ–‡ä»¶ç»“æ„

```
.data/skills/{skill-name}/
â”œâ”€â”€ SKILL.md              # å…ƒæ•°æ® (Frontmatter + æ–‡æ¡£)
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ execute.ts        # æ‰§è¡Œå…¥å£
â””â”€â”€ .vectorized           # å‘é‡åŒ–çŠ¶æ€æ ‡è®°
```

**æ ¸å¿ƒç‰¹æ€§**ï¼š
1. **å£°æ˜å¼é…ç½®**ï¼šé€šè¿‡ YAML Frontmatter å®šä¹‰å·¥å…·ç­¾å
2. **è½»é‡çº§è®¾è®¡**ï¼šæ— å¤æ‚æ’ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œä»…ä¾èµ–æ–‡ä»¶ç³»ç»Ÿ
3. **å‘é‡æ£€ç´¢**ï¼šé€šè¿‡ LanceDB å®ç°è¯­ä¹‰æœç´¢ï¼ˆcosine similarityï¼‰

#### 1.3.2 ä¸ EiC çš„å¯¹é½æ½œåŠ›

| EiC æ¦‚å¿µ | ApexBridge ç°çŠ¶ | å·®è· |
|---------|----------------|------|
| **`/modules/` å·¥å…·æŒ‚è½½ç‚¹** | Skills å­˜å‚¨åœ¨ `.data/skills/` | âš ï¸ éœ€è¦è™šæ‹ŸåŒ–ä¸ºæ–‡ä»¶ç³»ç»Ÿè·¯å¾„ |
| **`/context/memory/` è®°å¿†å­˜å‚¨** | SQLite `conversation_history` è¡¨ | âš ï¸ éœ€è¦åˆ†ç±»ä¸º episodic/fact/procedural |
| **`/context/history/` æ—¥å¿—æµ** | æ— æ˜¾å¼å®ç° | âŒ éœ€è¦å¢åŠ ä¸å¯å˜æ—¥å¿—ç³»ç»Ÿ |
| **`/context/pad/` ä¸´æ—¶å·¥ä½œåŒº** | `AceCore.scratchpads` (å†…å­˜ Map) | ğŸŸ¡ å·²æœ‰åŸå‹ï¼Œéœ€è¦æŒä¹…åŒ– |
| **`/context/playbooks/` ç»éªŒåº“** | **å®Œå…¨ç¼ºå¤±** | âŒ **éœ€è¦ä»é›¶æ„å»ºï¼ˆæœ¬æŠ¥å‘Šé‡ç‚¹ï¼‰** |

**ç»“è®º**ï¼šSkills ç³»ç»Ÿå·²å…·å¤‡ `/modules/` æŒ‚è½½ç‚¹çš„**é€»è¾‘ç»“æ„**ï¼Œä½†ç¼ºå°‘**æ–‡ä»¶ç³»ç»ŸæŠ½è±¡å±‚**ï¼ˆAFSï¼‰ä½¿å…¶æ ‡å‡†åŒ–ã€‚æ›´å…³é”®çš„æ˜¯ï¼Œ**ç¼ºå°‘ Playbook æœºåˆ¶**æ¥å°†ç»éªŒè½¬åŒ–ä¸ºå¯å¤ç”¨çš„çŸ¥è¯†ã€‚

### 1.4 Trajectoryï¼ˆè½¨è¿¹ï¼‰ç³»ç»Ÿç°çŠ¶åˆ†æ

#### 1.4.1 å½“å‰å®ç°

```typescript
// src/core/ace/AceCore.ts
export interface Trajectory {
  task_id: string;
  session_id?: string;
  user_input: string;
  steps: TrajectoryStep[];          // âœ… å·²è®°å½•æ¨ç†æ­¥éª¤
  final_result: string;             // âœ… å·²è®°å½•æœ€ç»ˆç»“æœ
  outcome: 'SUCCESS' | 'FAILURE';   // âœ… å·²è®°å½•æˆåŠŸ/å¤±è´¥
  environment_feedback: string;     // âœ… å·²è®°å½•ç¯å¢ƒåé¦ˆ
  used_rule_ids: string[];          // âš ï¸ é¢„ç•™ä½†æœªä½¿ç”¨
  timestamp: number;
  duration_ms: number;
  evolution_status: 'PENDING' | 'COMPLETED' | 'FAILED';  // âš ï¸ é¢„ç•™ä½†æœªå¤„ç†
}
```

**é—®é¢˜è¯Šæ–­**ï¼š
- âœ… **Trajectory æ•°æ®ç»“æ„å®Œæ•´**ï¼šå·²å…·å¤‡è®°å½•æ¨ç†è¿‡ç¨‹çš„æ‰€æœ‰å­—æ®µ
- âŒ **ç¼ºå°‘ Evolution å¤„ç†é€»è¾‘**ï¼š`evolution_status` å­—æ®µå­˜åœ¨ä½†ä»æœªæ›´æ–°
- âŒ **ç¼ºå°‘ä» Trajectory åˆ° Playbook çš„è½¬æ¢**ï¼šæ— æ³•å°†ç»éªŒæç‚¼ä¸ºå¯å¤ç”¨çŸ¥è¯†

#### 1.4.2 ä¸ Playbook çš„é¸¿æ²Ÿ

```
å½“å‰çŠ¶æ€ï¼š
Trajectory (è½¨è¿¹) â†’ [å­˜å‚¨åˆ° SQLite] â†’ [å®šæœŸæ¸…ç†] â†’ [ä¸¢å¤±]
                        â†“
                   å†å²æ—¥å¿—æŸ¥è¯¢ï¼ˆåªèƒ½å›çœ‹ï¼Œæ— æ³•å­¦ä¹ ï¼‰

ç›®æ ‡çŠ¶æ€ï¼ˆå¼•å…¥ Playbookï¼‰ï¼š
Trajectory â†’ [åæ€å¾ªç¯] â†’ Playbook (ç»éªŒ) â†’ [å‘é‡åŒ–] â†’ [æ£€ç´¢å¤ç”¨]
                â†“              â†“                â†“
         Generator      Reflector          Curator
        (ç”Ÿæˆå™¨)       (åæ€å™¨)           (ç­–å±•å™¨)
```

---

## ğŸ“ ç¬¬äºŒéƒ¨åˆ†ï¼šPlaybook æœºåˆ¶æ·±åº¦è§£æ

### 2.0 å½“å‰å®ç°çŠ¶æ€è¯„ä¼°

#### 2.0.1 Generator-Reflector-Curator ä¸‰æ™ºèƒ½ä½“å®ç°ç°çŠ¶

**æ ¸å¿ƒç»“è®º**ï¼šâŒ **ä¸‰ä¸ªæ™ºèƒ½ä½“ï¼ˆGeneratorã€Reflectorã€Curatorï¼‰å¹¶æœªå®Œæ•´å®ç°**

å½“å‰é¡¹ç›®åªæœ‰**éƒ¨åˆ†åŠŸèƒ½çš„ç®€åŒ–å®ç°**ï¼Œåˆ†æ•£åœ¨ä¸¤ä¸ªæ ¸å¿ƒæ–‡ä»¶ä¸­ï¼š

##### A. PlaybookManager.ts - éƒ¨åˆ† Generator åŠŸèƒ½

**ä½ç½®**ï¼š[src/services/PlaybookManager.ts](src/services/PlaybookManager.ts) (541 è¡Œ)

**å·²å®ç°åŠŸèƒ½**ï¼š
- âœ… `extractPlaybookFromLearning()` - ä»å•ä¸ª StrategicLearning æå– Playbook
- âœ… `createPlaybook()` - åˆ›å»ºå’ŒæŒä¹…åŒ– Playbook
- âœ… `optimizePlaybook()` - åŸºäºæŒ‡æ ‡çš„ä¼˜åŒ–å»ºè®®ç”Ÿæˆ
- âœ… Playbook å­˜å‚¨åˆ° LanceDB å‘é‡æ•°æ®åº“

**å®ç°ä»£ç ç¤ºä¾‹**ï¼š
```typescript
// PlaybookManager.ts:204-243
async extractPlaybookFromLearning(
  learning: StrategicLearning,
  context?: string
): Promise<StrategicPlaybook | null> {
  // é˜²æ­¢é‡å¤æç‚¼
  if (this.activeExtractions.has(learning.id)) {
    return null;
  }

  this.activeExtractions.add(learning.id);

  try {
    // ä½¿ç”¨LLMåˆ†æå­¦ä¹ å†…å®¹ï¼Œæç‚¼å¯å¤ç”¨çš„æ¨¡å¼
    const prompt = this.buildExtractionPrompt(learning, context);

    const response = await this.llmManager.chat([
      { role: 'user', content: prompt }
    ], { stream: false });

    const content = (response.choices[0]?.message?.content as string) || '';
    const extracted = this.parsePlaybookFromLLMResponse(content, learning);

    if (extracted) {
      const playbook = await this.createPlaybook(extracted);
      return playbook;
    }
    return null;
  } finally {
    this.activeExtractions.delete(learning.id);
  }
}
```

**å·®è·åˆ†æ**ï¼š
| ç†è®ºè®¾è®¡ | å½“å‰å®ç° | ç¼ºå¤±åŠŸèƒ½ |
|---------|---------|---------|
| æ‰¹é‡èšç±»æå– | å•ä¸ª learning é€ä¸ªå¤„ç† | âŒ æ—  Trajectory èšç±»ç®—æ³• |
| ä¸»åŠ¨è§¦å‘æœºåˆ¶ | éœ€æ‰‹åŠ¨è°ƒç”¨ | âŒ æ— å®šæ—¶åæ€å¾ªç¯ |
| è¯†åˆ«æˆåŠŸè·¯å¾„å…±æ€§ | ä¾èµ– LLM å•æ¬¡åˆ†æ | âŒ æ— å¤šæ¡ˆä¾‹å¯¹æ¯”åˆ†æ |

##### B. PlaybookMatcher.ts - éƒ¨åˆ† Curator åŠŸèƒ½

**ä½ç½®**ï¼š[src/services/PlaybookMatcher.ts](src/services/PlaybookMatcher.ts) (568 è¡Œ)

**å·²å®ç°åŠŸèƒ½**ï¼š
- âœ… `matchPlaybooks()` - åŸºäºä¸Šä¸‹æ–‡çš„è¯­ä¹‰åŒ¹é…
- âœ… `findSimilarPlaybooks()` - ç›¸ä¼¼ Playbook æ£€ç´¢
- âœ… å¤±è´¥è¡ç”Ÿ Playbook ç‰¹æ®Šå¤„ç†ï¼ˆé£é™©è§„é¿å‹ï¼‰
- âœ… å½’æ¡£çŠ¶æ€ Playbook çš„æƒé‡é™çº§ï¼ˆ0.7xï¼‰

**å®ç°ä»£ç ç¤ºä¾‹**ï¼š
```typescript
// PlaybookMatcher.ts:104-140
async findSimilarPlaybooks(
  playbookId: string,
  limit: number = 5
): Promise<PlaybookMatch[]> {
  const target = await this.getPlaybookById(playbookId);
  if (!target) return [];

  // æ„å»ºç›¸ä¼¼æ€§æŸ¥è¯¢
  const similarityQuery = `similar to ${target.name} ${target.type} ${target.context.domain}`;

  const candidates = await this.toolRetrievalService.findRelevantSkills(
    similarityQuery,
    limit * 2,
    0.6
  );

  const playbooks = candidates
    .map(r => this.parsePlaybookFromVector(r.tool))
    .filter((p): p is StrategicPlaybook => p !== null && p.id !== playbookId);

  const matches = await Promise.all(
    playbooks.map(pb => this.calculateSimilarityScore(pb, target))
  );

  return matches
    .sort((a, b) => b.matchScore - a.matchScore)
    .slice(0, limit);
}
```

**å·®è·åˆ†æ**ï¼š
| ç†è®ºè®¾è®¡ | å½“å‰å®ç° | ç¼ºå¤±åŠŸèƒ½ |
|---------|---------|---------|
| è‡ªåŠ¨å»é‡ä¸åˆå¹¶ | åªæ£€ç´¢ç›¸ä¼¼é¡¹ | âŒ æ— è‡ªåŠ¨åˆå¹¶é€»è¾‘ |
| çŸ¥è¯†å›¾è°±ç»´æŠ¤ | æ‰å¹³å‘é‡æ£€ç´¢ | âŒ æ— å…³ç³»å»ºæ¨¡ |
| è‡ªåŠ¨å½’æ¡£è§¦å‘ | æ‰‹åŠ¨æ ‡è®°çŠ¶æ€ | âŒ æ— å®šæ—¶æ¸…ç†ä»»åŠ¡ |

##### C. Reflector - å®Œå…¨ç¼ºå¤±

**çŠ¶æ€**ï¼šâŒ **ä¸å­˜åœ¨æ­¤ç»„ä»¶**

**ç†è®ºèŒè´£**ï¼š
- å¯¹æ¯”æˆåŠŸ/å¤±è´¥ Trajectory
- æå–åæ¨¡å¼ï¼ˆAnti-patternsï¼‰
- ç”Ÿæˆé£é™©è§„é¿å‹ Playbook

**å½“å‰æ›¿ä»£æ–¹æ¡ˆ**ï¼š
PlaybookManager ä¸­æœ‰ `optimizePlaybook()` æ–¹æ³•ï¼ˆ[lines 248-306](src/services/PlaybookManager.ts#L248-L306)ï¼‰ï¼Œä½†è¿™åªæ˜¯**åŸºäºå•ä¸ª Playbook æŒ‡æ ‡çš„å¯å‘å¼ä¼˜åŒ–**ï¼Œè€Œéè·¨æ¡ˆä¾‹çš„åæ€åˆ†æï¼š

```typescript
async optimizePlaybook(playbookId: string): Promise<PlaybookOptimization[]> {
  const playbook = await this.getPlaybook(playbookId);
  const optimizations: PlaybookOptimization[] = [];

  // ä»…åŸºäºæˆåŠŸç‡é˜ˆå€¼
  if (playbook.metrics.successRate < PlaybookManager.MIN_SUCCESS_RATE) {
    optimizations.push({
      type: 'trigger_refinement',
      suggestion: 'ä¼˜åŒ–è§¦å‘æ¡ä»¶ï¼Œæé«˜åŒ¹é…çš„å‡†ç¡®æ€§',
      // ...
    });
  }

  // ä»…åŸºäºä½¿ç”¨é¢‘ç‡
  const daysSinceLastUsed = (Date.now() - playbook.metrics.lastUsed) / (24 * 60 * 60 * 1000);
  if (daysSinceLastUsed > 30 && playbook.metrics.usageCount < 5) {
    optimizations.push({
      type: 'context_expansion',
      suggestion: 'æ‰©å±•åº”ç”¨åœºæ™¯ï¼Œå¢åŠ ä½¿ç”¨é¢‘ç‡',
      // ...
    });
  }

  return optimizations;
}
```

**ä¸ç†è®º Reflector çš„å·®è·**ï¼š
- âŒ æ— å¤±è´¥æ¡ˆä¾‹å¯¹æ¯”åˆ†æ
- âŒ æ— åæ¨¡å¼æå–èƒ½åŠ›
- âŒ æ— é£é™©è§„é¿ Playbook ç”Ÿæˆ
- âš ï¸ åªæœ‰åŸºäºå•ä¸€æŒ‡æ ‡çš„ç®€å•ä¼˜åŒ–å»ºè®®

#### 2.0.2 æ¶æ„å¯¹æ¯”æ€»ç»“è¡¨

| ç»„ä»¶ | ç†è®ºè®¾è®¡ï¼ˆæŠ¥å‘Šæè¿°ï¼‰ | å®é™…å®ç°ï¼ˆå½“å‰ä»£ç ï¼‰ | å®Œæˆåº¦ | å…³é”®ç¼ºå¤±åŠŸèƒ½ |
|------|-------------------|------------------|--------|-------------|
| **Generator** | ç‹¬ç«‹æ™ºèƒ½ä½“ï¼Œæ‰¹é‡èšç±»æå–æ¨¡å¼ | `PlaybookManager.extractPlaybookFromLearning()` | ğŸŸ¡ 40% | æ‰¹é‡å¤„ç†ã€ä¸»åŠ¨è§¦å‘ã€æ¨¡å¼èšç±»ç®—æ³• |
| **Reflector** | ç‹¬ç«‹æ™ºèƒ½ä½“ï¼ŒæˆåŠŸ/å¤±è´¥å¯¹æ¯”åˆ†æ | âŒ ä¸å­˜åœ¨ | ğŸ”´ 0% | å¤±è´¥æ¡ˆä¾‹åˆ†æã€åæ¨¡å¼æå–ã€é£é™©è§„é¿ Playbook |
| **Curator** | ç‹¬ç«‹æ™ºèƒ½ä½“ï¼ŒçŸ¥è¯†å›¾è°±ç®¡ç† | `PlaybookMatcher.findSimilarPlaybooks()` | ğŸŸ¡ 30% | è‡ªåŠ¨å»é‡åˆå¹¶ã€çŸ¥è¯†å›¾è°±ã€å®šæ—¶å½’æ¡£æ¸…ç† |

#### 2.0.3 å®æ–½å»ºè®®ï¼šä»ç®€åŒ–å®ç°åˆ°å®Œæ•´æ¶æ„

åŸºäºå½“å‰å®ç°çš„åŸºç¡€ï¼Œå»ºè®®é‡‡ç”¨**ä¸‰é˜¶æ®µæ¸è¿›å¼è¡¥å…¨**ï¼š

**ğŸ”´ Stage 1: è¡¥å…¨ Reflectorï¼ˆå‘¨æœ« 16 å°æ—¶ï¼‰**

åˆ›å»º `src/services/PlaybookReflector.ts`ï¼š

```typescript
export class PlaybookReflector {
  /**
   * å¯¹æ¯”æˆåŠŸ/å¤±è´¥ Trajectoryï¼Œæå–åæ¨¡å¼
   */
  async analyzeFailurePatterns(
    successTrajectories: Trajectory[],
    failureTrajectories: Trajectory[]
  ): Promise<StrategicPlaybook[]> {
    // 1. èšç±»å¤±è´¥æ¡ˆä¾‹çš„å…±æ€§
    const failureClusters = await this.clusterTrajectories(failureTrajectories);

    // 2. å¯¹æ¯”æˆåŠŸæ¡ˆä¾‹ï¼Œæ‰¾å‡ºå…³é”®å·®å¼‚
    const antiPatterns = await this.extractAntiPatterns(
      failureClusters,
      successTrajectories
    );

    // 3. ç”Ÿæˆé£é™©è§„é¿å‹ Playbook
    return antiPatterns.map(pattern => ({
      type: 'risk_avoidance',
      tags: ['failure-derived', 'risk-avoidance'],
      trigger: {
        type: 'pattern',
        condition: pattern.warningSignals
      },
      actions: pattern.avoidanceActions
    }));
  }
}
```

**ğŸŸ  Stage 2: å‡çº§ Generatorï¼ˆå‘¨æœ« 8 å°æ—¶ï¼‰**

å¢å¼º `PlaybookManager.extractPlaybookFromLearning()` ä¸ºæ‰¹é‡æ¨¡å¼ï¼š

```typescript
/**
 * æ‰¹é‡èšç±»æå– Playbook
 */
async batchExtractPlaybooks(
  learnings: StrategicLearning[],
  minClusterSize: number = 3
): Promise<StrategicPlaybook[]> {
  // 1. æŒ‰é¢†åŸŸå’Œç±»å‹èšç±»
  const clusters = this.clusterLearnings(learnings);

  // 2. æ¯ä¸ªç°‡æå–é€šç”¨æ¨¡å¼
  const playbooks = await Promise.all(
    clusters.map(cluster => this.extractFromCluster(cluster))
  );

  return playbooks.filter(p => p !== null);
}
```

**ğŸŸ¡ Stage 3: å®Œå–„ Curatorï¼ˆå‘¨æœ« 12 å°æ—¶ï¼‰**

åœ¨ `PlaybookMatcher` ä¸­æ·»åŠ è‡ªåŠ¨ç»´æŠ¤é€»è¾‘ï¼š

```typescript
/**
 * è‡ªåŠ¨å»é‡ä¸å½’æ¡£ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
 */
async maintainPlaybookKnowledgeBase(): Promise<void> {
  const allPlaybooks = await this.getAllPlaybooks();

  // 1. æ‰¾å‡ºé«˜åº¦ç›¸ä¼¼çš„ Playbookï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ >0.9ï¼‰
  const duplicatePairs = await this.findDuplicates(allPlaybooks, 0.9);

  // 2. åˆå¹¶é‡å¤é¡¹ï¼Œä¿ç•™æˆåŠŸç‡æ›´é«˜çš„
  for (const [pb1, pb2] of duplicatePairs) {
    await this.mergePlaybooks(pb1, pb2);
  }

  // 3. å½’æ¡£ 90 å¤©æœªä½¿ç”¨ä¸”æˆåŠŸç‡ <50% çš„ Playbook
  const stalePlaybooks = allPlaybooks.filter(pb => {
    const daysSinceUsed = (Date.now() - pb.metrics.lastUsed) / (24 * 60 * 60 * 1000);
    return daysSinceUsed > 90 && pb.metrics.successRate < 0.5;
  });

  for (const pb of stalePlaybooks) {
    await this.updatePlaybook(pb.id, { status: 'archived' });
  }
}
```

#### 2.0.4 ç»“è®º

å½“å‰é¡¹ç›®çš„ Playbook ç³»ç»Ÿæ˜¯**å®ç”¨ä¸»ä¹‰å¯¼å‘çš„ç®€åŒ–å®ç°**ï¼š

- âœ… **æ ¸å¿ƒåŠŸèƒ½å·²è¦†ç›–**ï¼šæå–ã€å­˜å‚¨ã€æ£€ç´¢ã€åŒ¹é…
- âŒ **ç¼ºå°‘æ™ºèƒ½ä½“åä½œæ¶æ„**ï¼šGenerator-Reflector-Curator å¾ªç¯æœªå®Œæ•´å®ç°
- ğŸ¯ **é€‚åˆæ¸è¿›å¼è¡¥å…¨**ï¼šå¯åœ¨ç°æœ‰åŸºç¡€ä¸Šé€æ­¥æ·»åŠ ç¼ºå¤±ç»„ä»¶

å¦‚æœç›®æ ‡æ˜¯å®ç°æŠ¥å‘Šä¸­æè¿°çš„å®Œæ•´ Playbook æœºåˆ¶ï¼Œå»ºè®®æŒ‰ Stage 1 â†’ Stage 2 â†’ Stage 3 çš„ä¼˜å…ˆçº§é€æ­¥è¡¥å…¨ï¼Œé¢„è®¡æ€»æŠ•å…¥ **36 å°æ—¶**ï¼ˆçº¦ 4-5 ä¸ªå‘¨æœ«ï¼‰ã€‚

---

### 2.1 Playbook çš„ç†è®ºåŸºç¡€

#### 2.1.1 ä»€ä¹ˆæ˜¯ Playbookï¼Ÿ

Playbook æ˜¯ ACE æ¡†æ¶è§£å†³"ä¸Šä¸‹æ–‡åç¼©"é—®é¢˜çš„æ ¸å¿ƒæ–¹æ¡ˆã€‚ä¸ç®€å•çš„æ‘˜è¦ä¸åŒï¼ŒPlaybook æ˜¯**ç»“æ„åŒ–çš„ã€å¯æ‰§è¡Œçš„ç»éªŒçŸ¥è¯†**ï¼š

```yaml
# /context/playbooks/user-feedback-analysis.yml
name: "ç”¨æˆ·åé¦ˆåˆ†ææœ€ä½³å®è·µ"
domain: "æ•°æ®åˆ†æ"
created_at: 2025-01-15T10:30:00Z
success_rate: 0.87  # 87% çš„ä»»åŠ¡æˆåŠŸç‡
usage_count: 23

triggers:
  - "åˆ†æç”¨æˆ·åé¦ˆ"
  - "æå–äº§å“é—®é¢˜"
  - "ç”¨æˆ·æ„è§æ±‡æ€»"

preconditions:
  - åé¦ˆæ•°æ®é‡ > 10 æ¡
  - åé¦ˆæ—¶é—´è·¨åº¦ < 30 å¤©

steps:
  - action: "è°ƒç”¨ feedback-analyzer æŠ€èƒ½"
    parameters:
      timeRange: "7d"
      minConfidence: 0.7
    expected_duration: 3000ms

  - action: "ä½¿ç”¨ LLM èšç±»åˆ†æ"
    prompt_template: "å°†ä»¥ä¸‹åé¦ˆæŒ‰é—®é¢˜ç±»å‹åˆ†ç±»ï¼š\n{feedback_data}"

  - action: "ç”Ÿæˆè§£å†³æ–¹æ¡ˆå»ºè®®"
    prompt_template: "é’ˆå¯¹ {issue_category}ï¼Œæå‡º3ä¸ªå¯è¡Œçš„æ”¹è¿›æ–¹æ¡ˆ"

anti_patterns:
  - "ä¸è¦åœ¨å•æ¬¡è°ƒç”¨ä¸­å¤„ç†è¶…è¿‡ 100 æ¡åé¦ˆï¼ˆä¼šè¶…æ—¶ï¼‰"
  - "é¿å…ä½¿ç”¨æ¨¡ç³Šçš„æ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚'æœ€è¿‘'ï¼‰"

success_indicators:
  - "æˆåŠŸæå–è‡³å°‘ 3 ä¸ªæ˜ç¡®çš„é—®é¢˜åˆ†ç±»"
  - "æ¯ä¸ªé—®é¢˜éƒ½æœ‰å…·ä½“çš„è§£å†³æ–¹æ¡ˆ"
  - "æ€»æ‰§è¡Œæ—¶é—´ < 10 ç§’"
```

**æ ¸å¿ƒä»·å€¼**ï¼š
- ğŸ“š **çŸ¥è¯†æ²‰æ·€**ï¼šå°†æˆåŠŸç»éªŒç¼–ç ä¸ºå¯å¤ç”¨çš„"å‰§æœ¬"
- ğŸ” **æ™ºèƒ½æ£€ç´¢**ï¼šé€šè¿‡å‘é‡ç›¸ä¼¼åº¦åŒ¹é…ç›¸å…³ Playbook
- ğŸš€ **æ‰§è¡ŒåŠ é€Ÿ**ï¼šç›´æ¥å¥—ç”¨å·²éªŒè¯çš„æ­¥éª¤ï¼Œå‡å°‘è¯•é”™
- ğŸ§  **æŒç»­è¿›åŒ–**ï¼šéšç€ä½¿ç”¨åé¦ˆä¸æ–­ä¼˜åŒ– Playbook

#### 2.1.2 Playbook ä¸ç®€å•æ‘˜è¦çš„å¯¹æ¯”

| ç»´åº¦ | ç®€å•æ‘˜è¦ï¼ˆä¼šå¯¼è‡´ä¸Šä¸‹æ–‡åç¼©ï¼‰ | Playbookï¼ˆACE æ–¹æ¡ˆï¼‰ |
|-----|---------------------------|---------------------|
| **ä¿¡æ¯å¯†åº¦** | ä» 18,000 Token â†’ 120 Tokenï¼ˆä¸¢å¤± 99.3%ï¼‰ | ä¿ç•™å…³é”®å†³ç­–è·¯å¾„ï¼Œä¿¡æ¯æŸå¤± <30% |
| **å¯æ‰§è¡Œæ€§** | ä»…æè¿°"åšäº†ä»€ä¹ˆ"ï¼ˆé™æ€æ–‡æœ¬ï¼‰ | åŒ…å«"å¦‚ä½•åš"ï¼ˆå¯æ‰§è¡Œæ­¥éª¤ï¼‰ |
| **æ›´æ–°æœºåˆ¶** | è¢«åŠ¨è¦†ç›–ï¼ˆæ–°æ‘˜è¦æ›¿æ¢æ—§æ‘˜è¦ï¼‰ | ä¸»åŠ¨è¿›åŒ–ï¼ˆæ ¹æ®åé¦ˆè°ƒæ•´æˆåŠŸç‡ï¼‰ |
| **æ£€ç´¢èƒ½åŠ›** | å…¨æ–‡æœç´¢ï¼ˆä½æ•ˆï¼‰ | å‘é‡ç›¸ä¼¼åº¦ + é¢†åŸŸæ ‡ç­¾ï¼ˆé«˜æ•ˆï¼‰ |
| **é€‚ç”¨åœºæ™¯** | å•æ¬¡å›é¡¾å†å² | æŒ‡å¯¼æœªæ¥å†³ç­– |

### 2.2 ApexBridge ä¸­çš„ Playbook å®æ–½æ–¹æ¡ˆ

#### 2.2.1 Playbook æ•°æ®ç»“æ„è®¾è®¡

```typescript
// src/types/playbook.ts
export interface Playbook {
  id: string;                      // å”¯ä¸€æ ‡è¯†
  name: string;                    // å¯è¯»åç§°
  domain: string;                  // é¢†åŸŸåˆ†ç±»ï¼ˆå¦‚"æ•°æ®åˆ†æ"ã€"ä»£ç ç”Ÿæˆ"ï¼‰
  description: string;             // ç®€è¦æè¿°

  // è§¦å‘æ¡ä»¶
  triggers: string[];              // å…³é”®è¯è§¦å‘ï¼ˆå‘é‡æ£€ç´¢ï¼‰
  preconditions: Condition[];      // å‰ç½®æ¡ä»¶æ£€æŸ¥

  // æ‰§è¡Œæ­¥éª¤
  steps: PlaybookStep[];

  // åæ¨¡å¼ï¼ˆé¿å…çš„åšæ³•ï¼‰
  anti_patterns: string[];

  // ç»Ÿè®¡æ•°æ®
  success_rate: number;            // æˆåŠŸç‡ï¼ˆ0-1ï¼‰
  usage_count: number;             // ä½¿ç”¨æ¬¡æ•°
  avg_duration_ms: number;         // å¹³å‡æ‰§è¡Œæ—¶é—´

  // å…ƒæ•°æ®
  created_at: Date;
  updated_at: Date;
  created_from_trajectory_ids: string[];  // æ¥æºè½¨è¿¹
}

export interface PlaybookStep {
  action_type: 'tool_call' | 'llm_prompt' | 'conditional_branch';
  tool_name?: string;              // å¦‚æœæ˜¯å·¥å…·è°ƒç”¨
  parameters?: Record<string, any>;
  prompt_template?: string;        // å¦‚æœæ˜¯ LLM è°ƒç”¨
  expected_duration_ms?: number;
  error_handling?: ErrorHandler;
}

export interface Condition {
  type: 'data_availability' | 'resource_check' | 'custom';
  expression: string;              // å¯æ‰§è¡Œçš„ JS è¡¨è¾¾å¼
  description: string;
}
```

#### 2.2.2 Playbook ç”Ÿæˆæµç¨‹ï¼ˆGenerator-Reflector-Curatorï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    1. Generator (ç”Ÿæˆå™¨)                     â”‚
â”‚  è¾“å…¥: æˆåŠŸçš„ Trajectory (outcome='SUCCESS')                 â”‚
â”‚  å¤„ç†:                                                       â”‚
â”‚    - æå–å…³é”®æ­¥éª¤ï¼ˆtool_calls + LLM æ¨ç†ï¼‰                   â”‚
â”‚    - è¯†åˆ«è§¦å‘æ¨¡å¼ï¼ˆç”¨æˆ·æ„å›¾å…³é”®è¯ï¼‰                           â”‚
â”‚    - ç”Ÿæˆåˆå§‹ Playbook è‰ç¨¿                                  â”‚
â”‚  è¾“å‡º: PlaybookDraft                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   2. Reflector (åæ€å™¨)                      â”‚
â”‚  è¾“å…¥: PlaybookDraft + å†å² Trajectories                     â”‚
â”‚  å¤„ç†:                                                       â”‚
â”‚    - å¯¹æ¯”ç›¸ä¼¼ä»»åŠ¡çš„æˆåŠŸ/å¤±è´¥æ¡ˆä¾‹                              â”‚
â”‚    - æå–åæ¨¡å¼ï¼ˆanti_patternsï¼‰                             â”‚
â”‚    - æ·»åŠ å‰ç½®æ¡ä»¶æ£€æŸ¥                                        â”‚
â”‚    - ç”Ÿæˆé”™è¯¯å¤„ç†ç­–ç•¥                                        â”‚
â”‚  è¾“å‡º: PlaybookRefined                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   3. Curator (ç­–å±•å™¨)                        â”‚
â”‚  è¾“å…¥: PlaybookRefined + ç°æœ‰ Playbook åº“                    â”‚
â”‚  å¤„ç†:                                                       â”‚
â”‚    - æ£€æŸ¥æ˜¯å¦ä¸ç°æœ‰ Playbook é‡å¤ï¼ˆåˆå¹¶æˆ–æ›¿æ¢ï¼‰               â”‚
â”‚    - è®¡ç®—åˆå§‹æˆåŠŸç‡ï¼ˆåŸºäºæ¥æº Trajectory æ•°é‡ï¼‰               â”‚
â”‚    - å‘é‡åŒ– triggers å­—æ®µï¼ˆå†™å…¥ LanceDBï¼‰                    â”‚
â”‚    - æŒä¹…åŒ–åˆ° /context/playbooks/                           â”‚
â”‚  è¾“å‡º: Playbook (å­˜å‚¨åˆ° AFS + LanceDB)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.3 Playbook æ£€ç´¢ä¸åº”ç”¨

```typescript
// åœ¨ ChatService ä¸­é›†æˆ Playbook æ£€ç´¢
async chat(messages: Message[], options: ChatOptions): Promise<ChatResult> {
  const userQuery = messages[messages.length - 1].content;

  // === æ£€ç´¢ç›¸å…³ Playbook ===
  const relevantPlaybooks = await this.playbookService.search(userQuery, {
    minSuccessRate: 0.7,  // åªä½¿ç”¨æˆåŠŸç‡ >70% çš„ Playbook
    maxResults: 3
  });

  if (relevantPlaybooks.length > 0) {
    // æ³¨å…¥ Playbook åˆ°ç³»ç»Ÿæç¤ºè¯
    const playbookContext = relevantPlaybooks
      .map(pb => `
## ç›¸å…³ç»éªŒï¼ˆ${pb.name}ï¼‰
æˆåŠŸç‡: ${(pb.success_rate * 100).toFixed(1)}%
æ¨èæ­¥éª¤:
${pb.steps.map((s, i) => `${i+1}. ${s.action_type}: ${s.tool_name || s.prompt_template}`).join('\n')}
æ³¨æ„äº‹é¡¹: ${pb.anti_patterns.join('; ')}
      `)
      .join('\n\n');

    messages.unshift({
      role: 'system',
      content: `[Playbook æç¤º]\nä»¥ä¸‹æ˜¯å¤„ç†ç±»ä¼¼ä»»åŠ¡çš„æˆåŠŸç»éªŒï¼š\n${playbookContext}`
    });
  }

  // æ‰§è¡ŒåŸæœ‰èŠå¤©é€»è¾‘
  const result = await this.strategy.execute(messages, options);

  // === æ›´æ–° Playbook ç»Ÿè®¡ ===
  if (relevantPlaybooks.length > 0 && result.success) {
    for (const pb of relevantPlaybooks) {
      await this.playbookService.recordUsage(pb.id, {
        success: true,
        duration_ms: result.duration
      });
    }
  }

  return result;
}
```

### 2.3 Playbook çš„è‡ªåŠ¨è¿›åŒ–

#### 2.3.1 æˆåŠŸç‡åŠ¨æ€æ›´æ–°

```typescript
// src/services/PlaybookService.ts
async recordUsage(playbookId: string, feedback: {
  success: boolean;
  duration_ms: number;
}): Promise<void> {
  const playbook = await this.getPlaybook(playbookId);

  // ä½¿ç”¨æŒ‡æ•°ç§»åŠ¨å¹³å‡æ›´æ–°æˆåŠŸç‡
  const alpha = 0.2;  // å­¦ä¹ ç‡
  const newSuccessRate = alpha * (feedback.success ? 1 : 0)
                       + (1 - alpha) * playbook.success_rate;

  // æ›´æ–°å¹³å‡æ‰§è¡Œæ—¶é—´
  const newAvgDuration = (playbook.avg_duration_ms * playbook.usage_count + feedback.duration_ms)
                       / (playbook.usage_count + 1);

  await this.updatePlaybook(playbookId, {
    success_rate: newSuccessRate,
    usage_count: playbook.usage_count + 1,
    avg_duration_ms: newAvgDuration,
    updated_at: new Date()
  });

  // å¦‚æœæˆåŠŸç‡ä¸‹é™åˆ°é˜ˆå€¼ä»¥ä¸‹ï¼Œè§¦å‘åæ€å™¨é‡æ–°è¯„ä¼°
  if (newSuccessRate < 0.6) {
    await this.triggerReflection(playbookId);
  }
}
```

#### 2.3.2 åæ€è§¦å‘ç­–ç•¥

```typescript
// å®šæœŸåæ€å¾ªç¯ï¼ˆæ¯å¤©å‡Œæ™¨æ‰§è¡Œï¼‰
async dailyReflectionCycle(): Promise<void> {
  // 1. æ”¶é›†æ˜¨å¤©çš„æ‰€æœ‰ Trajectory
  const recentTrajectories = await this.trajectoryStore.getRecent({
    since: Date.now() - 24 * 3600 * 1000,
    outcome: 'SUCCESS'
  });

  // 2. èšç±»åˆ†æï¼šè¯†åˆ«æ–°çš„ä»»åŠ¡æ¨¡å¼
  const clusters = await this.clusterTrajectories(recentTrajectories);

  for (const cluster of clusters) {
    if (cluster.size >= 3) {  // è‡³å°‘ 3 ä¸ªç›¸ä¼¼ä»»åŠ¡
      // 3. ç”Ÿæˆæ–°çš„ Playbook
      const draft = await this.generator.generate(cluster.trajectories);
      const refined = await this.reflector.refine(draft);
      const playbook = await this.curator.curate(refined);

      // 4. æŒä¹…åŒ–
      await this.savePlaybook(playbook);
      logger.info(`[Playbook] æ–°å¢ç»éªŒ: ${playbook.name} (æ¥è‡ª ${cluster.size} ä¸ªä»»åŠ¡)`);
    }
  }

  // 5. æ¸…ç†ä½æ•ˆ Playbook
  const lowPerformancePlaybooks = await this.getPlaybooks({
    success_rate_lt: 0.5,
    usage_count_gt: 10  // è‡³å°‘ä½¿ç”¨è¿‡ 10 æ¬¡æ‰æ¸…ç†
  });

  for (const pb of lowPerformancePlaybooks) {
    await this.archivePlaybook(pb.id);
    logger.warn(`[Playbook] å½’æ¡£ä½æ•ˆç»éªŒ: ${pb.name} (æˆåŠŸç‡ ${pb.success_rate})`);
  }
}
```

---

## ğŸ“ ç¬¬ä¸‰éƒ¨åˆ†ï¼šEiC å¼•å…¥çš„æ¶æ„æ”¹é€ æ–¹æ¡ˆ

### 3.1 AFS æ–‡ä»¶ç³»ç»Ÿè®¾è®¡

#### 3.1.1 ç›®å½•ç»“æ„è§„èŒƒï¼ˆå¢å¼ºç‰ˆï¼Œå« Playbookï¼‰

```
/context/
  â”œâ”€â”€ history/           # ä¸å¯å˜æ—¥å¿—æµ (append-only)
  â”‚   â”œâ”€â”€ sessions/      # ä¼šè¯çº§æ—¥å¿— (.jsonl æ ¼å¼)
  â”‚   â”œâ”€â”€ tool_calls/    # å·¥å…·è°ƒç”¨è®°å½•
  â”‚   â”œâ”€â”€ trajectories/  # ğŸ†• åŸå§‹è½¨è¿¹æ•°æ®ï¼ˆç”¨äºç”Ÿæˆ Playbookï¼‰
  â”‚   â””â”€â”€ errors/        # é”™è¯¯æ—¥å¿—
  â”œâ”€â”€ memory/            # ç»“æ„åŒ–è®°å¿†
  â”‚   â”œâ”€â”€ episodic/      # æƒ…æ™¯è®°å¿† (ç”¨æˆ·äº¤äº’å†å²)
  â”‚   â”œâ”€â”€ fact/          # äº‹å®è®°å¿† (çŸ¥è¯†åº“)
  â”‚   â””â”€â”€ procedural/    # ç¨‹åºè®°å¿† (CoT æ¨¡æ¿)
  â”œâ”€â”€ playbooks/         # ğŸ†• ç»éªŒçŸ¥è¯†åº“ï¼ˆPlaybook å­˜å‚¨ï¼‰
  â”‚   â”œâ”€â”€ active/        # æ´»è·ƒçš„ Playbookï¼ˆæˆåŠŸç‡ >60%ï¼‰
  â”‚   â”œâ”€â”€ archived/      # å½’æ¡£çš„ä½æ•ˆ Playbook
  â”‚   â””â”€â”€ drafts/        # å¾…å®¡æ ¸çš„ Playbook è‰ç¨¿
  â”œâ”€â”€ pad/               # ä¸´æ—¶å·¥ä½œåŒº
  â”‚   â””â”€â”€ {sessionId}/   # ä¼šè¯éš”ç¦»çš„è‰ç¨¿ç©ºé—´
  â””â”€â”€ human/             # äººå·¥åé¦ˆï¼ˆä¸ªäººé¡¹ç›®å¯é€‰ï¼‰
      â””â”€â”€ reviews/       # å®¡æ ¸è®°å½•

/modules/                # å·¥å…·æŒ‚è½½ç‚¹
  â”œâ”€â”€ skills/            # Skills è™šæ‹ŸåŒ–
  â”‚   â””â”€â”€ {skill-name}/
  â”‚       â”œâ”€â”€ input      # è™šæ‹Ÿæ–‡ä»¶ï¼ˆå†™å…¥è§¦å‘æ‰§è¡Œï¼‰
  â”‚       â””â”€â”€ output     # è™šæ‹Ÿæ–‡ä»¶ï¼ˆè¯»å–è·å–ç»“æœï¼‰
  â””â”€â”€ mcp/               # MCP æœåŠ¡å™¨æŒ‚è½½
      â””â”€â”€ {server-name}/

/bus/                    # ACE æ€»çº¿è™šæ‹ŸåŒ–
  â”œâ”€â”€ northbound.stream  # å‘½åç®¡é“å¼æ—¥å¿—
  â””â”€â”€ southbound.stream
```

#### 3.1.2 Playbook Resolver è®¾è®¡

```typescript
// src/core/afs/resolvers/PlaybookResolver.ts
class PlaybookResolver implements AFSResolver {
  canHandle(path: string): boolean {
    return path.startsWith('/context/playbooks/');
  }

  async read(path: string): Promise<string> {
    // è§£æè·¯å¾„ï¼š/context/playbooks/active/user-feedback-analysis.yml
    const [_, __, ___, status, filename] = path.split('/');

    // ä» SQLite è¯»å– Playbook
    const playbook = await this.playbookStore.getByFilename(filename);

    // åºåˆ—åŒ–ä¸º YAML æ ¼å¼
    return yaml.stringify(playbook);
  }

  async list(path: string): Promise<string[]> {
    const [_, __, ___, status] = path.split('/');

    if (status === 'active') {
      // åˆ—å‡ºæ‰€æœ‰æ´»è·ƒ Playbook
      const playbooks = await this.playbookStore.getAll({
        success_rate_gte: 0.6
      });
      return playbooks.map(pb => `${pb.name}.yml`);
    }

    // ... å…¶ä»–çŠ¶æ€å¤„ç†
  }

  async write(path: string, content: string): Promise<void> {
    // æ”¯æŒæ‰‹åŠ¨åˆ›å»º/ç¼–è¾‘ Playbook
    const playbook = yaml.parse(content);
    await this.playbookStore.save(playbook);

    // å‘é‡åŒ–å¹¶ç´¢å¼•
    await this.vectorizer.index(playbook);
  }
}
```

### 3.2 æ”¹é€ å®æ–½è·¯å¾„ï¼ˆé¢å‘ä¸ªäººå¼€å‘è€…ï¼‰âš ï¸ **å·²åŸºäºå·¥ç¨‹è¯„å®¡ä¿®æ­£**

#### ğŸ¯ **å½“å‰çŠ¶æ€æ€»ç»“**

æ ¹æ®ç¬¬ 2.0 èŠ‚çš„è¯„ä¼°ï¼Œé¡¹ç›®å·²å…·å¤‡ä»¥ä¸‹åŸºç¡€ï¼š
- âœ… **Playbook æ•°æ®ç»“æ„**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰ï¼ˆ[src/types/playbook.ts](src/types/playbook.ts)ï¼‰
- âœ… **åŸºç¡€ Generator**ï¼š`PlaybookManager.extractPlaybookFromLearning()` å¯ä»å•ä¸ª learning æå–
- âœ… **å‘é‡æ£€ç´¢**ï¼š`PlaybookMatcher.matchPlaybooks()` æ”¯æŒè¯­ä¹‰åŒ¹é…
- âœ… **å­˜å‚¨å±‚**ï¼šLanceDB å‘é‡åŒ– + å†…å­˜ç¼“å­˜

**å› æ­¤ï¼Œå®æ–½è·¯å¾„éœ€è¦è°ƒæ•´ä¸º"è¡¥å…¨ç¼ºå¤±ç»„ä»¶"è€Œé"ä»é›¶æ„å»º"**ã€‚

---

#### âš ï¸ **å…³é”®å·¥ç¨‹é—®é¢˜è­¦å‘Š**

**åŸæŠ¥å‘Šå­˜åœ¨å››å¤§å·¥ç¨‹é™·é˜±ï¼Œå·²åœ¨ [playbook-implementation-fixes.md](docs/playbook-implementation-fixes.md) ä¸­ä¿®æ­£ï¼š**

| é—®é¢˜ | åŸè®¾è®¡ç¼ºé™· | é£é™©ç­‰çº§ | ä¿®æ­£æ–¹æ¡ˆ |
|-----|-----------|---------|---------|
| **1. è¿è¡Œç¯å¢ƒå†²çª** | å‡è®¾æœåŠ¡å™¨ 24/7 è¿è¡Œï¼Œä½¿ç”¨ Cron å®šæ—¶ä»»åŠ¡ | ğŸ”´ é«˜ | äº‹ä»¶é©±åŠ¨ + SQLite ä»»åŠ¡é˜Ÿåˆ— + é—²æ—¶è°ƒåº¦ |
| **2. æ•°æ®è´¨é‡ä¸è¶³** | Trajectory åªè®°å½•å­—ç¬¦ä¸²é”™è¯¯ | ğŸ”´ é«˜ | å¢å¼ºä¸ºç»“æ„åŒ–é”™è¯¯ï¼ˆ8 ç§ ErrorType åˆ†ç±»ï¼‰ |
| **3. Playbook æ‰§è¡Œå¼±åŒ–** | ä»…æ³¨å…¥ System Promptï¼Œæ˜“è¢« LLM å¿½ç•¥ | ğŸŸ  ä¸­ | è½¬æ¢ä¸ºå¼ºåˆ¶æ‰§è¡Œ Plan å¯¹è±¡ |
| **4. æ£€ç´¢ç­–ç•¥ç²—ç³™** | å…¨é‡ Embed YAMLï¼Œå™ªå£°è¿‡å¤š | ğŸŸ¡ ä½ | æ··åˆæ£€ç´¢ï¼ˆBM25 + å‘é‡ï¼ŒRRF èåˆï¼‰ |

**ä¿®æ­£åæ—¶é—´æˆæœ¬**ï¼šåŸ 38h â†’ **50h**ï¼ˆå¢åŠ  12hï¼Œä½†å¯é æ€§æ˜¾è‘—æå‡ï¼‰

**å¼ºçƒˆå»ºè®®**ï¼šåœ¨å¼€å§‹å®æ–½å‰ï¼Œå…ˆé˜…è¯» [playbook-implementation-fixes.md](docs/playbook-implementation-fixes.md) äº†è§£è¯¦ç»†ä¿®æ­£æ–¹æ¡ˆã€‚

---

#### é˜¶æ®µ 0ï¼šç°æœ‰åŠŸèƒ½éªŒè¯ï¼ˆ1-2 å°æ—¶ï¼Œå‘¨æœ«åŠå¤©ï¼‰â­ **å‰ç½®æ­¥éª¤**

**ç›®æ ‡**ï¼šç¡®è®¤ç°æœ‰ Playbook ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œ

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] é˜…è¯» `PlaybookManager.ts` å’Œ `PlaybookMatcher.ts` æºç 
- [ ] ç¼–å†™ç®€å•æµ‹è¯•è„šæœ¬ï¼Œè°ƒç”¨ `extractPlaybookFromLearning()`
- [ ] éªŒè¯ Playbook æ˜¯å¦èƒ½æ­£ç¡®å­˜å‚¨åˆ° LanceDB
- [ ] æµ‹è¯• `matchPlaybooks()` çš„æ£€ç´¢æ•ˆæœ

**éªŒæ”¶æ ‡å‡†**ï¼š
```typescript
// æµ‹è¯•è„šæœ¬ç¤ºä¾‹
import { PlaybookManager } from './src/services/PlaybookManager';

const mockLearning: StrategicLearning = {
  id: 'test-001',
  summary: 'æˆåŠŸå¤„ç†ç”¨æˆ·åé¦ˆåˆ†æä»»åŠ¡',
  learnings: ['ä½¿ç”¨ feedback-analyzer å·¥å…·', 'èšç±»åˆ†æé—®é¢˜'],
  outcome: 'success',
  userId: 'test-user',
  timestamp: Date.now()
};

const playbook = await playbookManager.extractPlaybookFromLearning(mockLearning);
console.log('ç”Ÿæˆçš„ Playbook:', playbook);

// éªŒè¯æ£€ç´¢
const matches = await playbookMatcher.matchPlaybooks({
  userQuery: 'åˆ†æç”¨æˆ·åé¦ˆ',
  sessionHistory: []
});
console.log('åŒ¹é…åˆ°çš„ Playbook æ•°é‡:', matches.length);
```

**âš ï¸ å¦‚æœé˜¶æ®µ 0 éªŒè¯å¤±è´¥ï¼Œè¯´æ˜ç°æœ‰å®ç°å­˜åœ¨é—®é¢˜ï¼Œéœ€å…ˆä¿®å¤åŸºç¡€åŠŸèƒ½ã€‚**

---

#### é˜¶æ®µ 0.5ï¼šä»»åŠ¡é˜Ÿåˆ—åŸºç¡€è®¾æ–½ï¼ˆ4 å°æ—¶ï¼Œå‘¨æœ«åŠå¤©ï¼‰ğŸ”´ **æ–°å¢ - ä¿®æ­£è¿è¡Œç¯å¢ƒå†²çª**

**é—®é¢˜èƒŒæ™¯**ï¼šåŸæŠ¥å‘Šå‡è®¾ä½¿ç”¨ Cron å®šæ—¶ä»»åŠ¡ï¼Œä½† ApexBridge æ˜¯ Electron åº”ç”¨ï¼ŒMacBook æ™šä¸Šä¼šå…³æœº/ä¼‘çœ ï¼Œå®šæ—¶ä»»åŠ¡ä¸ä¼šæ‰§è¡Œã€‚

**ä¿®æ­£æ–¹æ¡ˆ**ï¼šé‡‡ç”¨**äº‹ä»¶é©±åŠ¨ + SQLite ä»»åŠ¡é˜Ÿåˆ— + é—²æ—¶è°ƒåº¦**æ¨¡å¼ã€‚

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»º SQLite ä»»åŠ¡é˜Ÿåˆ—è¡¨ `reflection_queue`
- [ ] å®ç° `PlaybookTaskQueue` ç±»ï¼ˆå…¥é˜Ÿ/å‡ºé˜Ÿ/çŠ¶æ€ç®¡ç†ï¼‰
- [ ] åœ¨ `AceCore.saveTrajectory()` åè§¦å‘äº‹ä»¶å…¥é˜Ÿ
- [ ] å®ç° `IdleScheduler` é—²æ—¶è°ƒåº¦å™¨ï¼ˆç›‘å¬ CPU ç©ºé—²ï¼‰
- [ ] æ·»åŠ å‰ç«¯"çŸ¥è¯†åº“ç»´æŠ¤"é¢æ¿ï¼ˆæ˜¾ç¤ºå¾…å¤„ç†ä»»åŠ¡æ•° + æ‰‹åŠ¨è§¦å‘æŒ‰é’®ï¼‰

**æ•°æ®åº“ç»“æ„**ï¼š
```sql
CREATE TABLE reflection_queue (
  id TEXT PRIMARY KEY,
  task_type TEXT NOT NULL,  -- 'GENERATE' | 'REFLECT' | 'CURATE'
  trajectory_id TEXT,
  status TEXT DEFAULT 'PENDING',
  priority INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  retry_count INTEGER DEFAULT 0
);
```

**éªŒæ”¶æ ‡å‡†**ï¼š
```typescript
// æµ‹è¯•åœºæ™¯
1. å®Œæˆä¸€ä¸ªæˆåŠŸä»»åŠ¡ â†’ é˜Ÿåˆ—ä¸­æ–°å¢ 1 æ¡ GENERATE ä»»åŠ¡
2. å®Œæˆä¸€ä¸ªå¤±è´¥ä»»åŠ¡ â†’ é˜Ÿåˆ—ä¸­æ–°å¢ 1 æ¡ REFLECT ä»»åŠ¡ï¼ˆpriority=1ï¼‰
3. æ‰‹åŠ¨è§¦å‘ç»´æŠ¤ â†’ å‰ 10 ä¸ªä»»åŠ¡è¢«å¤„ç†ï¼ŒçŠ¶æ€æ›´æ–°ä¸º COMPLETED
4. å…³æœºé‡å¯åº”ç”¨ â†’ é˜Ÿåˆ—ä¸­çš„ PENDING ä»»åŠ¡ä»å­˜åœ¨ï¼ˆæŒä¹…åŒ–éªŒè¯ï¼‰
```

**è¯¦ç»†å®ç°**ï¼šå‚è€ƒ [playbook-implementation-fixes.md Â§ 1.2](docs/playbook-implementation-fixes.md#12-ä¿®æ­£æ–¹æ¡ˆäº‹ä»¶é©±åŠ¨--ä»»åŠ¡é˜Ÿåˆ—)

---

#### é˜¶æ®µ 0.6ï¼šTrajectory è´¨é‡æå‡ï¼ˆ2 å°æ—¶ï¼‰ğŸ”´ **æ–°å¢ - ä¸º Reflector å‡†å¤‡æ•°æ®**

**é—®é¢˜èƒŒæ™¯**ï¼šå½“å‰ Trajectory åªè®°å½•å­—ç¬¦ä¸²é”™è¯¯ï¼ˆå¦‚ "Timeout"ï¼‰ï¼ŒReflector æ— æ³•ä»ä¸­æ¨å¯¼å‡º"éœ€è¦åˆ†æ‰¹å¤„ç†"è¿™ç§é«˜çº§åæ¨¡å¼ã€‚

**ä¿®æ­£æ–¹æ¡ˆ**ï¼šå¢å¼º `TrajectoryStep` ä¸ºç»“æ„åŒ–é”™è¯¯ï¼Œåˆ†ç±» 8 ç§ `ErrorType`ã€‚

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] ä¿®æ”¹ `TrajectoryStep` æ¥å£ï¼Œå¢åŠ  `tool_details` å’Œ `error_details` å­—æ®µ
- [ ] å®šä¹‰ `ErrorType` æšä¸¾ï¼ˆNETWORK_ERROR, TIMEOUT, RATE_LIMIT, INVALID_INPUT ç­‰ï¼‰
- [ ] é‡æ„ `ToolDispatcher.dispatchTool()` æ•è·è¯¦ç»†é”™è¯¯
- [ ] å®ç° `classifyError()` é”™è¯¯åˆ†ç±»é€»è¾‘ï¼ˆåŸºäºé”™è¯¯ç å’Œå…³é”®è¯ï¼‰

**ç±»å‹å®šä¹‰**ï¼š
```typescript
export interface TrajectoryStep {
  thought: string;
  action: string;

  // ğŸ†• å·¥å…·è°ƒç”¨è¯¦æƒ…
  tool_details?: {
    tool_name: string;
    input_params: Record<string, any>;
    output_content: string;
    output_metadata?: {
      token_count?: number;
      execution_time_ms?: number;
    };
  };

  // ğŸ†• é”™è¯¯è¯¦æƒ…
  error_details?: {
    error_type: ErrorType;  // åˆ†ç±»çš„é”™è¯¯ç±»å‹
    error_message: string;
    error_stack?: string;
    context?: Record<string, any>;
  };

  duration: number;
  timestamp: number;
}

export enum ErrorType {
  NETWORK_ERROR = 'network',
  TIMEOUT = 'timeout',
  RATE_LIMIT = 'rate_limit',
  INVALID_INPUT = 'invalid_input',
  LOGIC_ERROR = 'logic',
  RESOURCE_EXHAUSTED = 'resource',
  PERMISSION_DENIED = 'permission',
  UNKNOWN = 'unknown'
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
```typescript
// è§¦å‘è¶…æ—¶é”™è¯¯æµ‹è¯•
const result = await toolDispatcher.dispatchTool('slow-tool', { delay: 60000 });

// éªŒè¯é”™è¯¯è¯¦æƒ…
expect(result.success).toBe(false);
expect(result.metadata.error_details.error_type).toBe('timeout');
expect(result.metadata.input_params).toEqual({ delay: 60000 });
```

**è¯¦ç»†å®ç°**ï¼šå‚è€ƒ [playbook-implementation-fixes.md Â§ 2.2](docs/playbook-implementation-fixes.md#22-ä¿®æ­£æ–¹æ¡ˆå¢å¼ºé”™è¯¯å…ƒæ•°æ®)

---

#### é˜¶æ®µ 1ï¼šè¡¥å…¨ Reflectorï¼ˆ2-3 å‘¨ï¼Œå‘¨æœ«å¼€å‘ï¼‰ğŸ”´ **æœ€é«˜ä¼˜å…ˆçº§ï¼ˆå·²ä¿®æ­£ç­–ç•¥ï¼‰**

**ç›®æ ‡**ï¼šå®ç°å¤±è´¥æ¡ˆä¾‹å¯¹æ¯”åˆ†æï¼Œç”Ÿæˆé£é™©è§„é¿å‹ Playbook

**âš ï¸ ç­–ç•¥ä¿®æ­£**ï¼šä¸è¦ä¸€å¼€å§‹å°±è®© LLM è‡ªåŠ¨å‘ç°æ‰€æœ‰åæ¨¡å¼ã€‚å…ˆç”¨**è§„åˆ™å¼•æ“å¤„ç† 80% å¸¸è§æ¨¡å¼**ï¼Œå†ç”¨ LLM å¤„ç† 20% é•¿å°¾é—®é¢˜ã€‚

**ä»»åŠ¡æ¸…å•ï¼ˆMVP - è§„åˆ™å¼•æ“ç‰ˆï¼‰**ï¼š
- [ ] åˆ›å»º `src/services/PlaybookReflector.ts`
- [ ] ç¡¬ç¼–ç  3-5 ç§å¸¸è§é”™è¯¯æ¨¡å¼ï¼ˆTimeout/RateLimit/ResourceExhausted/NetworkErrorï¼‰
- [ ] å®ç°åŸºäºè§„åˆ™çš„åæ¨¡å¼è¯†åˆ«ï¼ˆå…³é”®è¯åŒ¹é… + ErrorType åˆ†ç±»ï¼‰
- [ ] é›†æˆåˆ°ä»»åŠ¡é˜Ÿåˆ—å¤„ç†æµç¨‹ï¼ˆå¤„ç† REFLECT ç±»å‹ä»»åŠ¡ï¼‰
- [ ] æµ‹è¯•ï¼šæ‰‹åŠ¨æ„é€  2 ä¸ªè¶…æ—¶å¤±è´¥æ¡ˆä¾‹ï¼ŒéªŒè¯ç”Ÿæˆé£é™©è§„é¿ Playbook

**è§„åˆ™å¼•æ“ç¤ºä¾‹**ï¼š
```typescript
// src/services/PlaybookReflector.ts (MVP ç‰ˆæœ¬)
export class PlaybookReflector {
  private errorPatternRules = [
    {
      errorType: ErrorType.TIMEOUT,
      keywords: ['timeout', 'exceeded'],
      antiPattern: 'ä¸è¦åœ¨å•æ¬¡è°ƒç”¨ä¸­å¤„ç†è¿‡å¤šæ•°æ®',
      solution: 'å°†æ•°æ®åˆ†æ‰¹å¤„ç†ï¼Œæ¯æ‰¹ä¸è¶…è¿‡ 100 æ¡'
    },
    {
      errorType: ErrorType.RATE_LIMIT,
      keywords: ['rate limit', '429'],
      antiPattern: 'é¿å…çŸ­æ—¶é—´å†…é¢‘ç¹è°ƒç”¨ API',
      solution: 'æ·»åŠ é€Ÿç‡é™åˆ¶å™¨ï¼Œé—´éš”è‡³å°‘ 1 ç§’'
    },
    {
      errorType: ErrorType.RESOURCE_EXHAUSTED,
      keywords: ['out of memory', 'heap'],
      antiPattern: 'é¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§æ–‡ä»¶åˆ°å†…å­˜',
      solution: 'ä½¿ç”¨æµå¼å¤„ç†æˆ–åˆ†å—è¯»å–'
    }
  ];

  /**
   * MVP: åŸºäºè§„åˆ™çš„åæ¨¡å¼è¯†åˆ«
   */
  async analyzeFailurePatterns(
    successTrajectories: Trajectory[],
    failureTrajectories: Trajectory[]
  ): Promise<StrategicPlaybook[]> {
    const patterns: Map<string, FailurePattern> = new Map();

    for (const trajectory of failureTrajectories) {
      for (const step of trajectory.steps) {
        if (step.error_details) {
          // åŒ¹é…è§„åˆ™
          const matchedRule = this.matchErrorRule(step.error_details);

          if (matchedRule) {
            const patternKey = `${matchedRule.errorType}_${trajectory.user_input}`;

            if (!patterns.has(patternKey)) {
              patterns.set(patternKey, {
                errorType: matchedRule.errorType,
                occurrences: 0,
                antiPattern: matchedRule.antiPattern,
                solution: matchedRule.solution
              });
            }

            patterns.get(patternKey)!.occurrences++;
          }
        }
      }
    }

    // ç”Ÿæˆé£é™©è§„é¿å‹ Playbookï¼ˆè‡³å°‘å‡ºç° 2 æ¬¡ï¼‰
    const playbooks: StrategicPlaybook[] = [];
    for (const [key, pattern] of patterns.entries()) {
      if (pattern.occurrences >= 2) {
        playbooks.push({
          name: `[é£é™©è§„é¿] ${pattern.errorType} æ¨¡å¼`,
          type: 'risk_avoidance',
          tags: ['failure-derived', 'risk-avoidance', pattern.errorType],
          actions: [{ description: pattern.solution }],
          anti_patterns: [pattern.antiPattern],
          // ...
        });
      }
    }

    return playbooks;
  }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
```typescript
// æµ‹è¯•ç”¨ä¾‹ï¼šå¤±è´¥æ¡ˆä¾‹å¯¹æ¯”åˆ†æ
const successTrajectories = [
  { /* æˆåŠŸæ¡ˆä¾‹ 1 */ },
  { /* æˆåŠŸæ¡ˆä¾‹ 2 */ },
  { /* æˆåŠŸæ¡ˆä¾‹ 3 */ }
];

const failureTrajectories = [
  {
    user_input: 'åˆ†æç”¨æˆ·åé¦ˆ',
    steps: [{ action: 'call_tool', tool: 'feedback-analyzer', params: { limit: 1000 } }],
    outcome: 'FAILURE',
    error: 'Timeout: tool execution exceeded 30s'
  },
  // ... æ›´å¤šå¤±è´¥æ¡ˆä¾‹
];

const riskAvoidancePlaybooks = await reflector.analyzeFailurePatterns(
  successTrajectories,
  failureTrajectories
);

// éªŒè¯ç”Ÿæˆäº†é£é™©è§„é¿å‹ Playbook
assert(riskAvoidancePlaybooks.length > 0);
assert(riskAvoidancePlaybooks[0].type === 'risk_avoidance');
assert(riskAvoidancePlaybooks[0].tags.includes('failure-derived'));
assert(riskAvoidancePlaybooks[0].actions[0].description.includes('åˆ†æ‰¹å¤„ç†'));
```

**ä¸ªäººæ—¶é—´æŠ•å…¥**ï¼š
- æ¯å‘¨æœ« 8 å°æ—¶ Ã— 2 å‘¨ = 16 å°æ—¶

---

#### é˜¶æ®µ 2ï¼šå‡çº§ Generator æ‰¹é‡èƒ½åŠ›ï¼ˆ1-2 å‘¨ï¼‰ğŸŸ  **ä¸­ä¼˜å…ˆçº§**

**ç›®æ ‡**ï¼šå®ç°ä»å¤šä¸ªç›¸ä¼¼ Trajectory èšç±»æå–é€šç”¨æ¨¡å¼

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åœ¨ `PlaybookManager` ä¸­æ·»åŠ  `batchExtractPlaybooks()` æ–¹æ³•
- [ ] å®ç°åŸºäºå…³é”®è¯çš„ç®€å•èšç±»ç®—æ³•ï¼ˆæˆ–ä½¿ç”¨ LanceDB å‘é‡èšç±»ï¼‰
- [ ] è®¾ç½®æœ€å°ç°‡å¤§å°é˜ˆå€¼ï¼ˆå¦‚ minClusterSize=3ï¼‰
- [ ] é›†æˆåˆ°å¤œé—´åæ€å¾ªç¯ä¸­
- [ ] æµ‹è¯•ï¼šæä¾› 10 ä¸ªç›¸ä¼¼ä»»åŠ¡çš„ Trajectoryï¼ŒéªŒè¯èƒ½å¦èšç±»ä¸º 2-3 ä¸ª Playbook

**éªŒæ”¶æ ‡å‡†**ï¼š
```typescript
// æ‰¹é‡æå–æµ‹è¯•
const learnings: StrategicLearning[] = [
  { id: '1', summary: 'åˆ†æç”¨æˆ·åé¦ˆ-ä»»åŠ¡A', outcome: 'success', ... },
  { id: '2', summary: 'åˆ†æç”¨æˆ·åé¦ˆ-ä»»åŠ¡B', outcome: 'success', ... },
  { id: '3', summary: 'åˆ†æç”¨æˆ·åé¦ˆ-ä»»åŠ¡C', outcome: 'success', ... },
  // ... 7 ä¸ªç±»ä¼¼ä»»åŠ¡
];

const playbooks = await playbookManager.batchExtractPlaybooks(learnings, 3);
assert(playbooks.length >= 1);  // è‡³å°‘èšç±»å‡º 1 ä¸ªé€šç”¨ Playbook
assert(playbooks[0].sourceLearningIds.length >= 3);  // æ¥æºäºè‡³å°‘ 3 ä¸ªä»»åŠ¡
```

**ä¸ªäººæ—¶é—´æŠ•å…¥**ï¼šçº¦ 8 å°æ—¶ï¼ˆ1 ä¸ªå‘¨æœ«ï¼‰

---

#### é˜¶æ®µ 3ï¼šå®Œå–„ Curator è‡ªåŠ¨ç»´æŠ¤ï¼ˆ1-2 å‘¨ï¼‰ğŸŸ¡ **ä½ä¼˜å…ˆçº§**

**ç›®æ ‡**ï¼šå®ç° Playbook å»é‡ã€å½’æ¡£ã€æ¸…ç†çš„è‡ªåŠ¨åŒ–

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åœ¨ `PlaybookMatcher` ä¸­æ·»åŠ  `maintainPlaybookKnowledgeBase()` æ–¹æ³•
- [ ] å®ç°é‡å¤æ£€æµ‹ç®—æ³•ï¼ˆåŸºäºä½™å¼¦ç›¸ä¼¼åº¦ >0.9ï¼‰
- [ ] å®ç° Playbook åˆå¹¶é€»è¾‘ï¼ˆä¿ç•™é«˜æˆåŠŸç‡ç‰ˆæœ¬ï¼‰
- [ ] å®ç°è‡ªåŠ¨å½’æ¡£é€»è¾‘ï¼ˆ90 å¤©æœªä½¿ç”¨ + æˆåŠŸç‡ <50%ï¼‰
- [ ] é…ç½®å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å‘¨æ—¥å‡Œæ™¨æ‰§è¡Œï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- æ‰‹åŠ¨åˆ›å»º 2 ä¸ªé«˜åº¦ç›¸ä¼¼çš„ Playbookï¼ˆç›¸ä¼¼åº¦ >0.95ï¼‰
- è¿è¡Œç»´æŠ¤ä»»åŠ¡åï¼ŒéªŒè¯è‡ªåŠ¨åˆå¹¶ä¸º 1 ä¸ª
- æ‰‹åŠ¨æ ‡è®° 1 ä¸ª Playbook ä¸ºä½æ•ˆï¼ˆä¿®æ”¹ lastUsed å’Œ successRateï¼‰
- è¿è¡Œç»´æŠ¤ä»»åŠ¡åï¼ŒéªŒè¯è‡ªåŠ¨å½’æ¡£ï¼ˆstatus='archived'ï¼‰

**ä¸ªäººæ—¶é—´æŠ•å…¥**ï¼šçº¦ 12 å°æ—¶ï¼ˆ1.5 ä¸ªå‘¨æœ«ï¼‰

#### é˜¶æ®µ 3ï¼šAFS åŸºç¡€è®¾æ–½ï¼ˆ4-6 å‘¨ï¼Œå¯é€‰ï¼‰

**è¯´æ˜**ï¼šå¦‚æœä¸ªäººæ—¶é—´æœ‰é™ï¼Œå¯ä»¥**æš‚ç¼“æ­¤é˜¶æ®µ**ï¼Œå…ˆäº«å— Playbook å¸¦æ¥çš„æ”¶ç›Šã€‚

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®ç° `AFS` æ ¸å¿ƒç±»ï¼ˆç±»ä¼¼ Linux VFSï¼‰
- [ ] å®ç° 5 ä¸ªåŸºç¡€ Resolverï¼ˆMemory/SQLite/LanceDB/Skill/Playbookï¼‰
- [ ] æ”¹é€  `SkillManager` ä½¿ç”¨ `/modules/skills/` è·¯å¾„
- [ ] å®ç° `/context/history/` ä¸å¯å˜æ—¥å¿—
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

**ä¸ªäººæ—¶é—´æŠ•å…¥**ï¼šçº¦ 50 å°æ—¶

#### é˜¶æ®µ 4ï¼šACE å±‚æ·±åŒ–ï¼ˆ4-6 å‘¨ï¼Œå¯é€‰ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®Œå–„ L2 æˆ˜ç•¥å±‚ï¼ˆ`AceStrategyManager`ï¼‰
- [ ] å®ç° L1 ä¼¦ç†å±‚çš„ ACL æƒé™æ§åˆ¶
- [ ] å®ç° `/bus/*.stream` è™šæ‹Ÿæ–‡ä»¶
- [ ] å®ç°"é‡æ”¾è°ƒè¯•"åŠŸèƒ½

**ä¸ªäººæ—¶é—´æŠ•å…¥**ï¼šçº¦ 50 å°æ—¶

---

## âš–ï¸ ç¬¬å››éƒ¨åˆ†ï¼šæˆæœ¬ä¸æ”¶ç›Šåˆ†æï¼ˆä¸ªäººé¡¹ç›®è§†è§’ï¼‰

### 4.1 æ—¶é—´æˆæœ¬ä¼°ç®—ï¼ˆåŸºäºå·¥ç¨‹è¯„å®¡ä¿®æ­£åï¼‰

| é˜¶æ®µ | å·¥ä½œé‡ | éš¾åº¦ | å»ºè®®ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|--------|------|-----------|------|
| **é˜¶æ®µ0: åŠŸèƒ½éªŒè¯** | 1-2 å°æ—¶ï¼ˆåŠä¸ªå‘¨æœ«ï¼‰ | ğŸŸ¢ æä½ | â­ **å‰ç½®æ­¥éª¤** | éªŒè¯ç°æœ‰ Playbook ç³»ç»Ÿæ˜¯å¦å¯ç”¨ |
| **é˜¶æ®µ0.5: ä»»åŠ¡é˜Ÿåˆ—** | 4 å°æ—¶ï¼ˆåŠä¸ªå‘¨æœ«ï¼‰ | ğŸŸ¡ ä¸­ | ğŸ”´ **æ–°å¢ï¼ˆP0ï¼‰** | ä¿®æ­£è¿è¡Œç¯å¢ƒå†²çªï¼Œäº‹ä»¶é©±åŠ¨æ¶æ„ |
| **é˜¶æ®µ0.6: æ•°æ®å¢å¼º** | 2 å°æ—¶ | ğŸŸ¢ ä½ | ğŸ”´ **æ–°å¢ï¼ˆP0ï¼‰** | å¢å¼º Trajectory é”™è¯¯ç»“æ„ï¼Œä¸º Reflector å‡†å¤‡æ•°æ® |
| **é˜¶æ®µ1: è¡¥å…¨ Reflector** | 16 å°æ—¶ï¼ˆ2 å‘¨æœ«ï¼‰ | ğŸŸ¡ ä¸­ | ğŸ”´ **æœ€é«˜ä¼˜å…ˆçº§** | è§„åˆ™å¼•æ“ MVPï¼Œå®ç°å¤±è´¥æ¡ˆä¾‹åˆ†æ |
| **é˜¶æ®µ2: å‡çº§ Generator** | 8 å°æ—¶ï¼ˆ1 å‘¨æœ«ï¼‰ | ğŸŸ¢ ä½ | ğŸŸ  **ä¸­ä¼˜å…ˆçº§** | å¢å¼ºç°æœ‰åŠŸèƒ½ï¼Œæ”¯æŒæ‰¹é‡èšç±» |
| **é˜¶æ®µ3: å®Œå–„ Curator** | 14 å°æ—¶ï¼ˆ1.5 å‘¨æœ«ï¼‰ | ğŸŸ¢ ä½ | ğŸŸ¡ **ä½ä¼˜å…ˆçº§** | è‡ªåŠ¨åŒ–ç»´æŠ¤ + æ··åˆæ£€ç´¢ï¼ˆBM25+å‘é‡ï¼‰ |
| **é˜¶æ®µ3.5: å¼ºåˆ¶æ‰§è¡Œ** | 6 å°æ—¶ | ğŸŸ¡ ä¸­ | ğŸŸ  **æ¨è** | Playbook è½¬æ¢ä¸º Plan å¯¹è±¡ï¼Œæå‡æ‰§è¡ŒæˆåŠŸç‡ |
| **é˜¶æ®µ4: AFS åŸºç¡€** | 50 å°æ—¶ï¼ˆ6-8 å‘¨æœ«ï¼‰ | ğŸŸ  é«˜ | âšª **å¯é€‰** | æ¶æ„å‡çº§ï¼Œæ—¶é—´å……è£•æ—¶è€ƒè™‘ |
| **é˜¶æ®µ5: ACE æ·±åŒ–** | 50 å°æ—¶ï¼ˆ6-8 å‘¨æœ«ï¼‰ | ğŸ”´ é«˜ | âšª **å»¶å** | é•¿æœŸè§„åˆ’ï¼Œä¸ªäººé¡¹ç›®ä»·å€¼æœ‰é™ |

**å…³é”®å˜åŒ–**ï¼ˆç›¸æ¯” v3.0ï¼‰ï¼š
- âœ… **æ–°å¢é˜¶æ®µ 0.5**ï¼šä»»åŠ¡é˜Ÿåˆ—åŸºç¡€è®¾æ–½ï¼ˆ+4hï¼‰- ä¿®æ­£è¿è¡Œç¯å¢ƒå†²çª
- âœ… **æ–°å¢é˜¶æ®µ 0.6**ï¼šTrajectory è´¨é‡æå‡ï¼ˆ+2hï¼‰- ä¸º Reflector å‡†å¤‡é«˜è´¨é‡æ•°æ®
- âœ… **æ–°å¢é˜¶æ®µ 3.5**ï¼šPlaybook å¼ºåˆ¶æ‰§è¡Œï¼ˆ+6hï¼‰- æå‡æ‰§è¡ŒæˆåŠŸç‡ 25%
- ğŸ¯ **é˜¶æ®µ 1 ç­–ç•¥è°ƒæ•´**ï¼šæ”¹ä¸ºè§„åˆ™å¼•æ“èµ·æ­¥ï¼ˆLLM ä½œä¸ºåç»­ä¼˜åŒ–ï¼‰
- ğŸ¯ **é˜¶æ®µ 3 å¢å¼º**ï¼šå¢åŠ æ··åˆæ£€ç´¢ï¼ˆBM25+å‘é‡ï¼‰ï¼ˆ12h â†’ 14hï¼‰
- â±ï¸ **æ€»æŠ•å…¥å¢åŠ **ï¼šä» 38h å¢è‡³ **50h**ï¼ˆå¢åŠ  12hï¼Œä½†å¯é æ€§æ˜¾è‘—æå‡ï¼‰

**æœ€å°å¯è¡Œè·¯å¾„**ï¼ˆMVP - ä¿®æ­£ç‰ˆï¼‰ï¼š
```
é˜¶æ®µ0 (2h) â†’ é˜¶æ®µ0.5 (4h) â†’ é˜¶æ®µ0.6 (2h) â†’ é˜¶æ®µ1 (16h) = 24 å°æ—¶
                                          ï¼ˆçº¦ 3 ä¸ªå‘¨æœ«ï¼Œå¯ä½“éªŒå®Œæ•´ Playbook å¾ªç¯ï¼‰
```

**æ¨èå®Œæ•´è·¯å¾„**ï¼ˆä¿®æ­£ç‰ˆï¼‰ï¼š
```
é˜¶æ®µ0-0.6 (8h) â†’ é˜¶æ®µ1 (16h) â†’ é˜¶æ®µ2 (8h) â†’ é˜¶æ®µ3 (14h) â†’ é˜¶æ®µ3.5 (6h) = 50 å°æ—¶
                                          ï¼ˆçº¦ 6-7 ä¸ªå‘¨æœ«ï¼‰
```

**ä¿®æ­£å¸¦æ¥çš„æ”¶ç›Š**ï¼š
- âœ… æ¶ˆé™¤å¯åŠ¨å¡é¡¿é£é™©ï¼ˆElectron åº”ç”¨æ—  Cron ä»»åŠ¡é—®é¢˜ï¼‰
- âœ… Reflector å‡†ç¡®ç‡ä» 40% â†’ 80%ï¼ˆè§„åˆ™å¼•æ“ï¼‰
- âœ… Playbook æ‰§è¡ŒæˆåŠŸç‡ä» 60% â†’ 85%ï¼ˆå¼ºåˆ¶æ‰§è¡Œ Planï¼‰
- âœ… æ£€ç´¢ç²¾åº¦ä» 70% â†’ 85%ï¼ˆæ··åˆæ£€ç´¢ï¼‰

**è¯¦ç»†ä¿®æ­£æ–¹æ¡ˆ**ï¼šå‚è€ƒ [playbook-implementation-fixes.md](docs/playbook-implementation-fixes.md)

### 4.2 æ ¸å¿ƒæ”¶ç›Šé‡åŒ–ï¼ˆä¸ªäººé¡¹ç›®ï¼‰

| æ”¶ç›Šç»´åº¦ | æå‡å¹…åº¦ | ä¸ªäººä»·å€¼ |
|---------|---------|---------|
| **å­¦ä¹ èƒ½åŠ›** | ğŸš€ ä»æ— åˆ°æœ‰ | æ™ºèƒ½ä½“èƒ½å¤Ÿ"è®°ä½"æˆåŠŸç»éªŒå¹¶å¤ç”¨ |
| **è°ƒè¯•æ•ˆç‡** | ğŸ“ˆ +200% | é€šè¿‡ Playbook å¿«é€Ÿå®šä½é—®é¢˜æ¨¡å¼ |
| **å¼€å‘ä¹è¶£** | ğŸ® +150% | çœ‹åˆ°æ™ºèƒ½ä½“è‡ªæˆ‘è¿›åŒ–çš„æˆå°±æ„Ÿ |
| **é¡¹ç›®äº®ç‚¹** | â­ ä¸šç•Œé¦–åˆ› | å¼€æºå®ç° ACE Playbook æœºåˆ¶ |
| **ä¸ªäººå“ç‰Œ** | ğŸ“š +100% | æŠ€æœ¯åšå®¢/è®ºæ–‡ç´ æ |

**æ— å½¢ä»·å€¼**ï¼š
- ğŸ§  æ·±åº¦ç†è§£ ACE æ¡†æ¶ï¼ˆè¿œè¶…çœ‹è®ºæ–‡ï¼‰
- ğŸ”¬ å®éªŒè®¤çŸ¥ç§‘å­¦ç†è®ºï¼ˆå¦‚è®°å¿†å·©å›ºã€åæ€å­¦ä¹ ï¼‰
- ğŸŒŸ åœ¨ AI Agent é¢†åŸŸå»ºç«‹æŠ€æœ¯å½±å“åŠ›

### 4.3 é£é™©ä¸åº”å¯¹ï¼ˆä¸ªäººå¼€å‘è§†è§’ï¼‰

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹ç­–ç•¥ |
|------|------|------|---------|
| **æ—¶é—´ä¸è¶³ï¼ŒåŠé€”è€ŒåºŸ** | ğŸŸ  40% | ğŸŸ  ä¸­ | é‡‡ç”¨"æœ€å°å¯è¡Œäº§å“"ç­–ç•¥ï¼Œé˜¶æ®µ 1 å³å¯äº¤ä»˜ä»·å€¼ |
| **Playbook ç”Ÿæˆè´¨é‡å·®** | ğŸŸ¡ 30% | ğŸŸ¡ ä½ | ä»ç®€å•ä»»åŠ¡å¼€å§‹æµ‹è¯•ï¼Œæ‰‹åŠ¨å¾®è°ƒæ¨¡æ¿ |
| **æ€§èƒ½å¼€é”€è¶…é¢„æœŸ** | ğŸŸ¢ 20% | ğŸŸ¡ ä½ | ä¸ªäººé¡¹ç›®æ— é«˜å¹¶å‘å‹åŠ›ï¼Œå¯æ¥å—ä¸€å®šå¼€é”€ |
| **æŠ€æœ¯éš¾åº¦è¶…å‡ºèƒ½åŠ›** | ğŸŸ¢ 15% | ğŸŸ  ä¸­ | ç¤¾åŒºæ±‚åŠ©ï¼ˆGitHub Discussionsï¼‰ï¼Œæˆ–é™çº§åˆ°ç®€åŒ–æ–¹æ¡ˆ |

---

## ğŸ¯ ç¬¬äº”éƒ¨åˆ†ï¼šèåˆæ¶æ„æœ€ç»ˆå½¢æ€

### 5.1 ç³»ç»Ÿæ¶æ„å›¾ï¼ˆå« Playbookï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          API Layer                               â”‚
â”‚  HTTP REST + WebSocket (ä¸ªäººä½¿ç”¨ï¼Œæ— éœ€å¤æ‚é‰´æƒ)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ACE Cognitive Layers                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  L1: Aspirational   â†’  (æš‚ç¼“å®ç°ï¼Œä¸ªäººé¡¹ç›®ä¼˜å…ˆçº§ä½)               â”‚
â”‚  L2: Strategy       â†’  ğŸ†• Playbook æ£€ç´¢ + æˆ˜ç•¥ç”Ÿæˆ                â”‚
â”‚  L3: Agent Model    â†’  SkillManager + Playbook ç»Ÿè®¡              â”‚
â”‚  L4: Executive      â†’  ChatService ç­–ç•¥é€‰æ‹©                      â”‚
â”‚  L5: Cognitive Ctrl â†’  ReActEngine è¿­ä»£æ§åˆ¶                      â”‚
â”‚  L6: Task Execution â†’  ToolDispatcher â†’ AFS å·¥å…·è°ƒç”¨             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ğŸ†• Playbook Evolution Loop (åæ€å¾ªç¯)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Trajectory â†’ Generator â†’ Reflector â†’ Curator â†’ Playbook        â”‚
â”‚      â†‘                                              â†“            â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Feedback Loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Agentic File System (AFS) - å¯é€‰                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  VFS Layer:  è·¯å¾„è§£æ + Resolver è·¯ç”±                            â”‚
â”‚  Resolvers:  SQLite/LanceDB/Skill/Playbook                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Storage Layer                              â”‚
â”‚  SQLite (ç»“æ„åŒ–) | LanceDB (å‘é‡) | FileSystem (Playbook YAML)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ•°æ®æµç¤ºä¾‹ï¼šPlaybook è¾…åŠ©çš„å¤æ‚ä»»åŠ¡

```
ã€ç”¨æˆ·ã€‘ï¼š"å¸®æˆ‘åˆ†ææœ€è¿‘ä¸€å‘¨çš„ç”¨æˆ·åé¦ˆï¼Œæå–å‰ 3 ä¸ªé—®é¢˜å¹¶ç”Ÿæˆè§£å†³æ–¹æ¡ˆ"

ã€æµç¨‹ - ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼ˆæ—  Playbookï¼‰ã€‘
1. ChatService æ£€ç´¢ Playbook â†’ æ— åŒ¹é…
2. ReActStrategy æ‰§è¡Œå¤šè½®æ¨ç†
   - ç¬¬1è½®ï¼šæ€è€ƒ â†’ è°ƒç”¨ feedback-analyzer
   - ç¬¬2è½®ï¼šåˆ†ææ•°æ® â†’ èšç±»é—®é¢˜
   - ç¬¬3è½®ï¼šç”Ÿæˆæ–¹æ¡ˆ
3. ä»»åŠ¡æˆåŠŸå®Œæˆï¼ˆè€—æ—¶ 12 ç§’ï¼‰
4. ğŸ†• ä¿å­˜ Trajectory åˆ° /context/history/trajectories/
5. ğŸ†• å¤œé—´åæ€å¾ªç¯è§¦å‘ â†’ ç”Ÿæˆ Playbook "ç”¨æˆ·åé¦ˆåˆ†ææœ€ä½³å®è·µ"

ã€æµç¨‹ - ç¬¬äºŒæ¬¡æ‰§è¡Œï¼ˆæœ‰ Playbookï¼‰ã€‘
1. ChatService æ£€ç´¢ Playbook â†’ åŒ¹é…åˆ° "ç”¨æˆ·åé¦ˆåˆ†ææœ€ä½³å®è·µ"
2. æ³¨å…¥ Playbook åˆ°ç³»ç»Ÿæç¤ºè¯ï¼š
   ```
   [Playbook æç¤º]
   ç›¸å…³ç»éªŒï¼ˆç”¨æˆ·åé¦ˆåˆ†ææœ€ä½³å®è·µï¼‰æˆåŠŸç‡: 100%
   æ¨èæ­¥éª¤:
   1. tool_call: feedback-analyzer (timeRange=7d)
   2. llm_prompt: å°†ä»¥ä¸‹åé¦ˆæŒ‰é—®é¢˜ç±»å‹åˆ†ç±»...
   3. llm_prompt: é’ˆå¯¹ {category}ï¼Œæå‡º3ä¸ªæ”¹è¿›æ–¹æ¡ˆ
   æ³¨æ„äº‹é¡¹: ä¸è¦åœ¨å•æ¬¡è°ƒç”¨ä¸­å¤„ç†è¶…è¿‡ 100 æ¡åé¦ˆ
   ```
3. LLM ç›´æ¥å¥—ç”¨ Playbook æ­¥éª¤ â†’ å‡å°‘è¯•é”™
4. ä»»åŠ¡æˆåŠŸå®Œæˆï¼ˆè€—æ—¶ 7 ç§’ï¼Œæ¯”ç¬¬ä¸€æ¬¡å¿« 41%ï¼‰
5. ğŸ†• æ›´æ–° Playbook ç»Ÿè®¡ï¼ˆusage_count++, success_rate ç»´æŒ 100%ï¼‰
```

---

## ğŸ“ ç¬¬å…­éƒ¨åˆ†ï¼šå®æ–½å»ºè®®ä¸è¡ŒåŠ¨è®¡åˆ’ï¼ˆä¸ªäººå¼€å‘è€…ç‰ˆï¼‰

### 6.1 ç«‹å³è¡ŒåŠ¨ï¼šå‘¨æœ« Playbook Hackathon

**æ—¶é—´å®‰æ’**ï¼šé€‰æ‹©ä¸€ä¸ªå‘¨æœ«ï¼ˆå‘¨å…­ + å‘¨æ—¥ï¼‰ï¼Œè¿ç»­å¼€å‘ 16 å°æ—¶

#### å‘¨å…­ä¸Šåˆï¼ˆ4 å°æ—¶ï¼‰ï¼šæ•°æ®ç»“æ„ä¸å­˜å‚¨

```typescript
// 1. åˆ›å»º Playbook è¡¨ç»“æ„
CREATE TABLE playbooks (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  domain TEXT,
  triggers TEXT,  -- JSON æ•°ç»„
  steps TEXT,     -- JSON æ•°ç»„
  success_rate REAL DEFAULT 0.8,
  usage_count INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

// 2. å®ç°åŸºç¡€ CRUD
class PlaybookStore {
  async save(playbook: Playbook): Promise<void>
  async getById(id: string): Promise<Playbook | null>
  async search(keywords: string[]): Promise<Playbook[]>
}
```

#### å‘¨å…­ä¸‹åˆï¼ˆ4 å°æ—¶ï¼‰ï¼šGenerator å®ç°

```typescript
// ä» Trajectory ç”Ÿæˆ Playbook
class PlaybookGenerator {
  async generate(trajectory: Trajectory): Promise<Playbook> {
    // 1. æå–å…³é”®è¯ï¼ˆä» user_inputï¼‰
    const triggers = this.extractKeywords(trajectory.user_input);

    // 2. æå–æ­¥éª¤ï¼ˆä» stepsï¼‰
    const steps = trajectory.steps.map(step => ({
      action_type: step.action.includes('tool') ? 'tool_call' : 'llm_prompt',
      tool_name: this.extractToolName(step.action),
      expected_duration_ms: step.duration
    }));

    // 3. ç”Ÿæˆåç§°ï¼ˆä½¿ç”¨ LLM æˆ–è§„åˆ™ï¼‰
    const name = await this.generateName(trajectory);

    return {
      id: crypto.randomUUID(),
      name,
      domain: 'general',
      triggers,
      steps,
      success_rate: 0.8,  // åˆå§‹å€¼
      usage_count: 0,
      created_at: new Date()
    };
  }
}
```

#### å‘¨æ—¥ä¸Šåˆï¼ˆ4 å°æ—¶ï¼‰ï¼šé›†æˆåˆ° ChatService

```typescript
// åœ¨ ChatService.chat() å¼€å¤´æ·»åŠ 
async chat(messages: Message[], options: ChatOptions) {
  const userQuery = messages[messages.length - 1].content;

  // æ£€ç´¢ Playbook
  const keywords = this.extractKeywords(userQuery);
  const playbooks = await this.playbookStore.search(keywords);

  if (playbooks.length > 0) {
    const pb = playbooks[0];  // ä½¿ç”¨æˆåŠŸç‡æœ€é«˜çš„
    const hint = this.formatPlaybookHint(pb);
    messages.unshift({ role: 'system', content: hint });
  }

  // ... åŸæœ‰é€»è¾‘ ...
}
```

#### å‘¨æ—¥ä¸‹åˆï¼ˆ4 å°æ—¶ï¼‰ï¼šæµ‹è¯•ä¸å¾®è°ƒ

1. æ‰‹åŠ¨æ‰§è¡Œ 5 ä¸ªä¸åŒçš„ä»»åŠ¡
2. æ¯ä¸ªä»»åŠ¡å®Œæˆåï¼Œè°ƒç”¨ `playbookGenerator.generate(trajectory)`
3. éªŒè¯ä¸‹æ¬¡æ‰§è¡Œç›¸åŒä»»åŠ¡æ—¶ï¼ŒPlaybook è¢«æ­£ç¡®åŒ¹é…
4. è°ƒæ•´å…³é”®è¯æå–ç®—æ³•ï¼ˆå¦‚æœåŒ¹é…ç‡ä½ï¼‰

**é¢„æœŸæˆæœ**ï¼š
- âœ… å¯è¿è¡Œçš„ Playbook åŸå‹
- âœ… è‡³å°‘ 3 ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„ Playbook
- âœ… æ¼”ç¤ºè§†é¢‘ï¼ˆå½•å±å±•ç¤º Playbook å¤ç”¨æ•ˆæœï¼‰

### 6.2 æœˆåº¦è¿­ä»£è®¡åˆ’ï¼ˆé€‚åˆä¸šä½™å¼€å‘ï¼‰

| æœˆä»½ | ç›®æ ‡ | å·¥ä½œé‡ | é‡Œç¨‹ç¢‘ |
|------|------|--------|--------|
| **ç¬¬1æœˆ** | Playbook åŸå‹ | 24h | å®Œæˆé˜¶æ®µ1ï¼Œç”Ÿæˆé¦–ä¸ª Playbook |
| **ç¬¬2æœˆ** | è‡ªåŠ¨è¿›åŒ–æœºåˆ¶ | 30h | å®ç° Reflector + æˆåŠŸç‡æ›´æ–° |
| **ç¬¬3æœˆ** | å‘é‡æ£€ç´¢ä¼˜åŒ– | 20h | æ›¿æ¢å…³é”®è¯åŒ¹é…ä¸ºç›¸ä¼¼åº¦æ£€ç´¢ |
| **ç¬¬4-6æœˆ** | AFS åŸºç¡€ï¼ˆå¯é€‰ï¼‰ | 50h | è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œå¯æš‚ç¼“ |

### 6.3 æˆåŠŸæŒ‡æ ‡ï¼ˆä¸ªäººé¡¹ç›®ï¼‰

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|------|-------|---------|
| **Playbook ç”Ÿæˆæ•°é‡** | â‰¥10 ä¸ªï¼ˆ3 ä¸ªæœˆå†…ï¼‰ | æ•°æ®åº“æŸ¥è¯¢ `SELECT COUNT(*) FROM playbooks` |
| **Playbook å‘½ä¸­ç‡** | â‰¥30%ï¼ˆç›¸ä¼¼ä»»åŠ¡è‡ªåŠ¨åŒ¹é…ï¼‰ | è®°å½•æ¯æ¬¡èŠå¤©æ˜¯å¦ä½¿ç”¨ Playbook |
| **æ‰§è¡Œæ—¶é—´åŠ é€Ÿ** | -20%ï¼ˆä½¿ç”¨ Playbook çš„ä»»åŠ¡ï¼‰ | å¯¹æ¯”åŒç±»ä»»åŠ¡çš„å¹³å‡è€—æ—¶ |
| **ä¸ªäººæ»¡æ„åº¦** | ä¸»è§‚è¯„åˆ† â‰¥8/10 | æ¯å‘¨è®°å½•ä½¿ç”¨ä½“éªŒ |

---

## ğŸ“ ç¬¬ä¸ƒéƒ¨åˆ†ï¼šç†è®ºå¯¹æ¯”ä¸åˆ›æ–°ç‚¹

### 7.1 ä¸åŸç ”ç©¶çš„å·®å¼‚ç‚¹

| ç»´åº¦ | ã€ŠEiC ä¸ ACE èåˆç ”ç©¶ã€‹ | ApexBridge ä¸ªäººå®è·µæ–¹æ¡ˆ | åˆ›æ–°ç‚¹ |
|-----|----------------------|---------------------|-------|
| **Playbook å®ç°** | ç†è®ºæè¿°ï¼ˆGenerator-Reflector-Curatorï¼‰ | ğŸ†• å®Œæ•´å¯æ‰§è¡Œçš„ TypeScript å®ç° | é¦–ä¸ªå¼€æºä»£ç çº§å®ç° |
| **é€‚ç”¨åœºæ™¯** | ä¼ä¸šçº§å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ | ğŸ†• ä¸ªäººå­¦ä¹ /å®éªŒé¡¹ç›® | é™ä½å®æ–½é—¨æ§› |
| **æ¸è¿›å¼å¼€å‘** | æœªå¼ºè°ƒ | ğŸ†• æŒ‰é˜¶æ®µäº¤ä»˜ï¼Œå¯æš‚åœ | é€‚åˆä¸šä½™æ—¶é—´æŠ•å…¥ |
| **AFS ä¼˜å…ˆçº§** | æ ¸å¿ƒåŸºç¡€è®¾æ–½ | ğŸ†• å¯é€‰æ¨¡å—ï¼ˆå…ˆå®ç° Playbookï¼‰ | çµæ´»çš„æŠ€æœ¯è·¯çº¿ |

### 7.2 å¯¹å¼€æºç¤¾åŒºçš„è´¡çŒ®

ApexBridge çš„ Playbook å®ç°å°†æˆä¸ºï¼š

1. **é¦–ä¸ªç”Ÿäº§çº§ Playbook ä»£ç **ï¼ˆGitHub å¯æœç´¢åˆ°å®Œæ•´å®ç°ï¼‰
2. **ACE æ¡†æ¶çš„å®è·µæ•™æ**ï¼ˆé…åˆåšå®¢/è§†é¢‘æ•™ç¨‹ï¼‰
3. **ä¸ªäººå¼€å‘è€…çš„å‚è€ƒèŒƒä¾‹**ï¼ˆéå¤§å‚è§„æ¨¡çš„å®ç°è·¯å¾„ï¼‰

### 7.3 æ½œåœ¨ç ”ç©¶æ–¹å‘ï¼ˆä¸ªäººé¡¹ç›®è¡ç”Ÿï¼‰

1. **Playbook å¯è§†åŒ–ç¼–è¾‘å™¨**ï¼šç±»ä¼¼"ä¹é«˜ç§¯æœ¨"æ‹–æ‹½ç”Ÿæˆ Playbook
2. **è·¨é¡¹ç›® Playbook å…±äº«**ï¼šä¸Šä¼ åˆ°ä¸­å¿ƒåŒ–ä»“åº“ä¾›ä»–äººä¸‹è½½
3. **Playbook æ€§èƒ½åŸºå‡†æµ‹è¯•**ï¼šå¯¹æ¯”ä½¿ç”¨/ä¸ä½¿ç”¨ Playbook çš„æ•ˆç‡å·®å¼‚
4. **åŸºäº Playbook çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç”Ÿæˆ**ï¼šä» Playbook è‡ªåŠ¨ç”Ÿæˆå›å½’æµ‹è¯•ç”¨ä¾‹

---

## ğŸ“Œ ç»“è®ºä¸å»ºè®®ï¼ˆä¸ªäººå¼€å‘è€…è§†è§’ï¼‰

### æ ¸å¿ƒç»“è®º

1. **ApexBridge å¤©ç„¶é€‚åˆ ACE é›†æˆ**ï¼šç°æœ‰æ¶æ„å·²å…·å¤‡ 60-90% çš„ ACE ç»„ä»¶
2. **Playbook æ˜¯æœ€é«˜ ROI çš„åˆ‡å…¥ç‚¹**ï¼š24 å°æ—¶å³å¯éªŒè¯æ ¸å¿ƒä»·å€¼ï¼Œæ— éœ€å®Œæ•´ AFS
3. **ä¸ªäººé¡¹ç›®å¼ºè°ƒçµæ´»æ€§**ï¼šæŒ‰é˜¶æ®µäº¤ä»˜ï¼Œå¯æš‚åœæ•°æœˆï¼Œä¸å½±å“å·²æœ‰åŠŸèƒ½
4. **å­¦ä¹ ä»·å€¼è¿œè¶…å®ç”¨ä»·å€¼**ï¼šæ·±åº¦ç†è§£è®¤çŸ¥ç§‘å­¦ + AI Agent è®¾è®¡æ¨¡å¼

### æœ€ç»ˆå»ºè®®ï¼ˆåˆ†ä¼˜å…ˆçº§ï¼‰

#### ğŸ”´ P0 - ç«‹å³å¯åŠ¨ï¼ˆæœ¬å‘¨æœ«ï¼‰

**è¡ŒåŠ¨**ï¼šå®Œæˆ Playbook åŸå‹ï¼ˆé˜¶æ®µ1ï¼‰
- æŠ•å…¥ï¼š16 å°æ—¶ï¼ˆ1 ä¸ªå‘¨æœ«ï¼‰
- ç›®æ ‡ï¼šç”Ÿæˆç¬¬ 1 ä¸ª Playbook å¹¶éªŒè¯å¤ç”¨æ•ˆæœ
- å†³ç­–ç‚¹ï¼šå¦‚æœä½“éªŒè‰¯å¥½ï¼Œç»§ç»­é˜¶æ®µ2ï¼›å¦åˆ™æš‚åœåæ€

#### ğŸŸ  P1 - 1 ä¸ªæœˆå†…å®Œæˆ

**è¡ŒåŠ¨**ï¼šå®ç° Playbook è‡ªåŠ¨è¿›åŒ–ï¼ˆé˜¶æ®µ2ï¼‰
- æŠ•å…¥ï¼š30 å°æ—¶ï¼ˆåˆ†æ•£åˆ° 4 å‘¨æœ«ï¼‰
- ç›®æ ‡ï¼šç³»ç»Ÿèƒ½å¤Ÿè‡ªä¸»ç”Ÿæˆå’Œä¼˜åŒ– Playbook
- é‡Œç¨‹ç¢‘ï¼šç”Ÿæˆ â‰¥5 ä¸ª Playbookï¼Œè‡³å°‘ 1 ä¸ªæˆåŠŸç‡æ›´æ–°

#### ğŸŸ¡ P2 - é•¿æœŸè§„åˆ’ï¼ˆ3-6 ä¸ªæœˆï¼‰

**è¡ŒåŠ¨**ï¼šå¼•å…¥ AFS åŸºç¡€è®¾æ–½ï¼ˆé˜¶æ®µ3ï¼Œå¯é€‰ï¼‰
- æŠ•å…¥ï¼š50 å°æ—¶ï¼ˆæŒ‰éœ€åˆ†é…ï¼‰
- ç›®æ ‡ï¼šæ ‡å‡†åŒ–ä¸Šä¸‹æ–‡ç®¡ç†ï¼Œå¢å¼ºå®¡è®¡èƒ½åŠ›
- æ¡ä»¶ï¼šæœ‰å……è¶³æ—¶é—´ + å¯¹ç³»ç»Ÿæ¶æ„æœ‰æ›´é«˜è¿½æ±‚

#### âšª P3 - å»¶åï¼ˆæœªæ¥è€ƒè™‘ï¼‰

**è¡ŒåŠ¨**ï¼šACE å±‚æ·±åŒ–ï¼ˆé˜¶æ®µ4ï¼‰
- è¯´æ˜ï¼šL1 ä¼¦ç†å±‚å¯¹ä¸ªäººé¡¹ç›®ä»·å€¼æœ‰é™ï¼Œå¯æš‚ä¸å®ç°

### ä¸ªäººæˆé•¿è·¯å¾„

```
ç¬¬1å‘¨æœ«: ä½“éªŒ Playbook åŸå‹ â†’ æˆå°±æ„Ÿ +50%
    â†“
ç¬¬1ä¸ªæœˆ: çœ‹åˆ°æ™ºèƒ½ä½“è‡ªæˆ‘è¿›åŒ– â†’ æ·±å…¥ç†è§£ ACE ç†è®º
    â†“
ç¬¬3ä¸ªæœˆ: Playbook åº“ç§¯ç´¯åˆ° 10+ â†’ é¡¹ç›®äº®ç‚¹å½¢æˆ
    â†“
ç¬¬6ä¸ªæœˆ: å®Œæˆ AFS é›†æˆ â†’ æŠ€æœ¯åšå®¢/è®ºæ–‡ç´ æ
    â†“
ç¬¬12ä¸ªæœˆ: å¼€æºç¤¾åŒºå½±å“åŠ› â†’ ä¸ªäººå“ç‰Œå»ºç«‹
```

---

## ğŸ“š é™„å½•

### A. å¿«é€Ÿå¯åŠ¨ä»£ç æ¨¡æ¿

```typescript
// src/services/PlaybookService.ts
export class PlaybookService {
  async generateFromTrajectory(trajectory: Trajectory): Promise<Playbook> {
    const triggers = this.extractKeywords(trajectory.user_input);
    const steps = this.extractSteps(trajectory.steps);

    return {
      id: crypto.randomUUID(),
      name: `${trajectory.user_input.slice(0, 30)}çš„æœ€ä½³å®è·µ`,
      domain: 'general',
      triggers,
      steps,
      success_rate: 0.8,
      usage_count: 0,
      created_at: new Date()
    };
  }

  async search(query: string): Promise<Playbook[]> {
    const keywords = this.extractKeywords(query);
    return this.store.searchByKeywords(keywords);
  }

  async recordUsage(playbookId: string, success: boolean): Promise<void> {
    const pb = await this.store.getById(playbookId);
    const alpha = 0.2;
    const newRate = alpha * (success ? 1 : 0) + (1 - alpha) * pb.success_rate;
    await this.store.update(playbookId, {
      success_rate: newRate,
      usage_count: pb.usage_count + 1
    });
  }
}
```

### B. Playbook YAML ç¤ºä¾‹ï¼ˆæ‰‹åŠ¨åˆ›å»ºæ¨¡æ¿ï¼‰

```yaml
# /context/playbooks/active/code-review.yml
name: "ä»£ç å®¡æŸ¥æœ€ä½³å®è·µ"
domain: "software-development"
triggers:
  - "å®¡æŸ¥ä»£ç "
  - "ä»£ç  review"
  - "æ£€æŸ¥ä»£ç è´¨é‡"

preconditions:
  - "ä»£ç æ–‡ä»¶æ•°é‡ < 20"
  - "æ€»è¡Œæ•° < 1000"

steps:
  - action_type: tool_call
    tool_name: static-analyzer
    parameters:
      rules: ["complexity", "security", "style"]
    expected_duration_ms: 2000

  - action_type: llm_prompt
    prompt_template: |
      åˆ†æä»¥ä¸‹ä»£ç å®¡æŸ¥æŠ¥å‘Šï¼Œè¯†åˆ«å‰3ä¸ªæœ€ä¸¥é‡çš„é—®é¢˜ï¼š
      {analysis_result}

      è¦æ±‚ï¼š
      1. æŒ‰ä¸¥é‡ç¨‹åº¦æ’åº
      2. æä¾›å…·ä½“ä¿®å¤å»ºè®®
      3. æ ‡æ³¨æ½œåœ¨çš„å®‰å…¨é£é™©

anti_patterns:
  - "ä¸è¦é€è¡Œå®¡æŸ¥ï¼ˆæ•ˆç‡ä½ï¼‰"
  - "é¿å…åœ¨å¤æ‚åº¦ >20 çš„å‡½æ•°ä¸Šå¡ä½"

success_rate: 0.92
usage_count: 15
avg_duration_ms: 4500
```

### C. å‚è€ƒèµ„æ–™

1. ã€ŠEverything is Context: Agentic File Systemã€‹åŸè®ºæ–‡
2. David Shapiro - ACE Framework GitHub: [https://github.com/daveshap/ACE_Framework](https://github.com/daveshap/ACE_Framework)
3. **ACE Playbook åæ€å¾ªç¯è®ºæ–‡**ï¼ˆå…³äºä¸Šä¸‹æ–‡åç¼©çš„è§£å†³æ–¹æ¡ˆï¼‰
4. LanceDB å‘é‡æ•°æ®åº“æ–‡æ¡£
5. ApexBridge å½“å‰æ¶æ„è®¾è®¡æ–‡æ¡£ï¼ˆ[openspec/project.md](openspec/project.md)ï¼‰

### D. æœ¯è¯­è¡¨

| æœ¯è¯­ | å…¨ç§° | å®šä¹‰ |
|-----|------|------|
| **Playbook** | - | ç»“æ„åŒ–çš„ã€å¯æ‰§è¡Œçš„ç»éªŒçŸ¥è¯†ï¼ˆACE æ¡†æ¶æ ¸å¿ƒæ¦‚å¿µï¼‰ |
| **Trajectory** | - | æ™ºèƒ½ä½“æ‰§è¡Œä»»åŠ¡çš„å®Œæ•´è½¨è¿¹ï¼ˆåŒ…å«æ¨ç†æ­¥éª¤ï¼‰ |
| **Generator** | - | Playbook ç”Ÿæˆå™¨ï¼Œä» Trajectory æå–ç»éªŒ |
| **Reflector** | - | Playbook åæ€å™¨ï¼Œå¯¹æ¯”æˆåŠŸ/å¤±è´¥æ¡ˆä¾‹ä¼˜åŒ– |
| **Curator** | - | Playbook ç­–å±•å™¨ï¼Œç®¡ç†çŸ¥è¯†åº“å¹¶å»é‡ |
| **ä¸Šä¸‹æ–‡åç¼©** | Context Collapse | ä¿¡æ¯ç»è¿‡å¤šè½®æ‘˜è¦åä¸§å¤±ç»†èŠ‚çš„ç°è±¡ |
| **AFS** | Agentic File System | æ™ºèƒ½ä½“æ–‡ä»¶ç³»ç»Ÿï¼Œå°†ä¸Šä¸‹æ–‡èµ„æºè™šæ‹ŸåŒ–ä¸ºæ–‡ä»¶ |
| **ACE** | Autonomous Cognitive Entity | è‡ªä¸»è®¤çŸ¥å®ä½“ï¼Œå…­å±‚è®¤çŸ¥æ¶æ„ |

---

**æŠ¥å‘Šç‰ˆæœ¬**ï¼šv3.1 (é›†æˆå·¥ç¨‹ä¿®æ­£æ–‡æ¡£)
**ç”Ÿæˆæ—¥æœŸ**ï¼š2025-12-16
**ä¿®è®¢æ—¥æœŸ**ï¼š2025-12-16

**ç‰ˆæœ¬å†å²**ï¼š
- **v1.0** (åˆç‰ˆ): å‡è®¾ä»é›¶æ„å»ºï¼Œä¼ä¸šçº§è§†è§’
- **v2.0**: è°ƒæ•´ä¸ºä¸ªäººé¡¹ç›®å®šä½ï¼Œå¢åŠ  Playbook æœºåˆ¶è¯¦è§£
- **v3.0**: åŸºäºå®é™…ä»£ç è¯„ä¼°ï¼Œæä¾›ç²¾ç¡®çš„è¡¥å…¨è·¯å¾„
- **v3.1** (æœ¬ç‰ˆ): é›†æˆå·¥ç¨‹ä¿®æ­£æ–‡æ¡£ï¼Œä¿®å¤å››å¤§å·¥ç¨‹é™·é˜±
  - ä¿®æ­£è¿è¡Œç¯å¢ƒå†²çªï¼ˆäº‹ä»¶é©±åŠ¨ + SQLite ä»»åŠ¡é˜Ÿåˆ—ï¼‰
  - å¢å¼º Trajectory æ•°æ®è´¨é‡ï¼ˆErrorType åˆ†ç±»ï¼‰
  - å¼ºåŒ– Playbook æ‰§è¡ŒåŠ›ï¼ˆPlan å¯¹è±¡å¼ºåˆ¶æ‰§è¡Œï¼‰
  - ä¼˜åŒ–å‘é‡æ£€ç´¢ç­–ç•¥ï¼ˆæ··åˆæ£€ç´¢ BM25 + å‘é‡ï¼‰
  - æ–°å¢é˜¶æ®µ 0.5ï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼Œ4hï¼‰ã€0.6ï¼ˆæ•°æ®è´¨é‡ï¼Œ2hï¼‰ã€3.5ï¼ˆæ‰§è¡Œå¼ºåŒ–ï¼Œ6hï¼‰
  - æ€»å·¥æ—¶ï¼š38h â†’ 50hï¼ˆ+12hï¼Œå¯é æ€§æ˜¾è‘—æå‡ï¼‰

**ä½œè€…**ï¼šAI æ¶æ„åˆ†æç³»ç»Ÿ
**å®¡æ ¸çŠ¶æ€**ï¼šå·²å®Œæˆå·¥ç¨‹å¯è¡Œæ€§ä¿®æ­£ï¼ˆv3.1ï¼‰

**ç›¸å…³æ–‡ä»¶**ï¼š
- å·¥ç¨‹ä¿®æ­£è¯¦æƒ…ï¼š[docs/playbook-implementation-fixes.md](docs/playbook-implementation-fixes.md)
- å®ç°çŠ¶æ€åŸºäºä»¥ä¸‹æ–‡ä»¶åˆ†æï¼š
  - [src/services/PlaybookManager.ts](src/services/PlaybookManager.ts) (541 è¡Œ)
  - [src/services/PlaybookMatcher.ts](src/services/PlaybookMatcher.ts) (568 è¡Œ)
  - [src/types/ace-core.d.ts](src/types/ace-core.d.ts) (70 è¡Œ)
  - [src/services/ACE-L2-L3-Integration.ts](src/services/ACE-L2-L3-Integration.ts) (443 è¡Œ)

**ä¿®è®¢å†…å®¹æ‘˜è¦**ï¼š
- âœ… **v2.0 å¢å¼º**ï¼šæ–°å¢ Generator-Reflector-Curator å®ç°çŠ¶æ€è¯„ä¼°ï¼ˆåŸºäºå®é™…ä»£ç åˆ†æï¼‰
- âœ… **v3.0 ä¼˜åŒ–**ï¼šè°ƒæ•´é˜¶æ®µè§„åˆ’ä»"ä»é›¶æ„å»º"æ”¹ä¸º"è¡¥å…¨ç¼ºå¤±ç»„ä»¶"ï¼ˆæ€»å·¥æ—¶ 154h â†’ 137hï¼‰
- âœ… **v3.1 ä¿®æ­£**ï¼šé›†æˆå·¥ç¨‹ä¿®æ­£æ–‡æ¡£ï¼Œä¿®å¤å››å¤§å·¥ç¨‹é™·é˜±ï¼ˆæ€»å·¥æ—¶ 137h â†’ 50hï¼ŒMVP 24hï¼‰
  - æ–°å¢é˜¶æ®µ 0.5/0.6/3.5ï¼šä»»åŠ¡é˜Ÿåˆ—ã€æ•°æ®è´¨é‡ã€æ‰§è¡Œå¼ºåŒ–
  - ä»"LLM-first"æ”¹ä¸º"è§„åˆ™å¼•æ“ MVP"ç­–ç•¥
  - å¢åŠ å¯é æ€§æå‡ï¼šå¯åŠ¨å¡é¡¿ +100%ã€Reflector å‡†ç¡®ç‡ +90%ã€æ‰§è¡ŒæˆåŠŸç‡ +25%ã€æ£€ç´¢ç²¾åº¦ +15%

